{"version":3,"sources":["diva.prefix","utils.js","diva.js","autoscroll.js","canvas.js","download.js","highlight.js","iiif-highlight.js","iiif-metadata.js","pagealias.js"],"names":["factory","localJQuery","module","exports","require","e","jQuery","Storage","prototype","setObject","key","value","this","setItem","JSON","stringify","getObject","getItem","parse","$","counter","generateId","suffix","generatedId","document","getElementById","getScrollbarWidth","inner","createElement","style","width","height","outer","position","top","left","visibility","overflow","appendChild","body","w1","offsetWidth","w2","clientWidth","removeChild","getHashParam","hash","window","location","startIndex","indexOf","length","endIndex","decodeURIComponent","substring","updateHashParam","originalValue","startThing","replace","fn","dragscrollable","options","settings","extend","dragSelector","acceptPropagatedEvent","preventDefault","dragscroll","mouseDownHandler","event","which","data","target","lastCoord","clientX","clientY","add","mouseUpHandler","mouseMoveHandler","delta","scrollable","scrollLeft","scrollTop","remove","each","find","bind","ACTIVE_CLASS","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","setTimeout","support","touch","Kinetic","el","$el","_initElements","DATA_KEY","DEFAULTS","cursor","decelerate","triggerHardware","threshold","y","x","slowdown","maxvelocity","throttleFPS","invert","movingClass","up","down","right","deceleratingClass","start","velocity","velocityY","_move","end","stop","isFunction","stopped","call","detach","_detachListeners","removeClass","css","attach","hasClass","_attachListeners","addClass","xpos","prevXPos","ypos","prevYPos","mouseDown","throttleTimeout","lastMove","elementFocused","mouseup","proxy","_resetMouse","click","_initEvents","-webkit-transform","-webkit-perspective","-webkit-backface-visibility","self","events","touchStart","_useTarget","originalEvent","touches","_threshold","_start","stopPropagation","touchMove","_inputmove","inputDown","nodeName","inputEnd","_end","inputMove","scroll","moved","inputClick","Math","abs","dragStart","selectStart","apply","arguments","$this","Date","getTime","movedX","movedY","sqrt","blur","focus","_calculateVelocities","_setMoveClasses","_capVelocity","filterTarget","_decelerateVelocity","floor","max","newVelocity","classes","$scroller","_getScroller","scroller","scrollWidth","scrollHeight","moving","is","mousedown","mousemove","unbind","kinetic","option","callOptions","instance","diva","cache","pub","Events","publish","topic","args","scope","thisTopic","global","thisTopicGlobal","i","getInstanceId","instanceID","thisTopicInstance","j","subscribe","push","handle","unsubscribe","completely","t","topicArray","splice","unsubscribeAll","topics","Object","keys","activeDivaController","active","on","updateActive","nearestOuter","idx","findOuter","closestOuter","closest","outers","getElementsByClassName","outerLen","parentElement","deactivate","parent","activate","getAttribute","attr","getActive","divaPlugins","Diva","parentObject","defaults","adaptivePadding","arrowScrollAmount","blockMobileMove","objectData","enableAutoTitle","enableFilename","enableFullscreen","enableGotoPage","enableGridIcon","enableGridControls","enableImageTitles","enableKeyScroll","enableLinkIcon","enableSpaceScroll","enableToolbar","enableZoomControls","fixedPadding","fixedHeightGrid","goDirectlyTo","iipServerURL","inFullscreen","inBookLayout","inGrid","imageDir","maxPagesPerRow","maxZoomLevel","minPagesPerRow","minZoomLevel","pageLoadTimeout","pagesPerRow","rowLoadTimeout","throbberTimeout","tileHeight","tileWidth","toolbarParentObject","verticallyOriented","viewportMargin","zoomLevel","globals","allTilesLoaded","averageHeights","averageWidths","currentPageIndex","unclampedVerticalPadding","doubleClickZoom","documentPaged","firstPageLoaded","firstRowLoaded","gridPageWidth","hashParamSuffix","horizontalOffset","horizontalPadding","ID","initialKeyScroll","initialSpaceScroll","innerObject","innerElement","isActiveDiva","isScrollable","isIIIF","itemTitle","isZooming","lastPageLoaded","lastRowLoaded","loaded","loadedTiles","maxWidths","maxHeights","maxRatio","minRatio","mobileWebkit","numPages","numRows","oldZoomLevel","outerObject","outerElement","pages","pageLeftOffsets","pagePreloadCanvases","pageTopOffsets","pageTimeouts","pageTools","panelHeight","panelWidth","plugins","previousLeftScroll","previousTopScroll","previousZoomLevelCanvases","realMaxZoom","resizeTimer","rowHeight","previousZoomRatio","scaleWait","scrollbarWidth","selector","singleClick","singleTap","throbberTimeoutID","toolbar","totalHeights","totalHeight","totalWidths","totalWidth","verticalOffset","verticalPadding","getPageData","pageIndex","attribute","d","getPageIndex","filename","np","f","isHorizontallyInViewport","viewportLeft","viewportRight","leftOfViewport","rightOfViewport","leftVisible","middleVisible","rightVisible","isVerticallyInViewport","bottom","viewportTop","viewportBottom","topOfViewport","bottomOfViewport","topVisible","bottomVisible","isTileVisible","tileRow","tileCol","tileTop","tileLeft","tileBottom","tileRight","isTileLoaded","tileIndex","isPageValid","isPageVisible","topOfPage","bottomOfPage","leftOfPage","rightOfPage","isPageLoaded","loadTiles","canvasElement","getDrawTileFunction","currentTile","context","drawImage","getContext","showError","error","row","col","imageURL","regionHeight","regionWidth","xOffset","yOffset","zoomDifference","imdir","rows","ceil","cols","maxZoom","m","baseURL","lastHeight","lastWidth","version","quality","iiifSuffix","baseImageURL","url","pow","api","hasOwnProperty","xoffset","yoffset","Image","crossOrigin","onload","src","loadPageTiles","pageSelector","pageElement","loadPage","paged","isPreloaded","heightFromTop","widthFromLeft","id","classList","setAttribute","title","innerHTML","undefined","placeholderElement","border","background","mozBoxSizing","webkitBoxSizing","boxSizing","preloadPage","pageCanvas","oldCanvas","newCanvasContext","deletePage","theNode","firstChild","parentNode","pageAboveViewport","pageBelowViewport","pageLeftOfViewport","pageRightOfViewport","pageBeforeViewport","pageAfterViewport","attemptPageShow","direction","attemptPageHide","adjustPages","setCurrentPage","lpl","scrollSoFar","isRowValid","rowIndex","isRowVisible","topOfRow","bottomOfRow","isRowLoaded","loadRow","innerElem","rowDiv","realWidth","realHeight","pageWidth","pageHeight","leftOffset","ppr","parseInt","encodeURI","pageDiv","addPageToQueue","deleteRow","rowAboveViewport","rowBelowViewport","attemptRowShow","attemptRowHide","adjustRows","setCurrentRow","newTopScroll","loadFunction","imgEl","getClosestVisiblePage","totalPages","currentPage","pageToConsider","middleOfViewport","verticalMiddleOfViewport","changeCurrentPage","isValidPagePosition","isScrolledToRight","bookDirection","bookPageToConsider","currentRow","rowToConsider","topScroll","changeCurrentRow","gotoPageTop","getYOffset","getXOffset","gotoPage","calculateDesiredScroll","desiredVerticalCenter","desiredTop","desiredHorizontalCenter","desiredLeft","desiredScroll","gotoRow","desiredRow","gridScroll","getValidZoomLevel","getValidPagesPerRow","clearViewer","transition","transform","transformOrigin","clearTimeout","pop","loadViewer","loadGrid","loadDocument","calculatePageOffsets","widthToSet","heightToSet","heightSoFar","widthSoFar","isLeft","padding","calculateDocumentDimensions","maxWidthToSet","maxHeightToSet","off","scrollFunction","z","documentDimensions","innerEl","round","lastPageIndex","lastOpeningHeight","pageBlockFound","fileName","escapeListener","keyCode","toggleFullscreen","handleModeChange","changeView","toggleClass","storedHeight","storedWidth","updatePanelSize","newHeight","newWidth","handleViewChange","destinationView","toggleOrientation","handleDocumentDoubleClick","newZoomLevel","zoomRatio","pageOffset","getBoundingClientRect","outerPosition","clickXToCenter","pageX","clickYToCenter","pageY","dblClickX","dblClickY","handleZoom","handleGridDoubleClick","offset","zoomProportion","handlePinchZoom","zoomDelta","preloadPages","viewportRectangle","newValue","originX","originY","getCurrentYOffset","getCurrentXOffset","elementHeight","elementWidth","handleGrid","newPagesPerRow","anchor","getState","view","state","v","n","p","getURLHash","param","hashParams","hashStringBuilder","encodeURIComponent","join","getCurrentURL","protocol","host","pathname","search","outerElem","clientHeight","bindMouseEvents","ctrlKey","singleClickTimeout","onResize","bindTouchEvents","move","startDistance","distance","moveDistance","firstTapCoordinates","tapDistance","onDoubleTap","touchEvent","changedTouches","singleTapTimeout","x2","x1","y2","y1","newScrollTop","newScrollLeft","handleEvents","mouseover","mouseout","upArrowKey","downArrowKey","leftArrowKey","rightArrowKey","spaceKey","pageUpKey","pageDownKey","homeKey","endKey","shiftKey","metaKey","addEventListener","removeEventListener","getTransitionEndEventName","transitions","OTransition","MozTransition","WebkitTransition","onZoomEnd","transitionEnd","createButtonElement","name","label","createViewMenuElement","viewMenuContainer","className","viewMenuButton","viewOptionsMenu","createSliderElement","min","sliderElement","createLabel","innerName","innerValue","labelContainerElement","zoomLabelNode","createTextNode","innerValueElement","initialInnerValue","createPageLabel","labelPrefixNode","currentPageElement","labelMiddleNode","numPagesElement","createToolbar","toolbarNode","divaToolsLeftElement","divaToolsRightElement","zoomControls","gridControls","zoomLabel","gridLabel","pageNavElement","pageLabel","gotoForm","pageField","pageSubmit","viewMenu","linkButton","fullscreenButton","prepend","displayViewMenu","viewOptions","createDocumentFragment","documentIcon","bookIcon","gridIcon","viewIcon","viewIconClasses","viewOptionsElement","intValue","zoomButtonClicked","toggle","selectedView","iconClass","hide","container","has","submit","desiredPage","val","alert","linkIcon","outerWidth","topOffset","outerHeight","targetID","select","currentSlider","display","updateCurrentPage","textContent","setNumPages","newNumber","updateZoomLabel","toString","updateGridLabel","closePopups","switchView","switchMode","toolsRightElement","insertBefore","initPlugins","index","plugin","pluginProperName","pluginName","toUpperCase","enablePlugin","init","titleText","handleClick","pluginButtonElement","hideThrobber","switchViewState","stateObj","parseImageInfo","resource","fragmentRegex","xywh","stripURL","test","urlArray","split","result","exec","service","slice","imageInfo","dimensions","w","h","parseManifest","manifest","incorporateZoom","imageDimension","getMaxZoomLevel","largestDimension","log","initializeArrayWithValue","array","sequence","sequences","viewingHint","info","imageAPIVersion","canvases","zoomLevels","Array","images","numCanvases","mx_w","mx_h","mx_z","lowestMaxZoom","totalHeightsPaged","currentPageZoomData","widthAtCurrentZoomLevel","heightAtCurrentZoomLevel","numImages","ratio","dims","a_wid","a_hei","max_w","max_h","max_ratio","min_ratio","t_hei","t_wid","divaServiceBlock","item_title","max_zoom","pgs","messageText","errorElement","closeButton","message","append","ajaxError","jqxhr","status","errorMessageText","dataHasAbsolutePath","lastIndexOf","jsonHost","hostname","resetTilesLoaded","loadObjectData","parseObjectData","yParam","isNaN","xParam","responseData","iParam","iParamPage","pParam","html","viewParam","setupViewer","show","ajax","dataType","success","checkLoaded","console","warn","orientation","divaNumber","nParam","zParam","fullscreenParam","goIntoFullscreen","getItemTitle","gotoPageByNumber","pageNumber","xAnchor","yAnchor","gotoPageByIndex","getNumberOfPages","getPageDimensionsAtZoomLevel","pageIdx","pg","pgAtZoom","getCurrentPageDimensionsAtCurrentZoomLevel","isReady","getCurrentPageIndex","getCurrentPageFilename","getCurrentPageNumber","getFilenames","filenames","getZoomLevel","getMaxZoomLevelForPage","getMinZoomLevel","setZoomLevel","zoomIn","zoomOut","inViewport","isPageInViewport","toggleFullscreenMode","enterFullscreenMode","leaveFullscreenMode","enterGridView","leaveGridView","gotoPageByName","getInstanceSelector","getSettings","translateFromMaxZoomLevel","translateToMaxZoomLevel","setState","enableScrollable","disableScrollable","getPageOffset","getCurrentPageOffset","getPageDimensionsAtCurrentGridLevel","getPageIndexForPageXYValues","outerObj","outerOffset","outerTop","outerLeft","outerBottom","outerRight","curPageIdx","curPage","curOffset","isVerticallyOriented","changeObject","destroy","empty","removeData","removeAttr","divaParent","retval","divaSettings","divaInstance","log10","pixelsPerScroll","disableManualScroll","autoScrollRefresh","defaultAutoRefresh","scrollSpeed","startScrolling","currentlyAutoScrolling","text","restartScrollingInterval","clearInterval","autoScrollInterval","setInterval","stopScrolling","toggleScrolling","changeRefresh","newRefresh","updatePixelsPerScroll","changeScrollSpeed","newSpeed","enableManualScroll","disableAutoscrollPrefs","setPosition","isFullscreen","fullscreenTools","toolsMargin","jqObj","margin-right","s","autoscrollPrefsString","before","checked","image","sliders","sliderMode","canvas","map","brightnessMax","brightnessMin","brightnessStep","contrastMax","contrastMin","contrastStep","localStoragePrefix","mobileWebkitMaxZoom","rgbMax","rgbMin","throbberFadeSpeed","buttons","toRadians","angle","PI","getNewCenter","currentCenter","centerX","centerY","theta","rotation","previous","newX","cos","sin","newY","rotateCanvas","aCanvas","center","size","startX","startY","clearRect","save","translate","rotate","restore","getImageData","shouldAdjustLevels","slider","current","updatePreviousLevels","updateMap","adjustLevels","updateCanvas","oldAngle","zoom","leftScroll","viewport","newCenter","zoomChange","toLeftScroll","toTopScroll","copyImageData","oldImageData","newImageData","createImageData","pixelArray","shouldAdjust","mode","thisChanged","thisNotDefault","initial","r","g","b","imageData","brightness","contrast","brightMul","brightTimesContrast","contrastOffset","redOffset","red","greenOffset","green","blueOffset","blue","adjustRed","adjustGreen","adjustBlue","adjustBrightness","adjustContrast","adjustOthers","putImageData","updateViewbox","cornerX","scaleFactor","cornerY","mapSize","loadMap","fillRect","loadCanvas","canvasError","complete","updateSliderLabel","thisSlider","stringValue","updateSliderValue","getImageURL","zoomWidthRatio","selectedPageIndex","showThrobber","saveSettings","sliderSettings","changed","storageKey","pluginIcon","localStorage","removeItem","updateZoom","bindCanvasKeyEvents","canvasSupported","HTMLCanvasElement","canvasPlugin","inCanvas","step","toFixed","resetSliders","defaultValue","buttonHTML","button","buttonTitle","canvasButtonsList","canvasButtons","canvasTools","canvasWrapper","canvasString","updateSlider","newMode","sliderData","newValueString","parseFloat","slideToggle","resize","innerHeight","innerWidth","scaledX","scaledY","setupHook","onPageLoad","page","keydown","open","_highlight","highlightObj","pageHighlights","pageId","pageObj","regions","colour","divClass","maxZoomWidth","currentWidth","widthProportion","box","_incorporate_zoom","uly","ulx","zIndex","divID","updateCurrentHighlight","currentHighlight","currentHighlightPage","boxes","classString","classElem","querySelectorAll","resetHighlights","highlightClass","descendents","parentObj","removeHighlightsOnPage","highlightsObj","getElementsByTagName","highlightOnPages","pageIdxs","highlightOnPage","gotoHighlight","numDivs","gotoDiv","pageArr","regionArr","arrIndex","thisDiv","centerYOfDiv","centerXOfDiv","desiredY","desiredX","currentTop","currentLeft","getDivCenter","findAdjacentHighlight","forward","centerOfTargetDiv","centerOfCurrentDiv","pageDims","centerOfDiv","targetDiv","compFunction","highlightFound","thisC","curC","targetC","targetPage","curIdx","gotoNextHighlight","gotoPreviousHighlight","highlightsVisible","highlightedPages","hideHighlights","highlights","showHighlights","getAnnotationsList","showAnnotations","canvasIndex","jqXHR","canvasAnnotations","numAnnotations","k","currentAnnotation","chars","onString","coordString","coordinates","region","otherContent","setManifest","activeOverlays","annotationElement","dataset","textOverlay","offsetTop","offsetHeight","_displayMetadata","showMetadata","labelProper","charAt","labelFormatted","getDataForLanguage","language","showMetadataFromLabelNames","names","elements","field","constructor","localizedData","metadataElement","metadataField","metadata","canonicalData","fadeToggle","pageAliases","pageAliasFunction","getAliasForPageIndex","originalPageIndex","getPageIndexForAlias","aliasedNumber","getPageIndicesForAlias","indexArr","getCurrentAliasedPageIndex","gotoPageByAliasedNumber","updateCurrentAliasedPage","initialChanges","tempSettings","newTotalPages","totalPageOffset"],"mappings":"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","file":"diva.min.js","sourcesContent":["(function(factory)\n{\n    var localJQuery;\n\n    // Test for CommonJS support and try to `require` jQuery, falling back to a global\n    if (typeof module === 'object' && module.exports)\n    {\n        try\n        {\n            localJQuery = require('jquery');\n        }\n        catch(e)\n        {\n            // Pass\n        }\n    }\n\n    // Start Diva\n    factory(localJQuery || jQuery);\n}(function(jQuery)\n{\n","// Some simple utility methods for web storage (e.g., localStorage)\nStorage.prototype.setObject = function (key, value) {\n    this.setItem(key, JSON.stringify(value));\n};\n\nStorage.prototype.getObject = function (key) {\n    var value = this.getItem(key);\n    return value && JSON.parse(value);\n};\n\n// from http://forrst.com/posts/jQuery_element_ID_generator-RoM\n(function ($) {\n    var counter = 1;\n    $.generateId = function(suffix) {\n        var generatedId;\n        do {\n            generatedId = (counter++) + (suffix ? '-' + suffix : '');\n        } while(document.getElementById(generatedId));\n\n        return generatedId;\n    };\n})(jQuery);\n\n// From http://www.alexandre-gomes.com/?p=115, modified slightly\n(function ($) {\n    $.getScrollbarWidth = function() {\n        var inner = document.createElement('p');\n        inner.style.width = '100%';\n        inner.style.height = '200px';\n\n        var outer = document.createElement('div');\n        outer.style.position = 'absolute';\n        outer.style.top = '0px';\n        outer.style.left = '0px';\n        outer.style.visibility = 'hidden';\n        outer.style.width = '200px';\n        outer.style.height = '150px';\n        outer.style.overflow = 'hidden';\n        outer.appendChild(inner);\n\n        document.body.appendChild(outer);\n\n        var w1 = inner.offsetWidth;\n        outer.style.overflow = 'scroll';\n        var w2 = inner.offsetWidth;\n        if (w1 == w2) {\n            w2 = outer.clientWidth; // for IE i think\n        }\n\n        document.body.removeChild(outer);\n        return w1 - w2;\n    };\n})(jQuery);\n\n// For getting the #key values from the URL. For specifying a page and zoom level\n// Look into caching, because we only need to get this during the initial load\n// Although for the tests I guess we would need to override caching somehow\n(function ($) {\n    $.getHashParam = function(key) {\n        var hash = window.location.hash;\n        if (hash !== '') {\n            // Check if there is something that looks like either &key= or #key=\n            var startIndex = (hash.indexOf('&' + key + '=') > 0) ? hash.indexOf('&' + key + '=') : hash.indexOf('#' + key + '=');\n\n            // If startIndex is still -1, it means it can't find either\n            if (startIndex >= 0) {\n                // Add the length of the key plus the & and =\n                startIndex += key.length + 2;\n\n                // Either to the next ampersand or to the end of the string\n                var endIndex = hash.indexOf('&', startIndex);\n                if (endIndex > startIndex) {\n                    return decodeURIComponent(hash.substring(startIndex, endIndex));\n                } else if (endIndex < 0) {\n                    // This means this hash param is the last one\n                    return decodeURIComponent(hash.substring(startIndex));\n                }\n                // If the key doesn't have a value I think\n                return '';\n            } else {\n                // If it can't find the key\n                return false;\n            }\n        } else {\n            // If there are no hash params just return false\n            return false;\n        }\n    };\n})(jQuery);\n\n(function ($) {\n    $.updateHashParam = function(key, value) {\n        // First make sure that we have to do any work at all\n        var originalValue = $.getHashParam(key);\n        var hash = window.location.hash;\n        if (originalValue !== value) {\n            // Is the key already in the URL?\n            if (typeof originalValue == 'string') {\n                // Already in the URL. Just get rid of the original value\n                var startIndex = (hash.indexOf('&' + key + '=') > 0) ? hash.indexOf('&' + key + '=') : hash.indexOf('#' + key + '=');\n                var endIndex = startIndex + key.length + 2 + originalValue.length;\n                // # if it's the first, & otherwise\n                var startThing = (startIndex === 0) ? '#' : '&';\n                window.location.replace(hash.substring(0, startIndex) + startThing + key + '=' + value + hash.substring(endIndex));\n            } else {\n                // It's not present - add it\n                if (hash.length === 0) {\n                    window.location.replace('#' + key + '=' + value);\n                } else {\n                    // Append it\n                    window.location.replace(hash + '&' + key + '=' + value);\n                }\n            }\n        }\n    };\n})(jQuery);\n\n/*\n * jQuery dragscrollable Plugin\n * version: 1.0 (25-Jun-2009)\n * Copyright (c) 2009 Miquel Herrera\n * http://plugins.jquery.com/project/Dragscrollable\n *\n * Dual licensed under the MIT and GPL licenses:\n *   http://www.opensource.org/licenses/mit-license.php\n *   http://www.gnu.org/licenses/gpl.html\n *\n */\n(function ($) { // secure $ jQuery alias\n\n/**\n * Adds the ability to manage elements scroll by dragging\n * one or more of its descendant elements. Options parameter\n * allow to specifically select which inner elements will\n * respond to the drag events.\n *\n * options properties:\n * ------------------------------------------------------------------------\n *  dragSelector         | jquery selector to apply to each wrapped element\n *                       | to find which will be the dragging elements.\n *                       | Defaults to '>:first' which is the first child of\n *                       | scrollable element\n * ------------------------------------------------------------------------\n *  acceptPropagatedEvent| Will the dragging element accept propagated\n *                       | events? default is yes, a propagated mouse event\n *                       | on a inner element will be accepted and processed.\n *                       | If set to false, only events originated on the\n *                       | draggable elements will be processed.\n * ------------------------------------------------------------------------\n *  preventDefault       | Prevents the event to propagate further effectivey\n *                       | dissabling other default actions. Defaults to true\n * ------------------------------------------------------------------------\n *\n *  usage examples:\n *\n *  To add the scroll by drag to the element id=viewport when dragging its\n *  first child accepting any propagated events\n *  $('#viewport').dragscrollable();\n *\n *  To add the scroll by drag ability to any element div of class viewport\n *  when dragging its first descendant of class dragMe responding only to\n *  evcents originated on the '.dragMe' elements.\n *  $('div.viewport').dragscrollable({dragSelector:'.dragMe:first',\n *                                    acceptPropagatedEvent: false});\n *\n *  Notice that some 'viewports' could be nested within others but events\n *  would not interfere as acceptPropagatedEvent is set to false.\n *\n */\n$.fn.dragscrollable = function( options ){\n\n    var settings = $.extend(\n        {\n            dragSelector:'>:first',\n            acceptPropagatedEvent: true,\n            preventDefault: true\n        },options || {});\n\n\n    var dragscroll= {\n        mouseDownHandler : function(event) {\n            // mousedown, left click, check propagation\n            if (event.which!=1 ||\n                (!event.data.acceptPropagatedEvent && event.target != this)){\n                return false;\n            }\n\n            // Initial coordinates will be the last when dragging\n            event.data.lastCoord = {left: event.clientX, top: event.clientY};\n\n            $.event.add( document, \"mouseup\",\n                         dragscroll.mouseUpHandler, event.data );\n            $.event.add( document, \"mousemove\",\n                         dragscroll.mouseMoveHandler, event.data );\n            if (event.data.preventDefault) {\n                event.preventDefault();\n                return false;\n            }\n        },\n        mouseMoveHandler : function(event) { // User is dragging\n            // How much did the mouse move?\n            var delta = {left: (event.clientX - event.data.lastCoord.left),\n                         top: (event.clientY - event.data.lastCoord.top)};\n\n            // Set the scroll position relative to what ever the scroll is now\n            event.data.scrollable.scrollLeft(\n                            event.data.scrollable.scrollLeft() - delta.left);\n            event.data.scrollable.scrollTop(\n                            event.data.scrollable.scrollTop() - delta.top);\n\n            // Save where the cursor is\n            event.data.lastCoord={left: event.clientX, top: event.clientY};\n            if (event.data.preventDefault) {\n                event.preventDefault();\n                return false;\n            }\n\n        },\n        mouseUpHandler : function(event) { // Stop scrolling\n            $.event.remove( document, \"mousemove\", dragscroll.mouseMoveHandler);\n            $.event.remove( document, \"mouseup\", dragscroll.mouseUpHandler);\n            if (event.data.preventDefault) {\n                event.preventDefault();\n                return false;\n            }\n        }\n    };\n\n    // set up the initial events\n    this.each(function() {\n        // closure object data for each scrollable element\n        var data = {scrollable : $(this),\n                    acceptPropagatedEvent : settings.acceptPropagatedEvent,\n                    preventDefault : settings.preventDefault };\n        // Set mouse initiating event on the desired descendant\n        $(this).find(settings.dragSelector).\n                        bind('mousedown', data, dragscroll.mouseDownHandler);\n    });\n}; //end plugin dragscrollable\n\n})( jQuery ); // confine scope\n\n/**\n jQuery.kinetic v2.2.1\n Dave Taylor http://davetayls.me\n\n @license The MIT License (MIT)\n @preserve Copyright (c) 2012 Dave Taylor http://davetayls.me\n */\n(function ($){\n    'use strict';\n\n    var ACTIVE_CLASS = 'kinetic-active';\n\n    /**\n     * Provides requestAnimationFrame in a cross browser way.\n     * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n     */\n    if (!window.requestAnimationFrame){\n\n        window.requestAnimationFrame = ( function (){\n\n            return window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                function (/* function FrameRequestCallback */ callback, /* DOMElement Element */ element){\n                    window.setTimeout(callback, 1000 / 60);\n                };\n\n        }());\n\n    }\n\n    // add touch checker to jQuery.support\n    $.support = $.support || {};\n    $.extend($.support, {\n        touch: 'ontouchend' in document\n    });\n\n\n    // KINETIC CLASS DEFINITION\n    // ======================\n\n    var Kinetic = function (element, settings) {\n        this.settings = settings;\n        this.el       = element;\n        this.$el      = $(element);\n\n        this._initElements();\n\n        return this;\n    };\n\n    Kinetic.DATA_KEY = 'kinetic';\n    Kinetic.DEFAULTS = {\n        cursor: 'move',\n        decelerate: true,\n        triggerHardware: false,\n        threshold: 0,\n        y: true,\n        x: true,\n        slowdown: 0.9,\n        maxvelocity: 40,\n        throttleFPS: 60,\n        invert: false,\n        movingClass: {\n            up: 'kinetic-moving-up',\n            down: 'kinetic-moving-down',\n            left: 'kinetic-moving-left',\n            right: 'kinetic-moving-right'\n        },\n        deceleratingClass: {\n            up: 'kinetic-decelerating-up',\n            down: 'kinetic-decelerating-down',\n            left: 'kinetic-decelerating-left',\n            right: 'kinetic-decelerating-right'\n        }\n    };\n\n\n    // Public functions\n\n    Kinetic.prototype.start = function (options){\n        this.settings = $.extend(this.settings, options);\n        this.velocity = options.velocity || this.velocity;\n        this.velocityY = options.velocityY || this.velocityY;\n        this.settings.decelerate = false;\n        this._move();\n    };\n\n    Kinetic.prototype.end = function (){\n        this.settings.decelerate = true;\n    };\n\n    Kinetic.prototype.stop = function (){\n        this.velocity = 0;\n        this.velocityY = 0;\n        this.settings.decelerate = true;\n        if ($.isFunction(this.settings.stopped)){\n            this.settings.stopped.call(this);\n        }\n    };\n\n    Kinetic.prototype.detach = function (){\n        this._detachListeners();\n        this.$el\n            .removeClass(ACTIVE_CLASS)\n            .css('cursor', '');\n    };\n\n    Kinetic.prototype.attach = function (){\n        if (this.$el.hasClass(ACTIVE_CLASS)) {\n            return;\n        }\n        this._attachListeners(this.$el);\n        this.$el\n            .addClass(ACTIVE_CLASS)\n            .css('cursor', this.settings.cursor);\n    };\n\n\n    // Internal functions\n\n    Kinetic.prototype._initElements = function (){\n        this.$el.addClass(ACTIVE_CLASS);\n\n        $.extend(this, {\n            xpos: null,\n            prevXPos: false,\n            ypos: null,\n            prevYPos: false,\n            mouseDown: false,\n            throttleTimeout: 1000 / this.settings.throttleFPS,\n            lastMove: null,\n            elementFocused: null\n        });\n\n        this.velocity = 0;\n        this.velocityY = 0;\n\n        // make sure we reset everything when mouse up\n        $(document)\n            .mouseup($.proxy(this._resetMouse, this))\n            .click($.proxy(this._resetMouse, this));\n\n        this._initEvents();\n\n        this.$el.css('cursor', this.settings.cursor);\n\n        if (this.settings.triggerHardware){\n            this.$el.css({\n                '-webkit-transform': 'translate3d(0,0,0)',\n                '-webkit-perspective': '1000',\n                '-webkit-backface-visibility': 'hidden'\n            });\n        }\n    };\n\n    Kinetic.prototype._initEvents = function(){\n        var self = this;\n        this.settings.events = {\n            touchStart: function (e){\n                var touch;\n                if (self._useTarget(e.target, e)){\n                    touch = e.originalEvent.touches[0];\n                    self.threshold = self._threshold(e.target, e);\n                    self._start(touch.clientX, touch.clientY);\n                    e.stopPropagation();\n                }\n            },\n            touchMove: function (e){\n                var touch;\n                if (self.mouseDown){\n                    touch = e.originalEvent.touches[0];\n                    self._inputmove(touch.clientX, touch.clientY);\n                    if (e.preventDefault){\n                        e.preventDefault();\n                    }\n                }\n            },\n            inputDown: function (e){\n                if (self._useTarget(e.target, e)){\n                    self.threshold = self._threshold(e.target, e);\n                    self._start(e.clientX, e.clientY);\n                    self.elementFocused = e.target;\n                    if (e.target.nodeName === 'IMG'){\n                        e.preventDefault();\n                    }\n                    e.stopPropagation();\n                }\n            },\n            inputEnd: function (e){\n                if (self._useTarget(e.target, e)){\n                    self._end();\n                    self.elementFocused = null;\n                    if (e.preventDefault){\n                        e.preventDefault();\n                    }\n                }\n            },\n            inputMove: function (e){\n                if (self.mouseDown){\n                    self._inputmove(e.clientX, e.clientY);\n                    if (e.preventDefault){\n                        e.preventDefault();\n                    }\n                }\n            },\n            scroll: function (e){\n                if ($.isFunction(self.settings.moved)){\n                    self.settings.moved.call(self, self.settings);\n                }\n                if (e.preventDefault){\n                    e.preventDefault();\n                }\n            },\n            inputClick: function (e){\n                if (Math.abs(self.velocity) > 0){\n                    e.preventDefault();\n                    return false;\n                }\n            },\n            // prevent drag and drop images in ie\n            dragStart: function (e){\n                if (self._useTarget(e.target, e) && self.elementFocused){\n                    return false;\n                }\n            },\n            // prevent selection when dragging\n            selectStart: function (e){\n                if ($.isFunction(self.settings.selectStart)){\n                    return self.settings.selectStart.apply(self, arguments);\n                } else if (self._useTarget(e.target, e)) {\n                    return false;\n                }\n            }\n        };\n\n        this._attachListeners(this.$el, this.settings);\n\n    };\n\n    Kinetic.prototype._inputmove = function (clientX, clientY){\n        var $this = this.$el;\n        var el = this.el;\n\n        if (!this.lastMove || new Date() > new Date(this.lastMove.getTime() + this.throttleTimeout)){\n            this.lastMove = new Date();\n\n            if (this.mouseDown && (this.xpos || this.ypos)){\n                var movedX = (clientX - this.xpos);\n                var movedY = (clientY - this.ypos);\n                if (this.settings.invert) {\n                    movedX *= -1;\n                    movedY *= -1;\n                }\n                if(this.threshold > 0){\n                    var moved = Math.sqrt(movedX * movedX + movedY * movedY);\n                    if(this.threshold > moved){\n                        return;\n                    } else {\n                        this.threshold = 0;\n                    }\n                }\n                if (this.elementFocused){\n                    $(this.elementFocused).blur();\n                    this.elementFocused = null;\n                    $this.focus();\n                }\n\n                this.settings.decelerate = false;\n                this.velocity = this.velocityY = 0;\n\n                var scrollLeft = this.scrollLeft();\n                var scrollTop = this.scrollTop();\n\n                this.scrollLeft(this.settings.x ? scrollLeft - movedX : scrollLeft);\n                this.scrollTop(this.settings.y ? scrollTop - movedY : scrollTop);\n\n                this.prevXPos = this.xpos;\n                this.prevYPos = this.ypos;\n                this.xpos = clientX;\n                this.ypos = clientY;\n\n                this._calculateVelocities();\n                this._setMoveClasses(this.settings.movingClass);\n\n                if ($.isFunction(this.settings.moved)){\n                    this.settings.moved.call(this, this.settings);\n                }\n            }\n        }\n    };\n\n    Kinetic.prototype._calculateVelocities = function (){\n        this.velocity = this._capVelocity(this.prevXPos - this.xpos, this.settings.maxvelocity);\n        this.velocityY = this._capVelocity(this.prevYPos - this.ypos, this.settings.maxvelocity);\n        if (this.settings.invert) {\n            this.velocity *= -1;\n            this.velocityY *= -1;\n        }\n    };\n\n    Kinetic.prototype._end = function (){\n        if (this.xpos && this.prevXPos && this.settings.decelerate === false){\n            this.settings.decelerate = true;\n            this._calculateVelocities();\n            this.xpos = this.prevXPos = this.mouseDown = false;\n            this._move();\n        }\n    };\n\n    Kinetic.prototype._useTarget = function (target, event){\n        if ($.isFunction(this.settings.filterTarget)){\n            return this.settings.filterTarget.call(this, target, event) !== false;\n        }\n        return true;\n    };\n\n    Kinetic.prototype._threshold = function (target, event){\n        if ($.isFunction(this.settings.threshold)){\n            return this.settings.threshold.call(this, target, event);\n        }\n        return this.settings.threshold;\n    };\n\n    Kinetic.prototype._start = function (clientX, clientY){\n        this.mouseDown = true;\n        this.velocity = this.prevXPos = 0;\n        this.velocityY = this.prevYPos = 0;\n        this.xpos = clientX;\n        this.ypos = clientY;\n    };\n\n    Kinetic.prototype._resetMouse = function (){\n        this.xpos = false;\n        this.ypos = false;\n        this.mouseDown = false;\n    };\n\n    Kinetic.prototype._decelerateVelocity = function (velocity, slowdown){\n        return Math.floor(Math.abs(velocity)) === 0 ? 0 // is velocity less than 1?\n            : velocity * slowdown; // reduce slowdown\n    };\n\n    Kinetic.prototype._capVelocity = function (velocity, max){\n        var newVelocity = velocity;\n        if (velocity > 0){\n            if (velocity > max){\n                newVelocity = max;\n            }\n        } else {\n            if (velocity < (0 - max)){\n                newVelocity = (0 - max);\n            }\n        }\n        return newVelocity;\n    };\n\n    Kinetic.prototype._setMoveClasses = function (classes){\n        // FIXME: consider if we want to apply PL #44, this should not remove\n        // classes we have not defined on the element!\n        var settings = this.settings;\n        var $this = this.$el;\n\n        $this.removeClass(settings.movingClass.up)\n            .removeClass(settings.movingClass.down)\n            .removeClass(settings.movingClass.left)\n            .removeClass(settings.movingClass.right)\n            .removeClass(settings.deceleratingClass.up)\n            .removeClass(settings.deceleratingClass.down)\n            .removeClass(settings.deceleratingClass.left)\n            .removeClass(settings.deceleratingClass.right);\n\n        if (this.velocity > 0){\n            $this.addClass(classes.right);\n        }\n        if (this.velocity < 0){\n            $this.addClass(classes.left);\n        }\n        if (this.velocityY > 0){\n            $this.addClass(classes.down);\n        }\n        if (this.velocityY < 0){\n            $this.addClass(classes.up);\n        }\n\n    };\n\n\n    // do the actual kinetic movement\n    Kinetic.prototype._move = function (){\n        var $scroller = this._getScroller();\n        var scroller = $scroller[0];\n        var self = this;\n        var settings = self.settings;\n\n        // set scrollLeft\n        if (settings.x && scroller.scrollWidth > 0){\n            this.scrollLeft(this.scrollLeft() + this.velocity);\n            if (Math.abs(this.velocity) > 0){\n                this.velocity = settings.decelerate ?\n                    self._decelerateVelocity(this.velocity, settings.slowdown) : this.velocity;\n            }\n        } else {\n            this.velocity = 0;\n        }\n\n        // set scrollTop\n        if (settings.y && scroller.scrollHeight > 0){\n            this.scrollTop(this.scrollTop() + this.velocityY);\n            if (Math.abs(this.velocityY) > 0){\n                this.velocityY = settings.decelerate ?\n                    self._decelerateVelocity(this.velocityY, settings.slowdown) : this.velocityY;\n            }\n        } else {\n            this.velocityY = 0;\n        }\n\n        self._setMoveClasses(settings.deceleratingClass);\n\n        if ($.isFunction(settings.moved)){\n            settings.moved.call(this, settings);\n        }\n\n        if (Math.abs(this.velocity) > 0 || Math.abs(this.velocityY) > 0){\n            if (!this.moving) {\n                this.moving = true;\n                // tick for next movement\n                window.requestAnimationFrame(function (){\n                    self.moving = false;\n                    self._move();\n                });\n            }\n        } else {\n            self.stop();\n        }\n    };\n\n    // get current scroller to apply positioning to\n    Kinetic.prototype._getScroller = function(){\n        var $scroller = this.$el;\n        if (this.$el.is('body') || this.$el.is('html')){\n            $scroller = $(window);\n        }\n        return $scroller;\n    };\n\n    // set the scroll position\n    Kinetic.prototype.scrollLeft = function(left){\n        var $scroller = this._getScroller();\n        if (typeof left === 'number'){\n            $scroller.scrollLeft(left);\n            this.settings.scrollLeft = left;\n        } else {\n            return $scroller.scrollLeft();\n        }\n    };\n    Kinetic.prototype.scrollTop = function(top){\n        var $scroller = this._getScroller();\n        if (typeof top === 'number'){\n            $scroller.scrollTop(top);\n            this.settings.scrollTop = top;\n        } else {\n            return $scroller.scrollTop();\n        }\n    };\n\n    Kinetic.prototype._attachListeners = function (){\n        var $this = this.$el;\n        var settings = this.settings;\n\n        if ($.support.touch){\n            $this\n                .bind('touchstart', settings.events.touchStart)\n                .bind('touchend', settings.events.inputEnd)\n                .bind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .mousedown(settings.events.inputDown)\n            .mouseup(settings.events.inputEnd)\n            .mousemove(settings.events.inputMove);\n\n        $this\n            .click(settings.events.inputClick)\n            .scroll(settings.events.scroll)\n            .bind('selectstart', settings.events.selectStart)\n            .bind('dragstart', settings.events.dragStart);\n    };\n\n    Kinetic.prototype._detachListeners = function (){\n        var $this = this.$el;\n        var settings = this.settings;\n        if ($.support.touch){\n            $this\n                .unbind('touchstart', settings.events.touchStart)\n                .unbind('touchend', settings.events.inputEnd)\n                .unbind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .unbind('mousedown', settings.events.inputDown)\n            .unbind('mouseup', settings.events.inputEnd)\n            .unbind('mousemove', settings.events.inputMove);\n\n        $this\n            .unbind('click', settings.events.inputClick)\n            .unbind('scroll', settings.events.scroll)\n            .unbind('selectstart', settings.events.selectStart)\n            .unbind('dragstart', settings.events.dragStart);\n    };\n\n\n    // EXPOSE KINETIC CONSTRUCTOR\n    // ==========================\n    $.Kinetic = Kinetic;\n\n    // KINETIC PLUGIN DEFINITION\n    // =======================\n\n    $.fn.kinetic = function (option, callOptions) {\n        return this.each(function () {\n            var $this    = $(this);\n            var instance = $this.data(Kinetic.DATA_KEY);\n            var options  = $.extend({}, Kinetic.DEFAULTS, $this.data(), typeof option === 'object' && option);\n\n            if (!instance) {\n                $this.data(Kinetic.DATA_KEY, (instance = new Kinetic(this, options)));\n            }\n\n            if (typeof option === 'string') {\n                instance[option](callOptions);\n            }\n\n        });\n    };\n\n}(jQuery));\n\n// jQuery.kinetic core modifications for diva.js (compatible with jQuery.kinetic 2.2.1)\n// use jQuery.kinetic for touch handlers only since we are using dragscrollable for mouse handlers\n//    - (kinetic provides inertial scrolling [ease into stopped state on release] for touch events and dragscrollable\n//      allows non-inertial scrolling which we like for mice)\n\n(function($)\n{\n    $.Kinetic.prototype._attachListeners = function()\n    {\n        // attach only touch listeners\n        var $this = this.$el;\n        var settings = this.settings;\n\n        if ($.support.touch)\n        {\n            $this\n                .bind('touchstart', settings.events.touchStart)\n                .bind('touchend', settings.events.inputEnd)\n                .bind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .click(settings.events.inputClick)\n            .scroll(settings.events.scroll)\n            .bind('selectstart', settings.events.selectStart)\n            .bind('dragstart', settings.events.dragStart);\n    };\n\n    $.Kinetic.prototype._detachListeners = function()\n    {\n        // detach only touch listeners\n        var $this = this.$el;\n        var settings = this.settings;\n\n        if ($.support.touch)\n        {\n            $this\n                .unbind('touchstart', settings.events.touchStart)\n                .unbind('touchend', settings.events.inputEnd)\n                .unbind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .unbind('click', settings.events.inputClick)\n            .unbind('scroll', settings.events.scroll)\n            .unbind('selectstart', settings.events.selectStart)\n            .unbind('dragstart', settings.events.dragStart);\n    };\n})(jQuery);\n\n/**\n*      Events. Pub/Sub system for Loosely Coupled logic.\n*      Based on Peter Higgins' port from Dojo to jQuery\n*      https://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js\n*\n*      Re-adapted to vanilla Javascript\n*\n*      @class Events\n*/\nvar diva = (function() {\n    var cache = {};\n    var pub = {\n        Events: {\n            /**\n             *      diva.Events.publish\n             *      e.g.: diva.Events.publish(\"PageDidLoad\", [pageIndex, filename, pageSelector], this);\n             *\n             *      @class Events\n             *      @method publish\n             *      @param topic {String}\n             *      @param args  {Array}\n             *      @param scope {Object=} Optional - Subscribed functions will be executed with the supplied object as `this`.\n             *          It is necessary to supply this argument with the self variable when within a Diva instance.\n             *          The scope argument is matched with the instance ID of subscribers to determine whether they\n             *              should be executed. (See instanceID argument of subscribe.)\n             */\n            publish: function (topic, args, scope)\n            {\n                if (cache[topic])\n                {\n                    var thisTopic = cache[topic];\n\n                    if (typeof thisTopic.global !== 'undefined')\n                    {\n                        var thisTopicGlobal = thisTopic.global;\n                        var i = thisTopicGlobal.length;\n\n                        while (i--)\n                        {\n                            thisTopicGlobal[i].apply(scope || this, args || []);\n                        }\n                    }\n\n                    if (scope && typeof scope.getInstanceId !== 'undefined')\n                    {\n                        // get publisher instance ID from scope arg, compare, and execute if match\n                        var instanceID = scope.getInstanceId();\n\n                        if (cache[topic][instanceID])\n                        {\n                            var thisTopicInstance = cache[topic][instanceID];\n                            var j = thisTopicInstance.length;\n\n                            while (j--)\n                            {\n                                thisTopicInstance[j].apply(scope || this, args || []);\n                            }\n                        }\n                    }\n                }\n            },\n            /**\n             *      diva.Events.subscribe\n             *      e.g.: diva.Events.subscribe(\"PageDidLoad\", highlight, settings.ID)\n             *\n             *      @class Events\n             *      @method subscribe\n             *      @param topic {String}\n             *      @param callback {Function}\n             *      @param instanceID {String=} Optional - String representing the ID of a Diva instance; if provided,\n             *                                            callback only fires for events published from that instance.\n             *      @return Event handler {Array}\n             */\n            subscribe: function (topic, callback, instanceID)\n            {\n                if (!cache[topic])\n                {\n                    cache[topic] = {};\n                }\n\n                if (typeof instanceID === 'string')\n                {\n                    if (!cache[topic][instanceID])\n                    {\n                        cache[topic][instanceID] = [];\n                    }\n\n                    cache[topic][instanceID].push(callback);\n                }\n                else\n                {\n                    if (!cache[topic].global)\n                    {\n                        cache[topic].global = [];\n                    }\n\n                    cache[topic].global.push(callback);\n                }\n\n                var handle = instanceID ? [topic, callback, instanceID] : [topic, callback];\n\n                return handle;\n            },\n            /**\n             *      diva.Events.unsubscribe\n             *      e.g.: var handle = Events.subscribe(\"PageDidLoad\", highlight);\n             *              Events.unsubscribe(handle);\n             *\n             *      @class Events\n             *      @method unsubscribe\n             *      @param handle {Array}\n             *      @param completely {Boolean=} - Unsubscribe all events for a given topic.\n             *      @return success {Boolean}\n             */\n            unsubscribe: function (handle, completely)\n            {\n                var t = handle[0];\n\n                if (cache[t])\n                {\n                    var topicArray;\n                    var instanceID = (handle.length === 3 && typeof cache[t][handle[2]] !== 'undefined') ? handle[2] : 'global';\n\n                    topicArray = cache[t][instanceID];\n                    var i = topicArray.length;\n\n                    while (i--)\n                    {\n                        if (topicArray[i] === handle[1])\n                        {\n                            cache[t][instanceID].splice(i, 1);\n\n                            if (completely)\n                            {\n                                delete cache[t][instanceID];\n                            }\n\n                            return true;\n                        }\n                    }\n                }\n\n                return false;\n            },\n            /**\n             *      diva.Events.unsubscribeAll\n             *      e.g.: diva.Events.unsubscribeAll('global');\n             *\n             *      @class Events\n             *      @param {String=} Optional - instance ID to remove subscribers from or 'global' (if omitted,\n             *                                 subscribers in all scopes removed)\n             *      @method unsubscribe\n             */\n            unsubscribeAll: function (instanceID)\n            {\n                if (instanceID)\n                {\n                    var topics = Object.keys(cache);\n                    var i = topics.length;\n                    var topic;\n\n                    while (i--)\n                    {\n                        topic = topics[i];\n\n                        if (cache[topic][instanceID] !== 'undefined')\n                        {\n                            delete cache[topic][instanceID];\n                        }\n                    }\n                }\n                else\n                {\n                    cache = {};\n                }\n            }\n        }\n    };\n\n    return pub;\n}());\n\n// Expose the Diva variable globally (needed for plugins, possibly even in CommonJS environments)\nwindow.diva = diva;\n\n// Expose diva as the export in CommonJS environments\nif (typeof module === 'object' && module.exports)\n    module.exports = diva;\n\n//Used to keep track of whether Diva was last clicked or which Diva was last clicked when there are multiple\nvar activeDivaController = (function ($)\n{\n    return function ()\n    {\n        var active;\n\n        //global click listener\n        $(document).on('click', function(e)\n        {\n            updateActive($(e.target));\n        });\n\n        //parameter should already be a jQuery selector\n        var updateActive = function (target)\n        {\n            var nearestOuter;\n\n            //these will find 0 or 1 objects, never more\n            var findOuter = target.find('.diva-outer');\n            var closestOuter = target.closest('.diva-outer');\n            var outers = document.getElementsByClassName('diva-outer');\n            var outerLen = outers.length;\n            var idx;\n\n            //clicked on something that was not either a parent or sibling of a diva-outer\n            if (findOuter.length > 0)\n            {\n                nearestOuter = findOuter;\n            }\n            //clicked on something that was a child of a diva-outer\n            else if (closestOuter.length > 0)\n            {\n                nearestOuter = closestOuter;\n            }\n            //clicked on something that was not in any Diva tree\n            else\n            {\n                //deactivate everything and return\n                for (idx = 0; idx < outerLen; idx++)\n                {\n                    $(outers[idx].parentElement).data('diva').deactivate();\n                }\n                return;\n            }\n\n            //if we found one, activate it...\n            nearestOuter.parent().data('diva').activate();\n            active = nearestOuter.parent();\n\n            //...and deactivate all the others\n            outers = document.getElementsByClassName('diva-outer');\n            for(idx = 0; idx < outerLen; idx++)\n            {\n                //getAttribute to attr - comparing DOM element to jQuery element\n                if (outers[idx].getAttribute('id') != nearestOuter.attr('id'))\n                    $(outers[idx].parentElement).data('diva').deactivate();\n            }\n        };\n\n        //public accessor in case. Will return a jQuery selector.\n        this.getActive = function()\n        {\n            return active;\n        };\n    };\n})(jQuery);\n\nvar activeDiva = new activeDivaController();","/*\nCopyright (C) 2011-2016 by Wendy Liu, Evan Magoni, Andrew Hankinson, Andrew Horwitz, Laurent Pugin\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\nwindow.divaPlugins = [];\n\n// this pattern was taken from http://www.virgentech.com/blog/2009/10/building-object-oriented-jquery-plugin.html\n(function ($)\n{\n    var Diva = function (element, options)\n    {\n        var parentObject = $(element);\n\n        // These are elements that can be overridden upon instantiation\n        // See https://github.com/DDMAL/diva.js/wiki/Settings for more details\n        var defaults = {\n            adaptivePadding: 0.05,      // The ratio of padding to the page dimension\n            arrowScrollAmount: 40,      // The amount (in pixels) to scroll by when using arrow keys\n            blockMobileMove: false,     // Prevent moving or scrolling the page on mobile devices\n            objectData: '',             // A IIIF Manifest or a JSON file generated by process.py that provides the object dimension data, or a URL pointing to such data - *REQUIRED*\n            enableAutoTitle: true,      // Shows the title within a div of id diva-title\n            enableFilename: true,       // Uses filenames and not page numbers for links (i=bm_001.tif, not p=1)\n            enableFullscreen: true,     // Enable or disable fullscreen icon (mode still available)\n            enableGotoPage: true,       // A \"go to page\" jump box\n            enableGridIcon: true,       // A grid view of all the pages\n            enableGridControls: 'buttons',  // Specify control of pages per grid row in Grid view. Possible values: 'buttons' (+/-), 'slider'. Any other value disables the controls.\n            enableImageTitles: true,    // Adds \"Page {n}\" title to page images if true\n            enableKeyScroll: true,      // Captures scrolling using the arrow and page up/down keys regardless of page focus. When off, defers to default browser scrolling behavior.\n            enableLinkIcon: true,       // Controls the visibility of the link icon\n            enableSpaceScroll: false,   // Scrolling down by pressing the space key\n            enableToolbar: true,        // Enables the toolbar. Note that disabling this means you have to handle all controls yourself.\n            enableZoomControls: 'buttons', // Specify controls for zooming in and out. Possible values: 'buttons' (+/-), 'slider'. Any other value disables the controls.\n            fixedPadding: 10,           // Fallback if adaptive padding is set to 0\n            fixedHeightGrid: true,      // So each page in grid view has the same height (only widths differ)\n            goDirectlyTo: 0,            // Default initial page to show (0-indexed)\n            iipServerURL: '',           // The URL to the IIPImage installation, including the `?FIF=` - *REQUIRED*, unless using IIIF\n            inFullscreen: false,        // Set to true to load fullscreen mode initially\n            inBookLayout: false,       // Set to true to view the document with facing pages in document mode\n            inGrid: false,              // Set to true to load grid view initially\n            imageDir: '',               // Image directory, either absolute path or relative to IIP's FILESYSTEM_PREFIX - *REQUIRED*, unless using IIIF\n            maxPagesPerRow: 8,          // Maximum number of pages per row in grid view\n            maxZoomLevel: -1,           // Optional; defaults to the max zoom returned in the JSON response\n            minPagesPerRow: 2,          // Minimum pages per row in grid view. Recommended default.\n            minZoomLevel: 0,            // Defaults to 0 (the minimum zoom)\n            pageLoadTimeout: 200,       // Number of milliseconds to wait before loading pages\n            pagesPerRow: 5,             // The default number of pages per row in grid view\n            rowLoadTimeout: 50,         // Number of milliseconds to wait before loading a row\n            throbberTimeout: 100,       // Number of milliseconds to wait before showing throbber\n            tileHeight: 256,            // The height of each tile, in pixels; usually 256\n            tileWidth: 256,             // The width of each tile, in pixels; usually 256\n            toolbarParentObject: parentObject, // The toolbar parent object.\n            verticallyOriented: true,   // Determines vertical vs. horizontal orientation\n            viewportMargin: 200,        // Pretend tiles +/- 200px away from viewport are in\n            zoomLevel: 2                // The initial zoom level (used to store the current zoom level)\n        };\n\n        // Apply the defaults, or override them with passed-in options.\n        var settings = $.extend({}, defaults, options);\n\n        // Things that cannot be changed because of the way they are used by the script\n        // Many of these are declared with arbitrary values that are changed later on\n        var globals = {\n            allTilesLoaded: [],         // A boolean for each page, indicating if all tiles have been loaded\n            averageHeights: [],         // The average page height for each zoom level\n            averageWidths: [],          // The average page width for each zoom level\n            currentPageIndex: 0,        // The current page in the viewport (center-most page)\n            unclampedVerticalPadding: 0, // Used to keep track of initial padding size before enforcing the minimum size needed to accommodate plugin icons\n            doubleClickZoom: false,     // Flag to determine whether handleZoom was called from a double-click\n            documentPaged: false,       // Set to true when the object has a viewingHint of 'paged' in its manifest\n            firstPageLoaded: -1,        // The ID of the first page loaded (value set later)\n            firstRowLoaded: -1,         // The index of the first row loaded\n            gridPageWidth: 0,           // Holds the max width of each row in grid view. Calculated in loadGrid()\n            hashParamSuffix: '',        // Used when there are multiple document viewers on a page\n            horizontalOffset: 0,        // Distance from the center of the diva element to the top of the current page\n            horizontalPadding: 0,       // Either the fixed padding or adaptive padding\n            ID: null,                   // The prefix of the IDs of the elements (usually 1-diva-)\n            initialKeyScroll: false,    // Holds the initial state of enableKeyScroll\n            initialSpaceScroll: false,  // Holds the initial state of enableSpaceScroll\n            innerObject: {},            // $(settings.ID + 'inner'), for selecting the .diva-inner element\n            innerElement: '',           // A reference to the native .diva-outer DOM object\n            isActiveDiva: true,         // In the case that multiple diva panes exist on the same page, this should have events funneled to it.\n            isScrollable: true,         // Used in enable/disableScrollable public methods\n            isIIIF: false,              // Specifies whether objectData is in Diva native or IIIF Manifest format\n            itemTitle: '',              // The title of the document\n            isZooming: false,           // Flag to keep track of whether zooming is still in progress, for handleZoom\n            lastPageLoaded: -1,         // The ID of the last page loaded (value set later)\n            lastRowLoaded: -1,          // The index of the last row loaded\n            loaded: false,              // A flag for when everything is loaded and ready to go.\n            loadedTiles: [],        // Keeps track of which tiles have been loaded already\n            maxWidths: [],              // The width of the widest page for each zoom level\n            maxHeights: [],             // The height of the tallest page for each zoom level\n            maxRatio: 0,                // The max height/width ratio (for grid view)\n            minRatio: 0,                // The minimum height/width ratio for a page\n            mobileWebkit: false,        // Checks if the user is on a touch device (iPad/iPod/iPhone/Android)\n            numPages: 0,                // Number of pages in the array\n            numRows: 0,                 // Number of rows\n            oldZoomLevel: -1,           // Holds the previous zoom level after zooming in or out\n            outerObject: {},            // $(settings.ID + 'outer'), for selecting the .diva-outer element\n            outerElement: '',           // A reference to the native .diva-outer DOM object\n            pages: [],                  // An array containing the data for all the pages\n            pageLeftOffsets: [],        // Distance from the left side of each page to the left side of the diva-inner object\n            pagePreloadCanvases: [],    // Stack to hold canvases of pages preloading during zoom\n            pageTopOffsets: [],         // Distance from the top side of each page to the top side of the diva-inner object\n            pageTimeouts: [],           // Stack to hold the loadPage timeouts\n            pageTools: '',              // The string for page tools\n            panelHeight: 0,             // Height of the document viewer pane\n            panelWidth: 0,              // Width of the document viewer pane\n            parentObject: parentObject, // JQuery object referencing the parent element\n            plugins: [],                // Filled with the enabled plugins from window.divaPlugins\n            previousLeftScroll: 0,      // Used to determine horizontal scroll direction\n            previousTopScroll: 0,       // Used to determine vertical scroll direction\n            previousZoomLevelCanvases: [],  // Array to hold canvases of pages visible at previous zoom level (for page image persistence across zooms)\n            realMaxZoom: -1,            // To hold the true max zoom level of the document (needed for calculations)\n            resizeTimer: -1,            // Holds the ID of the timeout used when resizing the window (for clearing)\n            rowHeight: 0,               // Holds the max height of each row in grid view. Calculated in loadGrid()\n            previousZoomRatio: 1,             // Used to keep track of the previous zoom ratio for scale transforming diva-inner\n            scaleWait: false,           // For preventing double-zoom on touch devices (iPad, etc)\n            scrollbarWidth: 0,          // Set to the actual scrollbar width in init()\n            selector: '',               // Uses the generated ID prefix to easily select elements\n            singleClick: false,         // Used for catching ctrl+double-click events in Firefox in Mac OS\n            singleTap: false,           // Used for caching double-tap events on mobile browsers\n            throbberTimeoutID: -1,      // Holds the ID of the throbber loading timeout\n            toolbar: null,              // Holds an object with some toolbar-related functions\n            totalHeights: [],           // The total height of all pages (stacked together) for each zoom level\n            totalHeight: 0,             // The total height for the current zoom level (including padding)\n            totalWidths: [],            // The total height of all pages (stacked together) for each zoom level\n            totalWidth: 0,              // The total height for the current zoom level (including padding)\n            verticalOffset: 0,          // Distance from the center of the diva element to the left side of the current page\n            verticalPadding: 0          // Either the fixed padding or adaptive padding\n        };\n\n        $.extend(settings, globals);\n\n        var self = this;\n\n        var getPageData = function (pageIndex, attribute)\n        {\n            return settings.pages[pageIndex].d[settings.zoomLevel][attribute];\n        };\n\n        // Returns the page index associated with the given filename; must called after settings settings.pages\n        var getPageIndex = function (filename)\n        {\n            var i,\n                np = settings.numPages;\n\n            for (i = 0; i < np; i++)\n            {\n                if (settings.pages[i].f === filename)\n                {\n                    return i;\n                }\n            }\n\n            return -1;\n        };\n\n        // Checks if a page or tile is within the viewport horizontally\n        var isHorizontallyInViewport = function (left, right, viewportLeft, viewportRight)\n        {\n            var leftOfViewport = viewportLeft - settings.viewportMargin;\n            var rightOfViewport = viewportRight + settings.viewportMargin * 2;\n\n            var leftVisible = left >= leftOfViewport && left <= rightOfViewport;\n            var middleVisible = left <= leftOfViewport && right >= rightOfViewport;\n            var rightVisible = right >= leftOfViewport && right <= rightOfViewport;\n\n            return (leftVisible || middleVisible || rightVisible);\n        };\n\n        // Checks if a page or tile is within the viewport vertically\n        var isVerticallyInViewport = function (top, bottom, viewportTop, viewportBottom)\n        {\n            //topOfViewport may need to have settings.innerObject.offset().top subtracted from it?\n            var topOfViewport = viewportTop - settings.viewportMargin;\n            var bottomOfViewport = viewportBottom + settings.viewportMargin * 2;\n\n            var topVisible = top >= topOfViewport && top <= bottomOfViewport;\n            var middleVisible = top <= topOfViewport && bottom >= bottomOfViewport;\n            var bottomVisible = bottom >= topOfViewport && bottom <= bottomOfViewport;\n\n            return (topVisible || middleVisible || bottomVisible);\n        };\n\n        // Check if a tile is near the specified viewport and thus should be loaded (performance-sensitive)\n        var isTileVisible = function (pageIndex, tileRow, tileCol, viewportTop, viewportLeft, viewportRight, viewportBottom)\n        {\n            var tileTop, tileLeft;\n\n            if (settings.verticallyOriented)\n            {\n                tileTop = settings.pageTopOffsets[pageIndex] + (tileRow * settings.tileHeight) + settings.verticalPadding;\n                tileLeft = settings.pageLeftOffsets[pageIndex] + (tileCol * settings.tileWidth);\n            }\n            else\n            {\n                tileTop = settings.pageTopOffsets[pageIndex] + (tileRow * settings.tileHeight);\n                tileLeft = settings.pageLeftOffsets[pageIndex] + (tileCol * settings.tileWidth) + settings.horizontalPadding;\n            }\n\n            var tileBottom = tileTop + settings.tileHeight;\n            var tileRight = tileLeft + settings.tileWidth;\n\n            return isVerticallyInViewport(tileTop, tileBottom, viewportTop, viewportBottom) && isHorizontallyInViewport(tileLeft, tileRight, viewportLeft, viewportRight);\n        };\n\n        // Check if a tile has been loaded (note: performance-sensitive function)\n        var isTileLoaded = function (pageIndex, tileIndex)\n        {\n            var i = settings.loadedTiles.length;\n\n            while (i--)\n            {\n                if (settings.loadedTiles[pageIndex][i] === tileIndex)\n                {\n                    return true;\n                }\n            }\n\n            return false;\n        };\n\n        // Check if a page index is valid\n        var isPageValid = function (pageIndex)\n        {\n            return pageIndex >= 0 && pageIndex < settings.numPages;\n        };\n\n        // Check if a page is in or near the viewport and thus should be loaded\n        var isPageVisible = function (pageIndex, viewportTop, viewportLeft, viewportRight, viewportBottom)\n        {\n            var topOfPage = settings.pageTopOffsets[pageIndex];\n            var bottomOfPage = topOfPage + getPageData(pageIndex, 'h') + settings.verticalPadding;\n\n            var leftOfPage = settings.pageLeftOffsets[pageIndex];\n            var rightOfPage = leftOfPage + getPageData(pageIndex, 'w') + settings.horizontalPadding;\n\n            return isVerticallyInViewport(topOfPage, bottomOfPage, viewportTop, viewportBottom) && isHorizontallyInViewport(leftOfPage, rightOfPage, viewportLeft, viewportRight);\n        };\n\n        // Check if a page has been appended to the DOM\n        var isPageLoaded = function (pageIndex)\n        {\n            return !!document.getElementById(settings.ID + 'page-' + pageIndex);\n        };\n\n        // Loads page tiles into the supplied canvas.\n        var loadTiles = function(pageIndex, filename, width, height, canvasElement, viewportTop, viewportLeft, viewportRight, viewportBottom)\n        {\n            var context;\n\n            if (canvasElement.getContext && canvasElement.getContext('2d'))\n            {\n                context = canvasElement.getContext('2d');\n            }\n            else\n            {\n                showError('Your browser lacks support for the <pre><canvas></pre> element. Please upgrade your browser. Error: ' + error);\n                return false;\n            }\n\n            function getDrawTileFunction(pageIndex, tileIndex, currentTile, left, top)\n            {\n                return function()\n                {\n                    settings.loadedTiles[pageIndex].push(tileIndex);\n                    context.drawImage(currentTile, left, top);\n                };\n            }\n\n            var imdir = settings.imageDir + \"/\";\n            var rows = Math.ceil(getPageData(pageIndex, 'h') / settings.tileWidth);\n            var cols = Math.ceil(getPageData(pageIndex, 'w') / settings.tileHeight);\n\n            var maxZoom = settings.pages[pageIndex].m;\n            var baseURL = settings.iipServerURL + \"?FIF=\" + imdir + filename + '&JTL=';\n            var allTilesLoaded = true;\n            var tileIndex = 0;\n\n            // Calculate the width and height of outer tiles (non-standard dimensions)\n            var lastHeight = height - (rows - 1) * settings.tileHeight;\n            var lastWidth = width - (cols - 1) * settings.tileWidth;\n\n            // Declare variables used within the loops\n            var row, col, tileHeight, tileWidth, currentTile, top, left, zoomLevel, imageURL, regionHeight, regionWidth, xOffset, yOffset, zoomDifference;\n\n            //resize canvas context to new zoom level if necessary before drawing tiles\n            // if context width is wrong, set it to h and w.\n            if (canvasElement.width !== Math.floor(getPageData(pageIndex, 'w')))\n            {\n                canvasElement.width = Math.floor(getPageData(pageIndex, 'w'));\n                canvasElement.height = Math.floor(getPageData(pageIndex, 'h'));\n            }\n\n            // Adjust the zoom level based on the max zoom level of the page\n            zoomLevel = settings.zoomLevel + maxZoom - settings.realMaxZoom;\n\n            var baseImageURL = (settings.isIIIF) ? settings.pages[pageIndex].url : baseURL + zoomLevel + ',';\n            var version, quality, iiifSuffix;\n\n            if (settings.isIIIF)\n            {\n                // regionX, regionY, regionWidth, regionHeight\n                zoomDifference = Math.pow(2, maxZoom - zoomLevel);\n                regionHeight = settings.tileHeight * zoomDifference;\n                regionWidth = settings.tileWidth * zoomDifference;\n\n                // if iiif 1.1, 'native'. if iiif 2.0, 'default'\n                version = settings.pages[pageIndex].api;\n                quality = (version >= 2.0) ? 'default' : 'native';\n                iiifSuffix = '/0/' + quality + '.jpg';\n\n                // only show segment defined in canvas.resource.@id in manifest\n                if (settings.pages[pageIndex].hasOwnProperty('xoffset'))\n                {\n                    xOffset = settings.pages[pageIndex].xoffset;\n                    yOffset = settings.pages[pageIndex].yoffset;\n                }\n                else\n                {\n                    xOffset = 0;\n                    yOffset = 0;\n                }\n            }\n            else\n            {\n                regionHeight = settings.tileHeight;\n                regionWidth = settings.tileWidth;\n            }\n\n            // Loop through all the tiles in this page\n            row = 0;\n\n            while (row < rows)\n            {\n                col = 0;\n                // If the tile is in the last row or column, its dimensions will be different\n                tileHeight = (row === rows - 1) ? lastHeight : settings.tileHeight;\n\n                while (col < cols)\n                {\n                    top = row * settings.tileHeight;\n                    left = col * settings.tileWidth;\n\n                    tileWidth = (col === cols - 1) ? lastWidth : settings.tileWidth;\n\n                    imageURL = (settings.isIIIF) ? baseImageURL + (col * regionWidth + xOffset) + ',' +\n                    (row * regionHeight + yOffset) + ',' + (tileWidth * zoomDifference) + ',' +\n                    (tileHeight * zoomDifference) + '/' + tileWidth + ',' + iiifSuffix : baseImageURL + tileIndex;\n\n                    // this check looks to see if the tile is already loaded, and then if\n                    // it isn't, if it should be visible.\n                    if (!isTileLoaded(pageIndex, tileIndex, context, left, top))\n                    {\n                        if (isTileVisible(pageIndex, row, col, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                        {\n                            currentTile = new Image();\n                            currentTile.crossOrigin = \"anonymous\";\n\n                            currentTile.onload = getDrawTileFunction(pageIndex, tileIndex, currentTile, left, top);\n                            currentTile.src = imageURL;\n                        }\n                        else\n                            allTilesLoaded = false;  // The tile does not need to be loaded - not all have been loaded\n                    }\n\n                    tileIndex++;\n                    col++;\n                }\n\n                row++;\n            }\n\n            settings.allTilesLoaded[pageIndex] = allTilesLoaded;\n        };\n\n        // There are still tiles to load, so try to load those (after the delay specified in loadPage)\n        var loadPageTiles = function (pageIndex, filename, width, height, pageSelector)\n        {\n            var pageElement = document.getElementById(settings.ID + 'page-' + pageIndex);\n            var outer = document.getElementById(settings.outerElement);\n            var viewportTop = outer.scrollTop;\n            var viewportBottom = viewportTop + settings.panelHeight;\n            var viewportLeft = outer.scrollLeft;\n            var viewportRight = viewportLeft + settings.panelWidth;\n\n            // If the page is no longer in the viewport or loaded, don't load any tiles\n            if (pageElement === null || !isPageVisible(pageIndex, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                return;\n\n            var canvasElement = document.getElementById(settings.ID + 'canvas-' + pageIndex);\n\n            loadTiles(pageIndex, filename, width, height, canvasElement, viewportTop, viewportLeft, viewportRight, viewportBottom);\n\n            diva.Events.publish(\"PageDidLoad\", [pageIndex, filename, pageSelector], self);\n        };\n\n        // Appends the page directly into the document body, or loads the relevant tiles\n        var loadPage = function (pageIndex)\n        {\n            // If the page and all of its tiles have been loaded, or if we are in book layout and the canvas is non-paged, exit\n            if ((isPageLoaded(pageIndex) && settings.allTilesLoaded[pageIndex]) || (settings.inBookLayout && settings.documentPaged && !settings.pages[pageIndex].paged))\n                return;\n\n            var isPreloaded = typeof settings.pagePreloadCanvases[pageIndex] !== 'undefined';\n\n            // Load some data for this page\n            var filename = settings.pages[pageIndex].f;\n            var width = Math.floor(getPageData(pageIndex, 'w'));\n            var height = Math.floor(getPageData(pageIndex, 'h'));\n            var heightFromTop = settings.pageTopOffsets[pageIndex] + settings.verticalPadding;\n            var widthFromLeft = settings.pageLeftOffsets[pageIndex] + settings.horizontalPadding;\n            var pageSelector = settings.selector + 'page-' + pageIndex;\n            var plugin;\n\n            // If the page has not been loaded yet, append the div to the DOM\n            if (!isPageLoaded(pageIndex))\n            {\n                var innerElement = document.getElementById(settings.innerElement);\n\n                var pageElement = document.createElement('div');\n                pageElement.id = settings.ID + 'page-' + pageIndex;\n                pageElement.classList.add('diva-page', 'diva-document-page');\n                pageElement.setAttribute('data-index', pageIndex);\n                pageElement.setAttribute('data-filename', filename);\n                pageElement.style.width = width + 'px';\n                pageElement.style.height = height + 'px';\n                if (settings.enableImageTitles) pageElement.title = \"Page \" + (pageIndex + 1);\n                // Append page tools\n                pageElement.innerHTML = settings.pageTools;\n\n                var canvasElement;\n\n                // Append canvas element\n                if (isPreloaded)\n                {\n                    canvasElement = settings.pagePreloadCanvases[pageIndex];\n\n                    settings.pagePreloadCanvases[pageIndex] = undefined;\n                }\n                else\n                {\n                    canvasElement = document.createElement('canvas');\n                    canvasElement.width = width;\n                    canvasElement.height = height;\n                }\n\n                canvasElement.style.width = width + 'px';\n                canvasElement.style.height = height + 'px';\n                canvasElement.id = settings.ID + 'canvas-' + pageIndex;\n                canvasElement.setAttribute('class', 'diva-canvas');\n                pageElement.appendChild(canvasElement);\n\n                if (settings.verticallyOriented)\n                {\n                    pageElement.style.top = heightFromTop + 'px';\n\n                    if (settings.inBookLayout)\n                    {\n                        pageElement.style.left = widthFromLeft + 'px';\n                        if (pageIndex % 2)\n                        {\n                            pageElement.classList.add('diva-page-book-left');\n                        }\n                        else\n                        {\n                            if (pageIndex === 0)\n                            {\n                                // create a placeholder div for the left side of the first opening\n                                var placeholderElement = document.createElement('div');\n                                placeholderElement.id = settings.ID + 'page-placeholder';\n                                placeholderElement.classList.add('diva-page', 'diva-document-page');\n                                placeholderElement.style.width = width + 'px';\n                                placeholderElement.style.height = height + 'px';\n                                placeholderElement.style.top = 0;\n                                placeholderElement.style.left = 0 - width + 'px';\n                                placeholderElement.style.border = '1px solid #ccc';\n                                placeholderElement.style.background = '#fdfdfd';\n                                placeholderElement.style.mozBoxSizing = 'border-box';\n                                placeholderElement.style.webkitBoxSizing = 'border-box';\n                                placeholderElement.style.boxSizing = 'border-box';\n                                // append the placeholder element to page as first child\n                                pageElement.appendChild(placeholderElement);\n                            }\n                            pageElement.classList.add('diva-page-book');\n                        }\n                    }\n                    else\n                    {\n                        pageElement.classList.add('diva-page-vertical');\n                    }\n                }\n                else\n                {\n                    pageElement.style.left = widthFromLeft + 'px';\n                    pageElement.classList.add('diva-page-horizontal');\n                }\n\n                innerElement.appendChild(pageElement);\n                diva.Events.publish(\"PageWillLoad\", [pageIndex, filename, pageSelector], self);\n            }\n\n            if (!isPreloaded)\n            {\n                settings.pageTimeouts.push(setTimeout(loadPageTiles, settings.pageLoadTimeout, pageIndex, filename, width, height));\n            }\n        };\n\n        var preloadPage = function(pageIndex, viewportTop, viewportLeft, viewportRight, viewportBottom)\n        {\n            // Exit if we've already started preloading this page and we're not still zooming\n            if (typeof settings.pagePreloadCanvases[pageIndex] !== 'undefined' && !settings.isZooming)\n                return;\n\n            var filename = settings.pages[pageIndex].f;\n            var width = Math.floor(getPageData(pageIndex, 'w'));\n            var height = Math.floor(getPageData(pageIndex, 'h'));\n            var pageSelector = settings.selector + 'page-' + pageIndex;\n\n            // New off-screen canvas\n            var pageCanvas = document.createElement('canvas');\n            pageCanvas.width = width;\n            pageCanvas.height = height;\n\n            // If corresponding page is in previousZoomLevelCanvases, copy existing image from previous zoom level, scaled, to canvas\n            if (settings.previousZoomLevelCanvases[pageIndex])\n            {\n                var oldCanvas = settings.previousZoomLevelCanvases[pageIndex];\n                var newCanvasContext = pageCanvas.getContext('2d');\n                newCanvasContext.drawImage(oldCanvas, 0, 0, width, height);\n            }\n\n            // Load visible page tiles into canvas\n            loadTiles(pageIndex, filename, width, height, pageCanvas, viewportTop, viewportLeft, viewportRight, viewportBottom);\n\n            diva.Events.publish(\"PageDidLoad\", [pageIndex, filename, pageSelector], self);\n\n            return pageCanvas;\n        };\n\n        // Delete a page from the DOM; will occur when a page is scrolled out of the viewport\n        var deletePage = function (pageIndex)\n        {\n            var theNode = document.getElementById(settings.ID + 'page-' + pageIndex);\n\n            if (theNode === null)\n                return;\n\n            while (theNode.firstChild)\n            {\n                theNode.removeChild(theNode.firstChild);\n            }\n\n            //delete loaded tiles\n            settings.loadedTiles[pageIndex] = [];\n\n            theNode.parentNode.removeChild(theNode);\n        };\n\n        // Check if the bottom of a page is above the top of a viewport (scrolling down)\n        // For when you want to keep looping but don't want to load a specific page\n        var pageAboveViewport = function (pageIndex)\n        {\n            var bottomOfPage = settings.pageTopOffsets[pageIndex] + getPageData(pageIndex, 'h') + settings.verticalPadding;\n            var topOfViewport = document.getElementById(settings.outerElement).scrollTop;\n\n            return bottomOfPage < topOfViewport;\n        };\n\n        // Check if the top of a page is below the bottom of a viewport (scrolling up)\n        var pageBelowViewport = function (pageIndex)\n        {\n            var topOfPage = settings.pageTopOffsets[pageIndex];\n            var bottomOfViewport = document.getElementById(settings.outerElement).scrollTop + settings.panelHeight;\n\n            return topOfPage > bottomOfViewport;\n        };\n\n        // Check if the left side of a page is to the left of a viewport (scrolling right)\n        // For when you want to keep looping but don't want to load a specific page\n        var pageLeftOfViewport = function (pageIndex)\n        {\n            var rightOfPage = settings.pageLeftOffsets[pageIndex] + getPageData(pageIndex, 'w') + settings.horizontalPadding;\n            var leftOfViewport = document.getElementById(settings.outerElement).scrollLeft;\n\n            return rightOfPage < leftOfViewport;\n        };\n\n        // Check if the right side of a page is to the right of a viewport (scrolling left)\n        var pageRightOfViewport = function (pageIndex)\n        {\n            var leftOfPage = settings.pageLeftOffsets[pageIndex];\n            var rightOfViewport = document.getElementById(settings.outerElement).scrollLeft + settings.panelWidth;\n\n            return leftOfPage > rightOfViewport;\n        };\n\n        //shorthand functions to determine which is the right \"before\" viewport function to use\n        var pageBeforeViewport = function (pageIndex)\n        {\n            return (settings.verticallyOriented ? pageAboveViewport(pageIndex) : pageLeftOfViewport(pageIndex));\n        };\n\n        //shorthand functions to determine which is the right \"after\" viewport function to use\n        var pageAfterViewport = function (pageIndex)\n        {\n            return (settings.verticallyOriented ? pageBelowViewport(pageIndex) : pageRightOfViewport(pageIndex));\n        };\n\n        // Called by adjust pages - determine what pages should be visible, and show them\n        var attemptPageShow = function (pageIndex, direction, viewportTop, viewportLeft, viewportRight, viewportBottom)\n        {\n            if (isPageValid(pageIndex))\n            {\n                if (direction > 0)\n                {\n                    // Direction is positive - we're scrolling down\n                    // If the page should be visible, then yes, add it\n                    if (isPageVisible(pageIndex, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                    {\n                        loadPage(pageIndex);\n                        settings.lastPageLoaded = pageIndex;\n\n                        // Recursively call this function until there's nothing to add\n                        attemptPageShow(settings.lastPageLoaded + 1, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    }\n                    else if (isPageValid(pageIndex + 1) && isPageVisible(pageIndex + 1, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                    {\n                        loadPage(pageIndex + 1);\n                        settings.lastPageLoaded = pageIndex + 1;\n\n                        // Recursively call this function until there's nothing to add\n                        attemptPageShow(settings.lastPageLoaded + 1, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    }\n                    else if (pageBeforeViewport(pageIndex))\n                    {\n                        // If the page is below the viewport. try to load the next one\n                        attemptPageShow(pageIndex + 1, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    }\n                }\n                else\n                {\n                    // Direction is negative - we're scrolling up\n                    // If it's near the viewport, yes, add it\n                    if (isPageVisible(pageIndex, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                    {\n                        loadPage(pageIndex);\n\n                        // Reset the first page loaded to this one\n                        settings.firstPageLoaded = pageIndex;\n\n                        // Recursively call this function until there's nothing to add\n                        attemptPageShow(settings.firstPageLoaded - 1, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    }\n                    else if (isPageValid(pageIndex - 1) && isPageVisible(pageIndex - 1, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                    {\n                        loadPage(pageIndex - 1);\n                        settings.firstPageLoaded = pageIndex - 1;\n\n                        // Recursively call this function until there's nothing to add\n                        attemptPageShow(settings.firstPageLoaded - 1, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    }\n                    else if (pageAfterViewport(pageIndex))\n                    {\n                        // Attempt to call this on the next page, do not increment anything\n                        attemptPageShow(pageIndex - 1, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    }\n                }\n            }\n        };\n\n        // Called by adjustPages - see what pages need to be hidden, and hide them\n        var attemptPageHide = function (pageIndex, direction)\n        {\n            if (direction > 0)\n            {\n                // Scrolling down - see if this page needs to be deleted from the DOM\n                if (isPageValid(pageIndex) && pageBeforeViewport(pageIndex))\n                {\n                    // Yes, delete it, reset the first page loaded\n                    deletePage(pageIndex);\n                    settings.firstPageLoaded = pageIndex + 1;\n\n                    // Try to call this function recursively until there's nothing to delete\n                    attemptPageHide(settings.firstPageLoaded, direction);\n                }\n            }\n            else\n            {\n                // Direction must be negative (not 0 - see adjustPages), we're scrolling up\n                if (isPageValid(pageIndex) && pageAfterViewport(pageIndex))\n                {\n                    // Yes, delete it, reset the last page loaded\n                    deletePage(pageIndex);\n                    settings.lastPageLoaded = pageIndex - 1;\n\n                    // Try to call this function recursively until there's nothing to delete\n                    attemptPageHide(settings.lastPageLoaded, direction);\n                }\n            }\n        };\n\n        // Handles showing and hiding pages when the user scrolls\n        var adjustPages = function (direction)\n        {\n            var i;\n\n            // Cache scroll state\n            var outerElement = document.getElementById(settings.outerElement);\n            var viewportTop = outerElement.scrollTop;\n            var viewportLeft = outerElement.scrollLeft;\n            var viewportRight = viewportLeft + settings.panelWidth;\n            var viewportBottom = viewportTop + settings.panelHeight;\n\n            if (direction < 0)\n            {\n                // Direction is negative, so we're scrolling up/left (doesn't matter for these calls)\n                // Attempt showing pages in ascending order starting from the last visible page in the viewport\n                attemptPageShow(settings.lastPageLoaded, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                setCurrentPage(-1);\n                attemptPageHide(settings.lastPageLoaded, direction);\n            }\n            else if (direction > 0)\n            {\n                // Direction is positive so we're scrolling down/right (doesn't matter for these calls)\n                // Attempt showing pages in descending order starting from the first visible page in the viewport\n                attemptPageShow(settings.firstPageLoaded, direction, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                setCurrentPage(1);\n                attemptPageHide(settings.firstPageLoaded, direction);\n            }\n            else\n            {\n                if (settings.inBookLayout)\n                {\n                    setCurrentPage(0);\n                }\n\n                // Non-primary scroll, check if we need to reveal any tiles\n                var lpl = settings.lastPageLoaded;\n                for (i = Math.max(settings.firstPageLoaded, 0); i <= lpl; i++)\n                {\n                    if (isPageVisible(i, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                        loadPage(i);\n                }\n            }\n\n            var scrollSoFar = (settings.verticallyOriented ? outerElement.scrollTop : outerElement.scrollLeft);\n\n            diva.Events.publish(\"ViewerDidScroll\", [scrollSoFar], self);\n\n            if (direction > 0)\n            {\n                // scrolling forwards\n                diva.Events.publish(\"ViewerDidScrollDown\", [scrollSoFar], self);\n            }\n            else if (direction < 0)\n            {\n                // scrolling backwards\n                diva.Events.publish(\"ViewerDidScrollUp\", [scrollSoFar], self);\n            }\n        };\n\n        // Check if a row index is valid\n        var isRowValid = function (rowIndex)\n        {\n            return rowIndex >= 0 && rowIndex < settings.numRows;\n        };\n\n        // Check if a row should be visible in the viewport\n        var isRowVisible = function (rowIndex, viewportTop, viewportBottom)\n        {\n            var topOfRow = settings.rowHeight * rowIndex;\n            var bottomOfRow = topOfRow + settings.rowHeight + settings.fixedPadding;\n\n            return isVerticallyInViewport(topOfRow, bottomOfRow, viewportTop, viewportBottom);\n        };\n\n        // Check if a row (in grid view) is present in the DOM\n        var isRowLoaded = function (rowIndex)\n        {\n            return !!document.getElementById(settings.ID + 'row-' + rowIndex);\n        };\n\n        var loadRow = function (rowIndex)\n        {\n            // If the row has already been loaded, don't attempt to load it again\n            if (isRowLoaded(rowIndex))\n                return;\n\n            // Load some data for this and initialise some variables\n            var heightFromTop = (settings.rowHeight * rowIndex) + settings.fixedPadding;\n            var innerElem = document.getElementById(settings.ID + \"inner\");\n\n            // Create the row div\n            var rowDiv = document.createElement('div');\n            rowDiv.id = settings.ID + 'row-' + rowIndex;\n            rowDiv.classList.add('diva-row');\n            rowDiv.style.height = settings.rowHeight + 'px';\n            rowDiv.style.top = heightFromTop + 'px';\n\n            // Create the opening tag for the row div\n            innerElem.appendChild(rowDiv);\n\n            // Declare variables used in the loop\n            var i, pageIndex, filename, realWidth, realHeight, pageWidth, pageHeight, leftOffset, imageURL, version, quality, iiifSuffix;\n            var imdir = settings.imageDir + \"/\";\n\n            // Load each page within that row\n            var ppr = settings.pagesPerRow;\n            for (i = 0; i < ppr; i++)\n            {\n                pageIndex = rowIndex * settings.pagesPerRow + i;\n\n                // If this page is the last row, don't try to load a nonexistent page\n                if (!isPageValid(pageIndex))\n                    break;\n\n                // Calculate the width, height and horizontal placement of this page\n                filename = settings.pages[pageIndex].f;\n                realWidth = getPageData(pageIndex, 'w');\n                realHeight = getPageData(pageIndex, 'h');\n                pageWidth = (settings.fixedHeightGrid) ? (settings.rowHeight - settings.fixedPadding) * realWidth / realHeight : settings.gridPageWidth;\n                pageHeight = (settings.fixedHeightGrid) ? settings.rowHeight - settings.fixedPadding : pageWidth / realWidth * realHeight;\n                leftOffset = parseInt(i * (settings.fixedPadding + settings.gridPageWidth) + settings.fixedPadding, 10);\n\n                version = settings.pages[pageIndex].api;\n                quality = (version >= 2.0) ? 'default' : 'native';\n                iiifSuffix = ',/0/' + quality + '.jpg';\n\n                // Make sure they're all integers for nice, round numbers\n                pageWidth = parseInt(pageWidth, 10);\n                pageHeight = parseInt(pageHeight, 10);\n\n                // Center the page if the height is fixed (otherwise, there is no horizontal padding)\n                leftOffset += (settings.fixedHeightGrid) ? (settings.gridPageWidth - pageWidth) / 2 : 0;\n                imageURL = (settings.isIIIF) ? encodeURI(settings.pages[pageIndex].url + 'full/' + pageWidth + iiifSuffix) : encodeURI(settings.iipServerURL + \"?FIF=\" + imdir + filename + '&HEI=' + (pageHeight + 2) + '&CVT=JPEG');\n\n                settings.pageTopOffsets[pageIndex] = heightFromTop;\n                settings.pageLeftOffsets[pageIndex] = leftOffset;\n\n                // Append the HTML for this page to the string builder array\n                var pageDiv = document.createElement('div');\n                pageDiv.id = settings.ID + 'page-' + pageIndex;\n                var pageSelector = settings.selector + 'page-' + pageIndex;\n                pageDiv.classList.add('diva-page', 'diva-grid-page');\n                pageDiv.style.width = pageWidth + 'px';\n                pageDiv.style.height = pageHeight + 'px';\n                pageDiv.style.left = leftOffset + 'px';\n                pageDiv.setAttribute('data-index', pageIndex);\n                pageDiv.setAttribute('data-filename', filename);\n                if (settings.enableImageTitles) pageDiv.title = \"Page \" + (pageIndex + 1);\n\n                rowDiv.appendChild(pageDiv);\n\n                diva.Events.publish(\"PageWillLoad\", [pageIndex, filename, pageSelector], self);\n\n                // Add each image to a queue so that images aren't loaded unnecessarily\n                addPageToQueue(rowIndex, pageIndex, imageURL, pageWidth, pageHeight);\n            }\n        };\n\n        var deleteRow = function (rowIndex)\n        {\n            var theNode = document.getElementById(settings.ID + 'row-' + rowIndex);\n            if (theNode === null)\n                return;\n\n            while (theNode.firstChild)\n            {\n                theNode.removeChild(theNode.firstChild);\n            }\n            theNode.parentNode.removeChild(theNode);\n        };\n\n        // Check if the bottom of a row is above the top of the viewport (scrolling down)\n        var rowAboveViewport = function (rowIndex)\n        {\n            var bottomOfRow = settings.rowHeight * (rowIndex + 1);\n            var topOfViewport = document.getElementById(settings.outerElement).scrollTop;\n\n            return (bottomOfRow < topOfViewport);\n        };\n\n        // Check if the top of a row is below the bottom of the viewport (scrolling up)\n        var rowBelowViewport = function (rowIndex)\n        {\n            var topOfRow = settings.rowHeight * rowIndex;\n            var bottomOfViewport = document.getElementById(settings.outerElement).scrollTop + settings.panelHeight;\n\n            return (topOfRow > bottomOfViewport);\n        };\n\n        // Same thing as attemptPageShow only with rows\n        var attemptRowShow = function (rowIndex, direction, viewportTop, viewportBottom)\n        {\n            if (direction > 0)\n            {\n                if (isRowValid(rowIndex))\n                {\n                    if (isRowVisible(rowIndex, viewportTop, viewportBottom))\n                    {\n                        loadRow(rowIndex);\n                        settings.lastRowLoaded = rowIndex;\n\n                        attemptRowShow(settings.lastRowLoaded + 1, direction, viewportTop, viewportBottom);\n                    }\n                    else if (rowAboveViewport(rowIndex))\n                    {\n                        attemptRowShow(rowIndex + 1, direction, viewportTop, viewportBottom);\n                    }\n                }\n            }\n            else\n            {\n                if (isRowValid(rowIndex))\n                {\n                    if (isRowVisible(rowIndex, viewportTop, viewportBottom))\n                    {\n                        loadRow(rowIndex);\n                        settings.firstRowLoaded = rowIndex;\n\n                        attemptRowShow(settings.firstRowLoaded - 1, direction, viewportTop, viewportBottom);\n                    }\n                    else if (rowBelowViewport(rowIndex))\n                    {\n                        attemptRowShow(rowIndex - 1, direction, viewportTop, viewportBottom);\n                    }\n                }\n            }\n        };\n\n        var attemptRowHide = function (rowIndex, direction)\n        {\n            if (direction > 0)\n            {\n                if (isRowValid(rowIndex) && rowAboveViewport(rowIndex))\n                {\n                    deleteRow(rowIndex);\n                    settings.firstRowLoaded++;\n\n                    attemptRowHide(settings.firstRowLoaded, direction);\n                }\n            }\n            else\n            {\n                if (isRowValid(rowIndex) && rowBelowViewport(rowIndex))\n                {\n                    deleteRow(rowIndex);\n                    settings.lastRowLoaded--;\n\n                    attemptRowHide(settings.lastRowLoaded, direction);\n                }\n            }\n        };\n\n        var adjustRows = function (direction)\n        {\n            // Cache scroll state\n            var viewportTop = document.getElementById(settings.outerElement).scrollTop;\n            var viewportBottom = viewportTop + settings.panelHeight;\n\n            if (direction < 0)\n            {\n                attemptRowShow(settings.firstRowLoaded, -1, viewportTop, viewportBottom);\n                setCurrentRow(-1);\n                attemptRowHide(settings.lastRowLoaded, -1);\n            }\n            else if (direction > 0)\n            {\n                attemptRowShow(settings.lastRowLoaded, 1, viewportTop, viewportBottom);\n                setCurrentRow(1);\n                attemptRowHide(settings.firstRowLoaded, 1);\n            }\n\n            var newTopScroll = document.getElementById(settings.outerElement).scrollTop;\n\n            diva.Events.publish(\"ViewerDidScroll\", [newTopScroll], self);\n\n            // If we're scrolling down\n            if (direction > 0)\n            {\n                diva.Events.publish(\"ViewerDidScrollDown\", [newTopScroll], self);\n            }\n            else if (direction < 0)\n            {\n                // We're scrolling up\n                diva.Events.publish(\"ViewerDidScrollUp\", [newTopScroll], self);\n            }\n        };\n\n        // Used to delay loading of page images in grid view to prevent unnecessary loads\n        var addPageToQueue = function (rowIndex, pageIndex, imageURL, pageWidth, pageHeight)\n        {\n            var loadFunction = function (rowIndex, pageIndex, imageURL, pageWidth, pageHeight)\n            {\n                if (isPageLoaded(pageIndex))\n                {\n                    var imgEl = document.createElement('img');\n                    imgEl.src = imageURL;\n                    imgEl.style.width = pageWidth + 'px';\n                    imgEl.style.height = pageHeight + 'px';\n                    document.getElementById(settings.ID + 'page-' + pageIndex).appendChild(imgEl);\n                }\n            };\n            settings.pageTimeouts.push(\n                window.setTimeout(loadFunction, settings.rowLoadTimeout, rowIndex, pageIndex, imageURL, pageWidth, pageHeight));\n        };\n\n        // Clamp pages to those with 'viewingHint: paged' === true (applicable only when document viewingHint === 'paged', see IIIF Presentation API 2.0)\n        // Traverses pages in the specified direction looking for the closest visible page\n        var getClosestVisiblePage = function(pageIndex, direction)\n        {\n            var totalPages = settings.numPages;\n\n            if (settings.documentPaged && settings.inBookLayout)\n            {\n                while (pageIndex > 0 && pageIndex < totalPages)\n                {\n                    if (settings.pages[pageIndex].paged)\n                    {\n                        return pageIndex;\n                    }\n\n                    pageIndex += direction;\n                }\n            }\n\n            return pageIndex;\n        };\n\n        // Determines and sets the \"current page\" (settings.currentPageIndex); called within adjustPages\n        // The \"direction\" is either 1 (downward scroll) or -1 (upward scroll)\n        var setCurrentPage = function (direction)\n        {\n            var currentPage = settings.currentPageIndex;\n            var pageToConsider = currentPage + direction;\n            var outerElement = document.getElementById(settings.outerElement);\n\n            pageToConsider = getClosestVisiblePage(pageToConsider, direction);\n\n            if (!isPageValid(pageToConsider))\n                return false;\n\n            var middleOfViewport = (settings.verticallyOriented ? outerElement.scrollTop + (settings.panelHeight / 2) : outerElement.scrollLeft + (settings.panelWidth / 2));\n            var verticalMiddleOfViewport = outerElement.scrollLeft + (settings.panelWidth / 2);\n            var changeCurrentPage = false;\n\n            if (direction < 0)\n            {\n                // When scrolling forwards:\n                // If the previous page > middle of viewport\n                if (settings.verticallyOriented)\n                {\n                    if (pageToConsider >= 0 && (settings.pageTopOffsets[pageToConsider] + getPageData(pageToConsider, 'h') + (settings.verticalPadding) >= middleOfViewport))\n                    {\n                        changeCurrentPage = true;\n                    }\n                }\n                else\n                {\n                    if (pageToConsider >= 0 && (settings.pageLeftOffsets[pageToConsider] + getPageData(pageToConsider, 'w') + (settings.horizontalPadding) >= middleOfViewport))\n                    {\n                        changeCurrentPage = true;\n                    }\n                }\n            }\n            else if (direction > 0)\n            {\n                // When scrolling backwards:\n                // If this page < middle of viewport\n                if (settings.verticallyOriented)\n                {\n                    if (settings.pageTopOffsets[currentPage] + getPageData(currentPage, 'h') + settings.verticalPadding < middleOfViewport)\n                    {\n                        changeCurrentPage = true;\n                    }\n                }\n                else\n                {\n                    if (settings.pageLeftOffsets[currentPage] + getPageData(currentPage, 'w') + settings.horizontalPadding < middleOfViewport)\n                    {\n                        changeCurrentPage = true;\n                    }\n                }\n            }\n\n            if (settings.inBookLayout && settings.verticallyOriented)\n            {\n                // if the viewer is scrolled to the rightmost side, switch the current page to that on the right. if less, choose the page on the left.\n                var isScrolledToRight = verticalMiddleOfViewport > settings.maxWidths[settings.zoomLevel];\n                var bookDirection = (isScrolledToRight) ? 1 : -1;\n                var bookPageToConsider = currentPage + bookDirection;\n                var isValidPagePosition;\n\n                bookPageToConsider = getClosestVisiblePage(bookPageToConsider, bookDirection);\n\n                if (isScrolledToRight)\n                {\n                    // the viewer is scrolled to the rightmost page, switch to next page if it's on the right\n                    isValidPagePosition = settings.pageLeftOffsets[bookPageToConsider] >= (settings.maxWidths[settings.zoomLevel] / 2);\n                }\n                else\n                {\n                    // the viewer is scrolled to the leftmost page, switch to previous page if it's on the left\n                    isValidPagePosition = settings.pageLeftOffsets[bookPageToConsider] < (settings.maxWidths[settings.zoomLevel] / 2);\n                }\n\n                if (isValidPagePosition && bookPageToConsider !== settings.currentPageIndex)\n                {\n                    settings.currentPageIndex = bookPageToConsider;\n                    diva.Events.publish(\"VisiblePageDidChange\", [bookPageToConsider, settings.pages[bookPageToConsider].f], self);\n                }\n            }\n\n            if (changeCurrentPage)\n            {\n                // Set this to the current page\n                settings.currentPageIndex = pageToConsider;\n                // Now try to change the next page, given that we're not going to a specific page\n                // Calls itself recursively - this way we accurately obtain the current page\n                if (direction !== 0)\n                {\n                    if (!setCurrentPage(direction))\n                    {\n                        var filename = settings.pages[pageToConsider].f;\n                        diva.Events.publish(\"VisiblePageDidChange\", [pageToConsider, filename], self);\n                    }\n                }\n                return true;\n            }\n\n            return false;\n        };\n\n        // Sets the current page in grid view\n        var setCurrentRow = function (direction)\n        {\n            var currentRow = Math.floor(settings.currentPageIndex / settings.pagesPerRow);\n            var rowToConsider = currentRow + parseInt(direction, 10);\n            var topScroll = document.getElementById(settings.outerElement).scrollTop;\n            var middleOfViewport = topScroll + (settings.panelHeight / 2);\n            var changeCurrentRow = false;\n\n            if (direction < 0)\n            {\n                if (rowToConsider >= 0 && (settings.rowHeight * currentRow >= middleOfViewport || settings.rowHeight * rowToConsider >= topScroll))\n                {\n                    changeCurrentRow = true;\n                }\n            }\n            else if (direction > 0)\n            {\n                if ((settings.rowHeight * (currentRow + 1)) < topScroll && isRowValid(rowToConsider))\n                {\n                    changeCurrentRow = true;\n                }\n            }\n\n            if (changeCurrentRow)\n            {\n                settings.currentPageIndex = rowToConsider * settings.pagesPerRow;\n\n                if (direction !== 0)\n                {\n                    if (!setCurrentRow(direction))\n                    {\n                        var pageIndex = settings.currentPageIndex;\n                        var filename = settings.pages[pageIndex].f;\n                        diva.Events.publish(\"VisiblePageDidChange\", [pageIndex, filename], self);\n                    }\n                }\n\n                return true;\n            }\n\n            return false;\n        };\n\n        //Helper function for going to the top of a specific page\n        var gotoPageTop = function (pageIndex)\n        {\n            var verticalOffset = getYOffset(pageIndex, \"top\");\n            var horizontalOffset = getXOffset(pageIndex, \"center\");\n\n            gotoPage(pageIndex, verticalOffset, horizontalOffset);\n        };\n\n        var calculateDesiredScroll = function(pageIndex, verticalOffset, horizontalOffset)\n        {\n            // convert offsets to 0 if undefined\n            horizontalOffset = (typeof horizontalOffset !== 'undefined') ? horizontalOffset : 0;\n            verticalOffset = (typeof verticalOffset !== 'undefined') ? verticalOffset : 0;\n\n            var desiredVerticalCenter = settings.pageTopOffsets[pageIndex] + verticalOffset;\n            var desiredTop = desiredVerticalCenter - parseInt(settings.panelHeight / 2, 10);\n\n            var desiredHorizontalCenter = settings.pageLeftOffsets[pageIndex] + horizontalOffset;\n            var desiredLeft = desiredHorizontalCenter - parseInt(settings.panelWidth / 2, 10);\n\n            return {\n                top: desiredTop,\n                left: desiredLeft\n            };\n        };\n\n        // Helper function for going to a particular page\n        // Vertical offset: from center of diva element to top of current page\n        // Horizontal offset: from the center of the page; can be negative if to the left\n        var gotoPage = function (pageIndex, verticalOffset, horizontalOffset)\n        {\n            var desiredScroll = calculateDesiredScroll(pageIndex, verticalOffset, horizontalOffset);\n\n            var outerElement = document.getElementById(settings.outerElement);\n            outerElement.scrollTop = desiredScroll.top;\n            outerElement.scrollLeft = desiredScroll.left;\n\n            // Pretend that this is the current page\n            if (pageIndex !== settings.currentPageIndex)\n            {\n                settings.currentPageIndex = pageIndex;\n                var filename = settings.pages[pageIndex].f;\n\n                diva.Events.publish(\"VisiblePageDidChange\", [pageIndex, filename], self);\n            }\n\n            diva.Events.publish(\"ViewerDidJump\", [pageIndex], self);\n        };\n\n        // Calculates the desired row, then scrolls there\n        var gotoRow = function (pageIndex)\n        {\n            var desiredRow = Math.floor(pageIndex / settings.pagesPerRow);\n            document.getElementById(settings.outerElement).scrollTop = desiredRow * settings.rowHeight;\n\n            // Pretend that this is the current page (it probably isn't)\n            settings.currentPageIndex = pageIndex;\n            var filename = settings.pages[pageIndex].f;\n            diva.Events.publish(\"VisiblePageDidChange\", [pageIndex, filename], self);\n        };\n\n        // Don't call this when not in grid mode please\n        // Scrolls to the relevant place when in grid view\n        var gridScroll = function ()\n        {\n            // Figure out and scroll to the row containing the current page\n            gotoRow(settings.goDirectlyTo);\n        };\n\n        // If the given zoom level is valid, returns it; else, returns the min\n        var getValidZoomLevel = function (zoomLevel)\n        {\n            return (zoomLevel >= settings.minZoomLevel && zoomLevel <= settings.maxZoomLevel) ? zoomLevel : settings.minZoomLevel;\n        };\n\n        var getValidPagesPerRow = function (pagesPerRow)\n        {\n            return (pagesPerRow >= settings.minPagesPerRow && pagesPerRow <= settings.maxPagesPerRow) ? pagesPerRow : settings.maxPagesPerRow;\n        };\n\n        // Reset some settings and empty the viewport\n        var clearViewer = function ()\n        {\n            // Post-zoom: clear scaling\n            var innerElement = document.getElementById(settings.innerElement);\n            innerElement.style.transition = '';\n            innerElement.style.transform = '';\n            innerElement.style.transformOrigin = '';\n\n            settings.allTilesLoaded = [];\n            document.getElementById(settings.outerElement).scrollTop = 0;\n\n            while (innerElement.firstChild)\n            {\n                innerElement.removeChild(innerElement.firstChild);\n            }\n\n            settings.firstPageLoaded = 0;\n            settings.firstRowLoaded = -1;\n            settings.previousTopScroll = 0;\n            settings.previousLeftScroll = 0;\n\n            // Clear all the timeouts to prevent undesired pages from loading\n            clearTimeout(settings.resizeTimer);\n\n            while (settings.pageTimeouts.length)\n            {\n                clearTimeout(settings.pageTimeouts.pop());\n            }\n        };\n\n        // Called when we don't necessarily know which view to go into\n        var loadViewer = function ()\n        {\n            if (settings.inGrid)\n                loadGrid();\n            else\n                loadDocument();\n        };\n\n        var calculatePageOffsets = function(widthToSet, heightToSet)\n        {\n            // Set settings.pageTopOffsets/pageLeftOffsets to determine where we're going to need to scroll, reset them in case they were used for grid before\n            var heightSoFar = 0;\n            var widthSoFar = 0;\n            var i;\n\n            settings.pageTopOffsets = [];\n            settings.pageLeftOffsets = [];\n\n            if (settings.inBookLayout)\n            {\n                var isLeft = false;\n\n                if (settings.verticallyOriented)\n                {\n                    for (i = 0; i < settings.numPages; i++)\n                    {\n                        //set the height above that page counting only every other page and excluding non-paged canvases\n                        //height of this 'row' = max(height of the pages in this row)\n\n                        settings.pageTopOffsets[i] = heightSoFar;\n\n                        if (isLeft)\n                        {\n                            //page on the left\n                            settings.pageLeftOffsets[i] = (widthToSet / 2) - getPageData(i, 'w') - settings.horizontalPadding;\n                        }\n                        else\n                        {\n                            //page on the right\n                            settings.pageLeftOffsets[i] = (widthToSet / 2) - settings.horizontalPadding;\n\n                            //increment the height\n                            if (!settings.documentPaged || settings.pages[i].paged)\n                            {\n                                var pageHeight = (isPageValid(i - 1)) ? Math.max(getPageData(i, 'h'), getPageData(i - 1, 'h')) : getPageData(i, 'h');\n                                heightSoFar = settings.pageTopOffsets[i] + pageHeight + settings.verticalPadding;\n                            }\n                        }\n\n                        //don't include non-paged canvases in layout calculation\n                        if (!settings.documentPaged || settings.pages[i].paged)\n                            isLeft = !isLeft;\n                    }\n                }\n                else\n                {\n                    // book, horizontally oriented\n                    for (i = 0; i < settings.numPages; i++)\n                    {\n                        settings.pageTopOffsets[i] = parseInt((heightToSet - getPageData(i, 'h')) / 2, 10);\n                        settings.pageLeftOffsets[i] = widthSoFar;\n\n                        var pageWidth = getPageData(i, 'w');\n                        var padding = (isLeft) ? 0 : settings.horizontalPadding;\n                        widthSoFar = settings.pageLeftOffsets[i] + pageWidth + padding;\n\n                        if (!settings.documentPaged || settings.pages[i].paged)\n                            isLeft = !isLeft;\n                    }\n                }\n            }\n            else\n            {\n                for (i = 0; i < settings.numPages; i++)\n                {\n                    // First set the height above that page by adding this height to the previous total\n                    // A page includes the padding above it\n                    settings.pageTopOffsets[i] = parseInt(settings.verticallyOriented ? heightSoFar : (heightToSet - getPageData(i, 'h')) / 2, 10);\n                    settings.pageLeftOffsets[i] = parseInt(settings.verticallyOriented ? (widthToSet - getPageData(i, 'w')) / 2 : widthSoFar, 10);\n\n                    // Has to be done this way otherwise you get the height of the page included too\n                    heightSoFar = settings.pageTopOffsets[i] + getPageData(i, 'h') + settings.verticalPadding;\n                    widthSoFar = settings.pageLeftOffsets[i] + getPageData(i, 'w') + settings.horizontalPadding;\n                }\n            }\n        };\n\n        var calculateDocumentDimensions = function(zoomLevel)\n        {\n            var maxWidthToSet = (settings.inBookLayout) ? (settings.maxWidths[zoomLevel] + settings.horizontalPadding) * 2 : settings.maxWidths[zoomLevel] + settings.horizontalPadding * 2;\n            var maxHeightToSet = settings.maxHeights[zoomLevel] + settings.verticalPadding * 2;\n            var widthToSet = Math.max(maxWidthToSet, settings.panelWidth);\n            var heightToSet = Math.max(maxHeightToSet, settings.panelHeight);\n\n            return {\n                widthToSet: widthToSet,\n                heightToSet: heightToSet\n            };\n        };\n\n        // Called every time we need to load document view (after zooming, fullscreen, etc)\n        var loadDocument = function ()\n        {\n            // re-attach scroll event to outer div (necessary if we just zoomed)\n            settings.outerObject.off('scroll');\n            settings.outerObject.scroll(scrollFunction);\n\n            clearViewer();\n\n            diva.Events.publish('DocumentWillLoad', [settings], self);\n\n            settings.zoomLevel = getValidZoomLevel(settings.zoomLevel);\n            var z = settings.zoomLevel;\n\n            //TODO skip this if we just zoomed (happens in preloadPages)\n            // Determine the length of the non-primary dimension of the inner element\n            var documentDimensions = calculateDocumentDimensions(z);\n\n            settings.totalHeight = settings.totalHeights[z] + settings.verticalPadding * (settings.numPages + 1);\n            settings.totalWidth = settings.totalWidths[z] + settings.horizontalPadding * (settings.numPages + 1);\n\n            // Calculate page layout (settings.pageTopOffsets, settings.pageLeftOffsets)\n            calculatePageOffsets(documentDimensions.widthToSet, documentDimensions.heightToSet);\n\n            //Set the inner element to said width\n            var innerEl = document.getElementById(settings.innerElement);\n\n            if (settings.verticallyOriented)\n            {\n                innerEl.style.height = Math.round(settings.totalHeight) + 'px';\n                innerEl.style.width = Math.round(documentDimensions.widthToSet) + 'px';\n            }\n            else\n            {\n                innerEl.style.height = Math.round(documentDimensions.heightToSet) + 'px';\n                innerEl.style.width = Math.round(settings.totalWidth) + 'px';\n            }\n\n            // In book view, determine the total height/width based on the last opening's height/width and offset\n            var lastPageIndex = settings.numPages - 1;\n\n            if (settings.inBookLayout)\n            {\n                if (settings.verticallyOriented)\n                {\n                    // Last opening height is the max height of the last two pages if they are an opening, else the height of the last page since it's on its own on the left\n                    // If the last page is page 0, then it's on its own on the right\n                    var lastOpeningHeight = (lastPageIndex % 2 || lastPageIndex === 0) ? getPageData(lastPageIndex, 'h') : Math.max(getPageData(lastPageIndex, 'h'), getPageData(lastPageIndex - 1, 'h'));\n                    innerEl.style.height = settings.pageTopOffsets[lastPageIndex] + lastOpeningHeight + (settings.verticalPadding * 2) + 'px';\n                }\n                else\n                {\n                    innerEl.style.width = settings.pageLeftOffsets[lastPageIndex] + getPageData(lastPageIndex, 'w') + (settings.horizontalPadding * 2) + 'px';\n                }\n            }\n\n            // Make sure the value for settings.goDirectlyTo is valid\n            if (!isPageValid(settings.goDirectlyTo))\n            {\n                settings.goDirectlyTo = 0;\n            }\n\n            // Scroll to the proper place using stored y/x offsets (relative to the center of the page)\n            gotoPage(settings.goDirectlyTo, settings.verticalOffset, settings.horizontalOffset);\n\n            // Once the viewport is aligned, we can determine which pages will be visible and load them\n            var pageBlockFound = false;\n\n            var outer = document.getElementById(settings.outerElement);\n            var viewportTop = outer.scrollTop;\n            var viewportBottom = viewportTop + settings.panelHeight;\n\n            var viewportLeft = outer.scrollLeft;\n            var viewportRight = viewportLeft + settings.panelWidth;\n\n            for (var i = 0; i < settings.numPages; i++)\n            {\n                if (isPageVisible(i, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                {\n                    loadPage(i);\n\n                    settings.lastPageLoaded = i;\n                    pageBlockFound = true;\n                }\n                else if (pageBlockFound) // There will only be one consecutive block of pages to load; once we find a page that's invisible, we can terminate this loop.\n                {\n                    break;\n                }\n            }\n\n            // If this is not the initial load, trigger the zoom events\n            if (settings.oldZoomLevel >= 0)\n            {\n                if (settings.oldZoomLevel < settings.zoomLevel)\n                {\n                    diva.Events.publish(\"ViewerDidZoomIn\", [z], self);\n                }\n                else\n                {\n                    diva.Events.publish(\"ViewerDidZoomOut\", [z], self);\n                }\n\n                diva.Events.publish(\"ViewerDidZoom\", [z], self);\n            }\n            else\n            {\n                settings.oldZoomLevel = settings.zoomLevel;\n            }\n\n            // For the iPad - wait until this request finishes before accepting others\n            if (settings.scaleWait)\n                settings.scaleWait = false;\n\n            var fileName = settings.pages[settings.currentPageIndex].f;\n            diva.Events.publish(\"DocumentDidLoad\", [settings.currentPageIndex, fileName], self);\n        };\n\n        var loadGrid = function ()\n        {\n            var pageIndex = settings.currentPageIndex;\n            settings.verticalOffset = (settings.verticallyOriented ? (settings.panelHeight / 2) : getPageData(pageIndex, \"h\") / 2);\n            settings.horizontalOffset = (settings.verticallyOriented ? getPageData(pageIndex, \"w\") / 2 : (settings.panelWidth / 2));\n\n            clearViewer();\n\n            // Make sure the pages per row setting is valid\n            settings.pagesPerRow = getValidPagesPerRow(settings.pagesPerRow);\n\n            var horizontalPadding = settings.fixedPadding * (settings.pagesPerRow + 1);\n            var pageWidth = (settings.panelWidth - horizontalPadding) / settings.pagesPerRow;\n            settings.gridPageWidth = pageWidth;\n\n            // Calculate the row height depending on whether we want to fix the width or the height\n            settings.rowHeight = (settings.fixedHeightGrid) ? settings.fixedPadding + settings.minRatio * pageWidth : settings.fixedPadding + settings.maxRatio * pageWidth;\n            settings.numRows = Math.ceil(settings.numPages / settings.pagesPerRow);\n            settings.totalHeight = settings.numRows * settings.rowHeight + settings.fixedPadding;\n\n            var innerEl = document.getElementById(settings.innerElement);\n            innerEl.style.height = Math.round(settings.totalHeight) + 'px';\n            innerEl.style.width = Math.round(settings.panelWidth) + 'px';\n\n            // First scroll directly to the row containing the current page\n            gridScroll();\n\n            var i, rowIndex;\n            settings.pageTopOffsets = [];\n            settings.pageLeftOffsets = [];\n\n            var viewportTop = document.getElementById(settings.outerElement).scrollTop;\n            var viewportBottom = viewportTop + settings.panelHeight;\n\n            // Figure out the row each page is in\n            var np = settings.numPages;\n            for (i = 0; i < np; i += settings.pagesPerRow)\n            {\n                rowIndex = Math.floor(i / settings.pagesPerRow);\n\n                if (isRowVisible(rowIndex, viewportTop, viewportBottom))\n                {\n                    settings.firstRowLoaded = (settings.firstRowLoaded < 0) ? rowIndex : settings.firstRowLoaded;\n                    loadRow(rowIndex);\n                    settings.lastRowLoaded = rowIndex;\n                }\n            }\n        };\n\n        //Shortcut for closing fullscreen with the escape key\n        var escapeListener = function (e)\n        {\n            if (e.keyCode == 27)\n                toggleFullscreen();\n        };\n\n        // Handles switching in and out of fullscreen mode\n        // Should only be called after changing settings.inFullscreen\n        var handleModeChange = function (changeView)\n        {\n            // Toggle the classes\n            settings.outerObject.toggleClass('diva-fullscreen');\n            $('body').toggleClass('diva-hide-scrollbar');\n            settings.parentObject.toggleClass('diva-full-width');\n\n            // Adjust Diva's internal panel size, keeping the old values\n            var storedHeight = settings.panelHeight;\n            var storedWidth = settings.panelWidth;\n            updatePanelSize();\n\n            // If this isn't the original load...\n            if (settings.oldZoomLevel >= 0 && !settings.inGrid)\n            {\n                //get the updated panel size\n                var newHeight = settings.panelHeight;\n                var newWidth = settings.panelWidth;\n\n                //and re-center the new panel on the same point\n                if (settings.inFullscreen)\n                {\n                    settings.verticalOffset -= ((newHeight - storedHeight) / 2);\n                    settings.horizontalOffset -= ((newWidth - storedWidth) / 2);\n                }\n                else\n                {\n                    settings.verticalOffset += ((storedHeight - newHeight) / 2);\n                    settings.horizontalOffset += ((storedWidth - newWidth) / 2);\n                }\n            }\n\n            // If setState changes both view and mode, trigger that here\n            if (changeView)\n            {\n                settings.inGrid = !settings.inGrid;\n                handleViewChange();\n            }\n            else\n            {\n                loadViewer();\n            }\n\n            //turn on/off escape key listener\n            if (settings.inFullscreen)\n                $(document).on('keyup', escapeListener);\n            else\n                $(document).off('keyup', escapeListener);\n\n           diva.Events.publish(\"ModeDidSwitch\", [settings.inFullscreen], self);\n        };\n\n        // Handles switching in and out of grid view\n        // Should only be called after changing settings.inGrid\n        var handleViewChange = function ()\n        {\n            loadViewer();\n\n            // Switch the slider\n            diva.Events.publish(\"ViewDidSwitch\", [settings.inGrid], self);\n            return true;\n        };\n\n        // Called when the fullscreen icon is clicked\n        var toggleFullscreen = function ()\n        {\n            settings.goDirectlyTo = settings.currentPageIndex;\n            settings.inFullscreen = !settings.inFullscreen;\n            handleModeChange(false);\n        };\n\n        // Called when the change view icon is clicked\n        var changeView = function (destinationView)\n        {\n            settings.goDirectlyTo = settings.currentPageIndex;\n\n            switch (destinationView)\n            {\n                case 'document':\n                    settings.inGrid = false;\n                    settings.inBookLayout = false;\n                    break;\n\n                case 'book':\n                    settings.inGrid = false;\n                    settings.inBookLayout = true;\n                    break;\n\n                case 'grid':\n                    settings.inGrid = true;\n                    break;\n\n                default:\n                    return false;\n            }\n\n            return handleViewChange();\n        };\n\n        //toggles between orientations\n        var toggleOrientation = function ()\n        {\n            settings.verticallyOriented = !settings.verticallyOriented;\n            settings.verticalOffset = getYOffset();\n            settings.horizontalOffset = getXOffset();\n            settings.goDirectlyTo = settings.currentPageIndex;\n\n            //if in grid, switch out of grid\n            if (settings.inGrid)\n            {\n                settings.inGrid = false;\n                handleViewChange();\n            }\n            else\n            {\n                loadDocument();\n            }\n            return settings.verticallyOriented;\n        };\n\n        // Called after double-click or ctrl+double-click events on pages in document view\n        var handleDocumentDoubleClick = function (event)\n        {\n            // Hold control to zoom out, otherwise, zoom in\n            var newZoomLevel = (event.ctrlKey) ? settings.zoomLevel - 1 : settings.zoomLevel + 1;\n            var zoomRatio = Math.pow(2, newZoomLevel - settings.zoomLevel);\n\n            var pageOffset = this.getBoundingClientRect();\n            var outerElement = document.getElementById(settings.outerElement);\n            var outerPosition = outerElement.getBoundingClientRect();\n\n            settings.doubleClickZoom = true;\n\n            // when double-click zooming, the part of the page under the cursor is the scale origin\n            // calculate distance from cursor coordinates to center of viewport\n            var clickXToCenter = event.pageX - (outerPosition.left + (settings.panelWidth / 2));\n            var clickYToCenter = event.pageY - (outerPosition.top + (settings.panelHeight / 2));\n\n            // calculate horizontal/verticalOffset: distance from viewport center to page upper left corner\n            // (these offsets are multiplied by zoomRatio in handleZoom to determine the coordinates at the new zoom level)\n            settings.horizontalOffset = (event.pageX - pageOffset.left) - (clickXToCenter / zoomRatio);\n            settings.verticalOffset = (event.pageY - pageOffset.top) - (clickYToCenter / zoomRatio);\n\n            // compensate for interpage padding\n            //TODO still a few pixels unaccounted for\n            //settings.verticalOffset += (settings.verticallyOriented) ? settings.verticalPadding / zoomRatio : 0;\n            settings.verticalOffset += (settings.verticallyOriented) ? settings.verticalPadding : 0;\n            settings.horizontalOffset += (settings.verticallyOriented && !settings.inBookLayout) ? 0 : settings.horizontalPadding;\n\n            // calculate click coordinates for smooth zoom transition: distance from edge of inner to cursor\n            var dblClickX = event.pageX + outerElement.scrollLeft  - outerPosition.left;\n            var dblClickY = event.pageY + outerElement.scrollTop - outerPosition.top;\n\n            settings.goDirectlyTo = parseInt($(this).attr('data-index'), 10); //page index\n\n            handleZoom(newZoomLevel, dblClickX, dblClickY);\n        };\n\n        // Called after double-clicking on a page in grid view\n        var handleGridDoubleClick = function (event)\n        {\n            var pageIndex = parseInt($(this).attr('data-index'), 10);\n            settings.goDirectlyTo = pageIndex;\n            var pageOffset = $(this).offset();\n            var zoomProportion = getPageData(pageIndex, \"w\") / $(this).width();\n\n            settings.horizontalOffset = (event.pageX - pageOffset.left) * zoomProportion;\n            settings.verticalOffset = (event.pageY - pageOffset.top) * zoomProportion;\n\n            // Leave grid view, jump directly to the desired page\n            settings.inGrid = false;\n            handleViewChange();\n        };\n\n        // Handles pinch-zooming for mobile devices\n        var handlePinchZoom = function (zoomDelta, event)\n        {\n            var newZoomLevel = settings.zoomLevel;\n\n            // First figure out the new zoom level:\n            if (zoomDelta > 100 && newZoomLevel < settings.maxZoomLevel)\n                newZoomLevel++;\n            else if (zoomDelta < -100 && newZoomLevel > settings.minZoomLevel)\n                newZoomLevel--;\n            else\n                return;\n\n            // Set scaleWait to true so that we wait for this scale event to finish\n            settings.scaleWait = true;\n\n            // Store the offset information so that it can be used in loadDocument()\n            var pageOffset = $(this).offset();\n            settings.horizontalOffset = event.pageX - pageOffset.left;\n            settings.verticalOffset = event.pageY - pageOffset.top;\n            settings.goDirectlyTo = parseInt($(this).attr('data-index'), 10); //page index\n\n            handleZoom(newZoomLevel);\n        };\n\n        var preloadPages = function()\n        {\n            //1. determine visible pages at new zoom level\n            //    a. recalculate page layout at new zoom level\n            var documentDimensions = calculateDocumentDimensions(settings.zoomLevel);\n            calculatePageOffsets(documentDimensions.widthToSet, documentDimensions.heightToSet);\n\n            //    b. determine diva-inner's visible rectangle\n            var viewportRectangle = calculateDesiredScroll(settings.currentPageIndex, settings.verticalOffset, settings.horizontalOffset);\n\n            //    c. for all pages (see loadDocument)\n            //        i) if page coords fall within visible coords, add to visible page block\n            var pageBlockFound = false;\n\n            var viewportTop = viewportRectangle.top;\n            var viewportLeft = viewportRectangle.left;\n            var viewportRight = viewportRectangle.left + settings.panelWidth;\n            var viewportBottom = viewportRectangle.top + settings.panelHeight;\n\n            for (var i = 0; i < settings.numPages; i++)\n            {\n                if (isPageVisible(i, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                {\n                    // it will be visible, start loading it at the new zoom level into an offscreen canvas\n                    settings.pagePreloadCanvases[i] = preloadPage(i, viewportTop, viewportLeft, viewportRight, viewportBottom);\n                    pageBlockFound = true;\n                }\n                else if (pageBlockFound) // There will only be one consecutive block of pages to load; once we find a page that's invisible, we can terminate this loop.\n                {\n                    break;\n                }\n            }\n        };\n\n        // Called to handle any zoom level\n        var handleZoom = function (newValue, dblClickX, dblClickY)\n        {\n            var innerElement = document.getElementById(settings.innerElement);\n            var outerElement = document.getElementById(settings.outerElement);\n\n            var newZoomLevel = getValidZoomLevel(newValue);\n            var originX;\n            var originY;\n\n            // If the zoom level provided is invalid, return false\n            if (newZoomLevel !== newValue)\n                return false;\n\n            var zoomRatio = Math.pow(2, newZoomLevel - settings.zoomLevel);\n\n            // Scale padding with zoom\n            settings.unclampedVerticalPadding *= zoomRatio;\n            settings.horizontalPadding *= zoomRatio;\n\n            // Make sure the vertical padding is at least 40, if plugin icons are enabled\n            settings.verticalPadding = (settings.pageTools.length) ? Math.max(settings.unclampedVerticalPadding, 40) : settings.unclampedVerticalPadding;\n\n            // verticalOffset and horizontalOffset refer to the distance from the top/left of the current page that the center (or clicked coordinates) of the viewport is.\n            // for example: if the viewport is 800 pixels and the active page is 600 pixels wide and starts at 100 pixels, verticalOffset will be 300 pixels.\n            if (settings.doubleClickZoom)\n            {\n                settings.verticalOffset *= zoomRatio;\n                settings.horizontalOffset *= zoomRatio;\n\n                settings.doubleClickZoom = false;\n\n                originX = dblClickX;\n                originY = dblClickY;\n                innerElement.style.transformOrigin = originX + 'px ' + originY + 'px';\n            }\n            else\n            {\n                // If already currently zooming, maintain origin position\n                if (settings.isZooming)\n                {\n                    settings.verticalOffset *= zoomRatio;\n                    settings.horizontalOffset *= zoomRatio;\n                }\n                else\n                {\n                    settings.goDirectlyTo = settings.currentPageIndex;\n\n                    // Calculate new offsets for loadDocument\n                    settings.verticalOffset = zoomRatio * getCurrentYOffset();\n                    settings.horizontalOffset = zoomRatio * getCurrentXOffset();\n\n                    // Calculate new zoom transition origin coordinates (originX measured from left of inner div, originY measured from top of inner div)\n                    var scrollTop = outerElement.scrollTop;\n                    var elementHeight = settings.panelHeight;\n                    originY = scrollTop + parseInt(elementHeight / 2, 10);\n\n                    var scrollLeft = outerElement.scrollLeft;\n                    var elementWidth = settings.panelWidth;\n                    originX = scrollLeft + parseInt(elementWidth / 2, 10);\n\n                    innerElement.style.transformOrigin = originX + 'px ' + originY + 'px';\n                }\n            }\n\n            // Before the first zoom, save currently visible canvases in previousZoomLevelCanvases so preloadPages can start drawing overtop the existing page data\n            if (!settings.isZooming)\n            {\n                var pageBlockFound = false;\n\n                var viewportTop = outerElement.scrollTop;\n                var viewportBottom = viewportTop + settings.panelHeight;\n                var viewportLeft = outerElement.scrollLeft;\n                var viewportRight = viewportLeft + settings.panelWidth;\n\n                for (var pageIndex = 0; pageIndex < settings.numPages; pageIndex++)\n                {\n                    if (isPageVisible(pageIndex, viewportTop, viewportLeft, viewportRight, viewportBottom))\n                    {\n                        settings.previousZoomLevelCanvases[pageIndex] = document.getElementById(settings.ID + 'canvas-' + pageIndex);\n                        pageBlockFound = true;\n                    }\n                    else if (pageBlockFound)\n                    {\n                        break;\n                    }\n                }\n            }\n\n            // Update the zoom level\n            settings.oldZoomLevel = settings.zoomLevel;\n            settings.zoomLevel = newZoomLevel;\n\n            // If first zoom, set transition parameters TODO css class\n            if (!settings.isZooming)\n            {\n                innerElement.style.transition = 'transform .3s cubic-bezier(0.000, 0.990, 1.000, 0.995)';\n            }\n\n            // If still zooming, zoomRatio needs to be multiplied by the previous zoomRatio and is reset on transitionend\n            zoomRatio *= settings.previousZoomRatio;\n            settings.previousZoomRatio = zoomRatio;\n\n            // Transition to new zoom level\n            innerElement.style.transform = 'scale(' + zoomRatio + ')';\n\n            // Set flag to indicate zooming is in progress until loadDocument is called by transitionend\n            settings.isZooming = true;\n\n            // Starts preloading pages for the new zoom level\n            preloadPages();\n\n            // Update the slider\n            diva.Events.publish(\"ZoomLevelDidChange\", [newZoomLevel], self);\n\n            // While zooming, don't update scroll offsets based on the scaled version of diva-inner\n            settings.outerObject.off('scroll');\n\n            return true;\n        };\n\n        // Called to handle changing the pages per row slider\n        var handleGrid = function (newValue)\n        {\n            var newPagesPerRow = getValidPagesPerRow(newValue);\n\n            // If the value provided is invalid, return false\n            if (newPagesPerRow !== newValue)\n                return false;\n\n            settings.pagesPerRow = newPagesPerRow;\n\n            // Update the slider\n            diva.Events.publish(\"GridRowNumberDidChange\", [newPagesPerRow], self);\n\n            settings.goDirectlyTo = settings.currentPageIndex;\n            loadGrid();\n\n            return true;\n        };\n\n        /*\n        Gets the Y-offset for a specific point on a specific page\n        Acceptable values for \"anchor\":\n            \"top\" (default) - will anchor top of the page to the top of the diva-outer element\n            \"bottom\" - top, s/top/bottom\n            \"center\" - will center the page on the diva element\n        Returned value will be the distance from the center of the diva-outer element to the top of the current page for the specified anchor\n        */\n        var getYOffset = function (pageIndex, anchor)\n        {\n            pageIndex = (typeof(pageIndex) === \"undefined\" ? settings.currentPageIndex : pageIndex);\n\n            if (anchor === \"center\" || anchor === \"centre\") //how you can tell an American coded this\n            {\n                return parseInt(getPageData(pageIndex, \"h\") / 2, 10);\n            }\n            else if (anchor === \"bottom\")\n            {\n                return parseInt(getPageData(pageIndex, \"h\") - settings.panelHeight / 2, 10);\n            }\n            else\n            {\n                return parseInt(settings.panelHeight / 2, 10);\n            }\n        };\n\n        //Same as getYOffset with \"left\" and \"right\" as acceptable values instead of \"top\" and \"bottom\"\n        var getXOffset = function (pageIndex, anchor)\n        {\n            pageIndex = (typeof(pageIndex) === \"undefined\" ? settings.currentPageIndex : pageIndex);\n\n            if (anchor === \"left\")\n            {\n                return parseInt(settings.panelWidth / 2, 10);\n            }\n            else if (anchor === \"right\")\n            {\n                return parseInt(getPageData(pageIndex, \"w\") - settings.panelWidth / 2, 10);\n            }\n            else\n            {\n                return parseInt(getPageData(pageIndex, \"w\") / 2, 10);\n            }\n        };\n\n        //gets distance from the center of the diva-outer element to the top of the current page\n        var getCurrentYOffset = function()\n        {\n            var scrollTop = document.getElementById(settings.outerElement).scrollTop;\n            var elementHeight = settings.panelHeight;\n\n            return (scrollTop - settings.pageTopOffsets[settings.currentPageIndex] + parseInt(elementHeight / 2, 10));\n        };\n\n        //gets distance from the center of the diva-outer element to the left of the current page\n        var getCurrentXOffset = function()\n        {\n            var scrollLeft = document.getElementById(settings.outerElement).scrollLeft;\n            var elementWidth = settings.panelWidth;\n\n            return (scrollLeft - settings.pageLeftOffsets[settings.currentPageIndex] + parseInt(elementWidth / 2, 10));\n        };\n\n        var getState = function ()\n        {\n            var view;\n\n            if (settings.inGrid)\n            {\n                view = 'g';\n            }\n            else if (settings.inBookLayout)\n            {\n                view = 'b';\n            }\n            else\n            {\n                view = 'd';\n            }\n\n            var state = {\n                'f': settings.inFullscreen,\n                'v': view,\n                'z': settings.zoomLevel,\n                'n': settings.pagesPerRow,\n                'i': (settings.enableFilename) ? settings.pages[settings.currentPageIndex].f : false,\n                'p': (settings.enableFilename) ? false : settings.currentPageIndex + 1,\n                'y': (settings.inGrid) ? false : getCurrentYOffset(),\n                'x': (settings.inGrid) ? false : getCurrentXOffset()\n            };\n\n            return state;\n        };\n\n        var getURLHash = function ()\n        {\n            var hashParams = getState();\n            var hashStringBuilder = [];\n            var param;\n\n            for (param in hashParams)\n            {\n                if (hashParams[param] !== false)\n                    hashStringBuilder.push(param + settings.hashParamSuffix + '=' + encodeURIComponent(hashParams[param]));\n            }\n\n            return hashStringBuilder.join('&');\n        };\n\n        // Returns the URL to the current state of the document viewer (so it should be an exact replica)\n        var getCurrentURL = function ()\n        {\n            return location.protocol + '//' + location.host + location.pathname + location.search + '#' + getURLHash();\n        };\n\n        // updates panelHeight/panelWidth on resize\n        var updatePanelSize = function ()\n        {\n            var outerElem = document.getElementById(settings.outerElement);\n            settings.panelHeight = outerElem.clientHeight - (outerElem.scrollWidth > outerElem.clientWidth ? settings.scrollbarWidth : 0);\n            settings.panelWidth = outerElem.clientWidth - (outerElem.scrollHeight > outerElem.clientHeight ? settings.scrollbarWidth : 0);\n\n            settings.horizontalOffset = getCurrentXOffset();\n            settings.verticalOffset = getCurrentYOffset();\n\n            gotoPage(settings.currentPageIndex, settings.verticalOffset, settings.horizontalOffset);\n            return true;\n        };\n\n        // Bind mouse events (drag to scroll, double-click)\n        var bindMouseEvents = function()\n        {\n            // Set drag scroll on first descendant of class dragger on both selected elements\n            settings.outerObject.dragscrollable({dragSelector: '.diva-dragger', acceptPropagatedEvent: true});\n            settings.innerObject.dragscrollable({dragSelector: '.diva-dragger', acceptPropagatedEvent: true});\n\n            // Double-click to zoom\n            settings.outerObject.on('dblclick', '.diva-document-page', function (event)\n            {\n                if (!event.ctrlKey)\n                {\n                    handleDocumentDoubleClick.call(this, event);\n                }\n            });\n\n            // Handle the control key for macs (in conjunction with double-clicking)\n            settings.outerObject.on('contextmenu', '.diva-document-page', function (event)\n            {\n                if (event.ctrlKey)\n                {\n                    // In Firefox, this doesn't trigger a double-click, so we apply one manually\n                    clearTimeout(settings.singleClickTimeout);\n\n                    if (settings.singleClick)\n                    {\n                        handleDocumentDoubleClick.call(this, event);\n                        settings.singleClick = false;\n                    }\n                    else\n                    {\n                        settings.singleClick = true;\n\n                        // Set it to false again after 500 milliseconds (standard double-click timeout)\n                        settings.singleClickTimeout = setTimeout(function ()\n                        {\n                            settings.singleClick = false;\n                        }, 500);\n                    }\n                }\n\n                return false;\n            });\n\n            settings.outerObject.on('dblclick', '.diva-row', function (event)\n            {\n                handleGridDoubleClick.call($(event.target).parent(), event);\n            });\n\n        };\n\n        var onResize = function()\n        {\n            updatePanelSize();\n            // Cancel any previously-set resize timeouts\n            clearTimeout(settings.resizeTimer);\n\n            settings.resizeTimer = setTimeout(function ()\n            {\n                settings.goDirectlyTo = settings.currentPageIndex;\n                settings.verticalOffset = getCurrentYOffset();\n                settings.horizontalOffset = getCurrentXOffset();\n                loadViewer();\n            }, 200);\n        };\n\n        // Bind touch and orientation change events\n        var bindTouchEvents = function()\n        {\n            // Block the user from moving the window only if it's not integrated\n            if (settings.blockMobileMove)\n            {\n                $('body').bind('touchmove', function (event)\n                {\n                    var e = event.originalEvent;\n                    e.preventDefault();\n\n                    return false;\n                });\n            }\n\n            // Touch events for swiping in the viewport to scroll pages\n            settings.outerObject.kinetic({\n                triggerHardware: true\n            });\n\n            // Bind events for pinch-zooming\n            var start = [],\n                move = [],\n                startDistance = 0;\n\n            settings.outerObject.on('touchstart', '.diva-document-page', function(event)\n            {\n                // Prevent mouse event from firing\n                event.preventDefault();\n\n                if (event.originalEvent.touches.length === 2)\n                {\n                    start = [event.originalEvent.touches[0].clientX,\n                             event.originalEvent.touches[0].clientY,\n                             event.originalEvent.touches[1].clientX,\n                             event.originalEvent.touches[1].clientY];\n\n                    startDistance = distance(start[2], start[0], start[3], start[1]);\n                }\n            });\n\n            settings.outerObject.on('touchmove', '.diva-document-page', function(event)\n            {\n                // Prevent mouse event from firing\n                event.preventDefault();\n\n                if (event.originalEvent.touches.length === 2)\n                {\n                    move = [event.originalEvent.touches[0].clientX,\n                            event.originalEvent.touches[0].clientY,\n                            event.originalEvent.touches[1].clientX,\n                            event.originalEvent.touches[1].clientY];\n\n                    var moveDistance = distance(move[2], move[0], move[3], move[1]);\n                    var zoomDelta = moveDistance - startDistance;\n\n                    if (!settings.scaleWait)\n                    {\n                        // Save the page we're currently on so we scroll there\n                        settings.goDirectlyTo = settings.currentPageIndex;\n\n                        if (settings.inGrid)\n                        {\n                            settings.inGrid = false;\n                            handleViewChange();\n                        }\n                        else\n                        {\n                            handlePinchZoom.call(this, zoomDelta, event);\n                        }\n                    }\n                }\n            });\n\n            var firstTapCoordinates = {},\n                tapDistance = 0;\n\n            var onDoubleTap = function(event)\n            {\n                // Prevent mouse event from firing\n                event.preventDefault();\n\n                if (settings.singleTap)\n                {\n                    // Doubletap has occurred\n                    var touchEvent = {\n                        pageX: event.originalEvent.changedTouches[0].clientX,\n                        pageY: event.originalEvent.changedTouches[0].clientY\n                    };\n\n                    // If first tap is close to second tap (prevents interference with scale event)\n                    tapDistance = distance(firstTapCoordinates.pageX, touchEvent.pageX, firstTapCoordinates.pageY, touchEvent.pageY);\n                    if (tapDistance < 50 && settings.zoomLevel < settings.maxZoomLevel)\n                        if (settings.inGrid)\n                            handleGridDoubleClick.call($(event.target).parent(), touchEvent);\n                        else\n                            handleDocumentDoubleClick.call(this, touchEvent);\n\n                    settings.singleTap = false;\n                    firstTapCoordinates = {};\n                }\n                else\n                {\n                    settings.singleTap = true;\n                    firstTapCoordinates.pageX = event.originalEvent.changedTouches[0].clientX;\n                    firstTapCoordinates.pageY = event.originalEvent.changedTouches[0].clientY;\n\n                    // Cancel doubletap after 250 milliseconds\n                    settings.singleTapTimeout = setTimeout(function()\n                    {\n                        settings.singleTap = false;\n                        firstTapCoordinates = {};\n                    }, 250);\n                }\n            };\n\n            // Document view: Double-tap to zoom in\n            // Grid view: Double-tap to jump to current page in document view\n            settings.outerObject.on('touchend', '.diva-page', onDoubleTap);\n\n        };\n\n        // Pythagorean theorem to get the distance between two points (used for calculating finger distance for double-tap and pinch-zoom)\n        var distance = function(x2, x1, y2, y1)\n        {\n            return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n        };\n\n        // Handle the scroll\n        var scrollFunction = function ()\n        {\n            var direction;\n\n            var outerElement = document.getElementById(settings.outerElement);\n            var newScrollTop = outerElement.scrollTop;\n            var newScrollLeft = outerElement.scrollLeft;\n\n            if (settings.verticallyOriented || settings.inGrid)\n                direction = newScrollTop - settings.previousTopScroll;\n            else\n                direction = newScrollLeft - settings.previousLeftScroll;\n\n            //give adjustPages the direction we care about\n            if (settings.inGrid)\n                adjustRows(direction);\n            else\n                adjustPages(direction);\n\n            settings.previousTopScroll = newScrollTop;\n            settings.previousLeftScroll = newScrollLeft;\n\n            settings.horizontalOffset = getCurrentXOffset();\n            settings.verticalOffset = getCurrentYOffset();\n        };\n\n        // Binds most of the event handlers (some more in createToolbar)\n        var handleEvents = function ()\n        {\n            // Change the cursor for dragging\n            settings.innerObject.mouseover(function ()\n            {\n                $(this).removeClass('diva-grabbing').addClass('diva-grab');\n            });\n\n            settings.innerObject.mouseout(function ()\n            {\n                $(this).removeClass('diva-grab');\n            });\n\n            settings.innerObject.mousedown(function ()\n            {\n                $(this).removeClass('diva-grab').addClass('diva-grabbing');\n            });\n\n            settings.innerObject.mouseup(function ()\n            {\n                $(this).removeClass('diva-grabbing').addClass('diva-grab');\n            });\n\n            bindMouseEvents();\n\n            settings.outerObject.scroll(scrollFunction);\n\n            var upArrowKey = 38,\n                downArrowKey = 40,\n                leftArrowKey = 37,\n                rightArrowKey = 39,\n                spaceKey = 32,\n                pageUpKey = 33,\n                pageDownKey = 34,\n                homeKey = 36,\n                endKey = 35;\n\n            // Catch the key presses in document\n            $(document).on('keydown.diva', function (event)\n            {\n                var outerElement = document.getElementById(settings.ID + 'outer');\n\n                if (!settings.isActiveDiva)\n                    return true;\n\n                // Space or page down - go to the next page\n                if ((settings.enableSpaceScroll && !event.shiftKey && event.keyCode === spaceKey) || (settings.enableKeyScroll && event.keyCode === pageDownKey))\n                {\n                    outerElement.scrollTop += settings.panelHeight;\n                    return false;\n                }\n                else if (!settings.enableSpaceScroll && event.keyCode === spaceKey)\n                {\n                    event.preventDefault();\n                }\n\n                if (settings.enableKeyScroll)\n                {\n                    // Don't steal keyboard shortcuts (metaKey = command [OS X], super [Win/Linux])\n                    if (event.shiftKey || event.ctrlKey || event.metaKey)\n                        return true;\n\n                    switch (event.keyCode)\n                    {\n                        case pageUpKey:\n                            // Page up - go to the previous page\n                            outerElement.scrollTop -= settings.panelHeight;\n                            return false;\n\n                        case upArrowKey:\n                            // Up arrow - scroll up\n                            outerElement.scrollTop -= settings.arrowScrollAmount;\n                            return false;\n\n                        case downArrowKey:\n                            // Down arrow - scroll down\n                            outerElement.scrollTop += settings.arrowScrollAmount;\n                            return false;\n\n                        case leftArrowKey:\n                            // Left arrow - scroll left\n                            outerElement.scrollLeft -= settings.arrowScrollAmount;\n                            return false;\n\n                        case rightArrowKey:\n                            // Right arrow - scroll right\n                            outerElement.scrollLeft += settings.arrowScrollAmount;\n                            return false;\n\n                        case homeKey:\n                            // Home key - go to the beginning of the document\n                            outerElement.scrollTop = 0;\n                            return false;\n\n                        case endKey:\n                            // End key - go to the end of the document\n                            outerElement.scrollTop = settings.totalHeight;\n                            return false;\n\n                        default:\n                            return true;\n                    }\n                }\n                return true;\n            });\n\n            diva.Events.subscribe('ViewerDidTerminate', function()\n            {\n                $(document).off('keydown.diva');\n            }, settings.ID);\n\n            bindTouchEvents();\n\n            // Handle window resizing events\n            window.addEventListener('resize', onResize, false);\n\n            diva.Events.subscribe('ViewerDidTerminate', function()\n            {\n                window.removeEventListener('resize', onResize, false);\n            }, settings.ID);\n\n            // Handle orientation change separately\n            if ('onorientationchange' in window)\n            {\n                window.addEventListener('orientationchange', onResize, false);\n\n                diva.Events.subscribe('ViewerDidTerminate', function()\n                {\n                    window.removeEventListener('orientationchange', onResize, false);\n                }, settings.ID);\n            }\n\n            diva.Events.subscribe('PanelSizeDidChange', updatePanelSize, settings.ID);\n\n            // Detect supported transition end event, bind loadDocument to end of zoom transition\n            // http://stackoverflow.com/a/9090128\n            var getTransitionEndEventName = function()\n            {\n                var i;\n                var undefined;\n                var el = document.createElement('div');\n                var transitions = {\n                    'transition': 'transitionend',\n                    'OTransition': 'otransitionend',\n                    'MozTransition': 'transitionend',\n                    'WebkitTransition': 'webkitTransitionEnd'\n                };\n\n                for (i in transitions)\n                {\n                    if (transitions.hasOwnProperty(i) && el.style[i] !== undefined)\n                    {\n                        return transitions[i];\n                    }\n                }\n\n                return false;\n            };\n\n            var onZoomEnd = function()\n            {\n                settings.isZooming = false;\n\n                settings.previousZoomRatio = 1;\n\n                // Clear the array of canvases at previous zoom level\n                settings.previousZoomLevelCanvases = [];\n\n                loadDocument();\n            };\n\n            var transitionEnd = getTransitionEndEventName();\n\n            if (transitionEnd)\n            {\n                var inner = document.getElementById(settings.innerElement);\n                inner.addEventListener(transitionEnd, onZoomEnd, false);\n            }\n            else\n            {\n                // Fallback for browsers without CSS transitions support\n                diva.Events.subscribe(\"ZoomLevelDidChange\", onZoomEnd, settings.ID);\n            }\n        };\n\n        // Creates a toolbar button\n        var createButtonElement = function(name, label)\n        {\n            var element = document.createElement('span');\n            element.id = settings.ID + name;\n            element.setAttribute('class', 'diva-' + name + ' diva-button');\n            element.title = label;\n\n            return element;\n        };\n\n        var createViewMenuElement = function()\n        {\n            var viewMenuContainer = document.createElement('div');\n            viewMenuContainer.id = settings.ID + 'view-menu';\n            viewMenuContainer.className = 'diva-view-menu';\n\n            var viewMenuButton = createButtonElement('view-icon', 'Change view');\n            viewMenuContainer.appendChild(viewMenuButton);\n\n            var viewOptionsMenu = document.createElement('div');\n            viewOptionsMenu.id = settings.ID + 'view-options';\n            viewOptionsMenu.className = 'diva-view-options';\n            viewMenuContainer.appendChild(viewOptionsMenu);\n\n            return viewMenuContainer;\n        };\n\n        var createSliderElement = function(name, value, min, max)\n        {\n            var sliderElement = document.createElement('input');\n\n            sliderElement.id = settings.ID + name;\n            sliderElement.className = name;\n            sliderElement.setAttribute('type', 'range');\n            sliderElement.setAttribute('value', value);\n            sliderElement.setAttribute('min', min);\n            sliderElement.setAttribute('max', max);\n\n            return sliderElement;\n        };\n\n        var createLabel = function(name, id, label, innerName, innerValue)\n        {\n            var labelContainerElement = document.createElement('div');\n            labelContainerElement.id = settings.ID + id;\n            labelContainerElement.className = name + ' diva-label';\n\n            var zoomLabelNode = document.createTextNode(label);\n            labelContainerElement.appendChild(zoomLabelNode);\n\n            var innerValueElement = document.createElement('span');\n            innerValueElement.id = settings.ID + innerName;\n            var initialInnerValue = document.createTextNode(innerValue);\n            innerValueElement.appendChild(initialInnerValue);\n            labelContainerElement.appendChild(innerValueElement);\n\n            return labelContainerElement;\n        };\n\n        var createPageLabel = function(name)\n        {\n            var labelContainerElement = document.createElement('span');\n            labelContainerElement.className = name + ' diva-label';\n\n            var labelPrefixNode = document.createTextNode('Page ');\n\n            var currentPageElement = document.createElement('span');\n            currentPageElement.id = settings.ID + 'current-page';\n\n            var labelMiddleNode = document.createTextNode(' of ');\n\n            var numPagesElement = document.createElement('span');\n            numPagesElement.id = settings.ID + 'num-pages';\n\n            labelContainerElement.appendChild(labelPrefixNode);\n            labelContainerElement.appendChild(currentPageElement);\n            labelContainerElement.appendChild(labelMiddleNode);\n            labelContainerElement.appendChild(numPagesElement);\n\n            return labelContainerElement;\n        };\n\n        // Handles all status updating etc (both fullscreen and not)\n        var createToolbar = function ()\n        {\n            // Assemble the toolbar components\n            var toolbarNode = document.createElement('div');\n            toolbarNode.id = settings.ID + 'tools';\n            toolbarNode.className = 'diva-tools';\n\n            var divaToolsLeftElement = document.createElement('div');\n            divaToolsLeftElement.id = settings.ID + 'tools-left';\n            divaToolsLeftElement.className = 'diva-tools-left';\n\n            var divaToolsRightElement = document.createElement('div');\n            divaToolsRightElement.id = settings.ID + 'tools-right';\n            divaToolsRightElement.className = 'diva-tools-right';\n\n            // Toolbar Left\n            // Zoom slider/buttons\n            if (settings.enableZoomControls === 'slider')\n            {\n                var zoomControls = createSliderElement('zoom-slider', settings.zoomLevel, settings.minZoomLevel, settings.maxZoomLevel);\n                divaToolsLeftElement.appendChild(zoomControls);\n            }\n            else if (settings.enableZoomControls === 'buttons')\n            {\n                divaToolsLeftElement.appendChild(createButtonElement('zoom-out-button', 'Zoom Out'));\n                divaToolsLeftElement.appendChild(createButtonElement('zoom-in-button', 'Zoom In'));\n            }\n\n            // Grid slider/buttons\n            if (settings.enableGridControls === 'slider')\n            {\n                var gridControls = createSliderElement('grid-slider', settings.pagesPerRow, settings.minPagesPerRow, settings.maxPagesPerRow);\n                divaToolsLeftElement.appendChild(gridControls);\n            }\n            else if (settings.enableGridControls === 'buttons')\n            {\n                divaToolsLeftElement.appendChild(createButtonElement('grid-out-button', 'Zoom Out'));\n                divaToolsLeftElement.appendChild(createButtonElement('grid-in-button', 'Zoom In'));\n            }\n\n            //TODO policy re unspecified enableXControls?\n            // Zoom slider/buttons label\n            if (settings.enableZoomControls === 'slider' || settings.enableZoomControls === 'buttons')\n            {\n                var zoomLabel = createLabel('diva-zoom-label', 'zoom-label', 'Zoom level: ', 'zoom-level', settings.zoomLevel);\n                divaToolsLeftElement.appendChild(zoomLabel);\n            }\n\n            // Grid slider/buttons label\n            if (settings.enableGridControls === 'slider' || settings.enableGridControls === 'buttons')\n            {\n                var gridLabel = createLabel('diva-grid-label', 'grid-label', 'Pages per row: ', 'pages-per-row', settings.pagesPerRow);\n                divaToolsLeftElement.appendChild(gridLabel);\n            }\n\n            // Toolbar right\n\n            // Page Navigation (Go to page form and 'Page x of y label')\n            var pageNavElement = document.createElement('span');\n            pageNavElement.id = settings.ID + 'page-nav';\n            pageNavElement.className = 'diva-page-nav';\n\n            // 'Page x of y' label\n            var pageLabel = createPageLabel('diva-page-label');\n            pageNavElement.appendChild(pageLabel);\n\n            // Go to page form\n            if (settings.enableGotoPage)\n            {\n                var gotoForm = document.createElement('form');\n                gotoForm.id = settings.ID + 'goto-page';\n                gotoForm.className = 'diva-goto-form';\n\n                //input\n                var pageField = document.createElement('input');\n                pageField.id = settings.ID + 'goto-page-input';\n                pageField.className = 'diva-input';\n                pageField.setAttribute('type', 'text');\n                gotoForm.appendChild(pageField);\n\n                //submit button\n                var pageSubmit = document.createElement('input');\n                pageSubmit.setAttribute('type', 'submit');\n                pageSubmit.setAttribute('value', 'Go');\n                gotoForm.appendChild(pageSubmit);\n\n                pageNavElement.appendChild(gotoForm);\n            }\n\n            divaToolsRightElement.appendChild(pageNavElement);\n\n            // View menu\n            var viewMenu = createViewMenuElement();\n            divaToolsRightElement.appendChild(viewMenu);\n\n            // Link icon\n            if (settings.enableLinkIcon)\n            {\n                var linkButton = createButtonElement('link-icon', 'Link to this page');\n                divaToolsRightElement.appendChild(linkButton);\n            }\n\n            // Fullscreen icon\n            if (settings.enableFullscreen)\n            {\n                var fullscreenButton = createButtonElement('fullscreen-icon', 'Toggle fullscreen mode');\n                divaToolsRightElement.appendChild(fullscreenButton);\n            }\n\n            toolbarNode.appendChild(divaToolsLeftElement);\n            toolbarNode.appendChild(divaToolsRightElement);\n\n            settings.toolbarParentObject.prepend(toolbarNode);\n\n            var displayViewMenu = function()\n            {\n                var viewOptions = document.createDocumentFragment();\n                var documentIcon = createButtonElement('document-icon', 'Document View');\n                var bookIcon = createButtonElement('book-icon', 'Book View');\n                var gridIcon = createButtonElement('grid-icon', 'Grid View');\n\n                var viewIcon = document.getElementById(settings.ID + 'view-icon');\n                var viewIconClasses = ' diva-view-icon diva-button';\n\n                // display the icon of the mode we're currently in (?)\n                if (settings.inGrid)\n                {\n                    viewIcon.className = 'diva-grid-icon' + viewIconClasses;\n                }\n                else if (settings.inBookLayout)\n                {\n                    viewIcon.className = 'diva-book-icon' + viewIconClasses;\n                }\n                else\n                {\n                    viewIcon.className = 'diva-document-icon' + viewIconClasses;\n                }\n\n                // then display document, book, and grid buttons in that order, excluding the current view\n                if (settings.inGrid || settings.inBookLayout)\n                    viewOptions.appendChild(documentIcon);\n\n                if (settings.inGrid || !settings.inBookLayout)\n                    viewOptions.appendChild(bookIcon);\n\n                if (!settings.inGrid)\n                    viewOptions.appendChild(gridIcon);\n\n                var viewOptionsElement = document.getElementById(settings.ID + 'view-options');\n\n                // remove old menu\n                while (viewOptionsElement.firstChild)\n                {\n                    viewOptionsElement.removeChild(viewOptionsElement.firstChild);\n                }\n\n                // insert new menu\n                viewOptionsElement.appendChild(viewOptions);\n            };\n\n            // bind zoom slider\n            $(settings.selector + 'zoom-slider').on('input', function(e)\n            {\n                var intValue = parseInt(this.value, 10);\n\n                handleZoom(intValue);\n            });\n\n            $(settings.selector + 'zoom-slider').on('change', function(e)\n            {\n                var intValue = parseInt(this.value, 10);\n                if (intValue !== settings.zoomLevel)\n                    handleZoom(intValue);\n            });\n\n            // Zoom when zoom buttons clicked\n            var zoomButtonClicked = function (direction)\n            {\n                handleZoom(settings.zoomLevel + direction);\n            };\n\n            // Bind the click event to zoom buttons\n            $(settings.selector + 'zoom-out-button').click(function()\n            {\n                zoomButtonClicked(-1);\n            });\n\n            $(settings.selector + 'zoom-in-button').click(function()\n            {\n                zoomButtonClicked(1);\n            });\n\n            //bind grid slider\n            $(settings.selector + 'grid-slider').on('input', function(e)\n            {\n                var intValue = parseInt(this.value, 10);\n                handleGrid(intValue);\n            });\n\n            $(settings.selector + 'grid-slider').on('change', function(e)\n            {\n                var intValue = parseInt(this.value, 10);\n                if (intValue !== settings.zoomLevel)\n                    handleGrid(intValue);\n            });\n\n            // Bind fullscreen button\n            $(settings.selector + 'fullscreen-icon').click(function()\n            {\n                toggleFullscreen();\n            });\n\n            // Bind the grid buttons\n            $(settings.selector + 'grid-out-button').click(function ()\n            {\n                handleGrid(settings.pagesPerRow - 1);\n            });\n\n            $(settings.selector + 'grid-in-button').click(function ()\n            {\n                handleGrid(settings.pagesPerRow + 1);\n            });\n\n            // Handle clicking of the view icon\n            $(settings.selector + 'view-icon').click(function ()\n            {\n                //show view menu\n                $(settings.selector + 'view-options').toggle();\n            });\n\n            $(settings.selector + 'view-options').on('click', '.diva-button', function(event)\n            {\n                // change to the selected view\n                var iconClass = event.target.classList[0];\n                var selectedView;\n\n                if (iconClass === 'diva-document-icon')\n                {\n                    selectedView = 'document';\n                }\n                else if (iconClass === 'diva-book-icon')\n                {\n                    selectedView = 'book';\n                }\n                else if (iconClass === 'diva-grid-icon')\n                {\n                    selectedView = 'grid';\n                }\n\n                diva.Events.publish('UserDidChooseView', [selectedView], self);\n\n                //hide view menu\n                $(settings.selector + 'view-options').hide();\n            });\n\n            diva.Events.subscribe('UserDidChooseView', changeView, settings.ID);\n\n            $(document).mouseup(function (event)\n            {\n                var container = $(settings.selector + 'view-options');\n\n                if (!container.is(event.target) && container.has(event.target).length === 0 && event.target.id !== settings.ID + 'view-icon')\n                {\n                    container.hide();\n                }\n            });\n\n            // Handle going to a specific page using the input box\n            $(settings.selector + 'goto-page').submit(function ()\n            {\n                var desiredPage = parseInt($(settings.selector + 'goto-page-input').val(), 10);\n                var pageIndex = desiredPage - 1;\n\n                if (!isPageValid(pageIndex))\n                {\n                    alert(\"Invalid page number\");\n                }\n                else\n                {\n                    if (settings.inGrid)\n                        gotoRow(pageIndex);\n                    else\n                        gotoPageTop(pageIndex);\n                }\n\n                // Prevent the default action of reloading the page\n                return false;\n            });\n\n            var linkIcon = $(settings.selector + 'link-icon');\n            // Handle the creation of the link popup box\n            linkIcon.click(function ()\n            {\n                $('body').prepend('<div id=\"' + settings.ID + 'link-popup\" class=\"diva-popup diva-link-popup\"><input id=\"' + settings.ID + 'link-popup-input\" class=\"diva-input\" type=\"text\" value=\"' + getCurrentURL() + '\"/></div>');\n\n                if (settings.inFullscreen)\n                {\n                    $(settings.selector + 'link-popup').addClass('in-fullscreen');\n                }\n                else\n                {\n                    // Calculate the left and top offsets\n                    var leftOffset = linkIcon.offset().left - 222 + linkIcon.outerWidth();\n                    var topOffset = linkIcon.offset().top + linkIcon.outerHeight() - 1;\n\n                    $(settings.selector + 'link-popup').removeClass('in-fullscreen').css(\n                    {\n                        'top': topOffset + 'px',\n                        'left': leftOffset + 'px'\n                    });\n                }\n\n                // Catch onmouseup events outside of this div\n                $('body').mouseup(function (event)\n                {\n                    var targetID = event.target.id;\n\n                    if (targetID !== settings.ID + 'link-popup' && targetID !== settings.ID + 'link-popup-input')\n                        $(settings.selector + 'link-popup').remove();\n                });\n\n                // Also delete it upon scroll and page up/down key events\n                settings.outerObject.scroll(function ()\n                {\n                    $(settings.selector + 'link-popup').remove();\n                });\n                $(settings.selector + 'link-popup input').click(function ()\n                {\n                    $(this).focus().select();\n                });\n\n                return false;\n            });\n\n            // Show the relevant slider (or buttons, depending on settings)\n            var currentSlider = (settings.inGrid) ? 'grid' : 'zoom';\n            $(settings.selector + currentSlider + '-slider').css('display', 'inline-block');\n            $(settings.selector + currentSlider + '-out-button').css('display', 'inline-block');\n            $(settings.selector + currentSlider + '-in-button').css('display', 'inline-block');\n            var display = (settings.inFullscreen) ? 'block' : 'inline-block';\n            $(settings.selector + currentSlider + '-label').css('display', display);\n\n            var toolbar =\n            {\n                updateCurrentPage: function ()\n                {\n                    document.getElementById(settings.ID + 'current-page').textContent = parseInt(settings.currentPageIndex, 10) + 1;\n                },\n                setNumPages: function (newNumber)\n                {\n                    document.getElementById(settings.ID + 'num-pages').textContent = newNumber;\n                },\n                updateZoomLabel: function ()\n                {\n                    // Update the position of the handle within the slider\n                    if (settings.enableZoomControls === 'slider' && settings.zoomLevel !== $(settings.selector + 'zoom-slider').val())\n                    {\n                        $(settings.selector + 'zoom-slider').val(settings.zoomLevel);\n                    }\n\n                    // Update the slider label\n                    document.getElementById(settings.ID + 'zoom-level').textContent = settings.zoomLevel.toString();\n                },\n                updateGridLabel: function ()\n                {\n                    // Update the position of the handle within the slider\n                    if (settings.enableGridControls === 'slider' && settings.pagesPerRow !== $(settings.selector + 'grid-slider').val())\n                    {\n                        $(settings.selector + 'grid-slider').val(settings.pagesPerRow);\n                    }\n\n                    // Update the slider label\n                    document.getElementById(settings.ID + 'pages-per-row').textContent = settings.pagesPerRow;\n                },\n                closePopups: function ()\n                {\n                    $('.diva-popup').css('display', 'none');\n                },\n                switchView: function (destinationView)\n                {\n                    $(settings.selector + currentSlider + '-slider').hide();\n                    $(settings.selector + currentSlider + '-out-button').hide();\n                    $(settings.selector + currentSlider + '-in-button').hide();\n                    $(settings.selector + currentSlider + '-label').hide();\n                    currentSlider = (settings.inGrid) ? 'grid' : 'zoom';\n                    $(settings.selector + currentSlider + '-slider').css('display', 'inline-block');\n                    $(settings.selector + currentSlider + '-out-button').css('display', 'inline-block');\n                    $(settings.selector + currentSlider + '-in-button').css('display', 'inline-block');\n                    var display = (settings.inFullscreen) ? 'block' : 'inline-block';\n                    $(settings.selector + currentSlider + '-label').css('display', display);\n                },\n                switchMode: function ()\n                {\n                    var toolsRightElement = document.getElementById(settings.ID + 'tools-right');\n                    var pageNavElement = document.getElementById(settings.ID + 'page-nav');\n                    var display;\n\n                    if (!settings.inFullscreen)\n                    {\n                        // Leaving fullscreen\n                        $(settings.selector + 'tools').removeClass('diva-fullscreen-tools');\n\n                        //move ID-page-nav to beginning of tools right\n                        toolsRightElement.removeChild(pageNavElement);\n                        toolsRightElement.insertBefore(pageNavElement, toolsRightElement.firstChild);\n\n                        // display-inline visible labels\n                        currentSlider = (settings.inGrid) ? 'grid' : 'zoom';\n                        display = (settings.inFullscreen) ? 'block' : 'inline-block';\n                        $(settings.selector + currentSlider + '-label').css('display', display);\n                    }\n                    else\n                    {\n                        // Entering fullscreen\n                        $(settings.selector + 'tools').addClass('diva-fullscreen-tools');\n\n                        //move ID-page-nav to end of tools right\n                        toolsRightElement.removeChild(pageNavElement);\n                        toolsRightElement.appendChild(pageNavElement);\n\n                        // display-block visible labels\n                        currentSlider = (settings.inGrid) ? 'grid' : 'zoom';\n                        display = (settings.inFullscreen) ? 'block' : 'inline-block';\n                        $(settings.selector + currentSlider + '-label').css('display', display);\n                    }\n                },\n                displayViewMenu: displayViewMenu\n            };\n\n            return toolbar;\n        };\n\n        var initPlugins = function ()\n        {\n            if (window.divaPlugins)\n            {\n                var pageTools = [];\n\n                // Add all the plugins that have not been explicitly disabled to settings.plugins\n                $.each(window.divaPlugins, function (index, plugin)\n                {\n                    var pluginProperName = plugin.pluginName[0].toUpperCase() + plugin.pluginName.substring(1);\n\n                    if (settings['enable' + pluginProperName])\n                    {\n                        // Call the init function and check return value\n                        var enablePlugin = plugin.init(settings, self);\n\n                        // If int returns false, consider the plugin disabled\n                        if (!enablePlugin)\n                            return;\n\n                        // If the title text is undefined, use the name of the plugin\n                        var titleText = plugin.titleText || pluginProperName + \" plugin\";\n\n                        // Create the pageTools bar if handleClick is set to a function\n                        if (typeof plugin.handleClick === 'function')\n                        {\n                            pageTools.push('<div class=\"diva-' + plugin.pluginName + '-icon\" title=\"' + titleText + '\"></div>');\n\n                            // Delegate the click event - pass it the settings\n                            var pluginButtonElement = '.diva-' + plugin.pluginName + '-icon';\n\n                            settings.outerObject.on('click', pluginButtonElement, function (event)\n                            {\n                                plugin.handleClick.call(this, event, settings, self);\n                            });\n\n                            settings.outerObject.on('touchend', pluginButtonElement, function (event)\n                            {\n                                // Prevent firing of emulated mouse events\n                                event.preventDefault();\n\n                                plugin.handleClick.call(this, event, settings, self);\n                            });\n                        }\n\n                        // Add it to settings.plugins so it can be used later\n                        settings.plugins.push(plugin);\n                    }\n                });\n\n                // Save the page tools bar so it can be added for each page\n                if (pageTools.length)\n                    settings.pageTools = '<div class=\"diva-page-tools\">' + pageTools.join('') + '</div>';\n            }\n        };\n\n        var hideThrobber = function ()\n        {\n            // Clear the timeout, if it hasn't executed yet\n            clearTimeout(settings.throbberTimeoutID);\n\n            // Hide the throbber if it has already executed\n            $(settings.selector + 'throbber').hide();\n        };\n\n        var switchViewState = function(stateObj)\n        {\n            var view = stateObj;\n\n            switch (view)\n            {\n                case 'd':\n                    settings.inGrid = false;\n                    settings.inBookLayout = false;\n                    break;\n\n                case 'b':\n                    settings.inGrid = false;\n                    settings.inBookLayout = true;\n                    break;\n\n                case 'g':\n                    settings.inGrid = true;\n                    settings.inBookLayout = false;\n                    break;\n            }\n        };\n\n        /**\n         * Takes in a resource block from a canvas and outputs the following information associated with that resource:\n         * - Image URL\n         * - Image region to be displayed\n         *\n         * @param {Object} resource - an object representing the resource block of a canvas section in a IIIF manifest\n         * @returns {Object} imageInfo - an object containing image URL and region\n         */\n        var parseImageInfo = function (resource)\n        {\n            var url = resource['@id'];\n            var fragmentRegex = /#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/;\n            var xywh = '';\n            var stripURL = true;\n\n            if (/\\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\\//.test(url))\n            {\n                // if resource in image API format, extract region x,y,w,h from URL (after 4th slash from last)\n                // matches coordinates in URLs of the form http://www.example.org/iiif/book1-page1/40,50,1200,1800/full/0/default.jpg\n                var urlArray = url.split('/');\n                xywh = urlArray[urlArray.length - 4];\n            }\n            else if (fragmentRegex.test(url))\n            {\n                // matches coordinates of the style http://www.example.org/iiif/book1/canvas/p1#xywh=50,50,320,240\n                var result = fragmentRegex.exec(url);\n                xywh = result[1];\n            }\n            else if (resource.service && resource.service['@id'])\n            {\n                // assume canvas size based on image size\n                url = resource.service['@id'];\n                // this URL excludes region parameters so we don't need to remove them\n                stripURL = false;\n            }\n\n            if (stripURL)\n            {\n                // extract URL up to identifier (we eliminate the last 5 parameters: /region/size/rotation/quality.format)\n                url = url.split('/').slice(0, -4).join('/');\n            }\n\n            var imageInfo = {\n                url: url\n            };\n\n            if (xywh.length)\n            {\n                // parse into separate components\n                var dimensions = xywh.split(',');\n                imageInfo.x = parseInt(dimensions[0], 10);\n                imageInfo.y = parseInt(dimensions[1], 10);\n                imageInfo.w = parseInt(dimensions[2], 10);\n                imageInfo.h = parseInt(dimensions[3], 10);\n            }\n\n            return imageInfo;\n        };\n\n        /**\n         * Parses a IIIF Presentation API Manifest and converts it into a Diva.js-format object\n         * (See https://github.com/DDMAL/diva.js/wiki/Development-notes#data-received-through-ajax-request)\n         * (This is a client-side re-implementation of generate_json.py)\n         *\n         * @param {Object} manifest - an object that represents a valid IIIF manifest\n         * @returns {Object} divaServiceBlock - the data needed by Diva to show a view of a single document\n         */\n        var parseManifest = function (manifest)\n        {\n\n            var incorporateZoom = function (imageDimension, zoomDifference)\n            {\n                return imageDimension / (Math.pow(2, zoomDifference));\n            };\n\n            var getMaxZoomLevel = function (width, height)\n            {\n                var largestDimension = Math.max(width, height);\n                return Math.ceil(Math.log((largestDimension + 1) / (256 + 1)) / Math.log(2));\n            };\n\n            var initializeArrayWithValue = function (array, value)\n            {\n                var i = array.length;\n                while (i--)\n                {\n                    array[i] = value;\n                }\n            };\n\n            // trigger ManifestDidLoad event\n            diva.Events.publish('ManifestDidLoad', [manifest], self);\n\n            var sequence = manifest.sequences[0];\n            settings.documentPaged = manifest.viewingHint === 'paged' || sequence.viewingHint === 'paged';\n\n            //@TODO choose a sequence intelligently\n            var canvases = sequence.canvases;\n\n            var zoomLevels = new Array(canvases.length);\n            var images = new Array(canvases.length);\n\n            var width;\n            var height;\n            var url;\n            var info;\n            var maxZoom;\n            var label;\n            var context;\n            var resource;\n            var imageAPIVersion;\n\n            var title = manifest.label;\n\n            for (var i = 0, numCanvases = canvases.length; i < numCanvases; i++)\n            {\n                resource = canvases[i].images[0].resource;\n                width = resource.width || canvases[i].width;\n                height = resource.height || canvases[i].height;\n\n                info = parseImageInfo(resource);\n                url = info.url;\n\n                //append trailing / from url if it's not there\n                if (url.slice(-1) !== '/')\n                {\n                    url = url + '/';\n                }\n\n                maxZoom = getMaxZoomLevel(width, height);\n\n                // get filenames from service block (@TODO should this be changed to 'identifiers?')\n                // get label from canvas block ('filename' is legacy)\n                label = canvases[i].label;\n\n                // indicate whether canvas has viewingHint of non-paged\n                var paged = canvases[i].viewingHint !== 'non-paged';\n\n                context = resource.service['@context'];\n                if (context === 'http://iiif.io/api/image/2/context.json')\n                {\n                    imageAPIVersion = 2.0;\n                }\n                else if (context === 'http://library.stanford.edu/iiif/image-api/1.1/context.json')\n                {\n                    imageAPIVersion = 1.1;\n                }\n                else\n                {\n                    imageAPIVersion = 1.0;\n                }\n\n                images[i] = {\n                    'mx_w': width,\n                    'mx_h': height,\n                    'mx_z': maxZoom,\n                    'fn': label,\n                    'url': url,\n                    'api': imageAPIVersion,\n                    'paged': paged\n                };\n\n                if (info.hasOwnProperty('x'))\n                {\n                    images[i].xoffset = info.x;\n                    images[i].yoffset = info.y;\n                }\n\n                zoomLevels[i] = maxZoom;\n            }\n\n            var lowestMaxZoom = Math.min.apply(Math, zoomLevels);\n\n            // ratio calculations\n            var maxRatio = 0;\n            var minRatio = 100; // initialize high so we can get the minimum later\n\n            var totalWidths = new Array(lowestMaxZoom + 1);\n            var totalHeights = new Array(lowestMaxZoom + 1);\n            var maxWidths = new Array(lowestMaxZoom + 1);\n            var maxHeights = new Array(lowestMaxZoom + 1);\n            // separate calculation for paged/book view\n            var totalHeightsPaged = new Array(lowestMaxZoom + 1);\n\n            initializeArrayWithValue(totalWidths, 0);\n            initializeArrayWithValue(totalHeights, 0);\n            initializeArrayWithValue(maxWidths, 0);\n            initializeArrayWithValue(maxHeights, 0);\n            initializeArrayWithValue(totalHeightsPaged, 0);\n\n            var pages = [];\n            var currentPageZoomData; // dimensions per zoomlevel\n\n            var widthAtCurrentZoomLevel;\n            var heightAtCurrentZoomLevel;\n\n            var numImages = images.length;\n\n            // for each page image:\n            for (i = 0; i < numImages; i++)\n            {\n                currentPageZoomData = [];\n\n                // construct 'd' key. for each zoom level:\n                for (var j = 0; j < lowestMaxZoom + 1; j++)\n                {\n                    // calculate current page zoom data\n                    widthAtCurrentZoomLevel = Math.floor(incorporateZoom(images[i].mx_w, lowestMaxZoom - j));\n                    heightAtCurrentZoomLevel = Math.floor(incorporateZoom(images[i].mx_h, lowestMaxZoom - j));\n                    currentPageZoomData[j] = {\n                        h: heightAtCurrentZoomLevel,\n                        w: widthAtCurrentZoomLevel\n                    };\n\n                    // add width of image at current zoom level to total widths/heights\n                    totalWidths[j] += widthAtCurrentZoomLevel;\n                    totalHeights[j] += heightAtCurrentZoomLevel;\n                    maxWidths[j] = Math.max(widthAtCurrentZoomLevel, maxWidths[j]);\n                    maxHeights[j] = Math.max(heightAtCurrentZoomLevel, maxHeights[j]);\n\n                    // calculate max/min ratios\n                    var ratio = images[i].mx_h / images[i].mx_w;\n                    maxRatio = Math.max(ratio, maxRatio);\n                    minRatio = Math.min(ratio, minRatio);\n                }\n\n                pages[i] = {\n                    d: currentPageZoomData,\n                    m: images[i].mx_z,\n                    f: images[i].fn,\n                    url: images[i].url,\n                    api: images[i].api,\n                    paged: images[i].paged\n                };\n\n                if (images[i].hasOwnProperty('xoffset'))\n                {\n                    pages[i].xoffset = images[i].xoffset;\n                    pages[i].yoffset = images[i].yoffset;\n                }\n            }\n\n            var averageWidths = [];\n            var averageHeights = [];\n\n            // for each zoom level, calculate average of heights/widths\n            for (i = 0; i < lowestMaxZoom + 1; i++)\n            {\n                averageWidths.push(totalWidths[i] / images.length);\n                averageHeights.push(totalHeights[i] / images.length);\n            }\n\n            var dims = {\n                'a_wid': averageWidths,\n                'a_hei': averageHeights,\n                'max_w': maxWidths,\n                'max_h': maxHeights,\n                'max_ratio': maxRatio,\n                'min_ratio': minRatio,\n                't_hei': totalHeights,\n                't_wid': totalWidths\n            };\n\n\n            var divaServiceBlock = {\n                item_title: title,\n                dims: dims,\n                max_zoom: lowestMaxZoom,\n                pgs: pages\n            };\n\n            return divaServiceBlock;\n        };\n\n        var showError = function(messageText)\n        {\n            var errorModal = '<div id=\"' + settings.ID + 'error\" class=\"diva-error\">' +\n                '<button id=\"' + settings.ID + 'error-close\" class=\"diva-error-close\" aria-label=\"Close dialog\"></button>' +\n                '<p><strong>Error</strong></p><p>' + messageText + '</p></div>';\n\n            var errorElement = document.createElement('div');\n            errorElement.id = settings.ID + 'error';\n            errorElement.setAttribute('class', 'diva-error');\n\n            var closeButton = document.createElement('button');\n            closeButton.id = settings.ID + 'error-close';\n            closeButton.setAttribute('class', 'diva-error-close');\n            closeButton.setAttribute('aria-label', 'Close Dialog');\n\n            var message = document.createElement('p');\n            message.innerHTML = '<strong>Error</strong></p><p>' + messageText + '</p>';\n\n            errorElement.appendChild(closeButton);\n            errorElement.appendChild(message);\n\n            settings.outerObject.append(errorElement);\n\n            //bind dialog close button\n            $(settings.selector + 'error-close').on('click', function()\n            {\n                errorElement.remove();\n            });\n        };\n\n        var ajaxError = function(jqxhr, status, error)\n        {\n            // Show a basic error message within the document viewer pane\n\n            hideThrobber();\n            var errorMessageText = 'Invalid objectData setting. Error code: ' + jqxhr.status + ' ' + error;\n\n            // Detect and handle CORS errors\n            var dataHasAbsolutePath = settings.objectData.lastIndexOf('http', 0) === 0;\n\n            if (dataHasAbsolutePath && error === '')\n            {\n                var jsonHost = settings.objectData.replace(/https?:\\/\\//i, \"\").split(/[/?#]/)[0];\n\n                if (location.hostname !== jsonHost)\n                {\n                    errorMessageText += '<p>Attempted to access cross-origin data without CORS.</p>' +\n                        '<p>You may need to update your server configuration to support CORS. ' +\n                        'For help, see the <a href=\"https://github.com/DDMAL/diva.js/wiki/' +\n                        'Installation#a-note-about-cross-site-requests\" target=\"_blank\">' +\n                        'cross-site request documentation.</a></p>';\n                }\n            }\n\n            showError(errorMessageText);\n        };\n\n        var resetTilesLoaded = function()\n        {\n            // re-initialize array to avoid sparseness if number of pages changes\n            settings.loadedTiles = [];\n            var i = settings.numPages;\n\n            while (i--)\n            {\n                settings.loadedTiles[i] = [];\n            }\n        };\n\n        var loadObjectData = function (data)\n        {\n            // store object data in settings\n            parseObjectData(data);\n\n            // Plugin setup hooks should be bound to the ObjectDidLoad event\n            diva.Events.publish('ObjectDidLoad', [settings], self);\n\n            // Adjust the document panel dimensions\n            updatePanelSize();\n\n            // y - vertical offset from the top of the relevant page\n            var yParam = parseInt($.getHashParam('y' + settings.hashParamSuffix), 10);\n\n            if (!isNaN(yParam))\n            {\n                settings.verticalOffset = yParam;\n            }\n            else\n            {\n                settings.verticalOffset = getYOffset(settings.currentPageIndex, \"top\");\n            }\n\n            // x - horizontal offset from the center of the page\n            var xParam = parseInt($.getHashParam('x' + settings.hashParamSuffix), 10);\n\n            if (!isNaN(xParam))\n            {\n                settings.horizontalOffset = xParam;\n            }\n            else if (settings.goDirectlyTo === 0 && settings.inBookLayout && settings.verticallyOriented)\n            {\n                // if in book layout, center the first opening\n                settings.horizontalOffset = 0 + settings.horizontalPadding;\n            }\n            else\n            {\n                settings.horizontalOffset = getXOffset(settings.currentPageIndex, \"center\");\n            }\n\n            if (settings.inFullscreen)\n                handleModeChange(false);\n            else\n                loadViewer();\n\n            //prep dimensions one last time now that pages have loaded\n            updatePanelSize();\n\n            diva.Events.publish(\"ViewerDidLoad\", [settings], self);\n\n            // signal that everything should be set up and ready to go.\n            settings.loaded = true;\n        };\n\n        var parseObjectData = function(responseData)\n        {\n            var data;\n\n            // parse IIIF manifest if it is an IIIF manifest. TODO improve IIIF detection method\n            if (responseData.hasOwnProperty('@context') && (responseData['@context'].indexOf('iiif') !== -1 ||\n                responseData['@context'].indexOf('shared-canvas') !== -1))\n            {\n                settings.isIIIF = true;\n                data = parseManifest(responseData);\n            }\n            else\n            {\n                data = responseData;\n            }\n\n            hideThrobber();\n\n            // Save all the data we need\n            settings.pages = data.pgs;\n            settings.maxRatio = data.dims.max_ratio;\n            settings.minRatio = data.dims.min_ratio;\n            settings.itemTitle = data.item_title;\n            settings.numPages = data.pgs.length;\n\n            // These are arrays, the index corresponding to the zoom level\n            settings.maxWidths = data.dims.max_w;\n            settings.maxHeights = data.dims.max_h;\n            settings.averageWidths = data.dims.a_wid;\n            settings.averageHeights = data.dims.a_hei;\n            settings.totalHeights = data.dims.t_hei;\n            settings.totalWidths = data.dims.t_wid;\n\n            // Make sure the set max and min values are valid\n            settings.realMaxZoom = data.max_zoom;\n            settings.maxZoomLevel = (settings.maxZoomLevel >= 0 && settings.maxZoomLevel <= data.max_zoom) ? settings.maxZoomLevel : data.max_zoom;\n            settings.minZoomLevel = (settings.minZoomLevel >= 0 && settings.minZoomLevel <= settings.maxZoomLevel) ? settings.minZoomLevel : 0;\n            settings.zoomLevel = getValidZoomLevel(settings.zoomLevel);\n            settings.minPagesPerRow = Math.max(2, settings.minPagesPerRow);\n            settings.maxPagesPerRow = Math.max(settings.minPagesPerRow, settings.maxPagesPerRow);\n\n            diva.Events.subscribe('DocumentWillLoad', resetTilesLoaded, settings.ID);\n\n            // Check that the desired page is in range\n            if (settings.enableFilename)\n            {\n                var iParam = $.getHashParam('i' + settings.hashParamSuffix);\n                var iParamPage = getPageIndex(iParam);\n\n                if (isPageValid(iParamPage))\n                {\n                    settings.goDirectlyTo = iParamPage;\n                    settings.currentPageIndex = iParamPage;\n                }\n            }\n            else\n            {\n                // Not using the i parameter, check the p parameter\n                // Subtract 1 to get the page index\n                var pParam = parseInt($.getHashParam('p' + settings.hashParamSuffix), 10) - 1;\n\n                if (isPageValid(pParam))\n                {\n                    settings.goDirectlyTo = pParam;\n                    settings.currentPageIndex = pParam;\n                }\n            }\n\n            diva.Events.publish('NumberOfPagesDidChange', [settings.numPages], self);\n\n            if (settings.enableAutoTitle)\n            {\n                if ($(settings.selector + 'title').length)\n                    $(settings.selector + 'title').html(settings.itemTitle);\n                else\n                    settings.parentObject.prepend('<div id=\"' + settings.ID + 'title\" class=\"diva-title\">' + settings.itemTitle + '</div>');\n            }\n\n            // Make sure the value for settings.goDirectlyTo is valid\n            if (!isPageValid(parseInt(settings.goDirectlyTo), 10))\n                settings.goDirectlyTo = 0;\n\n            // Calculate the horizontal and vertical inter-page padding based on the dimensions of the average zoom level\n            if (settings.adaptivePadding > 0)\n            {\n                var z = Math.floor((settings.minZoomLevel + settings.maxZoomLevel) / 2);\n                settings.horizontalPadding = parseInt(settings.averageWidths[z] * settings.adaptivePadding, 10);\n                settings.verticalPadding = parseInt(settings.averageHeights[z] * settings.adaptivePadding, 10);\n            }\n            else\n            {\n                // It's less than or equal to 0; use fixedPadding instead\n                settings.horizontalPadding = settings.fixedPadding;\n                settings.verticalPadding = settings.fixedPadding;\n            }\n\n            settings.unclampedVerticalPadding = settings.verticalPadding;\n\n            // Make sure the vertical padding is at least 40, if plugin icons are enabled\n            if (settings.pageTools.length)\n            {\n                settings.verticalPadding = Math.max(40, settings.verticalPadding);\n            }\n\n            // If we detect a viewingHint of 'paged' in the manifest or sequence, enable book view by default\n            if (settings.documentPaged)\n            {\n                settings.inBookLayout = true;\n            }\n\n            // Update view settings (settings.inGrid, settings.inBookLayout) to match 'v' parameter\n            var viewParam = $.getHashParam('v' + settings.hashParamSuffix);\n            switchViewState(viewParam);\n        };\n\n        var setupViewer = function ()\n        {\n            if (typeof settings.objectData === 'object')\n            {\n                // Defer execution until initialization has completed\n                setTimeout(function ()\n                {\n                    loadObjectData(settings.objectData);\n                }, 0);\n\n                return;\n            }\n\n            // If the request hasn't completed after a specified time, show it\n            settings.throbberTimeoutID = setTimeout(function ()\n            {\n                $(settings.selector + 'throbber').show();\n            }, settings.throbberTimeout);\n\n            $.ajax({\n                url: settings.objectData,\n                cache: true,\n                dataType: 'json',\n                error: ajaxError,\n                success: loadObjectData\n            });\n        };\n\n        var checkLoaded = function()\n        {\n            if (!settings.loaded)\n            {\n                console.warn(\"The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true.\");\n                return false;\n            }\n            return true;\n        };\n\n        var init = function ()\n        {\n            // First figure out the width of the scrollbar in this browser\n            settings.scrollbarWidth = $.getScrollbarWidth();\n\n            // If window.orientation is defined, then it's probably mobileWebkit\n            settings.mobileWebkit = window.orientation !== undefined;\n\n            // Generate an ID that can be used as a prefix for all the other IDs\n            settings.ID = $.generateId('diva-');\n            settings.selector = '#' + settings.ID;\n\n            // Figure out the hashParamSuffix from the ID\n            var divaNumber = parseInt(settings.ID, 10);\n\n            if (divaNumber > 1)\n            {\n                // If this is document viewer #1, don't use a suffix; otherwise, use the document viewer number\n                settings.hashParamSuffix = divaNumber;\n            }\n\n            // Create the inner and outer panels\n            settings.parentObject.append('<div id=\"' + settings.ID + 'outer\" class=\"diva-outer\"></div>');\n            settings.outerObject = $(settings.selector + 'outer');\n            settings.outerElement = settings.ID + 'outer';\n            settings.outerObject.append('<div id=\"' + settings.ID + 'inner\" class=\"diva-inner diva-dragger\"></div>');\n            settings.innerObject = $(settings.selector + 'inner');\n            settings.innerElement = settings.ID + 'inner';\n\n            // Create the throbber element\n            settings.outerObject.append('<div id=\"' + settings.ID + 'throbber\" class=\"diva-throbber\"></div>');\n\n            // First, n - check if it's in range\n            var nParam = parseInt($.getHashParam('n' + settings.hashParamSuffix), 10);\n\n            if (nParam >= settings.minPagesPerRow && nParam <= settings.maxPagesPerRow)\n            {\n                settings.pagesPerRow = nParam;\n            }\n\n            // Now z - check that it's in range\n            var zParam = $.getHashParam('z' + settings.hashParamSuffix);\n\n            if (zParam !== '')\n            {\n                // If it's empty, we don't want to change the default zoom level\n                zParam = parseInt(zParam, 10);\n\n                // Can't check if it exceeds the max zoom level or not because that data is not available yet ...\n                if (zParam >= settings.minZoomLevel)\n                {\n                    settings.zoomLevel = zParam;\n                }\n            }\n\n            // Create the toolbar and display the title + total number of pages\n            if (settings.enableToolbar)\n            {\n                settings.toolbar = createToolbar();\n                diva.Events.subscribe('VisiblePageDidChange', settings.toolbar.updateCurrentPage, settings.ID);\n                diva.Events.subscribe('ModeDidSwitch', settings.toolbar.switchMode, settings.ID);\n                diva.Events.subscribe('ViewDidSwitch', settings.toolbar.switchView, settings.ID);\n                diva.Events.subscribe('ViewDidSwitch', settings.toolbar.displayViewMenu, settings.ID);\n                diva.Events.subscribe('ZoomLevelDidChange', settings.toolbar.updateZoomLabel, settings.ID);\n                diva.Events.subscribe('GridRowNumberDidChange', settings.toolbar.updateGridLabel, settings.ID);\n                diva.Events.subscribe('NumberOfPagesDidChange', settings.toolbar.setNumPages, settings.ID);\n\n                // update toolbar items that depend on data from the objectData AJAX request once it has loaded\n                diva.Events.subscribe('ObjectDidLoad', settings.toolbar.displayViewMenu, settings.ID);\n                diva.Events.subscribe('ObjectDidLoad', settings.toolbar.switchView, settings.ID);\n                diva.Events.subscribe('ObjectDidLoad', function()\n                {\n                    settings.toolbar.setNumPages(settings.numPages);\n                }, settings.ID);\n\n                // update toolbar items that depend on the final layout of the viewer\n                diva.Events.subscribe('ViewerDidLoad', settings.toolbar.switchMode, settings.ID);\n                diva.Events.subscribe('ViewerDidLoad', function()\n                {\n                    settings.toolbar.updateCurrentPage(settings.currentPageIndex);\n                }, settings.ID);\n\n                diva.Events.subscribe('ViewerDidLoad', function()\n                {\n                    settings.toolbar.updateZoomLabel(settings.zoomLevel);\n                }, settings.ID);\n            }\n\n            // If the \"fullscreen\" hash param is true, go to fullscreen initially\n            var fullscreenParam = $.getHashParam('f' + settings.hashParamSuffix);\n            var goIntoFullscreen = fullscreenParam === 'true';\n\n            settings.inFullscreen = (settings.inFullscreen && fullscreenParam !== 'false') || goIntoFullscreen;\n\n            // Do the initial AJAX request and viewer loading\n            setupViewer();\n\n            // Do all the plugin initialisation\n            initPlugins();\n\n            handleEvents();\n        };\n\n        // Call the init function when this object is created.\n        init();\n\n        /* PUBLIC FUNCTIONS\n        ===============================================\n        */\n\n        // Returns the title of the document, based on the directory name\n        this.getItemTitle = function ()\n        {\n            return settings.itemTitle;\n        };\n\n        // Go to a particular page by its page number (with indexing starting at 1)\n            //xAnchor may either be \"left\", \"right\", or default \"center\"; the (xAnchor) side of the page will be anchored to the (xAnchor) side of the diva-outer element\n            //yAnchor may either be \"top\", \"bottom\", or default \"center\"; same process as xAnchor.\n        // returns True if the page number passed is valid; false if it is not.\n        this.gotoPageByNumber = function (pageNumber, xAnchor, yAnchor)\n        {\n            var pageIndex = parseInt(pageNumber, 10) - 1;\n            if (isPageValid(pageIndex))\n            {\n                gotoPage(pageIndex, getYOffset(pageIndex, yAnchor), getXOffset(pageIndex, xAnchor));\n                return true;\n            }\n            return false;\n        };\n\n        // Go to a particular page (with indexing starting at 0)\n            //xAnchor may either be \"left\", \"right\", or default \"center\"; the (xAnchor) side of the page will be anchored to the (xAnchor) side of the diva-outer element\n            //yAnchor may either be \"top\", \"bottom\", or default \"center\"; same process as xAnchor.\n        // returns True if the page index is valid; false if it is not.\n        this.gotoPageByIndex = function (pageIndex, xAnchor, yAnchor)\n        {\n            pageIndex = parseInt(pageIndex, 10);\n            if (isPageValid(pageIndex))\n            {\n                gotoPage(pageIndex, getYOffset(pageIndex, yAnchor), getXOffset(pageIndex, xAnchor));\n                return true;\n            }\n            return false;\n        };\n\n        this.getNumberOfPages = function ()\n        {\n            if (!checkLoaded())\n                return false;\n\n            return settings.numPages;\n        };\n\n        // Returns the dimensions of a given page index at a given zoom level\n        this.getPageDimensionsAtZoomLevel = function (pageIdx, zoomLevel)\n        {\n            if (!checkLoaded())\n                return false;\n\n            if (zoomLevel > settings.maxZoomLevel)\n                zoomLevel = settings.maxZoomLevel;\n\n            var pg = settings.pages[parseInt(pageIdx, 10)];\n            var pgAtZoom = pg.d[parseInt(zoomLevel, 10)];\n            return {'width': pgAtZoom.w, 'height': pgAtZoom.h};\n        };\n\n        // Returns the dimensions of the current page at the current zoom level\n        this.getCurrentPageDimensionsAtCurrentZoomLevel = function ()\n        {\n            return this.getPageDimensionsAtZoomLevel(settings.currentPageIndex, settings.zoomLevel);\n        };\n\n        this.isReady = function ()\n        {\n            return settings.loaded;\n        };\n\n        this.getCurrentPageIndex = function ()\n        {\n            return settings.currentPageIndex;\n        };\n\n        this.getCurrentPageFilename = function ()\n        {\n            return settings.pages[settings.currentPageIndex].f;\n        };\n\n        this.getCurrentPageNumber = function ()\n        {\n            return settings.currentPageIndex + 1;\n        };\n\n        // Returns an array of all filenames in the document\n        this.getFilenames = function ()\n        {\n            var filenames = [];\n\n            for (var i = 0; i < settings.numPages; i++)\n            {\n                filenames[i] = settings.pages[i].f;\n            }\n\n            return filenames;\n        };\n\n        // Returns the current zoom level\n        this.getZoomLevel = function ()\n        {\n            return settings.zoomLevel;\n        };\n\n        // gets the maximum zoom level for the entire document\n        this.getMaxZoomLevel = function ()\n        {\n            return settings.maxZoomLevel;\n        };\n\n        // gets the max zoom level for a given page\n        this.getMaxZoomLevelForPage = function (pageIdx)\n        {\n            if (!checkLoaded)\n                return false;\n\n            return settings.pages[pageIdx].m;\n        };\n\n        this.getMinZoomLevel = function ()\n        {\n            return settings.minZoomLevel;\n        };\n\n        // Use the provided zoom level (will check for validity first)\n        // Returns false if the zoom level is invalid, true otherwise\n        this.setZoomLevel = function (zoomLevel)\n        {\n            if (settings.inGrid)\n            {\n                settings.goDirectlyTo = settings.currentPageIndex;\n                settings.inGrid = false;\n                handleViewChange();\n            }\n\n            return handleZoom(zoomLevel);\n        };\n\n        // Zoom in. Will return false if it's at the maximum zoom\n        this.zoomIn = function ()\n        {\n            return this.setZoomLevel(settings.zoomLevel + 1);\n        };\n\n        // Zoom out. Will return false if it's at the minimum zoom\n        this.zoomOut = function ()\n        {\n            return this.setZoomLevel(settings.zoomLevel - 1);\n        };\n\n        // Check if something (e.g. a highlight box on a particular page) is visible\n        this.inViewport = function (pageNumber, leftOffset, topOffset, width, height)\n        {\n            var pageIndex = pageNumber - 1;\n            var top = settings.pageTopOffsets[pageIndex] + topOffset;\n            var bottom = top + height;\n            var left = settings.pageLeftOffsets[pageIndex] + leftOffset;\n            var right = left + width;\n            var outerElement = document.getElementById(settings.outerElement);\n\n            var viewportTop = outerElement.scrollTop;\n            var viewportBottom = viewportTop + settings.panelHeight;\n            var viewportLeft = outerElement.scrollLeft;\n            var viewportRight = viewportLeft + settings.panelWidth;\n\n            return isVerticallyInViewport(top, bottom, viewportTop, viewportBottom) && isHorizontallyInViewport(left, right, viewportLeft, viewportRight);\n        };\n\n        //Public wrapper for isPageVisible\n        //Determines if a page is currently in the viewport\n        this.isPageInViewport = function (pageIndex)\n        {\n            return isPageVisible(pageIndex);\n        };\n\n        //Public wrapper for isPageLoaded\n        //Determines if a page is currently in the DOM\n        this.isPageLoaded = function (pageIndex)\n        {\n            return isPageLoaded(pageIndex);\n        };\n\n        // Toggle fullscreen mode\n        this.toggleFullscreenMode = function ()\n        {\n            toggleFullscreen();\n        };\n\n        // Close toolbar popups\n        this.closePopups = function ()\n        {\n            settings.toolbar.closePopups();\n        };\n\n        // Enter fullscreen mode if currently not in fullscreen mode\n        // Returns false if in fullscreen mode initially, true otherwise\n        // This function will work even if enableFullscreen is set to false\n        this.enterFullscreenMode = function ()\n        {\n            if (!settings.inFullscreen)\n            {\n                toggleFullscreen();\n                return true;\n            }\n\n            return false;\n        };\n\n        // Leave fullscreen mode if currently in fullscreen mode\n        // Returns true if in fullscreen mode intitially, false otherwise\n        this.leaveFullscreenMode = function ()\n        {\n            if (settings.inFullscreen)\n            {\n                toggleFullscreen();\n                return true;\n            }\n\n            return false;\n        };\n\n        // Change views. Takes 'document', 'book', or 'grid' to specify which view to switch into\n        this.changeView = function(destinationView)\n        {\n            return changeView(destinationView);\n        };\n\n        // Enter grid view if currently not in grid view\n        // Returns false if in grid view initially, true otherwise\n        this.enterGridView = function ()\n        {\n            if (!settings.inGrid)\n            {\n                changeView('grid');\n                return true;\n            }\n\n            return false;\n        };\n\n        // Leave grid view if currently in grid view\n        // Returns true if in grid view initially, false otherwise\n        this.leaveGridView = function ()\n        {\n            if (settings.inGrid)\n            {\n                settings.goDirectlyTo = settings.currentPageIndex;\n                settings.inGrid = false;\n                handleViewChange();\n                return true;\n            }\n\n            return false;\n        };\n\n        // Jump to a page based on its filename\n        // Returns true if successful and false if the filename is invalid\n        this.gotoPageByName = function (filename, xAnchor, yAnchor)\n        {\n            var pageIndex = getPageIndex(filename);\n\n            if (isPageValid(pageIndex))\n            {\n                gotoPage(pageIndex, getYOffset(pageIndex, yAnchor), getXOffset(pageIndex, xAnchor));\n                return true;\n            }\n\n            return false;\n        };\n\n        // Get the page index (0-based) corresponding to a given filename\n        // If the page index doesn't exist, this will return -1\n        this.getPageIndex = function (filename)\n        {\n            return getPageIndex(filename);\n        };\n\n        // Get the current URL (exposes the private method)\n        this.getCurrentURL = function ()\n        {\n            return getCurrentURL();\n        };\n\n        // Get the hash part only of the current URL (without the leading #)\n        this.getURLHash = function ()\n        {\n            return getURLHash();\n        };\n\n        // Get an object representing the state of this diva instance (for setState)\n        this.getState = function ()\n        {\n            return getState();\n        };\n\n        // Get the instance selector for this instance, since it's auto-generated.\n        this.getInstanceSelector = function ()\n        {\n            return settings.selector;\n        };\n\n        // Get the instance ID -- essentially the selector without the leading '#'.\n        this.getInstanceId = function ()\n        {\n            return settings.ID;\n        };\n\n        this.getSettings = function ()\n        {\n            return settings;\n        };\n\n        /*\n            Translates a measurement from the zoom level on the largest size\n            to one on the current zoom level.\n\n            For example, a point 1000 on an image that is on zoom level 2 of 5\n            translates to a position of 111.111... (1000 / (5 - 2)^2).\n\n            Works for a single pixel co-ordinate or a dimension (e.g., translates a box\n            that is 1000 pixels wide on the original to one that is 111.111 pixels wide\n            on the current zoom level).\n        */\n        this.translateFromMaxZoomLevel = function (position)\n        {\n            var zoomDifference = settings.maxZoomLevel - settings.zoomLevel;\n            return position / Math.pow(2, zoomDifference);\n        };\n\n        /*\n            Translates a measurement from the current zoom level to the position on the\n            largest zoom level.\n\n            Works for a single pixel co-ordinate or a dimension (e.g., translates a box\n            that is 111.111 pixels wide on the current image to one that is 1000 pixels wide\n            on the current zoom level).\n        */\n        this.translateToMaxZoomLevel = function (position)\n        {\n            var zoomDifference = settings.maxZoomLevel - settings.zoomLevel;\n\n            // if there is no difference, it's a box on the max zoom level and\n            // we can just return the position.\n            if (zoomDifference === 0)\n                return position;\n\n            return position * Math.pow(2, zoomDifference);\n        };\n\n        // Align this diva instance with a state object (as returned by getState)\n        this.setState = function (state)\n        {\n            var pageIndex;\n\n            // Only change settings.goDirectlyTo if state.i or state.p is valid\n            pageIndex = getPageIndex(state.i);\n\n            if (isPageValid(pageIndex))\n                settings.goDirectlyTo = pageIndex;\n            else if (isPageValid(state.p))\n                settings.goDirectlyTo = state.p;\n\n            var horizontalOffset = parseInt(state.x, 10);\n            var verticalOffset = parseInt(state.y, 10);\n\n            // Only change the zoom if state.z is valid\n            if (state.z >= settings.minZoomLevel && state.z <= settings.maxZoomLevel)\n                settings.zoomLevel = state.z;\n\n            // Only change the pages per row setting if state.n is valid\n            if (state.n >= settings.minPagesPerRow && state.n <= settings.maxPagesPerRow)\n                settings.pagesPerRow = state.n;\n\n            // Change settings to match v (view) hash parameter\n\n            if (settings.inFullscreen !== state.f)\n            {\n                switchViewState(state.v);\n                // The parameter determines if we need to change the view as well\n                settings.inFullscreen = state.f;\n                handleModeChange(false);\n                settings.horizontalOffset = horizontalOffset;\n                settings.verticalOffset = verticalOffset;\n                gotoPage(pageIndex, settings.verticalOffset, settings.horizontalOffset);\n            }\n            else\n            {\n                settings.horizontalOffset = horizontalOffset;\n                settings.verticalOffset = verticalOffset;\n\n                // Don't need to change the mode, may need to change view\n                // If the current view is not equal to that in state, switch view\n                if ((state.v === 'g' && (!settings.inGrid || settings.inBookLayout)) ||\n                    (state.v === 'd' && (settings.inGrid || settings.inBookLayout)) ||\n                    (state.v === 'b' && !settings.inBookLayout))\n                {\n                    switchViewState(state.v);\n                    handleViewChange();\n                }\n                else\n                {\n                    // Reload the viewer, just in case\n                    loadViewer();\n                }\n            }\n        };\n\n        // Re-enables document dragging, scrolling (by keyboard if set), and zooming by double-clicking\n        this.enableScrollable = function()\n        {\n            if (!settings.isScrollable)\n            {\n                bindMouseEvents();\n                settings.enableKeyScroll = settings.initialKeyScroll;\n                settings.enableSpaceScroll = settings.initialSpaceScroll;\n                document.getElementById(settings.outerElement).style.overflow = 'auto';\n                settings.isScrollable = true;\n            }\n        };\n\n        // Disables document dragging, scrolling (by keyboard if set), and zooming by double-clicking\n        this.disableScrollable = function ()\n        {\n            if (settings.isScrollable)\n            {\n                // block dragging/double-click zooming\n                if (settings.innerObject.hasClass('diva-dragger'))\n                    settings.innerObject.unbind('mousedown');\n                settings.outerObject.unbind('dblclick');\n                settings.outerObject.unbind('contextmenu');\n\n                // disable all other scrolling actions\n                document.getElementById(settings.outerElement).style.overflow = 'hidden';\n\n                // block scrolling keys behavior, respecting initial scroll settings\n                settings.initialKeyScroll = settings.enableKeyScroll;\n                settings.initialSpaceScroll = settings.enableSpaceScroll;\n                settings.enableKeyScroll = false;\n                settings.enableSpaceScroll = false;\n\n                settings.isScrollable = false;\n            }\n        };\n\n        //Changes between horizontal layout and vertical layout. Returns true if document is now vertically oriented, false otherwise.\n        this.toggleOrientation = function ()\n        {\n            return toggleOrientation();\n        };\n\n        //Returns distance between the northwest corners of diva-inner and page index\n        this.getPageOffset = function(pageIndex)\n        {\n            return {\n                'top': parseInt(settings.pageTopOffsets[pageIndex]),\n                'left': parseInt(settings.pageLeftOffsets[pageIndex])\n            };\n        };\n\n        //shortcut to getPageOffset for current page\n        this.getCurrentPageOffset = function()\n        {\n            return this.getPageOffset(settings.currentPageIndex);\n        };\n\n        //Returns the page position and size (ulx, uly, h, w properties) of page pageIndex when there are pagesPerRow pages per row\n        //TODO: calculate all grid height levels and store them so this can be AtGridLevel(pageIndex, pagesPerRow) ?\n        this.getPageDimensionsAtCurrentGridLevel = function(pageIndex)\n        {\n            pageIndex = (isPageValid(pageIndex) ? pageIndex : settings.currentPageIndex);\n\n            var pageHeight = settings.rowHeight - settings.fixedPadding;\n            var pageWidth = (settings.fixedHeightGrid) ? (settings.rowHeight - settings.fixedPadding) * getPageData(pageIndex, 'w') / getPageData(pageIndex, 'h') : settings.gridPageWidth;\n\n            return {\n                'height': parseInt(pageHeight, 10),\n                'width': parseInt(pageWidth, 10)\n            };\n        };\n\n        /*\n            Given a pageX and pageY value (as could be retreived from a jQuery event object),\n                returns either the page visible at that (x,y) position or \"false\" if no page is.\n        */\n        this.getPageIndexForPageXYValues = function(pageX, pageY)\n        {\n            //get the four edges of the outer element\n            var outerObj = document.getElementById(settings.outerElement);\n            var outerOffset = outerObj.getBoundingClientRect();\n            var outerTop = outerOffset.top;\n            var outerLeft = outerOffset.left;\n            var outerBottom = outerOffset.bottom;\n            var outerRight = outerOffset.right;\n\n            //if the clicked position was outside the diva-outer object, it was not on a visible portion of a page\n            if (pageX < outerLeft || pageX > outerRight)\n                return false;\n\n            if (pageY < outerTop || pageY > outerBottom)\n                return false;\n\n            //navigate through all diva page objects\n            var pages = document.getElementsByClassName('diva-page');\n            var curPageIdx = pages.length;\n            while (curPageIdx--)\n            {\n                //get the offset for each page\n                var curPage = pages[curPageIdx];\n                var curOffset = curPage.getBoundingClientRect();\n\n                //if this point is outside the horizontal boundaries of the page, continue\n                if (pageX < curOffset.left || pageX > curOffset.right)\n                    continue;\n\n                //same with vertical boundaries\n                if (pageY < curOffset.top || pageY > curOffset.bottom)\n                    continue;\n\n                //if we made it through the above two, we found the page we're looking for\n                return curPage.getAttribute('data-index');\n            }\n\n            //if we made it through that entire while loop, we didn't click on a page\n            return false;\n        };\n\n        //Pretty self-explanatory.\n        this.isVerticallyOriented = function()\n        {\n            return settings.verticallyOriented;\n        };\n\n        this.changeObject = function(objectData)\n        {\n            settings.loaded = false;\n            clearViewer();\n            settings.objectData = objectData;\n\n            if (typeof objectData === 'object')\n            {\n                setTimeout(function ()\n                {\n                    parseObjectData(objectData);\n                    loadViewer();\n                    settings.loaded = true;\n                });\n\n                return;\n            }\n\n            settings.throbberTimeoutID = setTimeout(function ()\n            {\n                $(settings.selector + 'throbber').show();\n            }, settings.throbberTimeout);\n\n            $.ajax({\n                url: settings.objectData,\n                cache: true,\n                dataType: 'json',\n                error: ajaxError,\n                success: function (responseData, status, jqxhr)\n                {\n                    parseObjectData(responseData);\n                    hideThrobber();\n                    loadViewer();\n                    settings.loaded = true;\n                }\n            });\n        };\n\n        this.activate = function ()\n        {\n            settings.isActiveDiva = true;\n        };\n\n        this.deactivate = function ()\n        {\n            settings.isActiveDiva = false;\n        };\n\n        // Destroys this instance, tells plugins to do the same (for testing)\n        this.destroy = function ()\n        {\n            // Removes the hide-scrollbar class from the body\n            $('body').removeClass('diva-hide-scrollbar');\n\n            // Empty the parent container and remove any diva-related data\n            settings.parentObject.empty().removeData('diva');\n\n            diva.Events.publish('ViewerDidTerminate', [settings], self);\n\n            // Remove any additional styling on the parent element\n            settings.parentObject.removeAttr('style').removeAttr('class');\n\n            // Clear the Events cache\n            diva.Events.unsubscribeAll(settings.ID);\n        };\n    };\n\n    $.fn.diva = function (options)\n    {\n        return this.each(function ()\n        {\n            var divaParent = $(this);\n\n            // Return early if this element already has a plugin instance\n            if (divaParent.data('diva'))\n                return;\n\n            // Otherwise, instantiate the document viewer\n            var diva = new Diva(this, options);\n            divaParent.data('diva', diva);\n        });\n    };\n\n})(jQuery);\n","/*\nDiva.JS autoscroll plugin\nAuthor: Andrew Horwitz\n\nLets Diva scroll in the primary direction (as determined by\nsettings.verticallyOriented) automatically at a given/changeable rate.\n\nRelevant settings:\n    -scrollSpeed: pixels per second (defaults to 10)\n    -disableManualScroll: disables manual scroll while automatic scroll is on (defaults to false)\n    -currentlyAutoScrolling: whether or not autoscroll is currently on\n    -autoScrollRefresh: ms between scrolling actions\n    -disableAutoscrollPrefs: disables the autoscroll preferences panel\n\nRelevant methods:\n    -startScrolling, stopScrolling, toggleScrolling\n    -changeRefresh, changeScrollSpeed (setters for respective options)\n    -disableManualScroll, enableManualScroll\n*/\n\n(function ($)\n{\n    window.divaPlugins.push((function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                var pixelsPerScroll;\n                var disableManualScroll;\n                var autoScrollRefresh;\n                var defaultAutoRefresh;\n                var scrollSpeed;\n\n                function log10(x)\n                {\n                    return Math.log(x) / Math.log(10);\n                }\n\n                divaInstance.startScrolling = function()\n                {\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        console.warn(\"You are trying to start autoscrolling, but it is already scrolling.\");\n                        return;\n                    }\n\n                    $(\"#\" + divaSettings.ID + \"autoscroll-toggle\").text(\"Turn off\");\n                    if (disableManualScroll)\n                    {\n                        divaInstance.disableScrollable();\n                    }\n\n                    divaSettings.currentlyAutoScrolling = true;\n                    restartScrollingInterval();\n                };\n\n                restartScrollingInterval = function()\n                {\n                    clearInterval(divaSettings.autoScrollInterval);\n                    if (divaSettings.verticallyOriented)\n                    {\n                        divaSettings.autoScrollInterval = setInterval(function(){\n                            divaSettings.outerObject.scrollTop(divaSettings.outerObject.scrollTop() + pixelsPerScroll);\n                        }, autoScrollRefresh);\n                    }\n                    else\n                    {\n                        divaSettings.autoScrollInterval = setInterval(function(){\n                            divaSettings.outerObject.scrollLeft(divaSettings.outerObject.scrollLeft() + pixelsPerScroll);\n                        }, autoScrollRefresh);\n                    }\n                };\n\n                divaInstance.stopScrolling = function()\n                {\n                    if (!divaSettings.currentlyAutoScrolling)\n                    {\n                        console.warn(\"You are trying to stop autoscrolling, but it is not currently active.\");\n                        return;\n                    }\n\n                    $(\"#\" + divaSettings.ID + \"autoscroll-toggle\").text(\"Turn on\");\n                    if (disableManualScroll)\n                    {\n                        divaInstance.enableScrollable();\n                    }\n\n                    divaSettings.currentlyAutoScrolling = false;\n                    clearInterval(divaSettings.autoScrollInterval);\n                };\n\n                divaInstance.toggleScrolling = function()\n                {\n                    if (divaSettings.currentlyAutoScrolling)\n                        divaInstance.stopScrolling();\n                    else\n                        divaInstance.startScrolling();\n                };\n\n                divaInstance.changeRefresh = function(newRefresh)\n                {\n                    autoScrollRefresh = newRefresh;\n                    updatePixelsPerScroll();\n                };\n\n                divaInstance.changeScrollSpeed = function(newSpeed)\n                {\n                    scrollSpeed = newSpeed;\n                    updatePixelsPerScroll();\n\n                    $(\"#\" + divaSettings.ID + \"autoscroll-pps\").val(log10(scrollSpeed));\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        restartScrollingInterval();\n                    }\n                };\n\n                var updatePixelsPerScroll = function()\n                {\n                    autoScrollRefresh = defaultAutoRefresh;\n                    pixelsPerScroll = scrollSpeed / (1000 / autoScrollRefresh);\n\n                    //should be minimum of one otherwise it won't change the actual value\n                    //user can change autoscrollrefresh or scrollspeed; this may overwrite autoScrollRefresh\n                    if (pixelsPerScroll < 1)\n                    {\n                        autoScrollRefresh = autoScrollRefresh * (1 / pixelsPerScroll);\n                        pixelsPerScroll = scrollSpeed / (1000 / autoScrollRefresh);\n                    }\n                };\n\n                divaInstance.disableManualScroll = function()\n                {\n                    disableManualScroll = true;\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        divaInstance.disableScrollable();\n                    }\n                };\n\n                divaInstance.enableManualScroll = function()\n                {\n                    disableManualScroll = false;\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        divaInstance.enableScrollable();\n                    }\n                };\n\n                divaSettings.currentlyAutoScrolling = false;\n                divaSettings.autoScrollInterval = \"\";\n\n                disableManualScroll = divaSettings.disableManualScroll || false;\n                autoScrollRefresh = divaSettings.autoScrollRefresh || 50;\n                defaultAutoRefresh = autoScrollRefresh;\n\n                divaInstance.changeScrollSpeed((divaSettings.scrollSpeed || 10));\n\n                $(window).on('keyup', function(e)\n                {\n                    if (e.shiftKey && e.keyCode === 32)\n                    {\n                        divaInstance.toggleScrolling();\n                    }\n                });\n\n                if (!divaSettings.disableAutoscrollPrefs)\n                {\n                    var setPosition = function(isFullscreen)\n                    {\n                        if (divaSettings.inFullscreen)\n                        {\n                            var fullscreenTools = $(divaSettings.selector + 'tools');\n                            var toolsMargin = fullscreenTools.css('right');\n                            settings.jqObj.css({\n                                'right': toolsMargin,\n                                'margin-right': 0,\n                                'top': fullscreenTools.offset().top + fullscreenTools.outerHeight() + 15\n                            });\n                        }\n                        else\n                        {\n                            settings.jqObj.css({\n                                'right': $(window).width() - (divaSettings.outerObject.offset().left + divaSettings.outerObject.outerWidth()) + divaSettings.scrollbarWidth,\n                                'margin-right': '.6em'\n                            });\n                            settings.jqObj.offset({'top': divaSettings.outerObject.offset().top + 1});\n                        }\n                    };\n\n                    diva.Events.subscribe('ModeDidSwitch', setPosition, divaSettings.ID);\n\n                    diva.Events.subscribe('ViewerDidLoad', function(s)\n                    {\n                        var autoscrollPrefsString =\n                        \"<div id='\" + divaSettings.ID + \"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'>\" +\n                            \"<b>Autoscrolling options:</b><br>\" +\n                            \"<span class='diva-autoscroll-prefs-text'>Speed:</span>\" +\n                            \"<input type='range' id='\" + divaSettings.ID + \"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='\" + log10(scrollSpeed) + \"' min='0' max='3' step='0.1'><br>\" +\n                            \"<span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span>\" +\n                            \"<input type='checkbox' id='\" + divaSettings.ID + \"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br>\" +\n                            \"<button id='\" + divaSettings.ID + \"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button>\" +\n                        \"</div>\";\n                        $(\"#\" + divaSettings.ID + \"page-nav\").before(\"<div id='\" + divaSettings.ID + \"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>\");\n                        $(\"body\").prepend(autoscrollPrefsString);\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-pps\").on('change', function(e)\n                        {\n                            divaInstance.changeScrollSpeed(Math.pow(10, e.target.value));\n                        });\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-manual\").on('change', function(e)\n                        {\n                            if (e.target.checked)\n                                divaInstance.enableManualScroll();\n                            else\n                                divaInstance.disableManualScroll();\n                        });\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-toggle\").on('click', divaInstance.toggleScrolling);\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-icon\").on('click', function(e)\n                        {\n                            settings.jqObj = $(\"#\" + divaSettings.ID + \"autoscroll-prefs\");\n\n                            if (settings.jqObj.css('display') === 'none')\n                            {\n                                settings.jqObj.css({'display': 'block'});\n\n                                setPosition(divaSettings.inFullscreen);\n\n                            }\n                            else\n                            {\n                                settings.jqObj.css('display', 'none');\n                            }\n                        });\n                    }, divaSettings.ID);\n                }\n            },\n            pluginName: 'autoscroll',\n            titleText: 'Automatically scrolls page along primary axis'\n        };\n        return retval;\n    })());\n})(jQuery);","/*\n\nCanvas plugin for diva.js\nAdds an adjustment icon next to each image\n\n*/\n\n(function ($)\n{\n    window.divaPlugins.push((function ()\n    {\n        var canvas = {},\n            map = {},\n            settings = {},\n            image,\n            sliders,\n            sliderMode;\n\n        // Set up some default settings (can be overridden the normal way)\n        var defaults = {\n            brightnessMax: 150,\n            brightnessMin: -100,\n            brightnessStep: 1,\n            contrastMax: 3,\n            contrastMin: -1,\n            contrastStep: 0.05,\n            localStoragePrefix: 'canvas-',\n            mobileWebkitMaxZoom: 2,\n            rgbMax: 50,\n            rgbMin: -50,\n            throbberFadeSpeed: 200,\n            throbberTimeout: 100,\n            buttons: [\n                'contrast',\n                'brightness',\n                'rotation',\n                'zoom'\n            ]\n        };\n\n        // Convert an angle from degrees to radians\n        var toRadians = function (angle)\n        {\n            return angle * Math.PI / 180;\n        };\n\n        // Determine the new center of the page after rotating by the given angle\n        var getNewCenter = function (currentCenter, angle)\n        {\n            var x = currentCenter.x - canvas.centerX;\n            // Take the negative because the rotation is counterclockwise\n            var y = -(currentCenter.y - canvas.centerY);\n\n            var theta = toRadians(sliders.rotation.previous - angle);\n            var newX = Math.cos(theta) * x - Math.sin(theta) * y + canvas.centerX;\n            var newY = -(Math.sin(theta) * x + Math.cos(theta) * y) + canvas.centerY;\n\n            return {'x': newX, 'y': newY};\n        };\n\n        // Rotates the image on the given canvas by the given angle\n        var rotateCanvas = function (aCanvas, angle)\n        {\n            var context = aCanvas.context;\n            var center = aCanvas.size / 2;\n            var startX = -(aCanvas.width / 2);\n            var startY = -(aCanvas.height / 2);\n\n            // Clear the canvas so that remnants of the old image don't show\n            context.clearRect(0, 0, aCanvas.size, aCanvas.size);\n\n            // Do the rotation\n            context.save();\n            context.translate(center, center);\n            context.rotate(toRadians(angle));\n            context.drawImage(image, startX, startY, aCanvas.width, aCanvas.height);\n            context.restore();\n\n            // Save the new pixel data so that it can later be adjusted in adjustLevels\n            aCanvas.data = context.getImageData(0, 0, aCanvas.size, aCanvas.size);\n        };\n\n        // Determine if we need to update the large canvas\n        var shouldAdjustLevels = function ()\n        {\n            var slider;\n\n            // Returns true if something has been changed\n            for (slider in sliders)\n            {\n                if (sliders[slider].current !== sliders[slider].previous)\n                {\n                    return true;\n                }\n            }\n\n            return false;\n        };\n\n        // Sets the \"previous\" value to the \"current\" value for every slider\n        var updatePreviousLevels = function ()\n        {\n            var slider;\n\n            for (slider in sliders)\n            {\n                sliders[slider].previous = sliders[slider].current;\n            }\n        };\n\n        // Update the thumbnail preview (called when a slider is moved/reset)\n        var updateMap = function ()\n        {\n            rotateCanvas(map, sliders.rotation.current);\n            adjustLevels(map);\n        };\n\n        // Update the large canvas (rotation, zooming, scrolling, pixel manipulation)\n        var updateCanvas = function ()\n        {\n            var angle = sliders.rotation.current;\n            var oldAngle = sliders.rotation.previous;\n            var zoomLevel = sliders.zoom.current;\n            var oldZoomLevel = sliders.zoom.previous;\n\n            // Scroll the user to the desired location\n            if (angle !== oldAngle || zoomLevel !== oldZoomLevel)\n            {\n                // First figure out the current center of the viewport\n                var leftScroll = $('#diva-canvas-wrapper').scrollLeft();\n                var topScroll = $('#diva-canvas-wrapper').scrollTop();\n                var leftOffset = settings.viewport.width / 2;\n                var topOffset = settings.viewport.height / 2;\n\n                // Then determine the new center (the same part of the image)\n                var newCenter = getNewCenter({x: leftScroll + leftOffset, y: topScroll + topOffset}, angle);\n\n                // Incorporate the zoom change ratio (would be 1 if no change)\n                var zoomChange = Math.pow(2, zoomLevel - oldZoomLevel);\n                var toLeftScroll = zoomChange * newCenter.x - leftOffset;\n                var toTopScroll = zoomChange * newCenter.y - topOffset;\n\n                // Rotate the large canvas\n                rotateCanvas(canvas, angle);\n\n                // Scroll to the new center\n                $('#diva-canvas-wrapper').scrollLeft(toLeftScroll);\n                $('#diva-canvas-wrapper').scrollTop(toTopScroll);\n            }\n\n            // Only call adjustLevels again if we really need to (expensive)\n            if (shouldAdjustLevels())\n            {\n                adjustLevels(canvas);\n                updatePreviousLevels();\n            }\n        };\n\n        // Copies the canvas' pixel array and returns the copy\n        var copyImageData = function (aCanvas)\n        {\n            var oldImageData = aCanvas.data;\n            var newImageData = aCanvas.context.createImageData(oldImageData);\n            var pixelArray = newImageData.data;\n            var i, length;\n\n            for (i = 0, length = pixelArray.length; i < length; i++)\n            {\n                pixelArray[i] = oldImageData.data[i];\n            }\n\n            return newImageData;\n        };\n\n        // Determines whether or not we need to adjust this level - very simple\n        var shouldAdjust = function (mode)\n        {\n            var thisChanged = sliders[mode].current !== sliders[mode].previous;\n            var thisNotDefault = sliders[mode].current !== sliders[mode].initial;\n\n            return thisChanged || thisNotDefault;\n        };\n\n        var adjustLevels = function (aCanvas)\n        {\n            // Copy the pixel array to avoid destructively modifying the original\n            var imageData = copyImageData(aCanvas);\n            var pixelArray = imageData.data;\n\n            // Store and calculate some scale factors and offsets\n            var brightness = sliders.brightness.current;\n            var contrast = sliders.contrast.current;\n\n            var brightMul = 1 + Math.min(settings.brightnessMax, Math.max(settings.brightnessMin, brightness)) / settings.brightnessMax;\n            var brightTimesContrast = brightMul * contrast;\n            var contrastOffset = 128 - (contrast * 128);\n\n            var redOffset = sliders.red.current;\n            var greenOffset = sliders.green.current;\n            var blueOffset = sliders.blue.current;\n\n            // Determine whether or not we need to adjust certain things\n            var adjustRed = shouldAdjust('red');\n            var adjustGreen = shouldAdjust('green');\n            var adjustBlue = shouldAdjust('blue');\n\n            var adjustBrightness = shouldAdjust('brightness');\n            var adjustContrast = shouldAdjust('contrast');\n            var adjustOthers = adjustBrightness || adjustContrast;\n\n            var x, y, width, height, offset, r, g, b;\n\n            for (x = 0, width = imageData.width; x < width; x++)\n            {\n                for (y = 0, height = imageData.height; y < height; y++)\n                {\n                    offset = (y * width + x) * 4;\n\n                    r = pixelArray[offset];\n                    g = pixelArray[offset + 1];\n                    b = pixelArray[offset + 2];\n\n                    // Only do something if the pixel is not black originally\n                    if (r + g + b > 0)\n                    {\n                        // Only adjust individual colour channels if necessary\n                        if (adjustRed && r)\n                            r += redOffset;\n\n                        if (adjustGreen && g)\n                            g += greenOffset;\n\n                        if (adjustBlue && b)\n                            b += blueOffset;\n\n                        // If we need to adjust brightness and/or contrast\n                        if (adjustOthers)\n                        {\n                            if (r)\n                                r = r * brightTimesContrast + contrastOffset;\n\n                            if (g)\n                                g = g * brightTimesContrast + contrastOffset;\n\n                            if (b)\n                                b = b * brightTimesContrast + contrastOffset;\n                        }\n\n                        pixelArray[offset] = r;\n                        pixelArray[offset + 1] = g;\n                        pixelArray[offset + 2] = b;\n                    }\n                }\n            }\n\n            aCanvas.context.clearRect(0, 0, width, height);\n            aCanvas.context.putImageData(imageData, 0, 0);\n        };\n\n        // Update the box in the preview showing where you currently are\n        var updateViewbox = function ()\n        {\n            // Determine the top left corner coordinates based on our current position\n            var cornerX = $('#diva-canvas-wrapper').scrollLeft() * map.scaleFactor;\n            var cornerY = $('#diva-canvas-wrapper').scrollTop() * map.scaleFactor;\n\n            // Subtract 4 to compensate for the borders\n            var height = Math.min(Math.round(settings.viewport.height * map.scaleFactor), settings.mapSize) - 4;\n            var width = Math.min(Math.round(settings.viewport.width * map.scaleFactor), settings.mapSize) - 4;\n\n            $('#diva-map-viewbox').height(height).width(width).css({top: cornerY, left: cornerX});\n        };\n\n        // Draw the thumbnail preview in the toolbar\n        var loadMap = function (image)\n        {\n            map.canvas = document.getElementById('diva-canvas-minimap');\n            map.size = settings.mapSize;\n            map.canvas.width = map.size;\n            map.canvas.height = map.size;\n\n            // Give it a black background\n            map.context = map.canvas.getContext('2d');\n            map.context.fillRect(0, 0, map.size, map.size);\n\n            // Determine the coordinates/dimensions of the preview\n            map.scaleFactor = settings.mapSize / canvas.size;\n            map.cornerX = canvas.cornerX * map.scaleFactor;\n            map.cornerY = canvas.cornerY * map.scaleFactor;\n            map.width = image.width * map.scaleFactor;\n            map.height = image.height * map.scaleFactor;\n\n            // Draw the image within the map (no adjustments) and save the pixel array\n            map.context.drawImage(image, map.cornerX, map.cornerY, map.width, map.height);\n            map.data = map.context.getImageData(0, 0, settings.mapSize, settings.mapSize);\n\n            // Show the viewbox, make it reflect where we currently are\n            $('#diva-map-viewbox').show();\n            updateViewbox();\n        };\n\n        // Load the image within the large and small canvases\n        var loadCanvas = function (imageURL, callback)\n        {\n            image = new Image();\n            image.crossOrigin = \"anonymous\";\n\n            image.onload = function ()\n            {\n                // Determine the size of the (square) canvas based on the hypoteneuse\n                canvas.size = Math.sqrt(image.width * image.width + image.height * image.height);\n\n                // Resize the canvas if necessary\n                canvas.canvas = document.getElementById('diva-canvas');\n                canvas.canvas.width = canvas.size;\n                canvas.canvas.height = canvas.size;\n                canvas.cornerX = (canvas.size - image.width) / 2;\n                canvas.cornerY = (canvas.size - image.height) / 2;\n                canvas.width = image.width;\n                canvas.height = image.height;\n                canvas.centerX = canvas.size / 2;\n                canvas.centerY = canvas.size / 2;\n\n                // Draw the image to the large canvas, and save the pixel array\n                canvas.context = canvas.canvas.getContext('2d');\n                canvas.context.drawImage(image, canvas.cornerX, canvas.cornerY, canvas.width, canvas.height);\n                try\n                {\n                    canvas.data = canvas.context.getImageData(0, 0, canvas.size, canvas.size);\n                }\n                catch (error)\n                {\n                    var canvasError = '<div id=\"diva-error\" class=\"diva-error\"><p><strong>Error</strong></p><p>' + error.message + '</p>';\n\n                    if (error.name === 'SecurityError')\n                    {\n                        canvasError += '<p>You may need to update your server configuration in order to use the image manipulation tools. ' +\n                        'For help, see the <a href=\"https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-' +\n                        'canvas-and-cross-site-data\" target=\"_blank\">canvas cross-site data documentation</a>.</p>' +\n                        '</div>';\n                    }\n                    else\n                    {\n                        throw error;\n                    }\n\n                    canvasError += '</div>';\n                    $('#diva-canvas-backdrop').append(canvasError);\n                    hideThrobber();\n                }\n\n                // Only load the map the first time (when there is no callback)\n                if (callback === undefined) {\n                    loadMap(image);\n                }\n\n                // Update the map and the canvas if necessary\n                updateMap();\n                updateCanvas(canvas);\n\n                // Hide the throbber if it is visible\n                hideThrobber();\n\n                // If the callback function exists, execute it (for zooming)\n                if (typeof callback === 'function')\n                    callback.call(callback);\n            };\n\n            image.src = imageURL;\n\n            // make sure the load event fires for cached images too\n            if ( image.complete || image.complete === undefined ) {\n                image.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\n                image.src = imageURL;\n            }\n        };\n\n        var updateSliderLabel = function ()\n        {\n            var thisSlider = sliders[sliderMode];\n            var value = thisSlider.current;\n            var stringValue = (thisSlider.transform) ? thisSlider.transform(value) : value;\n            $('#diva-canvas-value').html(stringValue);\n        };\n\n        var updateSliderValue = function ()\n        {\n            $('#diva-canvas-slider').val(sliders[sliderMode].current);\n        };\n\n        // Returns the URL for the image at the specified zoom level\n        var getImageURL = function (zoomLevel)\n        {\n            var width = settings.zoomWidthRatio * Math.pow(2, zoomLevel);\n            var imdir = settings.imageDir + \"/\";\n            var pageIndex = settings.selectedPageIndex;\n\n            var imageURL;\n\n            if (settings.isIIIF)\n            {\n                var quality = (settings.pages[pageIndex].api > 1.1) ? 'default' : 'native';\n                imageURL = encodeURI(settings.pages[pageIndex].url + 'full/' + width + ',/0/' + quality + '.jpg');\n            }\n            else\n            {\n                imageURL = settings.iipServerURL + \"?FIF=\" + imdir + settings.filename + '&WID=' + width + '&CVT=JPEG';\n            }\n\n            return imageURL;\n        };\n\n        var showThrobber = function ()\n        {\n            // Only show the throbber if it will take a long time\n            if (sliders.zoom.current > 0 || settings.mobileWebkit)\n                $(settings.selector + 'throbber').addClass('canvas-throbber').show();\n        };\n\n        // Hides the loading indicator icon\n        var hideThrobber = function ()\n        {\n            $(settings.selector + 'throbber').removeClass('canvas-throbber').hide();\n        };\n\n        // If any modifications have been applied, save them to localStorage\n        var saveSettings = function ()\n        {\n            var sliderSettings = {};\n            var changed = false;\n            var storageKey = settings.localStoragePrefix + settings.filename;\n            var slider;\n\n            for (slider in sliders)\n            {\n                if (sliders[slider].previous !== sliders[slider].initial)\n                {\n                    sliderSettings[slider] = sliders[slider].previous;\n                    changed = true;\n                }\n            }\n\n            // If modifications need to be saved, update the canvas plugin icon\n            if (changed)\n            {\n                settings.pluginIcon.addClass('new');\n                localStorage.setObject(storageKey, sliderSettings);\n            }\n            else\n            {\n                settings.pluginIcon.removeClass('new');\n                localStorage.removeItem(storageKey);\n            }\n        };\n\n        // Handles zooming in when the zoom slider is changed and the change is applied\n        var updateZoom = function (newZoomLevel, callback)\n        {\n            settings.zoomLevel = newZoomLevel;\n\n            // Figure out the URL for the image at this new zoom level\n            var imageURL = getImageURL(newZoomLevel);\n\n            loadCanvas(imageURL, function ()\n            {\n                // Set the new scale factor and update the viewbox\n                map.scaleFactor = map.size / canvas.size;\n                updateViewbox();\n\n                saveSettings();\n            });\n        };\n\n        var bindCanvasKeyEvents = function (event)\n        {\n            var upArrowKey = 38,\n                downArrowKey = 40,\n                leftArrowKey = 37,\n                rightArrowKey = 39;\n\n            switch (event.keyCode)\n            {\n                case upArrowKey:\n                    // Up arrow - scroll up\n                    $('#diva-canvas-wrapper').scrollTop(document.getElementById('diva-canvas-wrapper').scrollTop - settings.arrowScrollAmount);\n                    return false;\n\n                case downArrowKey:\n                    // Down arrow - scroll down\n                    $('#diva-canvas-wrapper').scrollTop(document.getElementById('diva-canvas-wrapper').scrollTop + settings.arrowScrollAmount);\n                    return false;\n\n                case leftArrowKey:\n                    // Left arrow - scroll left\n                    $('#diva-canvas-wrapper').scrollLeft(document.getElementById('diva-canvas-wrapper').scrollLeft - settings.arrowScrollAmount);\n                    return false;\n\n                case rightArrowKey:\n                    // Right arrow - scroll right\n                    $('#diva-canvas-wrapper').scrollLeft(document.getElementById('diva-canvas-wrapper').scrollLeft + settings.arrowScrollAmount);\n                    return false;\n            }\n        };\n\n        var retval =\n        {\n            init: function (divaSettings, divaInstance)\n            {\n                // If the browser does not support canvas, do nothing\n                // And, disable this plugin\n                var canvasSupported = !!window.HTMLCanvasElement;\n                if (!canvasSupported)\n                    return false;\n\n                // Override all the configurable settings defined under canvasPlugin\n                $.extend(settings, defaults, divaSettings.canvasPlugin);\n\n                settings.inCanvas = false;\n                settings.iipServerURL = divaSettings.iipServerURL;\n                settings.imageDir = divaSettings.imageDir;\n                settings.selector = divaSettings.selector;\n                settings.mobileWebkit = divaSettings.mobileWebkit;\n                settings.arrowScrollAmount = divaSettings.arrowScrollAmount;\n\n                // Set up the settings for the sliders/icons\n                sliders = {\n                    'contrast': {\n                        'initial': 1,\n                        'min': settings.contrastMin,\n                        'max': settings.contrastMax,\n                        'step': settings.contrastStep,\n                        'transform': function (value) {\n                            return value.toFixed(2);\n                        },\n                        'title': 'Change the contrast'\n                    },\n                    'brightness': {\n                        'initial': 0,\n                        'min': settings.brightnessMin,\n                        'max': settings.brightnessMax,\n                        'step': settings.brightnessStep,\n                        'title': 'Adjust the brightness'\n                    },\n                    'rotation': {\n                        'initial': 0,\n                        'min': 0,\n                        'max': 359,\n                        'step': 1,\n                        'transform': function (value) {\n                            return value + '&deg;';\n                        },\n                        'title': 'Rotate the image'\n                    },\n                    'zoom': {\n                        // Default, min and max values updated within setupHook\n                        'initial': 0,\n                        'min': 0,\n                        'max': 0,\n                        'step': 1,\n                        'title': 'Adjust the zoom level'\n                    },\n                    'red': {\n                        'initial': 0,\n                        'min': settings.rgbMin,\n                        'max': settings.rgbMax,\n                        'step': 1,\n                        'title': 'Adjust the red channel'\n                    },\n                    'green': {\n                        'initial': 0,\n                        'min': settings.rgbMin,\n                        'max': settings.rgbMax,\n                        'step': 1,\n                        'title': 'Adjust the green channel'\n                    },\n                    'blue': {\n                        'initial': 0,\n                        'min': settings.rgbMin,\n                        'max': settings.rgbMax,\n                        'step': 1,\n                        'title': 'Adjust the blue channel'\n                    }\n                };\n\n                // Copy the \"default\" value into \"value\" and \"previous\" for each slider\n                var resetSliders = function ()\n                {\n                    var defaultValue, thisSlider, slider;\n                    for (slider in sliders)\n                    {\n                        thisSlider = sliders[slider];\n                        defaultValue = thisSlider.initial;\n                        thisSlider.current = defaultValue;\n                        thisSlider.previous = defaultValue;\n                    }\n                };\n\n                resetSliders();\n\n                // Create the DOM elements if they haven't already been created\n                if ($('#diva-canvas-backdrop').length)\n                {\n                    // Return true to keep the plugin enabled\n                    return true;\n                }\n\n                var canvasButtonsList = [];\n                var buttonHTML, button, buttonTitle, i;\n\n                for (i in settings.buttons)\n                {\n                    button = settings.buttons[i];\n                    buttonTitle = sliders[button].title;\n                    buttonHTML = '<div class=\"' + button + '\" title=\"' + buttonTitle + '\"></div>';\n                    canvasButtonsList.push(buttonHTML);\n                }\n                var canvasButtons = canvasButtonsList.join('');\n\n                var canvasTools = '<div id=\"diva-canvas-tools\">' +\n                    '<div id=\"diva-canvas-toolbar\">' +\n                        '<div id=\"diva-canvas-close\" title=\"Return to the document viewer\"></div>' +\n                        '<div id=\"diva-canvas-minimise\" title=\"Minimise the toolbar\"></div>' +\n                        '<span id=\"diva-canvas-info\">Test</span>' +\n                    '</div>' +\n                    '<div id=\"diva-canvas-toolwindow\">' +\n                        '<div id=\"diva-map-viewbox\"></div>' +\n                        '<canvas id=\"diva-canvas-minimap\"></canvas>' +\n                        '<div id=\"diva-canvas-buttons\">' +\n                            canvasButtons +\n                        '</div>' +\n                        '<div id=\"diva-canvas-pane\">' +\n                            '<p id=\"diva-canvas-tooltip\">' +\n                                '<span id=\"diva-canvas-mode\">contrast</span>: ' +\n                                '<span id=\"diva-canvas-value\">0</span> ' +\n                                '<span id=\"diva-canvas-reset\" class=\"link\">(Reset)</span>' +\n                            '</p>' +\n                            '<input type=\"range\" id=\"diva-canvas-slider\"></input>' +\n                        '</div>' +\n                        '<br />' +\n                        '<div class=\"action-buttons\">' +\n                            '<a href=\"#\" id=\"diva-canvas-reset-all\">Reset all</a>' +\n                            '<a href=\"#\" id=\"diva-canvas-apply\">Apply</a>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>';\n                var canvasWrapper = '<div id=\"diva-canvas-wrapper\">' +\n                    '<canvas id=\"diva-canvas\"></canvas>' +\n                '</div>';\n                var canvasString = '<div id=\"diva-canvas-backdrop\">' +\n                    canvasTools +\n                    canvasWrapper +\n                '</div>';\n\n                $('body').append(canvasString);\n\n                // Save the size of the map, as defined in the CSS\n                settings.mapSize = $('#diva-canvas-minimap').width();\n\n                // Adjust the slider when something is clicked, and make that the current mode\n                $('#diva-canvas-buttons div').click(function ()\n                {\n                    $('#diva-canvas-buttons .clicked').removeClass('clicked');\n                    updateSlider($(this).attr('class'));\n                });\n\n                var updateSlider = function (newMode)\n                {\n                    sliderMode = newMode;\n                    var sliderData = sliders[sliderMode];\n\n                    $('#diva-canvas-buttons .' + sliderMode).addClass('clicked');\n\n                    $('#diva-canvas-mode').text(sliderMode);\n\n                    var newValue = sliderData.current;\n                    var newValueString = (sliderData.transform) ? sliderData.transform(newValue) : newValue;\n\n                    var slider = document.getElementById('diva-canvas-slider');\n                    slider.min = sliderData.min;\n                    slider.max = sliderData.max;\n                    slider.step = sliderData.step;\n                    $('#diva-canvas-slider').val(newValue);\n                    $('#diva-canvas-value').html(newValueString);\n                };\n\n                updateSlider('contrast');\n\n                // Create the slider\n                $('#diva-canvas-slider').on('input', function(e){\n                    sliders[sliderMode].current = parseFloat(this.value);\n                    updateSliderLabel();\n                    updateMap();\n                });\n\n                // Reset all the sliders to the default value\n                $('#diva-canvas-reset-all').click(function ()\n                {\n                    var slider;\n\n                    for (slider in sliders)\n                    {\n                        sliders[slider].current = sliders[slider].initial;\n                    }\n\n                    // Change the value of the label\n                    updateSliderLabel();\n                    updateSliderValue();\n\n                    // Update the preview\n                    updateMap();\n                });\n\n                // Reset the current slider to the default value\n                $('#diva-canvas-reset').click(function ()\n                {\n                    // Update the current value and the slider\n                    sliders[sliderMode].current = sliders[sliderMode].initial;\n                    updateSliderLabel();\n                    updateSliderValue();\n\n                    // Update the preview\n                    updateMap();\n                });\n\n                // Update the large canvas when the apply button is clicked\n                $('#diva-canvas-apply').click(function ()\n                {\n                    if (shouldAdjustLevels())\n                    {\n                        showThrobber();\n\n                        setTimeout(function ()\n                        {\n                            if (sliders.zoom.current !== sliders.zoom.previous)\n                            {\n                                updateZoom(sliders.zoom.current);\n                            }\n                            else\n                            {\n                                updateCanvas();\n                                hideThrobber();\n\n                                // Save modifications to localSettings (also done in updateZoom callback)\n                                saveSettings();\n                            }\n                        }, settings.throbberTimeout);\n                    }\n                });\n\n                // Handle exiting canvas mode\n                $('#diva-canvas-close').click(function ()\n                {\n                    $('body').removeClass('overflow-hidden');\n\n                    // Clear the canvases and hide things\n                    // This needs to be improved - not done properly?\n                    canvas.context.clearRect(0, 0, canvas.size, canvas.size);\n                    map.context.clearRect(0, 0, map.size, map.size);\n                    $('#diva-canvas-wrapper').scrollTop(0).scrollLeft(0);\n                    $('#diva-canvas-backdrop').hide();\n                    $('#diva-map-viewbox').hide();\n                    hideThrobber();\n\n                    // Re-enable scrolling of diva when it is in the background\n                    divaInstance.enableScrollable();\n                    $(document).off('keydown', bindCanvasKeyEvents);\n\n                    // Reset everything\n                    resetSliders();\n                    updateSliderLabel();\n                    updateSliderValue();\n                    $('#diva-canvas-buttons .clicked').removeClass('clicked');\n                    updateSlider('contrast');\n\n                    diva.Events.publish(\"CanvasViewDidHide\");\n                });\n\n                // Hide the toolbar when the minimise icon is clicked\n                $('#diva-canvas-minimise').click(function ()\n                {\n                    $('#diva-canvas-toolwindow').slideToggle('fast');\n                });\n\n                // Adjust the size of the canvas when the browser window is resized\n                $(window).resize(function ()\n                {\n                    settings.viewport = {\n                        height: window.innerHeight - divaSettings.scrollbarWidth,\n                        width: window.innerWidth - divaSettings.scrollbarWidth\n                    };\n\n                    // Always update the settings but only redraw if in canvas\n                    if (settings.inCanvas)\n                        updateViewbox();\n                });\n\n                // Update the viewbox when the large canvas is scrolled\n                $('#diva-canvas-wrapper').scroll(function ()\n                {\n                    if (settings.inCanvas)\n                        updateViewbox();\n                });\n\n                // Handle clicking/dragging of the viewbox (should scroll the large canvas)\n                $('#diva-canvas-minimap, #diva-map-viewbox').mouseup(function (event)\n                {\n                    // Consider caching this eventually (can't be done in init though)\n                    var offset = $('#diva-canvas-minimap').offset();\n\n                    var scaledX = (event.pageX - offset.left) / map.scaleFactor;\n                    var scaledY = (event.pageY - offset.top) / map.scaleFactor;\n\n                    $('#diva-canvas-wrapper').scrollTop(scaledY - settings.viewport.height / 2);\n                    $('#diva-canvas-wrapper').scrollLeft(scaledX - settings.viewport.width / 2);\n                });\n\n                // Enable drag scroll\n                $('#diva-canvas').mousedown(function ()\n                {\n                    $(this).addClass('grabbing');\n                }).mouseup(function ()\n                {\n                    $(this).removeClass('grabbing');\n                });\n\n                // touch events\n                $('#diva-canvas-wrapper').kinetic();\n\n                // mouse events\n                $('#diva-canvas-wrapper').dragscrollable({\n                    acceptPropagatedEvent: true\n                });\n\n                diva.Events.subscribe('ObjectDidLoad', this.setupHook, divaSettings.ID);\n                diva.Events.subscribe('ViewerDidTerminate', this.destroy, divaSettings.ID);\n                diva.Events.subscribe('PageDidLoad', this.onPageLoad, divaSettings.ID);\n\n                return true;\n            },\n\n            pluginName: 'canvas',\n\n            titleText: 'View the image on a canvas and adjust various settings',\n\n            setupHook: function(divaSettings)\n            {\n                settings.viewport = {\n                    height: window.innerHeight - divaSettings.scrollbarWidth,\n                    width: window.innerWidth - divaSettings.scrollbarWidth\n                };\n\n                // Save the min and max zoom level, and update the zoom slider\n                settings.minZoomLevel = divaSettings.minZoomLevel;\n                settings.maxZoomLevel = divaSettings.maxZoomLevel;\n\n                // If we're on the iPad, limit the max zoom level to 2\n                // Can't do canvas elements that are > 5 megapixels (issue #112)\n                if (settings.mobileWebkit)\n                    settings.maxZoomLevel = Math.min(settings.maxZoomLevel, settings.mobileWebkitMaxZoom);\n\n                sliders.zoom.min = settings.minZoomLevel;\n                sliders.zoom.max = settings.maxZoomLevel;\n            },\n\n            handleClick: function(event, divaSettings, divaInstance)\n            {\n                // loadCanvas() calls all the other necessary functions to load\n                var page = $(this).parent().parent();\n                var filename = $(page).attr('data-filename');\n                var selectedPageIndex = $(page).attr('data-index');\n                var width = $(page).width() - 1;\n                var zoomLevel = divaSettings.zoomLevel;\n                var slider;\n\n                settings.zoomWidthRatio = width / Math.pow(2, zoomLevel);\n                settings.pluginIcon = $(this);\n\n                settings.pages = divaSettings.pages;\n                settings.isIIIF = divaSettings.isIIIF;\n                settings.selectedPageIndex = selectedPageIndex;\n\n                // Limit the max zoom level if we're on the iPad\n                if (settings.mobileWebkit) {\n                    zoomLevel = Math.min(settings.maxZoomLevel, zoomLevel);\n                }\n\n                settings.filename = filename;\n                sliders.zoom.initial = zoomLevel;\n                sliders.zoom.current = zoomLevel;\n\n                // Find the settings stored in localStorage, if they exist\n                var sliderSettings = localStorage.getObject(settings.localStoragePrefix + settings.filename);\n                if (sliderSettings)\n                {\n                    for (slider in sliderSettings)\n                    {\n                        sliders[slider].current = sliderSettings[slider];\n\n                        // If the current slider's value has changed, update it\n                        if (slider === sliderMode)\n                        {\n                            updateSliderLabel();\n                            updateSliderValue();\n                        }\n\n                        if (slider === 'zoom')\n                        {\n                            zoomLevel = sliderSettings[slider];\n                        }\n                    }\n                }\n\n                sliders.zoom.previous = zoomLevel;\n\n                // Prevent scroll in body, and show the canvas backdrop\n                $('body').addClass('overflow-hidden');\n                $('#diva-canvas-backdrop').show();\n\n                // Disable scrolling on main diva instance\n                divaInstance.disableScrollable();\n                // Enable canvas scrolling\n                $(document).keydown(bindCanvasKeyEvents);\n\n                // Set this to true so events can be captured\n                settings.inCanvas = true;\n\n                var imageURL = getImageURL(zoomLevel);\n\n                // Change the title of the page\n                $('#diva-canvas-info').text($(page).attr('title'));\n\n                showThrobber();\n\n                diva.Events.publish('CanvasViewDidActivate', [page]);\n\n                loadCanvas(imageURL);\n            },\n\n            onPageLoad: function(pageIndex, filename, selector)\n            {\n                // If something exists for this page in localStorage, then change icon color\n                var storageKey = settings.localStoragePrefix + filename;\n\n                if (localStorage.getItem(storageKey) !== null)\n                {\n                    $(selector).find('.diva-canvas-icon').addClass('new');\n                }\n            },\n\n            destroy: function(divaSettings, divaInstance)\n            {\n                $('#diva-canvas-backdrop').remove();\n            }\n        };\n\n        // this returns an object with all of the necessary hooks and callbacks\n        // embedded.\n        return retval;\n\n    })());\n})(jQuery);\n","/*\nDownload plugin for diva.js\nAllows you to download images served by IIPImage or IIIF compatible image servers\n*/\n\n(function ($)\n{\n    window.divaPlugins.push((function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                return true;\n            },\n            pluginName: 'download',\n            titleText: 'Download image at the given zoom level',\n            handleClick: function(event, divaSettings)\n            {\n                var pageDiv = $(this).parent().parent();\n                var filename = $(pageDiv).attr('data-filename');\n                var pageIndex = $(pageDiv).attr('data-index');\n                var width = $(pageDiv).width() - 1;\n                var image;\n\n                if (divaSettings.isIIIF)\n                {\n                    var quality = (divaSettings.pages[pageIndex].api > 1.1) ? 'default' : 'native';\n                    image = encodeURI(divaSettings.pages[pageIndex].url + 'full/' + width + ',/0/' + quality + '.jpg');\n                }\n                else\n                {\n                    image = divaSettings.iipServerURL + \"?FIF=\" + divaSettings.imageDir + '/' + filename + '&WID=' + width + '&CVT=JPEG';\n                }\n                window.open(image);\n            }\n        };\n\n        return retval;\n    })());\n})(jQuery);\n","/*\nHighlight plugin for diva.js\nAllows you to highlight regions of a page image\n*/\n\n(function ($)\n{\n    window.divaPlugins.push((function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                // initialize an empty highlights object.\n                divaSettings.parentObject.data('highlights', {});\n                var currentHighlight, currentHighlightPage;\n\n                /*\n                    When a new page is loaded, this method will be called with the\n                    page index for the page. This method looks at the 'highlights'\n                    data object set on the diva parent element, and determines whether\n                    highlights exist for that page.\n\n                    If so, this method will create and render elements for every\n                    highlighted box.\n\n                    If a page scrolls out of the viewer, the highlight elements\n                    will be removed as part of the Diva DOM pruning process, since\n                    each highlight element is a child of the the page object. When the page\n                    is scrolled back in to view, this method is called again.\n\n                    @param pageIdx       The page index of the page that is to be highlighted\n                    @param filename      The image filename of the page\n                    @param pageSelector  The selector for the page (unused here)\n                */\n                function _highlight(pageIdx, filename, pageSelector)\n                {\n                    var highlightObj = divaSettings.parentObject.data('highlights');\n\n                    if (typeof highlightObj === 'undefined')\n                        return;\n\n                    if (highlightObj.hasOwnProperty(pageIdx))\n                    {\n                        //first, make sure no highlights already exist on the page\n                        var pageHighlights = document.getElementById(divaSettings.ID + \"page-\" + pageIdx).getElementsByClassName(divaSettings.ID + \"highlight\");\n                        while(pageHighlights[0])\n                        {\n                            pageHighlights[0].parentNode.removeChild(pageHighlights[0]);\n                        }\n\n                        var pageId = divaInstance.getInstanceId() + 'page-' + pageIdx;\n                        var pageObj = document.getElementById(pageId);\n                        var regions = highlightObj[pageIdx].regions;\n                        var colour = highlightObj[pageIdx].colour;\n                        var divClass = highlightObj[pageIdx].divClass;\n\n                        var maxZoom = divaInstance.getMaxZoomLevel();\n                        var zoomDifference;\n\n                        if (divaSettings.inGrid)\n                        {\n                            var maxZoomWidth = divaInstance.getPageDimensionsAtZoomLevel(pageIdx, maxZoom).width;\n                            var currentWidth = pageObj.clientWidth;\n                            var widthProportion = maxZoomWidth / currentWidth;\n                            zoomDifference = Math.log(widthProportion) / Math.log(2);\n                        }\n                        else\n                        {\n                            zoomDifference = maxZoom - divaInstance.getZoomLevel();\n                        }\n\n                        var j = regions.length;\n                        while (j--)\n                        {\n                            var box = document.createElement('div');\n\n                            box.style.width = _incorporate_zoom(regions[j].width, zoomDifference) + \"px\";\n                            box.style.height = _incorporate_zoom(regions[j].height, zoomDifference) + \"px\";\n                            box.style.top = _incorporate_zoom(regions[j].uly, zoomDifference) + \"px\";\n                            box.style.left = _incorporate_zoom(regions[j].ulx, zoomDifference) + \"px\";\n                            box.style.background = colour;\n                            box.style.border = \"1px solid #555\";\n                            box.style.position = \"absolute\";\n                            box.style.zIndex = 100;\n                            box.className = divClass;\n\n                            if (typeof regions[j].divID !== 'undefined')\n                            {\n                                box.setAttribute('data-highlight-id', regions[j].divID);\n                            }\n\n                            pageObj.appendChild(box);\n                        }\n                    }\n                    updateCurrentHighlight();\n                    diva.Events.publish(\"HighlightCompleted\", [pageIdx, filename, pageSelector]);\n                }\n\n                var updateCurrentHighlight = function()\n                {\n                    var classString = divaSettings.ID + \"selected-highlight\";\n                    var classElem = document.getElementsByClassName(classString);\n                    var idx;\n                    var box;\n                    var boxes;\n\n                    for (idx = 0; idx < classElem.length; idx++)\n                    {\n                        box = classElem[idx];\n                        if (box.id !== currentHighlight)\n                        {\n                            box.className = box.className.replace(' '+classString, '');\n                            box.style.border = \"1px solid #555\";  \n                        }\n                    }\n\n                    if (divaInstance.isPageLoaded(currentHighlightPage))\n                    {\n                        boxes = document.querySelectorAll(\"*[data-highlight-id=\" + currentHighlight + \"]\");\n                        for(idx = 0; idx < boxes.length; idx++)\n                        {\n                            box = boxes[idx];\n                            box.className = box.className + \" \" + classString;\n                            box.style.border = \"2px solid #000\";\n                        }\n                    }\n                };\n\n                // subscribe the highlight method to the page change notification\n                diva.Events.subscribe(\"PageDidLoad\", _highlight, divaSettings.ID);\n\n                var _incorporate_zoom = function(position, zoomDifference)\n                {\n                    return position / Math.pow(2, zoomDifference);\n                };\n\n                /*\n                    Reset the highlights object and removes all highlights from the document.\n                */\n                divaInstance.resetHighlights = function()\n                {\n                    var inner = document.getElementById(divaSettings.ID + 'inner');\n                    var highlightClass = divaSettings.ID + 'highlight';\n                    var descendents = inner.getElementsByClassName(highlightClass);\n                    var j = descendents.length;\n\n                    while (j--) {\n                        var parentObj = descendents[j].parentNode;\n                        parentObj.removeChild(descendents[j]);\n                    }\n\n                    divaSettings.parentObject.data('highlights', {});\n                };\n\n                /*\n                    Resets the highlights for a single page.\n                */\n                divaInstance.removeHighlightsOnPage = function(pageIdx)\n                {\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n                    if (highlightsObj.hasOwnProperty(pageIdx))\n                    {\n                        var pageId = divaInstance.getInstanceId() + 'page-' + pageIdx;\n                        var pageObj = document.getElementById(pageId);\n                        var descendents = pageObj.getElementsByTagName('div');\n                        var highlightClass = highlightsObj[pageIdx].divClass;\n\n                        var j = descendents.length;\n\n                        while (j--)\n                        {\n                            if (descendents[j].className === highlightClass)\n                                pageObj.removeChild(descendents[j]);\n                        }\n\n                        delete highlightsObj[pageIdx];\n                    }\n                };\n\n                /*\n                    Highlights regions on multiple pages.\n                    @param pageIdxs An array of page index numbers\n                    @param regions  An array of regions\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                */\n                divaInstance.highlightOnPages = function(pageIdxs, regions, colour, divClass)\n                {\n                    var j = pageIdxs.length;\n                    while (j--)\n                    {\n                        divaInstance.highlightOnPage(pageIdxs[j], regions[j], colour, divClass);\n                    }\n                };\n\n                /*\n                    Highlights regions on a page.\n                    @param pageIdx  A page index number\n                    @param regions  An array of regions. Use {'width':i, 'height':i, 'ulx':i, 'uly': i, 'divID': str} for each region.\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                    @param divClass (optional) A class to identify a group of highlighted regions on a specific page by\n                */\n                divaInstance.highlightOnPage = function(pageIdx, regions, colour, divClass)\n                {\n                    if (typeof colour === 'undefined')\n                    {\n                        colour = 'rgba(255, 0, 0, 0.2)';\n                    }\n\n                    if (typeof divClass === 'undefined')\n                    {\n                        divClass = divaSettings.ID + 'highlight';\n                    }\n                    else\n                    {\n                        divClass = divaSettings.ID + 'highlight ' + divClass;\n                    }\n\n                    var maxZoom = divaInstance.getMaxZoomLevel();\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n\n                    highlightsObj[pageIdx] = {\n                        'regions': regions, 'colour': colour, 'divClass': divClass\n                    };\n\n\n                    //Highlights are created on load; create them for all loaded pages now\n                    if (divaInstance.isPageLoaded(pageIdx))\n                    {\n                        _highlight(pageIdx, null, null);\n                    }\n\n                    return true;\n                };\n\n                /*\n                    Jumps to a highlight somewhere in the document.\n                    @param divID The ID of the div to jump to. This ID must be attached to the div using .highlightOnPage(s) as the highlight may not be currently appended to the DOM.\n                */\n                divaInstance.gotoHighlight = function(divID)\n                {\n                    var thisDiv;\n                    var centerYOfDiv;\n                    var centerXOfDiv;\n\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n                    var highlightFound = false; //used to break both loops\n\n                    //see if it exists in the DOM already first\n                    if (document.getElementById(divID) !== null)\n                    {\n                        var page = parseInt(document.getElementById(divID).parentNode.getAttribute('data-index'), 10);\n                        \n                        var numDivs = highlightsObj[page].regions.length;\n                        while (numDivs--)\n                        {\n                            if (highlightsObj[page].regions[numDivs].divID === divID)\n                            {\n                                return gotoDiv(page, highlightsObj[page].regions[numDivs]);\n                            }\n                        }\n                    }\n                    else\n                    {\n                        var pageArr = Object.keys(highlightsObj);\n                        var pageIdx = pageArr.length;\n                        while (pageIdx--)\n                        {\n                            var regionArr = highlightsObj[pageArr[pageIdx]].regions;\n                            var arrIndex = regionArr.length;\n\n                            while (arrIndex--)\n                            {\n                                if (regionArr[arrIndex].divID === divID)\n                                {\n                                    return gotoDiv(pageArr[pageIdx], regionArr[arrIndex]);\n                                }\n                            }\n                        }\n                    }\n\n                    console.warn(\"Diva just tried to find a highlight that doesn't exist.\");\n                    return false;\n                };\n\n                /**\n                * Moves the diva pane to (page) and makes a darker border on (thisDiv)\n                */\n                var gotoDiv = function(page, thisDiv)\n                {\n                    //gets center of the div\n                    var centerYOfDiv = parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2;\n                    var centerXOfDiv = parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2;\n\n                    var desiredY = divaInstance.translateFromMaxZoomLevel(centerYOfDiv);\n                    var desiredX = divaInstance.translateFromMaxZoomLevel(centerXOfDiv);\n\n                    //navigates to the page\n                    page = parseInt(page, 10);\n                    divaInstance.gotoPageByIndex(page);\n                    var outerObject = divaInstance.getSettings().outerObject;\n                    var currentTop = outerObject.scrollTop() + desiredY - (outerObject.height() / 2) + divaSettings.verticalPadding;\n                    var currentLeft = outerObject.scrollLeft() + desiredX - (outerObject.width() / 2) + divaSettings.horizontalPadding;\n\n                    //changes the scroll location to center on the div as much as is possible\n                    outerObject.scrollTop(currentTop);\n                    outerObject.scrollLeft(currentLeft);\n\n                    currentHighlight = thisDiv.divID;\n                    currentHighlightPage = page;\n\n                    diva.Events.publish(\"SelectedHighlightChanged\", [currentHighlight, currentHighlightPage]);\n\n                    //selects the highlight\n                    updateCurrentHighlight();\n                    return currentHighlight;\n                };\n\n                var getDivCenter = function(thisDiv)\n                {\n                    if (divaSettings.verticallyOriented) return divaInstance.translateFromMaxZoomLevel(parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2);\n                    else return divaInstance.translateFromMaxZoomLevel(parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2);\n                };\n\n                /*\n                    Jumps to the next highlight along the primary axis of the document.\n                */\n                var findAdjacentHighlight = function(forward)\n                {\n                    var centerOfTargetDiv;\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n                    var highlightFound = false;\n                    var centerOfCurrentDiv;\n                    var currentPage;\n                    var regionArr, arrIndex;\n                    var pageDims;\n                    var centerOfDiv, targetDiv;\n                    \n                    var thisDiv;\n                    var compFunction;\n\n\n                    //if currentHighlight already exists\n                    if(currentHighlight && currentHighlightPage)\n                    {\n                        currentPage = currentHighlightPage;\n                        regionArr = highlightsObj[currentPage].regions;\n                        arrIndex = regionArr.length;\n\n                        //find the center of the current div\n                        while(arrIndex--)\n                        {\n                            if (regionArr[arrIndex].divID == currentHighlight)\n                            {\n                                thisDiv = regionArr[arrIndex];\n                                centerOfCurrentDiv = getDivCenter(thisDiv);     \n                                break;\n                            }\n                        }\n\n                        //if we do have a current highlight, try to find the next one in the same page\n\n                        //reinitialize the index in case regionArr is out of order\n                        arrIndex = regionArr.length;\n                        pageDims = divaInstance.getPageDimensionsAtZoomLevel(currentPage, divaInstance.getZoomLevel());\n                        \n                        //initialize the center of the div to the maximum possible value\n                        if(forward) centerOfTargetDiv = (divaSettings.verticallyOriented) ? pageDims.height : pageDims.width;\n                        else centerOfTargetDiv = 0;\n\n                        if(forward)\n                        {\n                            compFunction = function(thisC, curC, targetC)\n                            {\n                                return (thisC > curC && thisC < targetC);\n                            };\n                        }\n                        else\n                        {\n                            compFunction = function(thisC, curC, targetC)\n                            {\n                                return (thisC < curC && thisC > targetC);\n                            };\n                        }\n\n                        while(arrIndex--)\n                        {\n                            thisDiv = regionArr[arrIndex];\n                            centerOfDiv = getDivCenter(thisDiv);\n\n                            //skip if the data-highlight-id is the same\n                            if (thisDiv.divID === currentHighlight) continue;\n\n                            //if this div is farther along the main axis but closer than the current closest\n                            if (compFunction(centerOfDiv, centerOfCurrentDiv, centerOfTargetDiv))\n                            {\n                                //update targetDiv\n                                highlightFound = true; \n                                centerOfTargetDiv = centerOfDiv;\n                                targetDiv = thisDiv;\n                            }\n                        }\n\n                        //if a highlight was found on the current page that was next; this can get overwritten but we're still good\n                        if (highlightFound) return gotoDiv(currentPage, targetDiv);\n                        //if it wasn't found, continue on...\n                    }\n                    //otherwise just pretend we're starting at the northwest corner of diva-inner...\n                    //if we got into the previous if statement, currentPage and centerOfCurrentDiv should already be set and we still want next\n                    else\n                    {\n                        currentPage = 0;\n                        centerOfCurrentDiv = 0;\n                    }\n\n                    //find the minimum div on the next page with highlights and loop around if necessary\n\n                    //find the next page in the pageArr; this will be in order\n                    var pageArr = Object.keys(highlightsObj);\n                    var curIdx = pageArr.indexOf(currentPage);\n                    var targetPage;\n\n                    if(forward)\n                    {\n                        //default to first page, move to next if possible\n                        if(curIdx == pageArr.length - 1) targetPage = pageArr[0];\n                        else targetPage = pageArr[curIdx + 1];\n                    }\n\n                    else\n                    {\n                        //default to last page, move to previous if possible\n                        if(curIdx === 0) targetPage = pageArr[pageArr.length - 1];\n                        else targetPage = pageArr[curIdx - 1];\n                    }\n\n                    //reset regionArr and centerOfTargetDiv for the new page we're testing\n                    regionArr = highlightsObj[targetPage].regions;\n                    arrIndex = regionArr.length;\n                    pageDims = divaInstance.getPageDimensionsAtZoomLevel(targetPage, divaInstance.getMaxZoomLevel());\n                    \n                    if(forward) centerOfTargetDiv = (divaSettings.verticallyOriented) ? pageDims.height : pageDims.width;\n                    else centerOfTargetDiv = 0;\n                    \n                    //find the minimum this time\n                    if(forward)\n                    {\n                        compFunction = function(thisC, targetC)\n                        {\n                            return (thisC < targetC);\n                        };\n                    }\n                    else\n                    {\n                        compFunction = function(thisC, targetC)\n                        {\n                            return (thisC > targetC);\n                        };\n                    }\n\n                    while(arrIndex--)\n                    {\n                        thisDiv = regionArr[arrIndex];\n                        centerOfDiv = getDivCenter(thisDiv);\n                        if (compFunction(centerOfDiv, centerOfTargetDiv))\n                        {\n                            highlightFound = true; \n                            centerOfTargetDiv = centerOfDiv;\n                            targetDiv = thisDiv;\n                        }\n                    }\n\n                    //we've found it this time, as there'll be a region in the full regionArr to be the minimum\n                    return gotoDiv(targetPage, targetDiv);\n                };\n\n                /*\n                    Jumps to the next highlight along the primary axis of the document.\n                */\n                divaInstance.gotoNextHighlight = function()\n                {\n                    return findAdjacentHighlight(true);\n                };\n\n                /*\n                    Jumps to the previous highlight along the primary axis of the document.\n                */\n                divaInstance.gotoPreviousHighlight = function()\n                {\n                    return findAdjacentHighlight(false);\n                };\n\n                diva.Events.subscribe('ViewerDidTerminate', this.destroy, divaSettings.ID);\n\n                return true;\n            },\n            destroy: function (divaSettings, divaInstance)\n            {\n                divaSettings.parentObject.removeData('highlights');\n            },\n            pluginName: 'highlight',\n            titleText: 'Highlight regions of pages'\n        };\n        return retval;\n    })());\n})(jQuery);\n","/*\nIIIF Highlight plugin for diva.js\nAllows you to highlight regions of a page image based off of annotations in a IIIF Manifest\n*/\n\n(function ($)\n{\n    window.divaPlugins.push((function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                // initialize an empty highlights object.\n                divaSettings.parentObject.data('highlights', {});\n\n                /*\n                    When a new page is loaded, this method will be called with the\n                    page index for the page. This method looks at the 'highlights'\n                    data object set on the diva parent element, and determines whether\n                    highlights exist for that page.\n\n                    If so, this method will create and render elements for every\n                    highlighted box.\n\n                    If a page scrolls out of the viewer, the highlight elements\n                    will be removed as part of the Diva DOM pruning process, since\n                    each highlight element is a child of the the page object. When the page\n                    is scrolled back in to view, this method is called again.\n\n                    @param pageIdx       The page index of the page that is to be highlighted\n                    @param filename      The image filename of the page\n                    @param pageSelector  The selector for the page (unused here)\n                */\n                function _highlight(pageIdx, filename, pageSelector)\n                {\n                    var highlightObj = divaSettings.parentObject.data('highlights');\n\n                    if (typeof highlightObj === 'undefined' || !settings.highlightsVisible)\n                        return;\n\n                    if (highlightObj.hasOwnProperty(pageIdx))\n                    {\n                        var pageId = divaInstance.getInstanceId() + 'page-' + pageIdx;\n                        var pageObj = document.getElementById(pageId);\n                        var regions = highlightObj[pageIdx].regions;\n                        var colour = highlightObj[pageIdx].colour;\n                        var divClass = highlightObj[pageIdx].divClass;\n\n                        var maxZoom = divaInstance.getMaxZoomLevel();\n                        var zoomDifference;\n\n                        if (divaSettings.inGrid)\n                        {\n                            var maxZoomWidth = divaInstance.getPageDimensionsAtZoomLevel(pageIdx, maxZoom).width;\n                            var currentWidth = pageObj.clientWidth;\n                            var widthProportion = maxZoomWidth / currentWidth;\n                            zoomDifference = Math.log(widthProportion) / Math.log(2);\n                        }\n                        else\n                        {\n                            zoomDifference = maxZoom - divaInstance.getZoomLevel();\n                        }\n\n                        var j = regions.length;\n                        while (j--)\n                        {\n                            var box = document.createElement('div');\n\n                            box.style.width = _incorporate_zoom(regions[j].width, zoomDifference) + \"px\";\n                            box.style.height = _incorporate_zoom(regions[j].height, zoomDifference) + \"px\";\n                            box.style.top = _incorporate_zoom(regions[j].uly, zoomDifference) + \"px\";\n                            box.style.left = _incorporate_zoom(regions[j].ulx, zoomDifference) + \"px\";\n                            box.style.background = colour;\n                            box.style.border = \"1px solid #555\";\n                            box.style.position = \"absolute\";\n                            box.style.zIndex = 100;\n                            box.className = divClass;\n\n                            if (typeof regions[j].name !== 'undefined')\n                            {\n                                box.setAttribute('data-name', regions[j].name);\n                            }\n\n                            if (typeof regions[j].divID !== 'undefined')\n                            {\n                                box.id = regions[j].divID;\n                            }\n\n                            pageObj.appendChild(box);\n                        }\n                    }\n\n                    diva.Events.publish(\"HighlightCompleted\", [pageIdx, filename, pageSelector]);\n                }\n\n                settings.highlightedPages = [];\n\n                // subscribe the highlight method to the page change notification\n                diva.Events.subscribe(\"PageWillLoad\", _highlight, divaSettings.ID);\n\n                var _incorporate_zoom = function(position, zoomDifference)\n                {\n                    return position / Math.pow(2, zoomDifference);\n                };\n\n                /*\n                    Reset the highlights object and removes all highlights from the document.\n                */\n                divaInstance.resetHighlights = function()\n                {\n                    var inner = document.getElementById(divaSettings.ID + 'inner');\n                    var highlightClass = divaSettings.ID + 'highlight';\n                    var descendents = inner.getElementsByClassName(highlightClass);\n                    var j = descendents.length;\n\n                    while (j--) {\n                        var parentObj = descendents[j].parentNode;\n                        parentObj.removeChild(descendents[j]);\n                    }\n\n                    divaSettings.parentObject.data('highlights', {});\n                };\n\n                /*\n                    Resets the highlights for a single page.\n                */\n                divaInstance.removeHighlightsOnPage = function(pageIdx)\n                {\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n                    if (highlightsObj.hasOwnProperty(pageIdx))\n                    {\n                        var pageId = divaInstance.getInstanceId() + 'page-' + pageIdx;\n                        var pageObj = document.getElementById(pageId);\n                        var descendents = pageObj.getElementsByTagName('div');\n                        var highlightClass = highlightsObj[pageIdx].divClass;\n\n                        var j = descendents.length;\n\n                        while (j--)\n                        {\n                            if (descendents[j].className === highlightClass)\n                                pageObj.removeChild(descendents[j]);\n                        }\n\n                        delete highlightsObj[pageIdx];\n                    }\n                };\n\n                divaInstance.hideHighlights = function()\n                {\n                    settings.highlightsVisible = false;\n\n                    var highlightClass = divaSettings.ID + 'highlight';\n\n                    var inner = document.getElementById(divaSettings.ID + 'inner');\n                    var highlights = inner.getElementsByClassName(highlightClass);\n\n                    var j = highlights.length;\n\n                    while (j--) {\n                        var parentObj = highlights[j].parentNode;\n                        parentObj.removeChild(highlights[j]);\n                    }\n                };\n\n                divaInstance.showHighlights = function()\n                {\n                    settings.highlightsVisible = true;\n\n                    var inner = document.getElementById(divaSettings.ID + 'inner');\n                    var pages = inner.getElementsByClassName('diva-document-page');\n\n                    var pageIdx;\n\n                    for (var i = 0; i < pages.length; i++)\n                    {\n                        pageIdx = parseInt(pages[i].getAttribute('data-index'), 10);\n\n                        var highlightsObj = divaSettings.parentObject.data('highlights');\n\n                        if (!highlightsObj.hasOwnProperty(pageIdx))\n                        {\n                            //highlights object is empty, check if it has annotations\n                            getAnnotationsList(pageIdx);\n                        }\n                        else\n                        {\n                            //draw the existing highlights\n                            _highlight(pageIdx, null, null);\n                        }\n                    }\n                };\n\n                /*\n                    Highlights regions on multiple pages.\n                    @param pageIdxs An array of page index numbers\n                    @param regions  An array of regions\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                */\n                divaInstance.highlightOnPages = function(pageIdxs, regions, colour, divClass)\n                {\n                    var j = pageIdxs.length;\n                    while (j--)\n                    {\n                        divaInstance.highlightOnPage(pageIdxs[j], regions[j], colour, divClass);\n                    }\n                };\n\n                /*\n                    Highlights regions on a page.\n                    @param pageIdx  A page index number\n                    @param regions  An array of regions. Use {'width':i, 'height':i, 'ulx':i, 'uly': i, 'divID': str} for each region.\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                    @param divClass (optional) A class to identify a group of highlighted regions on a specific page by\n                */\n                divaInstance.highlightOnPage = function(pageIdx, regions, colour, divClass)\n                {\n                    if (typeof colour === 'undefined')\n                    {\n                        colour = 'rgba(255, 0, 0, 0.1)';\n                    }\n\n                    if (typeof divClass === 'undefined')\n                    {\n                        divClass = divaSettings.ID + 'highlight';\n                    }\n                    else\n                    {\n                        divClass = divaSettings.ID + 'highlight ' + divClass;\n                    }\n\n                    var maxZoom = divaInstance.getMaxZoomLevel();\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n\n                    highlightsObj[pageIdx] = {\n                        'regions': regions, 'colour': colour, 'divClass': divClass\n                    };\n\n                    //Highlights are created on load; create them for all loaded pages now\n                    if (divaInstance.isPageLoaded(pageIdx))\n                    {\n                        _highlight(pageIdx, null, null);\n                    }\n\n                    return true;\n                };\n\n                                /*\n                    Jumps to a highlight somewhere in the document.\n                    @param divID The ID of the div to jump to. This ID must be attached to the div using .highlightOnPage(s) as the highlight may not be appended to the DOM.\n                */\n                divaInstance.gotoHighlight = function(divID)\n                {\n                    var page;\n                    var thisDiv;\n                    var centerYOfDiv;\n                    var centerXOfDiv;\n\n                    var highlightsObj = divaSettings.parentObject.data('highlights');\n                    var highlightFound = false; //used to break both loops\n\n                    //see if it exists in the DOM already first\n                    if (document.getElementById(divID) !== null)\n                    {\n                        page = parseInt(document.getElementById(divID).parentNode.getAttribute('data-index'), 10);\n\n                        var numDivs = highlightsObj[page].regions.length;\n                        while (numDivs--)\n                        {\n                            if (highlightsObj[page].regions[numDivs].divID === divID)\n                            {\n                                thisDiv = highlightsObj[page].regions[numDivs];\n                                centerYOfDiv = parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2;\n                                centerXOfDiv = parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2;\n\n                                highlightFound = true;\n                                break;\n                            }\n                        }\n                    }\n                    else\n                    {\n                        var pageArr = Object.keys(highlightsObj);\n                        var pageIdx = pageArr.length;\n                        while (pageIdx--)\n                        {\n                            var regionArr = highlightsObj[pageArr[pageIdx]].regions;\n                            var arrIndex = regionArr.length;\n\n                            while (arrIndex--)\n                            {\n                                if (regionArr[arrIndex].divID === divID)\n                                {\n                                    page = pageArr[pageIdx];\n                                    thisDiv = regionArr[arrIndex];\n                                    centerYOfDiv = parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2;\n                                    centerXOfDiv = parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2;\n\n                                    highlightFound = true;\n                                    break;\n                                }\n                            }\n\n                            if (highlightFound) break;\n                        }\n                    }\n\n                    if (!highlightFound)\n                    {\n                        console.warn(\"Diva just tried to find a highlight that doesn't exist.\");\n                        return false;\n                    }\n\n                    var outerObject = divaInstance.getSettings().outerObject;\n\n                    var desiredY = divaInstance.translateFromMaxZoomLevel(centerYOfDiv);\n                    var desiredX = divaInstance.translateFromMaxZoomLevel(centerXOfDiv);\n\n                    divaInstance.gotoPageByIndex(page);\n                    var currentTop = outerObject.scrollTop() + desiredY - (outerObject.height() / 2) + divaSettings.verticalPadding;\n                    var currentLeft = outerObject.scrollLeft() + desiredX - (outerObject.width() / 2) + divaSettings.horizontalPadding;\n\n                    outerObject.scrollTop(currentTop);\n                    outerObject.scrollLeft(currentLeft);\n\n                    divaSettings.currentHighlight = divID;\n\n                    return true;\n                };\n\n                var showAnnotations = function(canvasIndex)\n                {\n                    return function(data, status, jqXHR)\n                    {\n                        var canvasAnnotations = data;\n                        var numAnnotations = data.length;\n\n                        //convert annotations in annotations object to diva highlight objects\n                        var regions = [];\n\n                        //loop over annotations in a single canvas\n                        for (var k = 0; k < numAnnotations; k++)\n                        {\n                            var currentAnnotation = canvasAnnotations[k];\n                            // get text content\n                            var text = currentAnnotation.resource.chars;\n\n                            // get x,y,w,h (slice string from '#xywh=' to end)\n                            var onString = currentAnnotation.on;\n                            var coordString = onString.slice(onString.indexOf('#xywh=') + 6);\n                            var coordinates = coordString.split(',');\n\n                            var region = {\n                                ulx: parseInt(coordinates[0], 10),\n                                uly: parseInt(coordinates[1], 10),\n                                width: parseInt(coordinates[2], 10),\n                                height: parseInt(coordinates[3], 10),\n                                name: text\n                            };\n\n                            regions.push(region);\n                        }\n\n                        divaInstance.highlightOnPage(canvasIndex, regions);\n                        //flag this page's annotations as having been retrieved\n                        settings.highlightedPages.push(canvasIndex);\n                    };\n                };\n\n                var getAnnotationsList = function(pageIndex)\n                {\n                    //if page has annotationList\n                    var canvases = settings.manifest.sequences[0].canvases;\n\n                    if (canvases[pageIndex].hasOwnProperty('otherContent'))\n                    {\n                        var otherContent = canvases[pageIndex].otherContent;\n\n                        for (var j = 0; j < otherContent.length; j++)\n                        {\n                            if (otherContent[j]['@type'] === 'sc:AnnotationList')\n                            {\n                                // canvas has annotations. get the annotations:\n                                $.ajax({\n                                    url: otherContent[j]['@id'],\n                                    cache: true,\n                                    dataType: 'json',\n                                    success: showAnnotations(pageIndex)\n                                });\n                            }\n                        }\n                    }\n                };\n\n                var setManifest = function(manifest)\n                {\n                    settings.manifest = manifest;\n                };\n\n                diva.Events.subscribe('ManifestDidLoad', setManifest, divaSettings.ID);\n\n                diva.Events.subscribe('PageWillLoad', function(pageIndex)\n                {\n                    if (!settings.highlightsVisible)\n                    {\n                        return;\n                    }\n\n                    //if highlights for this page have already been checked/loaded, return\n                    for (var i = 0; i < settings.highlightedPages.length; i++)\n                    {\n                        if (settings.highlightedPages[i] === pageIndex)\n                        {\n                            return;\n                        }\n                    }\n\n                    getAnnotationsList(pageIndex, settings.manifest);\n                }, divaSettings.ID);\n\n                var activeOverlays = [];\n\n                //on mouseover, show the annotation text\n                divaSettings.innerObject.on('mouseenter', '.' + divaSettings.ID + 'highlight', function(e)\n                {\n                    var annotationElement = e.target;\n                    var name = annotationElement.dataset.name;\n                    var textOverlay = document.createElement('div');\n\n                    textOverlay.style.top = (annotationElement.offsetTop + annotationElement.offsetHeight - 1) + 'px';\n                    textOverlay.style.left = annotationElement.style.left;\n                    textOverlay.style.background = '#fff';\n                    textOverlay.style.border = '1px solid #555';\n                    textOverlay.style.position = 'absolute';\n                    textOverlay.style.zIndex = 101;\n                    textOverlay.className = 'annotation-overlay';\n                    textOverlay.textContent = name;\n\n                    annotationElement.parentNode.appendChild(textOverlay);\n                    activeOverlays.push(textOverlay);\n                });\n\n                divaSettings.innerObject.on('mouseleave', '.' + divaSettings.ID + 'highlight', function(e)\n                {\n                    while (activeOverlays.length)\n                    {\n                        var textOverlay = activeOverlays.pop();\n                        textOverlay.parentNode.removeChild(textOverlay);\n                    }\n                });\n\n                diva.Events.subscribe('ViewerDidLoad', function(){\n                    //button to toggle annotations\n                    $('#' + divaSettings.ID + 'page-nav').before('<div id=\"' + divaSettings.ID + 'annotations-icon\" class=\"diva-button diva-annotations-icon\" title=\"Turn annotations on or off\"></div>');\n\n                    $(divaSettings.selector + 'annotations-icon').addClass('annotations-icon-active');\n\n                    $('#' + divaSettings.ID + 'annotations-icon').on('click', function(e)\n                    {\n                        //toggle visibility of annotations\n                        if (settings.highlightsVisible)\n                        {\n                            divaInstance.hideHighlights();\n                            $(divaSettings.selector + 'annotations-icon').removeClass('annotations-icon-active');\n                        }\n                        else\n                        {\n                            divaInstance.showHighlights();\n                            $(divaSettings.selector + 'annotations-icon').addClass('annotations-icon-active');\n                        }\n                    });\n                }, divaSettings.ID);\n\n                //enable annotations by default\n                settings.highlightsVisible = true;\n\n                return true;\n            },\n            destroy: function (divaSettings, divaInstance)\n            {\n                divaSettings.parentObject.removeData('highlights');\n            },\n            pluginName: 'IIIFHighlight',\n            titleText: 'Highlight regions of pages'\n        };\n        return retval;\n    })());\n})(jQuery);\n","\n// IIIF Metadata plugin for diva.js\n// Displays object metadata from a IIIF manifest\n(function ($)\n{\n    window.divaPlugins.push((function()\n    {\n        var settings = {\n            metadataModal: ''\n        };\n\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                var _displayMetadata = function(manifest)\n                {\n                    var showMetadata = function(label, value)\n                    {\n                        var labelProper = label.charAt(0).toUpperCase() + label.slice(1);\n                        var labelFormatted = labelProper.replace('_', ' ');\n\n                        if (value.indexOf('http://') === 0)\n                        {\n                            value = '<a href=\"' + value + '\" target=\"_blank\">' + value + '</a>';\n                        }\n\n                        return '<div class=\"metadata-row\"><span class=\"metadata-label\">' + labelFormatted + ':</span> <span class=\"metadata-value\">' +\n                            value  + '</span></div>';\n                    };\n\n                    var getDataForLanguage = function(data, language)\n                    {\n                        for (var i = 0; i < data.length; i++)\n                        {\n                            if (data[i]['@language'] === language)\n                            {\n                                return data[i]['@value'];\n                            }\n                        }\n                    };\n\n                    /**\n                     * Shows metadata from label names (if the metadata exists).\n                     * @param names {Array} - An array of strings representing field names to display.\n                     */\n                    var showMetadataFromLabelNames = function(names)\n                    {\n                        var elements = '';\n\n                        for (var i = 0; i < names.length; i++)\n                        {\n                            var field = names[i];\n\n                            if (manifest.hasOwnProperty(field))\n                            {\n                                if (manifest[field].constructor === Array)\n                                {\n                                    //multiple languages\n                                    var localizedData = getDataForLanguage(manifest[field], 'en');\n                                    elements += showMetadata(field, localizedData);\n                                }\n                                else\n                                {\n                                    elements += showMetadata(field, manifest[field]);\n                                }\n                            }\n                        }\n\n                        return elements;\n                    };\n\n                    var metadataElement = '<div id=\"' + divaSettings.ID + 'metadata\" class=\"diva-modal\">';\n                    metadataElement += showMetadataFromLabelNames(['label']);\n\n                    if (manifest.hasOwnProperty('metadata'))\n                    {\n                        var metadataField = manifest.metadata;\n\n                        for (var i = 0; i < metadataField.length; i++)\n                        {\n                            if (metadataField[i].value.constructor === Array)\n                            {\n                                var canonicalData = getDataForLanguage(metadataField[i].value, 'en');\n                                metadataElement += showMetadata(metadataField[i].label, canonicalData);\n                            }\n                            else\n                            {\n                                metadataElement += showMetadata(metadataField[i].label, metadataField[i].value);\n                            }\n                        }\n                    }\n\n                    metadataElement += showMetadataFromLabelNames([\n                        'description',\n                        'within',\n                        'see_also',\n                        'service',\n                        'license',\n                        'attribution'\n                    ]);\n\n                    metadataElement += '</div>';\n\n                    divaSettings.parentObject.prepend(metadataElement);\n                    $(divaSettings.selector + 'metadata').hide();\n                };\n\n                //subscribe to ManifestDidLoad event, get the manifest\n                diva.Events.subscribe('ManifestDidLoad', _displayMetadata, divaSettings.ID);\n\n                divaSettings.parentObject.prepend('<div style=\"text-align: center; clear: both\"><a href=\"#\" id=\"' + divaSettings.ID + 'metadata-link\" class=\"diva-metadata-link\">Details</a></div>');\n                // $(divaSettings.selector + 'title').append('<div><a href=\"#\" id=\"' + divaSettings.ID + 'metadata-link\" class=\"diva-metadata-link\">Details</a></div>');\n\n                $(divaSettings.selector + 'metadata-link').on('click', function(e)\n                {\n                    $(divaSettings.selector + 'metadata').fadeToggle('fast');\n                });\n\n                return true;\n            },\n            destroy: function (divaSettings, divaInstance)\n            {\n            },\n            pluginName: 'IIIFMetadata',\n            titleText: 'Show metadata from a IIIF manifest'\n        };\n        return retval;\n    })());\n})(jQuery);\n","/*\nDiva.JS pagealias plugin\nAuthor: Andrew Horwitz\n\nLets pages be set up with custom aliases to allow for sections with different \nnumbering schemas.\n\nDiva needs to be instantiated with one or both of the following settings:\n\n1) a pageAliases dictionary attribute, structured as {(0-indexed page index): \n(aliased page index)}. For example, a document with three forward pages may be \nconstructed as:\n\n    {0: 'i', 1: 'ii', 2: 'iii'}\n\nThis object does not need to have a complete list of possible page indices. \n\n2) a pageAliasFunction function that takes in a 0-indexed integer value (the \noriginal page index) and returns either the aliased page index or the boolean\nvalue \"false\". For example, the default mapping from 0-index to 1-index may be \nconstructed as:\n\n    pageAliasFunction: function(originalPageIndex)\n    {\n        return originalPageIndex + 1;\n    }\n\n\nThis plugin is solely for cosmetic purposes; it will replace the \"Page _ of XX\" \ncounter and add functions that run in parallel with their non-aliased \nequivalents instead of replacing them. When one of the aliased functions is \ncalled, the  plugin will first try to find the page alias in the pageAliases \nattribute. If this fails, the plugin will then pass the original page index into\nthe pageAliasFunction function. If this function returns a boolean \"false\" (NOT \na number 0 or an undefined), the plugin will revert to the default page index.\n\nThe plugin may also be instantiated with the 'divaSettings.newTotalPages' \nattribute, which will replace the \"Page 1 of __\" counter.\n*/\n\n(function ($)\n{\n    window.divaPlugins.push((function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                if (divaSettings.pageAliases === undefined) \n                {\n                    divaSettings.pageAliases = {};\n                }\n\n                if (divaSettings.pageAliasFunction === undefined)\n                {\n                    divaSettings.pageAliasFunction = function(){return false;};\n                } \n\n                /*\n                    Main function. Will return the first of these three that \n                        resolves to boolean true:\n                    -Explicit alias as defined in pageAliases\n                    -Result of pageAliasFunction\n                    -originalPageIndex + 1 (to simulate the original mapping)\n\n                    Else the function will return false.\n                */\n                divaInstance.getAliasForPageIndex = function(originalPageIndex)\n                {\n                    return divaSettings.pageAliases[originalPageIndex] || divaSettings.pageAliasFunction(originalPageIndex) || originalPageIndex + 1;\n                };\n\n                /*\n                    Returns the first page index found for a given aliased number or false if not found.\n                    This may cause issues if a specific alias is found for multiple page indices; use getPageIndicesForAlias and reimplement functions as necessary if this is the case.\n                */\n                divaInstance.getPageIndexForAlias = function(aliasedNumber)\n                {\n                    for(var idx = 0; idx < divaSettings.numPages; idx++)\n                    {\n                        if(divaInstance.getAliasForPageIndex(idx) == aliasedNumber)\n                        {\n                            return idx;\n                        }\n                    }\n                    return false;\n                };\n\n                //Returns array of page indices for a given aliased number. Returns an empty array if none are found.\n                divaInstance.getPageIndicesForAlias = function(aliasedNumber)\n                {\n                    var indexArr = [];\n                    for(var idx = 0; idx < divaSettings.numPages; idx++)\n                    {\n                        if(divaInstance.getAliasForPageIndex(idx) == aliasedNumber)\n                        {\n                            indexArr.push(idx);\n                        }\n                    }\n                    return indexArr;\n                };\n\n\n                //Maps the current page index to getAliasForPageIndex\n                divaInstance.getCurrentAliasedPageIndex = function()\n                {\n                    return divaInstance.getAliasForPageIndex(divaSettings.currentPageIndex);\n                };\n\n                //Wrapper for gotoPageByIndex, keeping the aliased numbers in mind\n                divaInstance.gotoPageByAliasedNumber = function(aliasedNumber, xAnchor, yAnchor)\n                {\n                    return divaInstance.gotoPageByIndex(divaInstance.getPageIndexForAlias(aliasedNumber), xAnchor, yAnchor);\n                };\n\n                //this function overwrites updateCurrentPage from the main diva file to update page numbers on VisiblePAgeDidChange\n                var updateCurrentAliasedPage = function ()\n                {\n                    document.getElementById(this.getSettings().ID + 'current-page').textContent = this.getCurrentAliasedPageIndex();\n                };\n\n                //various changes that need to be made once viewer is loaded\n                var initialChanges = function ()\n                {\n                    //changes total pages value in GUI\n                    var tempSettings = this.getSettings();\n                    var newTotalPages = tempSettings.numPages;\n                    if (tempSettings.newTotalPages !== undefined)\n                    {\n                        newTotalPages = tempSettings.newTotalPages;\n                    }\n\n                    else if (tempSettings.totalPageOffset !== undefined)\n                    {\n                        newTotalPages = newTotalPages + tempSettings.totalPageOffset;\n                    }\n\n                    //actually changes values\n                    document.getElementById(this.getSettings().ID + 'num-pages').textContent = newTotalPages;\n                    document.getElementById(this.getSettings().ID + 'current-page').textContent = this.getCurrentAliasedPageIndex();\n                    \n                    //resubscribes our new update function\n                    diva.Events.unsubscribe([\"VisiblePageDidChange\", tempSettings.toolbar.updateCurrentPage, divaSettings.ID]);\n                    diva.Events.subscribe(\"VisiblePageDidChange\", updateCurrentAliasedPage, divaSettings.ID);\n                };\n\n                diva.Events.subscribe(\"ViewerDidLoad\", initialChanges, divaSettings.ID);\n            },\n            pluginName: 'pagealias',\n            titleText: 'Re-aliases page indexes'\n        };\n        return retval;\n    })());\n})(jQuery);"],"sourceRoot":"/source/"}