Storage.prototype.setObject=function(b,f){this.setItem(b,JSON.stringify(f))};Storage.prototype.getObject=function(b){return(b=this.getItem(b))&&JSON.parse(b)};(function(b){var f=1;b.generateId=function(b){var c;do c=f++ +(b?"-"+b:"");while(document.getElementById(c));return c}})(jQuery);
(function(b){b.getScrollbarWidth=function(){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";var e=document.createElement("div");e.style.position="absolute";e.style.top="0px";e.style.left="0px";e.style.visibility="hidden";e.style.width="200px";e.style.height="150px";e.style.overflow="hidden";e.appendChild(b);document.body.appendChild(e);var c=b.offsetWidth;e.style.overflow="scroll";b=b.offsetWidth;c==b&&(b=e.clientWidth);document.body.removeChild(e);return c-b}})(jQuery);
(function(b){b.getHashParam=function(b){var e=window.location.hash;if(""!==e){var c=0<e.indexOf("&"+b+"=")?e.indexOf("&"+b+"="):e.indexOf("#"+b+"=");if(0<=c)return c+=b.length+2,b=e.indexOf("&",c),b>c?e.substring(c,b):0>b?e.substring(c):""}return!1}})(jQuery);
(function(b){b.updateHashParam=function(f,e){var c=b.getHashParam(f),a=window.location.hash;if(c!==e)if("string"==typeof c){var h=0<a.indexOf("&"+f+"=")?a.indexOf("&"+f+"="):a.indexOf("#"+f+"="),c=h+f.length+2+c.length,m=0===h?"#":"&";window.location.replace(a.substring(0,h)+m+f+"="+e+a.substring(c))}else 0===a.length?window.location.replace("#"+f+"="+e):window.location.replace(a+"&"+f+"="+e)}})(jQuery);
(function(b){b.fn.dragscrollable=function(f){var e=b.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},f||{}),c={mouseDownHandler:function(a){if(1!=a.which||!a.data.acceptPropagatedEvent&&a.target!=this)return!1;a.data.lastCoord={left:a.clientX,top:a.clientY};b.event.add(document,"mouseup",c.mouseUpHandler,a.data);b.event.add(document,"mousemove",c.mouseMoveHandler,a.data);if(a.data.preventDefault)return a.preventDefault(),!1},mouseMoveHandler:function(a){var b=a.clientX-
a.data.lastCoord.left,c=a.clientY-a.data.lastCoord.top;a.data.scrollable.scrollLeft(a.data.scrollable.scrollLeft()-b);a.data.scrollable.scrollTop(a.data.scrollable.scrollTop()-c);a.data.lastCoord={left:a.clientX,top:a.clientY};if(a.data.preventDefault)return a.preventDefault(),!1},mouseUpHandler:function(a){b.event.remove(document,"mousemove",c.mouseMoveHandler);b.event.remove(document,"mouseup",c.mouseUpHandler);if(a.data.preventDefault)return a.preventDefault(),!1}};this.each(function(){var a={scrollable:b(this),
acceptPropagatedEvent:e.acceptPropagatedEvent,preventDefault:e.preventDefault};b(this).find(e.dragSelector).bind("mousedown",a,c.mouseDownHandler)})}})(jQuery);
(function(b){var f={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:0.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}};window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}());b.support=b.support||{};b.extend(b.support,{touch:"ontouchend"in document});var e=function(){return!1},c=function(a,b){return 0===Math.floor(Math.abs(a))?0:a*b},a=function(a,b){var c=a;0<a?a>b&&(c=b):a<0-b&&(c=0-b);return c},h=function(a,b){this.removeClass(a.movingClass.up).removeClass(a.movingClass.down).removeClass(a.movingClass.left).removeClass(a.movingClass.right).removeClass(a.deceleratingClass.up).removeClass(a.deceleratingClass.down).removeClass(a.deceleratingClass.left).removeClass(a.deceleratingClass.right);
0<a.velocity&&this.addClass(b.right);0>a.velocity&&this.addClass(b.left);0<a.velocityY&&this.addClass(b.down);0>a.velocityY&&this.addClass(b.up)},m=function(a,b){b.velocity=0;b.velocityY=0;b.decelerate=!0;"function"===typeof b.stopped&&b.stopped.call(a,b)},k=function(a,b){var e=a[0];b.x&&0<e.scrollWidth?(e.scrollLeft=b.scrollLeft=e.scrollLeft+b.velocity,0<Math.abs(b.velocity)&&(b.velocity=b.decelerate?c(b.velocity,b.slowdown):b.velocity)):b.velocity=0;b.y&&0<e.scrollHeight?(e.scrollTop=b.scrollTop=
e.scrollTop+b.velocityY,0<Math.abs(b.velocityY)&&(b.velocityY=b.decelerate?c(b.velocityY,b.slowdown):b.velocityY)):b.velocityY=0;h.call(a,b,b.deceleratingClass);"function"===typeof b.moved&&b.moved.call(a,b);0<Math.abs(b.velocity)||0<Math.abs(b.velocityY)?window.requestAnimationFrame(function(){k(a,b)}):m(a,b)},g=function(a,c){var e=b.kinetic.callMethods[a],h=Array.prototype.slice.call(arguments);e&&this.each(function(){var a=h.slice(1),c=b(this).data("kinetic-settings");a.unshift(c);e.apply(this,
a)})},q=function(a,c){b.support.touch?a.bind("touchstart",c.events.touchStart).bind("touchend",c.events.inputEnd).bind("touchmove",c.events.touchMove):a.mousedown(c.events.inputDown).mouseup(c.events.inputEnd).mousemove(c.events.inputMove);a.click(c.events.inputClick).scroll(c.events.scroll).bind("selectstart",e).bind("dragstart",c.events.dragStart)},r=function(c){this.addClass("kinetic-active").each(function(){var e=this,m=b(this);if(!m.data("kinetic-settings")){var l=b.extend({},f,c),g,r=!1,w,x=
!1,u=!1,y=1E3/l.throttleFPS,A,z;l.velocity=0;l.velocityY=0;var L=function(){u=w=g=!1};b(document).mouseup(L).click(L);var v=function(){l.velocity=a(r-g,l.maxvelocity);l.velocityY=a(x-w,l.maxvelocity)},t=function(a){return b.isFunction(l.filterTarget)?!1!==l.filterTarget.call(e,a):!0},F=function(a,c){if(!A||new Date>new Date(A.getTime()+y))A=new Date,u&&(g||w)&&(z&&(b(z).blur(),z=null,m.focus()),l.decelerate=!1,l.velocity=l.velocityY=0,m[0].scrollLeft=l.scrollLeft=l.x?m[0].scrollLeft-(a-g):m[0].scrollLeft,
m[0].scrollTop=l.scrollTop=l.y?m[0].scrollTop-(c-w):m[0].scrollTop,r=g,x=w,g=a,w=c,v(),h.call(m,l,l.movingClass),"function"===typeof l.moved&&l.moved.call(m,l))};l.events={touchStart:function(a){var b;if(t(a.target)){b=a.originalEvent.touches[0];var c=b.clientX;b=b.clientY;u=!0;l.velocity=r=0;l.velocityY=x=0;g=c;w=b;a.stopPropagation()}},touchMove:function(a){var b;u&&(b=a.originalEvent.touches[0],F(b.clientX,b.clientY),a.preventDefault&&a.preventDefault())},inputDown:function(a){if(t(a.target)){var b=
a.clientX,c=a.clientY;u=!0;l.velocity=r=0;l.velocityY=x=0;g=b;w=c;z=a.target;"IMG"===a.target.nodeName&&a.preventDefault();a.stopPropagation()}},inputEnd:function(a){g&&r&&!1===l.decelerate&&(l.decelerate=!0,v(),g=r=u=!1,k(m,l));z=null;a.preventDefault&&a.preventDefault()},inputMove:function(a){u&&(F(a.clientX,a.clientY),a.preventDefault&&a.preventDefault())},scroll:function(a){"function"===typeof l.moved&&l.moved.call(m,l);a.preventDefault&&a.preventDefault()},inputClick:function(a){if(0<Math.abs(l.velocity))return a.preventDefault(),
!1},dragStart:function(a){if(z)return!1}};q(m,l);m.data("kinetic-settings",l).css("cursor",l.cursor);l.triggerHardware&&m.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};b.kinetic={settingsKey:"kinetic-settings",callMethods:{start:function(a,c){var e=b(this);if(a=b.extend(a,c))a.decelerate=!1,k(e,a)},end:function(a,c){b(this);a&&(a.decelerate=!0)},stop:function(a,c){var e=b(this);m(e,a)},detach:function(a,c){var h=b(this);b.support.touch?
h.unbind("touchstart",a.events.touchStart).unbind("touchend",a.events.inputEnd).unbind("touchmove",a.events.touchMove):h.unbind("mousedown",a.events.inputDown).unbind("mouseup",a.events.inputEnd).unbind("mousemove",a.events.inputMove).unbind("scroll",a.events.scroll);h.unbind("click",a.events.inputClick).unbind("selectstart",e);h.unbind("dragstart",a.events.dragStart);h.removeClass("kinetic-active").css("cursor","")},attach:function(a,c){var e=b(this);q(e,a);e.addClass("kinetic-active").css("cursor",
"move")}}};b.fn.kinetic=function(a){"string"===typeof a?g.apply(this,arguments):r.call(this,a);return this}})(window.jQuery||window.Zepto);
var diva=function(){var b={};return{Events:{publish:function(f,e,c){if(b[f]){f=b[f];for(var a=f.length;a--;)f[a].apply(c||this,e||[])}},subscribe:function(f,e){b[f]||(b[f]=[]);b[f].push(e);return[f,e]},unsubscribe:function(f,e){var c=f[0];if(b[c])for(var a=b[c].length;a--;)if(b[c][a]===f[1])return b[c].splice(a,1),e&&delete b[c],!0;return!1},unsubscribeAll:function(){b={}}}}}(),activeDivaController=function(){var b;$(document).on("click",function(f){a:{f=$(f.target);var e;e=f.find(".diva-outer");
var c=f.closest(".diva-outer");f=document.getElementsByClassName("diva-outer");var a=f.length;if(!(0<e.length))if(0<c.length)e=c;else{for(c=0;c<a;c++)$(f[c].parentElement).data("diva").deactivate();break a}e.parent().data("diva").activate();b=e.parent();f=document.getElementsByClassName("diva-outer");for(c=0;c<a;c++)f[c].getAttribute("id")!=e.attr("id")&&$(f[c].parentElement).data("diva").deactivate()}});this.getActive=function(){return b}},activeDiva=new activeDivaController;window.divaPlugins=[];
(function(b){var f=function(e,c){var a=b.extend({},{adaptivePadding:0.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,
minPagesPerRow:2,minZoomLevel:0,onDocumentLoaded:null,onModeToggle:null,onViewToggle:null,onJump:null,onPageLoad:null,onPageLoaded:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onSetCurrentPage:null,onZoom:null,onZoomIn:null,onZoomOut:null,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:c.parentObject,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},c);b.extend(a,{allTilesLoaded:[],averageHeights:[],
averageWidths:[],currentPageIndex:0,divaIsFullWindow:!1,doubleClickZoom:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerObject:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerObject:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],
pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0});var h=this,f=function(a){var b=!0;return function(a){var d,c,e;if("function"===typeof a){d=[];c=1;for(e=arguments.length;c<e;c++)d.push(arguments[c]);b&&
(console.warn('The use of callback functions is deprecated. Use diva.Events.subscribe("Event", function) instead.'),b=!1);a.apply(h,d);return!0}return!1}}(),k=function(d,b){return a.pages[d].d[a.zoomLevel][b]},g=function(d){var b,c=a.numPages;for(b=0;b<c;b++)if(a.pages[b].f===d)return b;return-1},q=function(d,c){var e=b("#"+a.ID+"outer").scrollLeft()-a.viewportMargin,h=e+a.panelWidth+2*a.viewportMargin;return d>=e&&d<=h||d<=e&&c>=h||c>=e&&c<=h},r=function(d,c){var e=b("#"+a.ID+"outer").scrollTop()-
a.viewportMargin,h=e+a.panelHeight+2*a.viewportMargin;return d>=e&&d<=h||d<=e&&c>=h||c>=e&&c<=h},p=function(d){return 0<=d&&d<a.numPages},n=function(d){var b=a.pageTopOffsets[d],c=b+k(d,"h")+a.verticalPadding,e=a.pageLeftOffsets[d];d=e+k(d,"w")+a.horizontalPadding;return r(b,c)&&q(e,d)},s=function(d){return!!document.getElementById(a.ID+"page-"+d)},l=function(d){if(!s(d)||!a.allTilesLoaded[d]){var b=a.pages[d].f,c=k(d,"w"),e=k(d,"h"),g=a.pageTopOffsets[d]+a.verticalPadding,l=a.pageLeftOffsets[d]+
a.horizontalPadding,v=a.selector+"page-"+d,p;if(!s(d)){var n=document.getElementById(a.ID+"inner"),t=document.createElement("div");t.id=a.ID+"page-"+d;t.classList.add("diva-document-page");t.setAttribute("data-index",d);t.setAttribute("data-filename",b);a.enableImageTitles&&(t.title="Page "+(d+1));t.innerHTML=a.pageTools;t.style.width=c+"px";t.style.height=e+"px";a.verticallyOriented?(t.style.top=g+"px",t.classList.add("diva-page-vertical")):(t.style.left=l+"px",t.classList.add("diva-page-horizontal"));
n.appendChild(t);f(a.onPageLoad,d,b,v);diva.Events.publish("PageWillLoad",[d,b,v],h);for(p in a.plugins)f(a.plugins[p].onPageLoad,d,b,v)}a.pageTimeouts.push(setTimeout(function(d){var g=document.getElementById(a.ID+"page-"+d);if(s(d)){var l=a.imageDir+"/",p=Math.ceil(k(d,"h")/a.tileWidth),t=Math.ceil(k(d,"w")/a.tileHeight),n=a.pages[d].m,W=a.iipServerURL+"?FIF="+l+b+"&JTL=",l=!0,E=0,F=e-(p-1)*a.tileHeight,sa=c-(t-1)*a.tileWidth,G,I,X,ha,V,K,w,x;G=a.zoomLevel+n-a.realMaxZoom;W=a.isIIIF?a.pages[d].url:
W+G+",";if(a.isIIIF){var A=Math.pow(2,n-G);w=a.tileHeight*A;x=a.tileWidth*A;var R="/0/"+(2<=a.pages[d].api?"default":"native")+".jpg"}else w=a.tileHeight,x=a.tileWidth;for(n=0;n<p;){G=0;for(I=n===p-1?F:a.tileHeight;G<t;){ha=n*a.tileHeight;V=G*a.tileWidth;X=G===t-1?sa:a.tileWidth;K=a.isIIIF?W+G*x+","+n*w+","+X*A+","+I*A+"/"+X+","+R:W+E;if(!document.getElementById(a.ID+"tile-"+d+"-"+E)){var u=void 0,y=void 0;a.verticallyOriented?(u=a.pageTopOffsets[d]+n*a.tileHeight+a.verticalPadding,y=a.pageLeftOffsets[d]+
G*a.tileWidth):(u=a.pageTopOffsets[d]+n*a.tileHeight,y=a.pageLeftOffsets[d]+G*a.tileWidth+a.horizontalPadding);var z=y+a.tileWidth;r(u,u+a.tileHeight)&&q(y,z)?(u=document.createElement("div"),u.id=a.ID+"tile-"+d+"-"+E,u.classList.add("diva-document-tile"),u.style.display="inline",u.style.position="absolute",u.style.top=ha+"px",u.style.left=V+"px",u.style.backgroundImage="url('"+K+"')",u.style.height=I+"px",u.style.width=X+"px",g.appendChild(u)):l=!1}E++;G++}n++}a.allTilesLoaded[d]=l;f(a.onPageLoaded,
d,b,v);diva.Events.publish("PageDidLoad",[d,b,v],h)}},a.pageLoadTimeout,d))}},J=function(d){d=document.getElementById(a.ID+"page-"+d);if(null!==d){for(;d.firstChild;)d.removeChild(d.firstChild);d.parentNode.removeChild(d)}},D=function(d){if(a.verticallyOriented){d=a.pageTopOffsets[d]+k(d,"h")+a.verticalPadding;var b=document.getElementById(a.ID+"outer").scrollTop}else d=a.pageLeftOffsets[d]+k(d,"w")+a.horizontalPadding,b=document.getElementById(a.ID+"outer").scrollLeft;return d=d<b},w=function(d){if(a.verticallyOriented){d=
a.pageTopOffsets[d];var b=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight}else d=a.pageLeftOffsets[d],b=document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth;return d=d>b},x=function(d,b){0<b?p(d)&&(n(d)?(l(d),a.lastPageLoaded=d,x(a.lastPageLoaded+1,b)):D(d)&&x(d+1,b)):p(d)&&(n(d)?(l(d),a.firstPageLoaded=d,x(a.firstPageLoaded-1,b)):w(d)&&x(d-1,b))},u=function(d,b){0<b?p(d)&&D(d)&&(J(d),a.firstPageLoaded=d+1,u(a.firstPageLoaded,b)):p(d)&&w(d)&&(J(d),a.lastPageLoaded=d-1,u(a.lastPageLoaded,
b))},y=function(d){return 0<=d&&d<a.numRows},A=function(d){d*=a.rowHeight;return r(d,d+a.rowHeight+a.fixedPadding)},z=function(d){if(!document.getElementById(a.ID+"row-"+d)){var b=a.rowHeight*d+a.fixedPadding,c=document.getElementById(a.ID+"inner"),e=document.createElement("div");e.id=a.ID+"row-"+d;e.classList.add("diva-row");e.style.height=a.rowHeight+"px";e.style.top=b+"px";c.appendChild(e);for(var f,m,g,l,v,n,t=a.imageDir+"/",q=a.pagesPerRow,c=0;c<q;c++){f=d*a.pagesPerRow+c;if(!p(f))break;m=a.pages[f].f;
g=k(f,"w");l=k(f,"h");v=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*g/l:a.gridPageWidth;g=a.fixedHeightGrid?a.rowHeight-a.fixedPadding:v/g*l;l=parseInt(c*(a.fixedPadding+a.gridPageWidth)+a.fixedPadding,10);n=a.pages[f].api;n=2<=n?"default":"native";n=",/0/"+n+".jpg";v=parseInt(v,10);g=parseInt(g,10);l+=a.fixedHeightGrid?(a.gridPageWidth-v)/2:0;n=a.isIIIF?encodeURI(a.pages[f].url+"full/"+v+n):encodeURI(a.iipServerURL+"?FIF="+t+m+"&HEI="+(g+2)+"&CVT=JPEG");a.pageTopOffsets[f]=b;a.pageLeftOffsets[f]=
l;var r=document.createElement("div");r.id=a.ID+"page-"+f;var E=a.selector+"page-"+f;r.classList.add("diva-page");r.style.width=v+"px";r.style.height=g+"px";r.style.left=l+"px";r.setAttribute("data-index",f);r.setAttribute("data-filename",m);a.enableImageTitles&&(r.title="Page "+(f+1));e.appendChild(r);diva.Events.publish("PageWillLoad",[f,m,E],h);V(d,f,n,v,g)}}},L=function(d){d=document.getElementById(a.ID+"row-"+d);if(null!==d){for(;d.firstChild;)d.removeChild(d.firstChild);d.parentNode.removeChild(d)}},
v=function(d){d=a.rowHeight*(d+1);var b=document.getElementById(a.ID+"outer").scrollTop;return d<b},t=function(d){d*=a.rowHeight;var b=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return d>b},F=function(d,b){0<b?y(d)&&(A(d)?(z(d),a.lastRowLoaded=d,F(a.lastRowLoaded+1,b)):v(d)&&F(d+1,b)):y(d)&&(A(d)?(z(d),a.firstRowLoaded=d,F(a.firstRowLoaded-1,b)):t(d)&&F(d-1,b))},E=function(d,b){0<b?y(d)&&v(d)&&(L(d),a.firstRowLoaded++,E(a.firstRowLoaded,b)):y(d)&&t(d)&&(L(d),a.lastRowLoaded--,E(a.lastRowLoaded,
b))},V=function(d,b,c,e,f){a.pageTimeouts.push(window.setTimeout(function(d,b,c,e,f){document.getElementById(a.ID+"row-"+d)&&(d=document.createElement("img"),d.src=c,d.style.width=e+"px",d.style.height=f+"px",document.getElementById(a.ID+"page-"+b).appendChild(d))},a.rowLoadTimeout,d,b,c,e,f))},K=function(d){var b=a.currentPageIndex,c=b+d;if(!p(c))return!1;var e=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop+a.panelHeight/2:document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth/
2,g=!1;0>d?a.verticallyOriented?0<=c&&a.pageTopOffsets[c]+k(c,"h")+a.verticalPadding>=e&&(g=!0):0<=c&&a.pageLeftOffsets[c]+k(c,"w")+a.horizontalPadding>=e&&(g=!0):0<d&&(a.verticallyOriented?a.pageTopOffsets[b]+k(b,"h")+a.verticalPadding<e&&(g=!0):a.pageLeftOffsets[b]+k(b,"w")+a.horizontalPadding<e&&(g=!0));return g?(a.currentPageIndex=c,0===d||K(d)||(d=a.pages[c].f,f(a.onSetCurrentPage,c,d),diva.Events.publish("VisiblePageDidChange",[c,d],h)),!0):!1},Z=function(d){var b=Math.floor(a.currentPageIndex/
a.pagesPerRow),c=b+parseInt(d,10),e=document.getElementById(a.ID+"outer").scrollTop,f=e+a.panelHeight/2,k=!1;0>d?0<=c&&(a.rowHeight*b>=f||a.rowHeight*c>=e)&&(k=!0):0<d&&a.rowHeight*(b+1)<e&&y(c)&&(k=!0);return k?(a.currentPageIndex=c*a.pagesPerRow,0===d||Z(d)||(d=a.currentPageIndex,diva.Events.publish("VisiblePageDidChange",[d,a.pages[d].f],h)),!0):!1},H=function(d,b,c){c="undefined"!==typeof c?c:0;b=a.pageTopOffsets[d]+("undefined"!==typeof b?b:0)-parseInt(a.panelHeight/2,10);c=a.pageLeftOffsets[d]+
c-parseInt(a.panelWidth/2,10);a.outerObject.scrollTop(b);a.outerObject.scrollLeft(c);d!==a.currentPageIndex&&(a.currentPageIndex=d,c=a.pages[d].f,f(a.onSetCurrentPage,d,c),diva.Events.publish("VisiblePageDidChange",[d,c],h));f(a.onJump,d);diva.Events.publish("ViewerDidJump",[d],h)},I=function(d){a.outerObject.scrollTop(Math.floor(d/a.pagesPerRow)*a.rowHeight);a.currentPageIndex=d;diva.Events.publish("VisiblePageDidChange",[d,a.pages[d].f],h)},R=function(d){return d>=a.minZoomLevel&&d<=a.maxZoomLevel?
d:a.minZoomLevel},ia=function(d){return d>=a.minPagesPerRow&&d<=a.maxPagesPerRow?d:a.maxPagesPerRow},aa=function(){a.allTilesLoaded=[];a.outerObject.scrollTop(0);a.innerObject.empty();a.firstPageLoaded=0;a.firstRowLoaded=-1;a.previousTopScroll=0;a.previousLeftScroll=0;for(clearTimeout(a.resizeTimer);a.pageTimeouts.length;)clearTimeout(a.pageTimeouts.pop())},M=function(){a.inGrid?ja():ba()},ba=function(){aa();a.zoomLevel=R(a.zoomLevel);var d=a.zoomLevel;a.totalHeight=a.totalHeights[d]+a.verticalPadding*
(a.numPages+1);a.totalWidth=a.totalWidths[d]+a.horizontalPadding*(a.numPages+1);var b=a.maxHeights[d]+2*a.verticalPadding,c=Math.max(a.maxWidths[d]+2*a.horizontalPadding,a.panelWidth),b=Math.max(b,a.panelHeight),e=document.getElementById(a.ID+"inner");a.verticallyOriented?(e.style.height=Math.round(a.totalHeight)+"px",e.style.width=Math.round(c)+"px"):(e.style.height=Math.round(b)+"px",e.style.width=Math.round(a.totalWidth)+"px");var g=0,v=0;a.pageTopOffsets=[];a.pageLeftOffsets=[];for(e=0;e<a.numPages;e++)a.pageTopOffsets[e]=
parseInt(a.verticallyOriented?g:(b-k(e,"h"))/2,10),a.pageLeftOffsets[e]=parseInt(a.verticallyOriented?(c-k(e,"w"))/2:v,10),g=a.pageTopOffsets[e]+k(e,"h")+a.verticalPadding,v=a.pageLeftOffsets[e]+k(e,"w")+a.horizontalPadding;p(a.goDirectlyTo)||(a.goDirectlyTo=0);H(a.goDirectlyTo,a.verticalOffset,a.horizontalOffset);c=!1;for(e=0;e<a.numPages;e++)if(n(e))l(e),a.lastPageLoaded=e,c=!0;else if(c)break;0<=a.oldZoomLevel?(a.oldZoomLevel<a.zoomLevel?(f(a.onZoomIn,d),diva.Events.publish("ViewerDidZoomIn",[d],
h)):(f(a.onZoomOut,d),diva.Events.publish("ViewerDidZoomOut",[d],h)),f(a.onZoom,d)):a.oldZoomLevel=a.zoomLevel;a.scaleWait&&(a.scaleWait=!1);d=a.pages[a.currentPageIndex].f;f(a.onDocumentLoaded,a.currentPageIndex,d);diva.Events.publish("DocumentDidLoad",[a.currentPageIndex,d],h)},ja=function(){var d=a.currentPageIndex;a.verticalOffset=a.verticallyOriented?a.panelHeight/2:k(d,"h")/2;a.horizontalOffset=a.verticallyOriented?k(d,"w")/2:a.panelWidth/2;aa();a.pagesPerRow=ia(a.pagesPerRow);d=(a.panelWidth-
a.fixedPadding*(a.pagesPerRow+1))/a.pagesPerRow;a.gridPageWidth=d;a.rowHeight=a.fixedHeightGrid?a.fixedPadding+a.minRatio*d:a.fixedPadding+a.maxRatio*d;a.numRows=Math.ceil(a.numPages/a.pagesPerRow);a.totalHeight=a.numRows*a.rowHeight+a.fixedPadding;d=document.getElementById(a.ID+"inner");d.style.height=Math.round(a.totalHeight)+"px";d.style.width=Math.round(a.panelWidth)+"px";I(a.goDirectlyTo);var b;a.pageTopOffsets=[];a.pageLeftOffsets=[];for(var c=a.numPages,d=0;d<c;d+=a.pagesPerRow)b=Math.floor(d/
a.pagesPerRow),A(b)&&(a.firstRowLoaded=0>a.firstRowLoaded?b:a.firstRowLoaded,z(b),a.lastRowLoaded=b)},ka=function(a){27==a.keyCode&&B()},ca=function(d){a.outerObject.toggleClass("diva-fullscreen");b("body").toggleClass("diva-hide-scrollbar");a.parentObject.toggleClass("diva-full-width");if(a.mobileWebkit){var c=parseInt(a.outerObject.css("margin-left"),10)-parseInt(b("body").css("margin-left"),10);a.outerObject.css("margin-left",c)}var c=a.panelHeight,e=a.panelWidth;O();if(0<=a.oldZoomLevel&&!a.inGrid){var k=
a.panelHeight,g=a.panelWidth;a.inFullscreen?(a.verticalOffset-=(k-c)/2,a.horizontalOffset-=(g-e)/2):(a.verticalOffset+=(c-k)/2,a.horizontalOffset+=(e-g)/2)}d?(a.inGrid=!a.inGrid,S()):M();if(a.inFullscreen)b(document).on("keyup",ka);else b(document).off("keyup",ka);f(a.onModeToggle,a.inFullscreen);diva.Events.publish("ModeDidSwitch",[a.inFullscreen],h)},S=function(){M();f(a.onViewToggle,a.inGrid);diva.Events.publish("ViewDidSwitch",[a.inGrid],h)},B=function(){a.goDirectlyTo=a.currentPageIndex;a.inFullscreen=
!a.inFullscreen;ca(!1)},C=function(){a.goDirectlyTo=a.currentPageIndex;a.inGrid=!a.inGrid;S()},da=function(d){var c=b(this).offset();a.doubleClickZoom=!0;a.horizontalOffset=d.pageX-c.left;a.verticalOffset=d.pageY-c.top;a.goDirectlyTo=parseInt(b(this).attr("data-index"),10);N(d.ctrlKey?a.zoomLevel-1:a.zoomLevel+1)},la=function(d){var c=parseInt(b(this).attr("data-index"),10);a.goDirectlyTo=c;var e=b(this).offset(),c=k(c,"w")/b(this).width();a.horizontalOffset=(d.pageX-e.left)*c;a.verticalOffset=(d.pageY-
e.top)*c;a.inGrid=!1;S()},N=function(d){var b=R(d);if(b!==d)return!1;d=Math.pow(2,b-a.zoomLevel);a.doubleClickZoom?(a.verticalOffset*=d,a.horizontalOffset*=d,a.doubleClickZoom=!1):(a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=d*T(),a.horizontalOffset=d*U());a.oldZoomLevel=a.zoomLevel;a.zoomLevel=b;diva.Events.publish("ZoomLevelDidChange",[b],h);ba();return!0},Y=function(d){var b=ia(d);if(b!==d)return!1;a.pagesPerRow=b;diva.Events.publish("GridRowNumberDidChange",[b],h);a.goDirectlyTo=a.currentPageIndex;
ja();return!0},P=function(d,b){d="undefined"===typeof d?a.currentPageIndex:d;return"center"===b||"centre"===b?parseInt(k(d,"h")/2,10):"bottom"===b?parseInt(k(d,"h")-a.panelHeight/2,10):parseInt(a.panelHeight/2,10)},Q=function(d,b){d="undefined"===typeof d?a.currentPageIndex:d;return"left"===b?parseInt(a.panelWidth/2,10):"right"===b?parseInt(k(d,"w")-a.panelWidth/2,10):parseInt(k(d,"w")/2,10)},T=function(){return document.getElementById(a.ID+"outer").scrollTop-a.pageTopOffsets[a.currentPageIndex]+
parseInt(a.panelHeight/2,10)},U=function(){return document.getElementById(a.ID+"outer").scrollLeft-a.pageLeftOffsets[a.currentPageIndex]+parseInt(a.panelWidth/2,10)},ma=function(){return{f:a.inFullscreen,g:a.inGrid,z:a.zoomLevel,n:a.pagesPerRow,i:a.enableFilename?a.pages[a.currentPageIndex].f:!1,p:a.enableFilename?!1:a.currentPageIndex+1,y:a.inGrid?!1:T(),x:a.inGrid?!1:U()}},na=function(){var d=ma(),b=[],c;for(c in d)!1!==d[c]&&b.push(c+a.hashParamSuffix+"="+d[c]);return b.join("&")},oa=function(){return location.protocol+
"//"+location.host+location.pathname+"#"+na()},O=function(){var d=document.getElementById(a.ID+"outer");a.panelHeight=d.clientHeight-(d.scrollWidth>d.clientWidth?a.scrollbarWidth:0);a.panelWidth=d.clientWidth-(d.scrollHeight>d.clientHeight?a.scrollbarWidth:0);a.horizontalOffset=U();a.verticalOffset=T();H(a.currentPageIndex,a.verticalOffset,a.horizontalOffset);return!0},pa=function(){a.mobileWebkit||(a.outerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),a.innerObject.dragscrollable({dragSelector:".diva-dragger",
acceptPropagatedEvent:!0}));a.outerObject.on("dblclick",".diva-document-page",function(a){da.call(this,a)});a.outerObject.on("contextmenu",".diva-document-page",function(d){if(d.ctrlKey)return clearTimeout(a.singleClickTimeout),a.singleClick?(da.call(this,d),a.singleClick=!1):(a.singleClick=!0,a.singleClickTimeout=setTimeout(function(){a.singleClick=!1},500)),!1});a.outerObject.on("dblclick",".diva-row",function(a){la.call(b(a.target).parent(),a)})},ea=function(a,b,c,e){return Math.sqrt((a-b)*(a-
b)+(c-e)*(c-e))},ta=function(){a.innerObject.mouseover(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});a.innerObject.mouseout(function(){b(this).removeClass("diva-grab")});a.innerObject.mousedown(function(){b(this).removeClass("diva-grab").addClass("diva-grabbing")});a.innerObject.mouseup(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});pa();a.outerObject.scroll(function(){var d,b=document.getElementById(a.ID+"outer").scrollTop,c=document.getElementById(a.ID+
"outer").scrollLeft;d=a.verticallyOriented||a.inGrid?b-a.previousTopScroll:c-a.previousLeftScroll;if(a.inGrid){0>d?(F(a.firstRowLoaded,-1),Z(-1),E(a.lastRowLoaded,-1)):0<d&&(F(a.lastRowLoaded,1),Z(1),E(a.firstRowLoaded,1));var e=document.getElementById(a.ID+"outer").scrollTop}else{if(0>d)x(a.firstPageLoaded,d),K(-1),u(a.lastPageLoaded,d);else if(0<d)x(a.lastPageLoaded,d),K(1),u(a.firstPageLoaded,d);else for(var k=a.lastPageLoaded,e=Math.max(a.firstPageLoaded,0);e<=k;e++)n(e)&&l(e);e=a.verticallyOriented?
document.getElementById(a.ID+"outer").scrollTop:document.getElementById(a.ID+"outer").scrollLeft}f(a.onScroll,e);diva.Events.publish("ViewerDidScroll",[e],h);0<d?(f(a.onScrollDown,e),diva.Events.publish("ViewerDidScrollDown",[e],h)):0>d&&(f(a.onScrollUp,e),diva.Events.publish("ViewerDidScrollUp",[e],h));a.previousTopScroll=b;a.previousLeftScroll=c;a.horizontalOffset=U();a.verticalOffset=T()});b(document).keydown(function(d){if(!a.isActiveDiva)return!0;if(a.enableSpaceScroll&&!d.shiftKey&&32===d.keyCode||
a.enableKeyScroll&&34===d.keyCode)return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.panelHeight),!1;a.enableSpaceScroll||32!==d.keyCode||d.preventDefault();if(a.enableKeyScroll)switch(d.keyCode){case 33:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.panelHeight),!1;case 38:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.arrowScrollAmount),!1;case 40:return a.outerObject.scrollTop(document.getElementById(a.ID+
"outer").scrollTop+a.arrowScrollAmount),!1;case 37:return a.outerObject.scrollLeft(document.getElementById(a.ID+"outer").scrollLeft-a.arrowScrollAmount),!1;case 39:return a.outerObject.scrollLeft(document.getElementById(a.ID+"outer").scrollLeft+a.arrowScrollAmount),!1;case 36:return a.outerObject.scrollTop(0),!1;case 35:return a.outerObject.scrollTop(a.totalHeight),!1}return!0});if(a.mobileWebkit){var d=[];d.push('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />');
d.push('<meta name="apple-mobile-web-app-capable" content="yes" />');d.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');b("head").append(d.join("\n"));a.blockMobileMove&&b("body").bind("touchmove",function(a){a.originalEvent.preventDefault();return!1});a.outerObject.kinetic({triggerHardware:!0});var c=[],e=[],k=0;a.outerObject.on("touchstart",".diva-document-page",function(a){2===a.originalEvent.touches.length&&(c=[a.originalEvent.touches[0].clientX,a.originalEvent.touches[0].clientY,
a.originalEvent.touches[1].clientX,a.originalEvent.touches[1].clientY],k=ea(c[2],c[0],c[3],c[1]))});a.outerObject.on("touchmove",".diva-document-page",function(d){if(2===d.originalEvent.touches.length){e=[d.originalEvent.touches[0].clientX,d.originalEvent.touches[0].clientY,d.originalEvent.touches[1].clientX,d.originalEvent.touches[1].clientY];var c=ea(e[2],e[0],e[3],e[1])-k;if(!a.scaleWait)if(a.goDirectlyTo=a.currentPageIndex,a.inGrid)a.inGrid=!1,S();else a:{var f=a.zoomLevel;if(100<c&&f<a.maxZoomLevel)f++;
else if(-100>c&&f>a.minZoomLevel)f--;else break a;a.scaleWait=!0;c=b(this).offset();a.horizontalOffset=d.pageX-c.left;a.verticalOffset=d.pageY-c.top;a.goDirectlyTo=parseInt(b(this).attr("data-index"),10);N(f)}}});var g={},v=0,d=function(d){if(a.singleTap){var c={pageX:d.originalEvent.changedTouches[0].clientX,pageY:d.originalEvent.changedTouches[0].clientY};v=ea(g.pageX,c.pageX,g.pageY,c.pageY);50>v&&a.zoomLevel<a.maxZoomLevel&&(a.inGrid?la.call(b(d.target).parent(),c):da.call(this,c));a.singleTap=
!1;g={}}else a.singleTap=!0,g.pageX=d.originalEvent.changedTouches[0].clientX,g.pageY=d.originalEvent.changedTouches[0].clientY,a.singleTapTimeout=setTimeout(function(){a.singleTap=!1;g={}},250)};a.outerObject.on("touchend",".diva-document-page",d);a.outerObject.on("touchend",".diva-page",d);d="onorientationchange"in window?"orientationchange":"resize";b(window).bind(d,function(d){d=a.panelWidth;var b=a.panelHeight;O();a.horizontalOffset-=(a.panelWidth-d)/2;a.verticalOffset-=(a.panelHeight-b)/2;a.goDirectlyTo=
a.currentPageIndex;M()})}else b(window).resize(function(){O();clearTimeout(a.resizeTimer);a.resizeTimer=setTimeout(function(){a.goDirectlyTo=a.currentPageIndex;a.verticalOffset=T();a.horizontalOffset=U();M()},200)});diva.Events.subscribe("PanelSizeDidChange",O)},ua=function(){a.toolbarParentObject.prepend('<div id="'+a.ID+'tools" class="diva-tools">'+('<div id="'+a.ID+'tools-left" class="diva-tools-left">'+("slider"===a.enableZoomControls?'<input type="range" id="'+a.ID+'zoom-slider" class="zoom-slider" value="'+
a.zoomLevel+'" min="'+a.minZoomLevel+'" max="'+a.maxZoomLevel+'">':"")+("buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-out-button" class="diva-zoom-out-button button" title="Zoom Out"></div><div id="'+a.ID+'zoom-in-button" class="diva-zoom-in-button button" title="Zoom In"></div>':"")+("slider"===a.enableGridControls?'<input type="range" id="'+a.ID+'grid-slider" class="grid-slider" value="'+a.pagesPerRow+'" min="'+a.minPagesPerRow+'" max="'+a.maxPagesPerRow+'">':"")+("buttons"===a.enableGridControls?
'<div id="'+a.ID+'grid-out-button" class="diva-grid-out-button button" title="Zoom Out"></div><div id="'+a.ID+'grid-in-button" class="diva-grid-in-button button" title="Zoom In"></div>':"")+("slider"===a.enableZoomControls?'<div id="'+a.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"")+("buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+a.ID+'zoom-level">'+
a.zoomLevel+"</span></div>":"")+("slider"===a.enableGridControls?'<div id="'+a.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"")+("buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"")+'</div><div id="'+a.ID+'tools-right" class="diva-tools-right">'+(a.enableFullscreen?'<div id="'+a.ID+'fullscreen" class="diva-fullscreen-icon button" title="Toggle fullscreen mode"></div>':
"")+(a.enableLinkIcon?'<div class="diva-link-icon button" id="'+a.ID+'link-icon" style="'+(a.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"")+(a.enableGridIcon?'<div class="diva-grid-icon button'+(a.inGrid?" diva-in-grid":"")+'" id="'+a.ID+'grid-icon" title="Toggle grid view"></div>':"")+'<div id="'+a.ID+'page-nav" class="diva-page-nav">'+(a.enableGotoPage?'<form id="'+a.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+a.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':
"")+('<div class="diva-page-label">Page <span id="'+a.ID+'current-page">1</span> of <span id="'+a.ID+'num-pages">'+a.numPages+"</span></div>")+"</div></div>")+"</div>");b(a.selector+"zoom-slider").on("input",function(a){a=parseInt(this.value,10);N(a)});b(a.selector+"zoom-slider").on("change",function(d){d=parseInt(this.value,10);d!==a.zoomLevel&&N(d)});b(a.selector+"zoom-out-button").click(function(){N(a.zoomLevel+-1)});b(a.selector+"zoom-in-button").click(function(){N(a.zoomLevel+1)});b(a.selector+
"grid-slider").on("input",function(a){a=parseInt(this.value,10);Y(a)});b(a.selector+"grid-slider").on("change",function(d){d=parseInt(this.value,10);d!==a.zoomLevel&&Y(d)});b(a.selector+"fullscreen").click(function(){B()});b(a.selector+"grid-out-button").click(function(){Y(a.pagesPerRow-1)});b(a.selector+"grid-in-button").click(function(){Y(a.pagesPerRow+1)});b(a.selector+"grid-icon").click(function(){C()});b(a.selector+"goto-page").submit(function(){var d=parseInt(b(a.selector+"goto-page-input").val(),
10)-1;if(p(d))if(a.inGrid)I(d);else{var c=P(d,"top"),e=Q(d,"center");H(d,c,e)}else alert("Invalid page number");return!1});var d=b(a.selector+"link-icon");d.click(function(){b("body").prepend('<div id="'+a.ID+'link-popup" class="diva-popup diva-link-popup"><input id="'+a.ID+'link-popup-input" class="diva-input" type="text" value="'+oa()+'"/></div>');if(a.inFullscreen)b(a.selector+"link-popup").addClass("in-fullscreen");else{var c=d.offset().left-222+d.outerWidth(),e=d.offset().top+d.outerHeight()-
1;b(a.selector+"link-popup").removeClass("in-fullscreen").css({top:e+"px",left:c+"px"})}b("body").mouseup(function(d){d=d.target.id;d!==a.ID+"link-popup"&&d!==a.ID+"link-popup-input"&&b(a.selector+"link-popup").remove()});a.outerObject.scroll(function(){b(a.selector+"link-popup").remove()});b(a.selector+"link-popup input").click(function(){b(this).focus().select()});return!1});var c=a.inGrid?"grid":"zoom";b(a.selector+c+"-slider").show();b(a.selector+c+"-out-button").show();b(a.selector+c+"-in-button").show();
b(a.selector+c+"-slider-label").show();b(a.selector+c+"-buttons-label").show();return{updateCurrentPage:function(){document.getElementById(a.ID+"current-page").textContent=a.currentPageIndex+1},setNumPages:function(d){document.getElementById(a.ID+"num-pages").textContent=d},updateZoomSlider:function(){a.zoomLevel!==b(a.selector+"zoom-slider").val()&&b(a.selector+"zoom-slider").val(a.zoomLevel);document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateZoomButtons:function(){document.getElementById(a.ID+
"zoom-level").textContent=a.zoomLevel},updateGridSlider:function(){a.pagesPerRow!==b(a.selector+"grid-slider").val()&&b(a.selector+"grid-slider").val(a.pagesPerRow);document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},updateGridButtons:function(){document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},closePopups:function(){b(".diva-popup").css("display","none")},switchView:function(){b(a.selector+c+"-slider").hide();b(a.selector+c+"-out-button").hide();b(a.selector+
c+"-in-button").hide();b(a.selector+c+"-slider-label").hide();b(a.selector+c+"-buttons-label").hide();c=a.inGrid?"grid":"zoom";b(a.selector+c+"-slider").show();b(a.selector+c+"-out-button").show();b(a.selector+c+"-in-button").show();b(a.selector+c+"-slider-label").show();b(a.selector+c+"-buttons-label").show();b(a.selector+"grid-icon").toggleClass("diva-in-grid")},switchMode:function(){b(a.selector+"tools").toggleClass("diva-fullscreen-tools");a.inFullscreen?b(a.selector+"tools-left").addClass("in-fullscreen"):
b(a.selector+"tools-left").removeClass("in-fullscreen")}}},va=function(){if(window.divaPlugins){var d=[];b.each(window.divaPlugins,function(b,c){var e=c.pluginName[0].toUpperCase()+c.pluginName.substring(1);a["enable"+e]&&c.init(a,h)&&(e=c.titleText||e+" plugin","function"===typeof c.handleClick&&(d.push('<div class="diva-'+c.pluginName+'-icon" title="'+e+'"></div>'),a.outerObject.on(a.mobileWebkit?"touchend":"click",".diva-"+c.pluginName+"-icon",function(d){c.handleClick.call(this,d,a,h)})),a.plugins.push(c))});
d.length&&(a.pageTools='<div class="diva-page-tools">'+d.join("")+"</div>")}},fa=function(){clearTimeout(a.throbberTimeoutID);b(a.selector+"throbber").hide()},wa=function(a){var b=function(a,d){var b=Math.max(a,d);return Math.ceil(Math.log((b+1)/257)/Math.log(2))},c=function(a,d){for(var b=a.length;b--;)a[b]=d};diva.Events.publish("ManifestDidLoad",[a],this);var e=a.sequences[0].canvases,f=Array(e.length),h=Array(e.length),k,g,m,v,l,n;a=a.label;for(var p=0,t=e.length;p<t;p++)k=e[p].width,g=e[p].height,
n=e[p].images[0].resource,m=n.service["@id"],"/"!==m.slice(-1)&&(m+="/"),v=b(k,g),l=e[p].label,n=n.service["@context"],n="http://iiif.io/api/image/2/context.json"===n?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===n?1.1:1,h[p]={mx_w:k,mx_h:g,mx_z:v,fn:l,url:m,api:n},f[p]=v;b=Math.min.apply(Math,f);e=0;f=100;k=Array(b+1);g=Array(b+1);m=Array(b+1);v=Array(b+1);c(k,0);c(g,0);c(m,0);c(v,0);var c=[],q,p=0;for(numImages=h.length;p<numImages;p++){l=[];for(t=0;t<b+1;t++)n=Math.floor(h[p].mx_w/
Math.pow(2,b-t)),q=Math.floor(h[p].mx_h/Math.pow(2,b-t)),l[t]={h:q,w:n},k[t]+=n,g[t]+=q,m[t]=Math.max(n,m[t]),v[t]=Math.max(q,v[t]),n=h[p].mx_h/h[p].mx_w,e=Math.max(n,e),f=Math.min(n,f);c[p]={d:l,m:h[p].mx_z,f:h[p].fn,url:h[p].url,api:h[p].api}}l=[];t=[];for(p=0;p<b+1;p++)l.push(k[p]/h.length),t.push(g[p]/h.length);return{item_title:a,dims:{a_wid:l,a_hei:t,max_w:m,max_h:v,max_ratio:e,min_ratio:f,t_hei:g,t_wid:k},max_zoom:b,pgs:c}},qa=function(d,b,c){fa();d='<div id="'+a.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+
b+" "+c+"</p>";0===a.objectData.lastIndexOf("http",0)&&""===c&&(c=a.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0],location.hostname!==c&&(d+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>'));a.outerObject.append(d+"</div>")},ra=function(d){!d.hasOwnProperty("@context")||
-1===d["@context"].indexOf("iiif")&&-1===d["@context"].indexOf("shared-canvas")||(a.isIIIF=!0,d=wa(d));fa();a.pages=d.pgs;a.maxRatio=d.dims.max_ratio;a.minRatio=d.dims.min_ratio;a.itemTitle=d.item_title;a.numPages=d.pgs.length;a.maxWidths=d.dims.max_w;a.maxHeights=d.dims.max_h;a.averageWidths=d.dims.a_wid;a.averageHeights=d.dims.a_hei;a.totalHeights=d.dims.t_hei;a.totalWidths=d.dims.t_wid;a.realMaxZoom=d.max_zoom;a.maxZoomLevel=0<=a.maxZoomLevel&&a.maxZoomLevel<=d.max_zoom?a.maxZoomLevel:d.max_zoom;
a.minZoomLevel=0<=a.minZoomLevel&&a.minZoomLevel<=a.maxZoomLevel?a.minZoomLevel:0;a.zoomLevel=R(a.zoomLevel);a.minPagesPerRow=Math.max(2,a.minPagesPerRow);a.maxPagesPerRow=Math.max(a.minPagesPerRow,a.maxPagesPerRow);a.enableFilename?(d=b.getHashParam("i"+a.hashParamSuffix),d=g(d)):d=parseInt(b.getHashParam("p"+a.hashParamSuffix),10)-1;p(d)&&(a.goDirectlyTo=d,a.currentPageIndex=d);diva.Events.publish("NumberOfPagesDidChange",[a.numPages],this);a.enableAutoTitle&&(b(a.selector+"title").length?b(a.selector+
"title").html(a.itemTitle):a.parentObject.prepend('<div id="'+a.ID+'title" class="diva-title">'+a.itemTitle+"</div>"));p(parseInt(a.goDirectlyTo),10)||(a.goDirectlyTo=0);0<a.adaptivePadding?(d=a.zoomLevel,a.horizontalPadding=parseInt(a.averageWidths[d]*a.adaptivePadding,10),a.verticalPadding=parseInt(a.averageHeights[d]*a.adaptivePadding,10)):(a.horizontalPadding=a.fixedPadding,a.verticalPadding=a.fixedPadding);a.pageTools.length&&(a.verticalPadding=Math.max(40,a.verticalPadding))},xa=function(){a.outerObject.append('<div id="'+
a.ID+'throbber" class="diva-throbber"></div>');a.throbberTimeoutID=setTimeout(function(){b(a.selector+"throbber").show()},a.throbberTimeout);b.ajax({url:a.objectData,cache:!0,dataType:"json",error:qa,success:function(d,c,e){ra(d);b.each(a.plugins,function(d,b){f(b.setupHook,a)});a.enableToolbar&&(a.toolbar=ua(),diva.Events.subscribe("VisiblePageDidChange",a.toolbar.updateCurrentPage),diva.Events.subscribe("ModeDidSwitch",a.toolbar.switchMode),diva.Events.subscribe("ViewDidSwitch",a.toolbar.switchView),
diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomButtons),diva.Events.subscribe("GridRowNumberDidChange",a.toolbar.updateGridSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateGridButtons),diva.Events.subscribe("NumberOfPagesDidChange",a.toolbar.setNumPages));a.parentObject.parent()[0]!==document.body||a.parentObject.siblings().not("#diva-canvas-backdrop")[0]||(a.divaIsFullWindow=!0);O();d=parseInt(b.getHashParam("y"+
a.hashParamSuffix),10);isNaN(d)?a.verticalOffset=P(a.currentPageIndex,"top"):a.verticalOffset=d;d=parseInt(b.getHashParam("x"+a.hashParamSuffix),10);isNaN(d)?a.horizontalOffset=Q(a.currentPageIndex,"center"):a.horizontalOffset=d;a.inFullscreen?ca(!1):M();O();f(a.onReady,a);diva.Events.publish("ViewerDidLoad",[a],h);a.loaded=!0}})},ga=function(){return a.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),
!1)};(function(){a.scrollbarWidth=b.getScrollbarWidth();a.mobileWebkit=void 0!==window.orientation;a.ID=b.generateId("diva-");a.selector="#"+a.ID;var d=parseInt(a.ID,10);1<d&&(a.hashParamSuffix=d);a.parentObject.append('<div id="'+a.ID+'outer" class="diva-outer"></div>');a.outerObject=b(a.selector+"outer");a.outerObject.append('<div id="'+a.ID+'inner" class="diva-inner diva-dragger"></div>');a.innerObject=b(a.selector+"inner");d=parseInt(b.getHashParam("n"+a.hashParamSuffix),10);d>=a.minPagesPerRow&&
d<=a.maxPagesPerRow&&(a.pagesPerRow=d);d=b.getHashParam("z"+a.hashParamSuffix);""!==d&&(d=parseInt(d,10),d>=a.minZoomLevel&&(a.zoomLevel=d));var d=b.getHashParam("g"+a.hashParamSuffix),c="true"===d,e=b.getHashParam("f"+a.hashParamSuffix);a.inGrid=a.inGrid&&"false"!==d||c;a.inFullscreen=a.inFullscreen&&"false"!==e||"true"===e;xa();va();ta()})();this.getItemTitle=function(){return a.itemTitle};this.gotoPageByNumber=function(a,b,c){a-=1;return p(a)?(H(a,P(a,c),Q(a,b)),!0):!1};this.gotoPageByIndex=function(a,
b,c){return p(a)?(H(a,P(a,c),Q(a,b)),!0):!1};this.getCurrentPage=function(){console.warn("The call to getCurrentPage is deprecated. Use getCurrentPageIndex instead.");return a.currentPageIndex};this.getNumberOfPages=function(){return ga()?a.numPages:!1};this.getPageDimensionsAtZoomLevel=function(d,b){if(!ga())return!1;b>a.maxZoomLevel&&(b=a.maxZoomLevel);var c=a.pages[d].d[parseInt(b,10)];return{width:c.w,height:c.h}};this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(a.currentPageIndex,
a.zoomLevel)};this.isReady=function(){return a.loaded};this.getCurrentPageIndex=function(){return a.currentPageIndex};this.getCurrentPageFilename=function(){return a.pages[a.currentPageIndex].f};this.getCurrentPageNumber=function(){return a.currentPageIndex+1};this.getFilenames=function(){for(var d=[],b=0;b<a.numPages;b++)d[b]=a.pages[b].f;return d};this.getZoomLevel=function(){return a.zoomLevel};this.getMaxZoomLevel=function(){return a.maxZoomLevel};this.getMaxZoomLevelForPage=function(d){return ga?
a.pages[d].m:!1};this.getMinZoomLevel=function(){return a.minZoomLevel};this.setZoomLevel=function(d){a.inGrid&&C();return N(d)};this.zoomIn=function(){return this.setZoomLevel(a.zoomLevel+1)};this.zoomOut=function(){return this.setZoomLevel(a.zoomLevel-1)};this.inViewport=function(d,b,c,e,f){d-=1;c=a.pageTopOffsets[d]+c;b=a.pageLeftOffsets[d]+b;e=b+e;return r(c,c+f)&&q(b,e)};this.isPageInViewport=function(a){return n(a)};this.isPageInDOM=function(a){return s(a)};this.toggleFullscreenMode=function(){B()};
this.closePopups=function(){a.toolbar.closePopups()};this.enterFullscreenMode=function(){return a.inFullscreen?!1:(B(),!0)};this.leaveFullscreenMode=function(){return a.inFullscreen?(B(),!0):!1};this.toggleGridView=function(){C()};this.enterGridView=function(){return a.inGrid?!1:(C(),!0)};this.leaveGridView=function(){return a.inGrid?(C(),!0):!1};this.gotoPageByName=function(a,b,c){a=g(a);return p(a)?(H(a,P(a,c),Q(a,b)),!0):!1};this.getPageIndex=function(a){return g(a)};this.getCurrentURL=function(){return oa()};
this.getURLHash=function(){return na()};this.getState=function(){return ma()};this.getInstanceSelector=function(){return a.selector};this.getInstanceId=function(){return a.ID};this.getSettings=function(){return a};this.translateFromMaxZoomLevel=function(b){return b/Math.pow(2,a.maxZoomLevel-a.zoomLevel)};this.translateToMaxZoomLevel=function(b){var c=a.maxZoomLevel-a.zoomLevel;return 0===c?b:b*Math.pow(2,c)};this.setState=function(b){var c;c=g(b.i);p(c)?a.goDirectlyTo=c:p(b.p)&&(a.goDirectlyTo=b.p);
horizontalOffset=parseInt(b.x,10);verticalOffset=parseInt(b.y,10);b.z>=a.minZoomLevel&&b.z<=a.maxZoomLevel&&(a.zoomLevel=b.z);b.n>=a.minPagesPerRow&&b.n<=a.maxPagesPerRow&&(a.pagesPerRow=b.n);a.inFullscreen!==b.f?(a.inFullscreen=b.f,ca(a.inGrid!==b.g),a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,H(c,a.verticalOffset,a.horizontalOffset)):(a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,a.inGrid!==b.g?(a.inGrid=b.g,S()):M())};this.enableScrollable=function(){a.isScrollable||
(pa(),a.enableKeyScroll=a.initialKeyScroll,a.enableSpaceScroll=a.initialSpaceScroll,a.outerObject.css("overflow","auto"),a.isScrollable=!0)};this.disableScrollable=function(){a.isScrollable&&(a.innerObject.hasClass("diva-dragger")&&a.innerObject.unbind("mousedown"),a.outerObject.unbind("dblclick"),a.outerObject.unbind("contextmenu"),a.outerObject.css("overflow","hidden"),a.initialKeyScroll=a.enableKeyScroll,a.initialSpaceScroll=a.enableSpaceScroll,a.enableKeyScroll=!1,a.enableSpaceScroll=!1,a.isScrollable=
!1)};this.toggleOrientation=function(){a.verticallyOriented=!a.verticallyOriented;a.verticalOffset=P();a.horizontalOffset=Q();a.goDirectlyTo=a.currentPageIndex;ba();return a.verticallyOriented};this.getPageOffset=function(b){return{top:parseInt(a.pageTopOffsets[b]),left:parseInt(a.pageLeftOffsets[b])}};this.getCurrentPageOffset=function(){return this.getPageOffset(a.currentPageIndex)};this.getPageDimensionsAtCurrentGridLevel=function(b){b=p(b)?b:a.currentPageIndex;var c=a.rowHeight-a.fixedPadding;
b=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*k(b,"w")/k(b,"h"):a.gridPageWidth;return{height:parseInt(c,10),width:parseInt(b,10)}};this.getPageIndexForPageXYValues=function(b,c){var e=document.getElementById(a.ID+"outer").getBoundingClientRect(),f=e.bottom,h=e.right;if(b<e.left||b>h||c<e.top||c>f)return!1;e=document.getElementsByClassName("diva-document-page");for(f=e.length;f--;){var h=e[f],k=h.getBoundingClientRect();if(!(b<k.left||b>k.right||c<k.top||c>k.bottom))return h.getAttribute("data-index")}return!1};
this.isVerticallyOriented=function(){return a.verticallyOriented};this.changeObject=function(d){a.loaded=!1;aa();a.throbberTimeoutID=setTimeout(function(){b(a.selector+"throbber").show()},a.throbberTimeout);a.objectData=d;b.ajax({url:a.objectData,cache:!0,dataType:"json",error:qa,success:function(b,d,c){ra(b);fa();M();a.loaded=!0}})};this.activate=function(){a.isActiveDiva=!0};this.deactivate=function(){a.isActiveDiva=!1};this.destroy=function(){b("body").removeClass("diva-hide-scrollbar");a.parentObject.empty().removeData("diva");
b.each(a.plugins,function(b,c){f(c.destroy,a,h)});a.parentObject.removeAttr("style").removeAttr("class");diva.Events.unsubscribeAll()}};b.fn.diva=function(e){return this.each(function(){e.parentObject=b(this);if(!e.parentObject.data("diva")){var c=new f(this,e);e.parentObject.data("diva",c)}})}})(jQuery);(function(b){window.divaPlugins.push(function(){var f={};return{init:function(e,c){var a,h,m,k,g;c.startScrolling=function(){e.currentlyAutoScrolling?console.warn("You are trying to start autoscrolling, but it is already scrolling."):(b("#"+e.ID+"autoscroll-toggle").text("Turn off"),h&&c.disableScrollable(),e.currentlyAutoScrolling=!0,restartScrollingInterval())};restartScrollingInterval=function(){clearInterval(e.autoScrollInterval);e.autoScrollInterval=e.verticallyOriented?setInterval(function(){e.outerObject.scrollTop(e.outerObject.scrollTop()+
a)},m):setInterval(function(){e.outerObject.scrollLeft(e.outerObject.scrollLeft()+a)},m)};c.stopScrolling=function(){e.currentlyAutoScrolling?(b("#"+e.ID+"autoscroll-toggle").text("Turn on"),h&&c.enableScrollable(),e.currentlyAutoScrolling=!1,clearInterval(e.autoScrollInterval)):console.warn("You are trying to stop autoscrolling, but it is not currently active.")};c.toggleScrolling=function(){e.currentlyAutoScrolling?c.stopScrolling():c.startScrolling()};c.changeRefresh=function(a){m=a;q()};c.changeScrollSpeed=
function(a){g=a;q();b("#"+e.ID+"autoscroll-pps").val(Math.log(g)/Math.log(10));e.currentlyAutoScrolling&&restartScrollingInterval()};var q=function(){m=k;a=g/(1E3/m);1>a&&(m*=1/a,a=g/(1E3/m))};c.disableManualScroll=function(){h=!0;e.currentlyAutoScrolling&&c.disableScrollable()};c.enableManualScroll=function(){h=!1;e.currentlyAutoScrolling&&c.enableScrollable()};e.currentlyAutoScrolling=!1;e.autoScrollInterval="";h=e.disableManualScroll||!1;k=m=e.autoScrollRefresh||50;c.changeScrollSpeed(e.scrollSpeed||
10);b(window).on("keyup",function(a){a.shiftKey&&32===a.keyCode&&c.toggleScrolling()});if(!e.disableAutoscrollPrefs){var r=function(a){if(e.inFullscreen){a=b(e.selector+"tools");var c=a.css("right");f.jqObj.css({right:c,"margin-right":0,top:a.offset().top+a.outerHeight()+15})}else f.jqObj.css({right:b(window).width()-(e.outerObject.offset().left+e.outerObject.outerWidth())+e.scrollbarWidth,"margin-right":".6em"}),f.jqObj.offset({top:e.outerObject.offset().top+1})};diva.Events.subscribe("ModeDidSwitch",
r);diva.Events.subscribe("ViewerDidLoad",function(a){a="<div id='"+e.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+e.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+Math.log(g)/Math.log(10)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+e.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+
e.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";b("#"+e.ID+"page-nav").before("<div id='"+e.ID+"autoscroll-icon' class='button diva-autoscroll-icon' title='Expand autoscroll options'></div>");b("body").prepend(a);b("#"+e.ID+"autoscroll-pps").on("change",function(a){c.changeScrollSpeed(Math.pow(10,a.target.value))});b("#"+e.ID+"autoscroll-manual").on("change",function(a){a.target.checked?c.enableManualScroll():c.disableManualScroll()});
b("#"+e.ID+"autoscroll-toggle").on("click",c.toggleScrolling);b("#"+e.ID+"autoscroll-icon").on("click",function(a){f.jqObj=b("#"+e.ID+"autoscroll-prefs");"none"===f.jqObj.css("display")?(f.jqObj.css({display:"block"}),r(e.inFullscreen)):f.jqObj.css("display","none")})})}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"}}())})(jQuery);(function(b){window.divaPlugins.push(function(){var f={},e={},c={},a,h,m,k={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:0.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,onInit:null,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},g=function(b,c){var e=b.context,f=b.size/2,h=-(b.width/2),k=-(b.height/2);e.clearRect(0,0,b.size,b.size);e.save();e.translate(f,f);e.rotate(c*Math.PI/
180);e.drawImage(a,h,k,b.width,b.height);e.restore();b.data=e.getImageData(0,0,b.size,b.size)},q=function(){for(var a in h)if(h[a].current!==h[a].previous)return!0;return!1},r=function(){g(e,h.rotation.current);s(e)},p=function(){var a=h.rotation.current,e=h.zoom.current,k=h.zoom.previous;if(a!==h.rotation.previous||e!==k){var m=b("#diva-canvas-wrapper").scrollLeft(),l=b("#diva-canvas-wrapper").scrollTop(),n=c.viewport.width/2,p=c.viewport.height/2,m=m+n-f.centerX,r=-(l+p-f.centerY),I=(h.rotation.previous-
a)*Math.PI/180,l=Math.cos(I)*m-Math.sin(I)*r+f.centerX,m=-(Math.sin(I)*m+Math.cos(I)*r)+f.centerY,e=Math.pow(2,e-k),n=e*l-n,p=e*m-p;g(f,a);b("#diva-canvas-wrapper").scrollLeft(n);b("#diva-canvas-wrapper").scrollTop(p)}if(q()){s(f);for(var u in h)h[u].previous=h[u].current}},n=function(a){var b=h[a].current!==h[a].initial;return h[a].current!==h[a].previous||b},s=function(a){var b=a.data,e=a.context.createImageData(b),f=e.data,k,g;k=0;for(g=f.length;k<g;k++)f[k]=b.data[k];b=e.data;k=h.contrast.current;
f=(1+Math.min(c.brightnessMax,Math.max(c.brightnessMin,h.brightness.current))/c.brightnessMax)*k;k=128-128*k;g=h.red.current;var m=h.green.current,l=h.blue.current,p=n("red"),q=n("green"),r=n("blue"),s=n("brightness"),u=n("contrast"),s=s||u,A,w,x,y,z,B,C,u=0;for(w=e.width;u<w;u++)for(A=0,x=e.height;A<x;A++)y=4*(A*w+u),z=b[y],B=b[y+1],C=b[y+2],0<z+B+C&&(p&&z&&(z+=g),q&&B&&(B+=m),r&&C&&(C+=l),s&&(z&&(z=z*f+k),B&&(B=B*f+k),C&&(C=C*f+k)),b[y]=z,b[y+1]=B,b[y+2]=C);a.context.clearRect(0,0,w,x);a.context.putImageData(e,
0,0)},l=function(){var a=b("#diva-canvas-wrapper").scrollLeft()*e.scaleFactor,f=b("#diva-canvas-wrapper").scrollTop()*e.scaleFactor,h=Math.min(Math.round(c.viewport.height*e.scaleFactor),c.mapSize)-4,k=Math.min(Math.round(c.viewport.width*e.scaleFactor),c.mapSize)-4;b("#diva-map-viewbox").height(h).width(k).css({top:f,left:a})},J=function(h,k){a=new Image;a.crossOrigin="anonymous";a.onload=function(){f.size=Math.sqrt(a.width*a.width+a.height*a.height);f.canvas=document.getElementById("diva-canvas");
f.canvas.width=f.size;f.canvas.height=f.size;f.cornerX=(f.size-a.width)/2;f.cornerY=(f.size-a.height)/2;f.width=a.width;f.height=a.height;f.centerX=f.size/2;f.centerY=f.size/2;f.context=f.canvas.getContext("2d");f.context.drawImage(a,f.cornerX,f.cornerY,f.width,f.height);try{f.data=f.context.getImageData(0,0,f.size,f.size)}catch(h){var g='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+h.message+"</p>";if("SecurityError"!==h.name)throw h;g+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div></div>';
b("#diva-canvas-backdrop").append(g);y()}void 0===k&&(g=a,e.canvas=document.getElementById("diva-canvas-minimap"),e.size=c.mapSize,e.canvas.width=e.size,e.canvas.height=e.size,e.context=e.canvas.getContext("2d"),e.context.fillRect(0,0,e.size,e.size),e.scaleFactor=c.mapSize/f.size,e.cornerX=f.cornerX*e.scaleFactor,e.cornerY=f.cornerY*e.scaleFactor,e.width=g.width*e.scaleFactor,e.height=g.height*e.scaleFactor,e.context.drawImage(g,e.cornerX,e.cornerY,e.width,e.height),e.data=e.context.getImageData(0,
0,c.mapSize,c.mapSize),b("#diva-map-viewbox").show(),l());r();p(f);y();"function"===typeof k&&k.call(k)};a.src=h;if(a.complete||void 0===a.complete)a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.src=h},D=function(){var a=h[m],c=a.current,a=a.transform?a.transform(c):c;b("#diva-canvas-value").html(a)},w=function(){b("#diva-canvas-slider").val(h[m].current)},x=function(a){a=c.zoomWidthRatio*Math.pow(2,a);return c.proxyURL?c.proxyURL+"?f="+c.filename+"&w="+a:c.iipServerURL+
"?FIF="+(c.imageDir+"/")+c.filename+"&WID="+a+"&CVT=JPEG"},u=function(){(0<h.zoom.current||c.mobileWebkit)&&b(c.selector+"throbber").addClass("canvas-throbber").show()},y=function(){b(c.selector+"throbber").removeClass("canvas-throbber").hide()},A=function(){var a={},b=!1,e=c.localStoragePrefix+c.filename,f;for(f in h)h[f].previous!==h[f].initial&&(a[f]=h[f].previous,b=!0);b?(c.pluginIcon.addClass("new"),localStorage.setObject(e,a)):(c.pluginIcon.removeClass("new"),localStorage.removeItem(e))},z=
function(a,b){c.zoomLevel=a;var h=x(a);J(h,function(){e.scaleFactor=e.size/f.size;l();A()})},L=function(a){switch(a.keyCode){case 38:return b("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-c.arrowScrollAmount),!1;case 40:return b("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+c.arrowScrollAmount),!1;case 37:return b("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-c.arrowScrollAmount),
!1;case 39:return b("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+c.arrowScrollAmount),!1}};return{init:function(a,g){if(!window.HTMLCanvasElement)return!1;b.extend(c,k,a.canvasPlugin);c.inCanvas=!1;c.iipServerURL=a.iipServerURL;c.imageDir=a.imageDir;c.selector=a.selector;c.mobileWebkit=a.mobileWebkit;c.arrowScrollAmount=a.arrowScrollAmount;h={contrast:{initial:1,min:c.contrastMin,max:c.contrastMax,step:c.contrastStep,transform:function(a){return a.toFixed(2)},
title:"Change the contrast"},brightness:{initial:0,min:c.brightnessMin,max:c.brightnessMax,step:c.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(a){return a+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:c.rgbMin,
max:c.rgbMax,step:1,title:"Adjust the blue channel"}};var n=function(){var a,b,c;for(c in h)b=h[c],a=b.initial,b.current=a,b.previous=a};n();if(b("#diva-canvas-backdrop").length)return!0;var s=[],x,K,J;for(J in c.buttons)x=c.buttons[J],K=h[x].title,x='<div class="'+x+'" title="'+K+'"></div>',s.push(x);s='<div id="diva-canvas-backdrop">'+('<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+
s.join("")+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>')+'<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div></div>';
b("body").append(s);c.mapSize=b("#diva-canvas-minimap").width();b("#diva-canvas-buttons div").click(function(){b("#diva-canvas-buttons .clicked").removeClass("clicked");H(b(this).attr("class"))});var H=function(a){m=a;a=h[m];b("#diva-canvas-buttons ."+m).addClass("clicked");b("#diva-canvas-mode").text(m);var c=a.current,e=a.transform?a.transform(c):c,f=document.getElementById("diva-canvas-slider");f.min=a.min;f.max=a.max;f.step=a.step;b("#diva-canvas-slider").val(c);b("#diva-canvas-value").html(e)};
H("contrast");b("#diva-canvas-slider").on("input",function(a){h[m].current=parseFloat(this.value);D();r()});b("#diva-canvas-reset-all").click(function(){for(var a in h)h[a].current=h[a].initial;D();w();r()});b("#diva-canvas-reset").click(function(){h[m].current=h[m].initial;D();w();r()});b("#diva-canvas-apply").click(function(){q()&&(u(),setTimeout(function(){h.zoom.current!==h.zoom.previous?z(h.zoom.current):(p(),y(),A())},c.throbberTimeout))});b("#diva-canvas-close").click(function(){b("body").removeClass("overflow-hidden");
f.context.clearRect(0,0,f.size,f.size);e.context.clearRect(0,0,e.size,e.size);b("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0);b("#diva-canvas-backdrop").hide();b("#diva-map-viewbox").hide();y();g.enableScrollable();b(document).off("keydown",L);n();D();w();b("#diva-canvas-buttons .clicked").removeClass("clicked");H("contrast");diva.Events.publish("CanvasViewDidHide")});b("#diva-canvas-minimise").click(function(){b("#diva-canvas-toolwindow").slideToggle("fast")});b(window).resize(function(){c.viewport=
{height:window.innerHeight-a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};c.inCanvas&&l()});b("#diva-canvas-wrapper").scroll(function(){c.inCanvas&&l()});b("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(a){var f=b("#diva-canvas-minimap").offset(),h=(a.pageX-f.left)/e.scaleFactor;a=(a.pageY-f.top)/e.scaleFactor;b("#diva-canvas-wrapper").scrollTop(a-c.viewport.height/2);b("#diva-canvas-wrapper").scrollLeft(h-c.viewport.width/2)});b("#diva-canvas").mousedown(function(){b(this).addClass("grabbing")}).mouseup(function(){b(this).removeClass("grabbing")});
c.mobileWebkit?b("#diva-canvas-wrapper").kinetic():b("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0});"function"===typeof c.onInit&&c.onInit.call(this,c);return!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(a){c.viewport={height:window.innerHeight-a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};c.minZoomLevel=a.minZoomLevel;c.maxZoomLevel=a.maxZoomLevel;c.mobileWebkit&&(c.maxZoomLevel=Math.min(c.maxZoomLevel,
c.mobileWebkitMaxZoom));h.zoom.min=c.minZoomLevel;h.zoom.max=c.maxZoomLevel},handleClick:function(a,e,f){a=b(this).parent().parent();var k=b(a).attr("data-filename"),g=b(a).width()-1;e=e.zoomLevel;var l;c.zoomWidthRatio=g/Math.pow(2,e);c.pluginIcon=b(this);c.mobileWebkit&&(e=Math.min(c.maxZoomLevel,e));c.filename=k;h.zoom.initial=e;h.zoom.current=e;if(k=localStorage.getObject(c.localStoragePrefix+c.filename))for(l in k)h[l].current=k[l],l===m&&(D(),w()),"zoom"===l&&(e=k[l]);h.zoom.previous=e;b("body").addClass("overflow-hidden");
b("#diva-canvas-backdrop").show();f.disableScrollable();b(document).keydown(L);c.inCanvas=!0;f=x(e);b("#diva-canvas-info").text(b(a).attr("title"));u();diva.Events.publish("CanvasViewDidActivate",[a]);J(f)},onPageLoad:function(a,e,f){null!==localStorage.getItem(c.localStoragePrefix+e)&&b(f).find(".diva-canvas-icon").addClass("new")},destroy:function(a,c){b("#diva-canvas-backdrop").remove()}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){var f,e;return{init:function(b,a){f=b.iipServerURL;e=b.imageDir;return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(c){var a=b(this).parent().parent();c=b(a).attr("data-filename");a=b(a).width()-1;window.open(f+"?FIF="+(e+"/")+c+"&WID="+a+"&CVT=JPEG")}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){return{init:function(b,e){function c(a,c,m){var k=b.parentObject.data("highlights");if("undefined"!==typeof k){if(k.hasOwnProperty(a)){var g=e.getInstanceId()+"page-"+a,g=document.getElementById(g),q=k[a].regions,r=k[a].colour,k=k[a].divClass,p=e.getMaxZoomLevel();b.inGrid?(p=e.getPageDimensionsAtZoomLevel(a,p).width,p=Math.log(p/g.clientWidth)/Math.log(2)):p-=e.getZoomLevel();for(var n=q.length;n--;){var s=document.createElement("div");s.style.width=
q[n].width/Math.pow(2,p)+"px";s.style.height=q[n].height/Math.pow(2,p)+"px";s.style.top=q[n].uly/Math.pow(2,p)+"px";s.style.left=q[n].ulx/Math.pow(2,p)+"px";s.style.background=r;s.style.border="1px solid #555";s.style.position="absolute";s.style.zIndex=100;s.className=k;"undefined"!==typeof q[n].divID&&(s.id=q[n].divID);g.appendChild(s)}}diva.Events.publish("HighlightCompleted",[a,c,m])}}b.parentObject.data("highlights",{});diva.Events.subscribe("PageWillLoad",c);e.resetHighlights=function(){for(var a=
document.getElementById(b.ID+"inner").getElementsByClassName(b.ID+"highlight"),c=a.length;c--;)a[c].parentNode.removeChild(a[c]);b.parentObject.data("highlights",{})};e.removeHighlightsOnPage=function(a){var c=b.parentObject.data("highlights");if(c.hasOwnProperty(a)){for(var m=e.getInstanceId()+"page-"+a,m=document.getElementById(m),k=m.getElementsByTagName("div"),g=c[a].divClass,q=k.length;q--;)k[q].className===g&&m.removeChild(k[q]);delete c[a]}};e.highlightOnPages=function(a,b,c,f){for(var g=a.length;g--;)e.highlightOnPage(a[g],
b[g],c,f)};e.highlightOnPage=function(a,h,m,k){"undefined"===typeof m&&(m="rgba(255, 0, 0, 0.2)");k="undefined"===typeof k?b.ID+"highlight":b.ID+"highlight "+k;e.getMaxZoomLevel();b.parentObject.data("highlights")[a]={regions:h,colour:m,divClass:k};e.isPageInDOM(a)&&c(a,null,null);return!0};e.gotoHighlight=function(a){var c,m,k,g=b.parentObject.data("highlights"),q=!1;if(null!==document.getElementById(a)){c=parseInt(document.getElementById(a).parentNode.getAttribute("data-index"),10);for(var r=g[c].regions.length;r--;)if(g[c].regions[r].divID===
a){m=g[c].regions[r];k=parseFloat(m.uly)+parseFloat(m.height)/2;m=parseFloat(m.ulx)+parseFloat(m.width)/2;q=!0;break}}else for(var r=Object.keys(g),p=r.length;p--;){for(var n=g[r[p]].regions,s=n.length;s--;)if(n[s].divID===a){c=r[p];m=n[s];k=parseFloat(m.uly)+parseFloat(m.height)/2;m=parseFloat(m.ulx)+parseFloat(m.width)/2;q=!0;break}if(q)break}if(!q)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;g=e.getSettings().outerObject;k=e.translateFromMaxZoomLevel(k);m=e.translateFromMaxZoomLevel(m);
e.gotoPageByIndex(c);c=g.scrollTop()+k-g.height()/2+b.verticalPadding;k=g.scrollLeft()+m-g.width()/2+b.horizontalPadding;g.scrollTop(c);g.scrollLeft(k);b.currentHighlight=a;return!0};return!0},destroy:function(b,e){b.parentObject.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"}}())})(jQuery);(function(b){window.divaPlugins.push(function(){return{init:function(f,e){function c(a,b,c){var g=f.parentObject.data("highlights");if("undefined"!==typeof g){if(g.hasOwnProperty(a)){var q=e.getInstanceId()+"page-"+a,q=document.getElementById(q),r=g[a].regions,p=g[a].colour,g=g[a].divClass,n=e.getMaxZoomLevel();f.inGrid?(n=e.getPageDimensionsAtZoomLevel(a,n).width,n=Math.log(n/q.clientWidth)/Math.log(2)):n-=e.getZoomLevel();for(var s=r.length;s--;){var l=document.createElement("div");l.style.width=
r[s].width/Math.pow(2,n)+"px";l.style.height=r[s].height/Math.pow(2,n)+"px";l.style.top=r[s].uly/Math.pow(2,n)+"px";l.style.left=r[s].ulx/Math.pow(2,n)+"px";l.style.background=p;l.style.border="1px solid #555";l.style.position="absolute";l.style.zIndex=100;l.className=g;"undefined"!==typeof r[s].name&&l.setAttribute("data-name",r[s].name);"undefined"!==typeof r[s].divID&&(l.id=r[s].divID);q.appendChild(l)}}diva.Events.publish("HighlightCompleted",[a,b,c])}}f.parentObject.data("highlights",{});diva.Events.subscribe("PageWillLoad",
c);e.resetHighlights=function(){for(var a=document.getElementById(f.ID+"inner").getElementsByClassName(f.ID+"highlight"),b=a.length;b--;)a[b].parentNode.removeChild(a[b]);f.parentObject.data("highlights",{})};e.removeHighlightsOnPage=function(a){var b=f.parentObject.data("highlights");if(b.hasOwnProperty(a)){for(var c=e.getInstanceId()+"page-"+a,c=document.getElementById(c),g=c.getElementsByTagName("div"),q=b[a].divClass,r=g.length;r--;)g[r].className===q&&c.removeChild(g[r]);delete b[a]}};e.highlightOnPages=
function(a,b,c,f){for(var q=a.length;q--;)e.highlightOnPage(a[q],b[q],c,f)};e.highlightOnPage=function(a,b,k,g){"undefined"===typeof k&&(k="rgba(255, 0, 0, 0.1)");g="undefined"===typeof g?f.ID+"highlight":f.ID+"highlight "+g;e.getMaxZoomLevel();f.parentObject.data("highlights")[a]={regions:b,colour:k,divClass:g};e.isPageInDOM(a)&&c(a,null,null);return!0};e.gotoHighlight=function(a){var b,c,g,q=f.parentObject.data("highlights"),r=!1;if(null!==document.getElementById(a)){b=parseInt(document.getElementById(a).parentNode.getAttribute("data-index"),
10);for(var p=q[b].regions.length;p--;)if(q[b].regions[p].divID===a){c=q[b].regions[p];g=parseFloat(c.uly)+parseFloat(c.height)/2;c=parseFloat(c.ulx)+parseFloat(c.width)/2;r=!0;break}}else for(var p=Object.keys(q),n=p.length;n--;){for(var s=q[p[n]].regions,l=s.length;l--;)if(s[l].divID===a){b=p[n];c=s[l];g=parseFloat(c.uly)+parseFloat(c.height)/2;c=parseFloat(c.ulx)+parseFloat(c.width)/2;r=!0;break}if(r)break}if(!r)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;
q=e.getSettings().outerObject;g=e.translateFromMaxZoomLevel(g);c=e.translateFromMaxZoomLevel(c);e.gotoPageByIndex(b);b=q.scrollTop()+g-q.height()/2+f.verticalPadding;g=q.scrollLeft()+c-q.width()/2+f.horizontalPadding;q.scrollTop(b);q.scrollLeft(g);f.currentHighlight=a;return!0};diva.Events.subscribe("ManifestDidLoad",function(a){a=a.sequences[0].canvases;for(var c={},f=[],g=[],q=0,r,p,n,s=[],l=0,J=a.length;l<J;l++)if(a[l].hasOwnProperty("otherContent"))for(var D=a[l].otherContent,w=0;w<D.length;w++)"sc:AnnotationList"===
D[w]["@type"]&&(g.push(b.ajax({url:D[w]["@id"],cache:!0,dataType:"json"})),g[q].canvasIndex=l,q++);b.when.apply(b,g).then(function(){for(l=0;l<arguments.length;l++){r=arguments[l];f=r[0];p=f.length;n=r[2].canvasIndex;c[n]=[];for(var a=0;a<p;a++)c[n].push(f[a])}for(var b in c)if(c.hasOwnProperty(b)){s=[];n=parseInt(b,10);a=c[n];p=a.length;for(var h=0;h<p;h++){var g=a[h],q=g.resource.chars,g=g.on,g=g.slice(g.indexOf("#xywh=")+6).split(","),q={ulx:parseInt(g[0],10),uly:parseInt(g[1],10),width:parseInt(g[2],
10),height:parseInt(g[3],10),name:q};s.push(q)}e.highlightOnPage(n,s)}}).fail(function(){console.log("ajax error")})});var a=[];f.innerObject.on("mouseenter","."+f.ID+"highlight",function(b){b=b.target;var c=b.dataset.name,e=document.createElement("div");e.style.top=b.offsetTop+b.offsetHeight-1+"px";e.style.left=b.style.left;e.style.background="#fff";e.style.border="1px solid #555";e.style.position="absolute";e.style.zIndex=101;e.className="annotation-overlay";e.textContent=c;b.parentNode.appendChild(e);
a.push(e)});f.innerObject.on("mouseleave","."+f.ID+"highlight",function(b){for(;a.length;)b=a.pop(),b.parentNode.removeChild(b)});return!0},destroy:function(b,e){b.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"}}())})(jQuery);(function(b){window.divaPlugins.push(function(){return{init:function(f,e){diva.Events.subscribe("ManifestDidLoad",function(c){var a=function(a,b){var c=(a.charAt(0).toUpperCase()+a.slice(1)).replace("_"," ");0===b.indexOf("http://")&&(b='<a href="'+b+'" target="_blank">'+b+"</a>");return'<div class="metadata-row"><span class="metadata-label">'+c+':</span> <span class="metadata-value">'+b+"</span></div>"},e=function(a,b){for(var c=0;c<a.length;c++)if(a[c]["@language"]===b)return a[c]["@value"]},m=
function(b){for(var f="",g=0;g<b.length;g++){var k=b[g];if(c.hasOwnProperty(k))if(c[k].constructor===Array)var m=e(c[k],"en"),f=f+a(k,m);else f+=a(k,c[k])}return f},k='<div id="'+f.ID+'metadata" class="diva-modal">',k=k+m(["label"]);if(c.hasOwnProperty("metadata"))for(var g=c.metadata,q=0;q<g.length;q++)if(g[q].value.constructor===Array)var r=e(g[q].value,"en"),k=k+a(g[q].label,r);else k+=a(g[q].label,g[q].value);k+=m("description within see_also service license attribution".split(" "));f.parentObject.prepend(k+
"</div>");b(f.selector+"metadata").hide()});f.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+f.ID+'metadata-link" class="diva-metadata-link">Details</a></div>');b(f.selector+"metadata-link").on("click",function(c){b(f.selector+"metadata").fadeToggle("fast")});return!0},destroy:function(b,e){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"}}())})(jQuery);(function(b){window.divaPlugins.push(function(){return{init:function(b,e){void 0===b.pageAliases&&(b.pageAliases={});void 0===b.pageAliasFunction&&(b.pageAliasFunction=function(){return!1});e.getAliasForPageIndex=function(c){return b.pageAliases[c]||b.pageAliasFunction(c)||c+1};e.getPageIndexForAlias=function(c){for(var a=0;a<b.numPages;a++)if(e.getAliasForPageIndex(a)==c)return a;return!1};e.getPageIndicesForAlias=function(c){for(var a=[],h=0;h<b.numPages;h++)e.getAliasForPageIndex(h)==c&&a.push(h);
return a};e.getCurrentAliasedPageIndex=function(){return e.getAliasForPageIndex(b.currentPageIndex)};e.gotoPageByAliasedNumber=function(b,a,f){return e.gotoPageByIndex(e.getPageIndexForAlias(b),a,f)};updateCurrentAliasedPage=function(){document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex()};initialChanges=function(){var b=this.getSettings(),a=b.numPages;void 0!==b.newTotalPages?a=b.newTotalPages:void 0!==b.totalPageOffset&&(a+=b.totalPageOffset);
document.getElementById(this.getSettings().ID+"num-pages").textContent=a;document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex();diva.Events.unsubscribe(["VisiblePageDidChange",b.toolbar.updateCurrentPage]);diva.Events.subscribe("VisiblePageDidChange",updateCurrentAliasedPage)};diva.Events.subscribe("ViewerDidLoad",initialChanges)},pluginName:"pagealias",titleText:"Re-aliases page indexes"}}())})(jQuery);
