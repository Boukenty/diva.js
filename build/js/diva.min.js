Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},function(e){var t=1;e.generateId=function(e){var i;do i=t++ +(e?"-"+e:"");while(document.getElementById(i));return i}}(jQuery),function(e){e.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return i==n&&(n=t.clientWidth),document.body.removeChild(t),i-n}}(jQuery),function(e){e.getHashParam=function(e){var t=window.location.hash;if(""!==t){var i=t.indexOf(t.indexOf("&"+e+"=")>0?"&"+e+"=":"#"+e+"=");if(i>=0){i+=e.length+2;var n=t.indexOf("&",i);return n>i?t.substring(i,n):0>n?t.substring(i):""}return!1}return!1}}(jQuery),function(e){e.updateHashParam=function(t,i){var n=e.getHashParam(t),a=window.location.hash;if(n!==i)if("string"==typeof n){var o=a.indexOf(a.indexOf("&"+t+"=")>0?"&"+t+"=":"#"+t+"="),r=o+t.length+2+n.length,l=0===o?"#":"&";window.location.replace(a.substring(0,o)+l+t+"="+i+a.substring(r))}else window.location.replace(0===a.length?"#"+t+"="+i:a+"&"+t+"="+i)}}(jQuery),function(e){e.fn.dragscrollable=function(t){var i=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),n={mouseDownHandler:function(t){return 1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this?!1:(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",n.mouseUpHandler,t.data),e.event.add(document,"mousemove",n.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t={left:e.clientX-e.data.lastCoord.left,top:e.clientY-e.data.lastCoord.top};return e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t.left),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-t.top),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault?(e.preventDefault(),!1):void 0},mouseUpHandler:function(t){return e.event.remove(document,"mousemove",n.mouseMoveHandler),e.event.remove(document,"mouseup",n.mouseUpHandler),t.data.preventDefault?(t.preventDefault(),!1):void 0}};this.each(function(){var t={scrollable:e(this),acceptPropagatedEvent:i.acceptPropagatedEvent,preventDefault:i.preventDefault};e(this).find(i.dragSelector).bind("mousedown",t,n.mouseDownHandler)})}}(jQuery),function(e){"use strict";var t={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i="kinetic-settings",n="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var a=function(){return!1},o=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},r=function(e,t){var i=e;return e>0?e>t&&(i=t):0-t>e&&(i=0-t),i},l=function(e,t){this.removeClass(e.movingClass.up).removeClass(e.movingClass.down).removeClass(e.movingClass.left).removeClass(e.movingClass.right).removeClass(e.deceleratingClass.up).removeClass(e.deceleratingClass.down).removeClass(e.deceleratingClass.left).removeClass(e.deceleratingClass.right),e.velocity>0&&this.addClass(t.right),e.velocity<0&&this.addClass(t.left),e.velocityY>0&&this.addClass(t.down),e.velocityY<0&&this.addClass(t.up)},s=function(e,t){t.velocity=0,t.velocityY=0,t.decelerate=!0,"function"==typeof t.stopped&&t.stopped.call(e,t)},d=function(e,t){var i=e[0];t.x&&i.scrollWidth>0?(i.scrollLeft=t.scrollLeft=i.scrollLeft+t.velocity,Math.abs(t.velocity)>0&&(t.velocity=t.decelerate?o(t.velocity,t.slowdown):t.velocity)):t.velocity=0,t.y&&i.scrollHeight>0?(i.scrollTop=t.scrollTop=i.scrollTop+t.velocityY,Math.abs(t.velocityY)>0&&(t.velocityY=t.decelerate?o(t.velocityY,t.slowdown):t.velocityY)):t.velocityY=0,l.call(e,t,t.deceleratingClass),"function"==typeof t.moved&&t.moved.call(e,t),Math.abs(t.velocity)>0||Math.abs(t.velocityY)>0?window.requestAnimationFrame(function(){d(e,t)}):s(e,t)},c=function(t,n){var a=e.kinetic.callMethods[t],o=Array.prototype.slice.call(arguments);a&&this.each(function(){var t=o.slice(1),n=e(this).data(i);t.unshift(n),a.apply(this,t)})},u=function(t,i){t[0];e.support.touch?t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove):t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",a).bind("dragstart",i.events.dragStart)},g=function(t,i){t[0];e.support.touch?t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove):t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove).unbind("scroll",i.events.scroll),t.unbind("click",i.events.inputClick).unbind("selectstart",a),t.unbind("dragstart",i.events.dragStart)},v=function(a){this.addClass(n).each(function(){var n=this,o=e(this);if(!o.data(i)){var s,c,g,v,h=e.extend({},t,a),p=!1,f=!1,m=!1,b=1e3/h.throttleFPS;h.velocity=0,h.velocityY=0;var w=function(){s=!1,c=!1,m=!1};e(document).mouseup(w).click(w);var I=function(){h.velocity=r(p-s,h.maxvelocity),h.velocityY=r(f-c,h.maxvelocity)},y=function(t){return e.isFunction(h.filterTarget)?h.filterTarget.call(n,t)!==!1:!0},x=function(e,t){m=!0,h.velocity=p=0,h.velocityY=f=0,s=e,c=t},P=function(){s&&p&&h.decelerate===!1&&(h.decelerate=!0,I(),s=p=m=!1,d(o,h))},D=function(t,i){(!g||new Date>new Date(g.getTime()+b))&&(g=new Date,m&&(s||c)&&(v&&(e(v).blur(),v=null,o.focus()),h.decelerate=!1,h.velocity=h.velocityY=0,o[0].scrollLeft=h.scrollLeft=h.x?o[0].scrollLeft-(t-s):o[0].scrollLeft,o[0].scrollTop=h.scrollTop=h.y?o[0].scrollTop-(i-c):o[0].scrollTop,p=s,f=c,s=t,c=i,I(),l.call(o,h,h.movingClass),"function"==typeof h.moved&&h.moved.call(o,h)))};h.events={touchStart:function(e){var t;y(e.target)&&(t=e.originalEvent.touches[0],x(t.clientX,t.clientY),e.stopPropagation())},touchMove:function(e){var t;m&&(t=e.originalEvent.touches[0],D(t.clientX,t.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){y(e.target)&&(x(e.clientX,e.clientY),v=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){P(),v=null,e.preventDefault&&e.preventDefault()},inputMove:function(e){m&&(D(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(e){"function"==typeof h.moved&&h.moved.call(o,h),e.preventDefault&&e.preventDefault()},inputClick:function(e){return Math.abs(h.velocity)>0?(e.preventDefault(),!1):void 0},dragStart:function(e){return v?!1:void 0}},u(o,h),o.data(i,h).css("cursor",h.cursor),h.triggerHardware&&o.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};e.kinetic={settingsKey:i,callMethods:{start:function(t,i){var n=e(this);t=e.extend(t,i),t&&(t.decelerate=!1,d(n,t))},end:function(t,i){e(this);t&&(t.decelerate=!0)},stop:function(t,i){var n=e(this);s(n,t)},detach:function(t,i){var a=e(this);g(a,t),a.removeClass(n).css("cursor","")},attach:function(t,i){var a=e(this);u(a,t),a.addClass(n).css("cursor","move")}}},e.fn.kinetic=function(e){return"string"==typeof e?c.apply(this,arguments):v.call(this,e),this}}(window.jQuery||window.Zepto);var diva=function(){var e={},t={Events:{publish:function(t,i,n){if(e[t])for(var a=e[t],o=a.length;o--;)a[o].apply(n||this,i||[])},subscribe:function(t,i){return e[t]||(e[t]=[]),e[t].push(i),[t,i]},unsubscribe:function(t,i){var n=t[0];if(e[n])for(var a=e[n].length;a--;)if(e[n][a]===t[1])return e[n].splice(a,1),i&&delete e[n],!0;return!1},unsubscribeAll:function(){e={}}}};return t}(),activeDivaController=function(){var e;$(document).on("click",function(e){t($(e.target))});var t=function(t){var i,n,a=t.find(".diva-outer"),o=t.closest(".diva-outer"),r=document.getElementsByClassName("diva-outer"),l=r.length;if(a.length>0)i=a;else{if(!(o.length>0)){for(n=0;l>n;n++)$(r[n].parentElement).data("diva").deactivate();return}i=o}for(i.parent().data("diva").activate(),e=i.parent(),r=document.getElementsByClassName("diva-outer"),n=0;l>n;n++)r[n].getAttribute("id")!=i.attr("id")&&$(r[n].parentElement).data("diva").deactivate()};this.getActive=function(){return e}},activeDiva=new activeDivaController;window.divaPlugins=[],function(e){var t=function(t,n){var a={adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inBookLayout:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,onDocumentLoaded:null,onModeToggle:null,onViewToggle:null,onJump:null,onPageLoad:null,onPageLoaded:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onSetCurrentPage:null,onZoom:null,onZoomIn:null,onZoomOut:null,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:n.parentObject,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},o=e.extend({},a,n),r={allTilesLoaded:[],averageHeights:[],averageWidths:[],currentPageIndex:0,divaIsFullWindow:!1,doubleClickZoom:!1,documentPaged:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerObject:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerObject:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0};e.extend(o,r);var l=this,s=function(e){var t=!0;return function(e){var i,n,a;if("function"==typeof e){for(i=[],n=1,a=arguments.length;a>n;n++)i.push(arguments[n]);return t&&(console.warn('The use of callback functions is deprecated. Use diva.Events.subscribe("Event", function) instead.'),t=!1),e.apply(l,i),!0}return!1}}(),d=function(e,t){return o.pages[e].d[o.zoomLevel][t]},c=function(e){var t,i=o.numPages;for(t=0;i>t;t++)if(o.pages[t].f===e)return t;return-1},u=function(e,t){var i=o.outerObject.scrollLeft()-o.viewportMargin,n=i+o.panelWidth+2*o.viewportMargin,a=e>=i&&n>=e,r=i>=e&&t>=n,l=t>=i&&n>=t;return a||r||l},g=function(e,t){var i=o.outerObject.scrollTop()-o.viewportMargin,n=i+o.panelHeight+2*o.viewportMargin,a=e>=i&&n>=e,r=i>=e&&t>=n,l=t>=i&&n>=t;return a||r||l},v=function(e,t,i){var n,a;o.verticallyOriented?(n=o.pageTopOffsets[e]+t*o.tileHeight+o.verticalPadding,a=o.pageLeftOffsets[e]+i*o.tileWidth):(n=o.pageTopOffsets[e]+t*o.tileHeight,a=o.pageLeftOffsets[e]+i*o.tileWidth+o.horizontalPadding);var r=n+o.tileHeight,l=a+o.tileWidth;return g(n,r)&&u(a,l)},h=function(e,t){return!!document.getElementById(o.ID+"tile-"+e+"-"+t)},p=function(e){return e>=0&&e<o.numPages},f=function(e){var t=o.pageTopOffsets[e],i=t+d(e,"h")+o.verticalPadding,n=o.pageLeftOffsets[e],a=n+d(e,"w")+o.horizontalPadding;return g(t,i)&&u(n,a)},m=function(e){return!!document.getElementById(o.ID+"page-"+e)},b=function(e){if(!m(e)||!o.allTilesLoaded[e]){var t,i=o.pages[e].f,n=d(e,"w"),a=d(e,"h"),r=o.pageTopOffsets[e]+o.verticalPadding,c=o.pageLeftOffsets[e]+o.horizontalPadding,u=o.selector+"page-"+e;if(!m(e)){var g=document.getElementById(o.ID+"inner"),p=document.createElement("div");p.id=o.ID+"page-"+e,p.classList.add("diva-page","diva-document-page"),p.setAttribute("data-index",e),p.setAttribute("data-filename",i),o.enableImageTitles&&(p.title="Page "+(e+1)),p.innerHTML=o.pageTools,p.style.width=n+"px",p.style.height=a+"px",o.verticallyOriented?(p.style.top=r+"px",o.inBookLayout?(p.style.left=c+"px",p.classList.add(e%2?"diva-page-book-left":"diva-page-book")):p.classList.add("diva-page-vertical")):(p.style.left=c+"px",p.classList.add("diva-page-horizontal")),g.appendChild(p),s(o.onPageLoad,e,i,u),diva.Events.publish("PageWillLoad",[e,i,u],l);for(t in o.plugins)s(o.plugins[t].onPageLoad,e,i,u)}var b=function(e){var t=document.getElementById(o.ID+"page-"+e);if(null!==t&&f(e)){var r,c,g,p,m,b,w,I,y,x,P=o.imageDir+"/",D=Math.ceil(d(e,"h")/o.tileWidth),L=Math.ceil(d(e,"w")/o.tileHeight),O=o.pages[e].m,C=o.iipServerURL+"?FIF="+P+i+"&JTL=",T=!0,S=0,E=a-(D-1)*o.tileHeight,z=n-(L-1)*o.tileWidth;w=o.zoomLevel+O-o.realMaxZoom;var k=o.isIIIF?o.pages[e].url:C+w+",";if(o.isIIIF){var j=Math.pow(2,O-w);y=o.tileHeight*j,x=o.tileWidth*j;var M=o.pages[e].api,H=M>=2?"default":"native",A="/0/"+H+".jpg"}else y=o.tileHeight,x=o.tileWidth;for(r=0;D>r;){for(c=0,g=r===D-1?E:o.tileHeight;L>c;){if(m=r*o.tileHeight,b=c*o.tileWidth,p=c===L-1?z:o.tileWidth,I=o.isIIIF?k+c*x+","+r*y+","+p*j+","+g*j+"/"+p+","+A:k+S,!h(e,S))if(v(e,r,c)){var F=document.createElement("div");F.id=o.ID+"tile-"+e+"-"+S,F.classList.add("diva-document-tile"),F.style.display="inline",F.style.position="absolute",F.style.top=m+"px",F.style.left=b+"px",F.style.backgroundImage="url('"+I+"')",F.style.height=g+"px",F.style.width=p+"px",t.appendChild(F)}else T=!1;S++,c++}r++}o.allTilesLoaded[e]=T,s(o.onPageLoaded,e,i,u),diva.Events.publish("PageDidLoad",[e,i,u],l)}};o.pageTimeouts.push(setTimeout(b,o.pageLoadTimeout,e))}},w=function(e){var t=document.getElementById(o.ID+"page-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},I=function(e){var t=o.pageTopOffsets[e]+d(e,"h")+o.verticalPadding,i=document.getElementById(o.ID+"outer").scrollTop;return i>t},y=function(e){var t=o.pageTopOffsets[e],i=document.getElementById(o.ID+"outer").scrollTop+o.panelHeight;return t>i},x=function(e){var t=o.pageLeftOffsets[e]+d(e,"w")+o.horizontalPadding,i=document.getElementById(o.ID+"outer").scrollLeft;return i>t},P=function(e){var t=o.pageLeftOffsets[e],i=document.getElementById(o.ID+"outer").scrollLeft+o.panelWidth;return t>i},D=function(e){return o.verticallyOriented?I(e):x(e)},L=function(e){return o.verticallyOriented?y(e):P(e)},O=function(e,t){t>0?p(e)&&(f(e)?(b(e),o.lastPageLoaded=e,O(o.lastPageLoaded+1,t)):D(e)&&O(e+1,t)):p(e)&&(f(e)?(b(e),o.firstPageLoaded=e,O(o.firstPageLoaded-1,t)):L(e)&&O(e-1,t))},C=function(e,t){t>0?p(e)&&D(e)&&(w(e),o.firstPageLoaded=e+1,C(o.firstPageLoaded,t)):p(e)&&L(e)&&(w(e),o.lastPageLoaded=e-1,C(o.lastPageLoaded,t))},T=function(e){var t;if(0>e)O(o.lastPageLoaded,e),B(-1),C(o.lastPageLoaded,e);else if(e>0)O(o.firstPageLoaded,e),B(1),C(o.firstPageLoaded,e);else{var i=o.lastPageLoaded;for(t=Math.max(o.firstPageLoaded,0);i>=t;t++)f(t)&&b(t)}var n=o.verticallyOriented?document.getElementById(o.ID+"outer").scrollTop:document.getElementById(o.ID+"outer").scrollLeft;s(o.onScroll,n),diva.Events.publish("ViewerDidScroll",[n],l),e>0?(s(o.onScrollDown,n),diva.Events.publish("ViewerDidScrollDown",[n],l)):0>e&&(s(o.onScrollUp,n),diva.Events.publish("ViewerDidScrollUp",[n],l))},S=function(e){return e>=0&&e<o.numRows},E=function(e){var t=o.rowHeight*e,i=t+o.rowHeight+o.fixedPadding;return g(t,i)},z=function(e){return!!document.getElementById(o.ID+"row-"+e)},k=function(e){if(!z(e)){var t=o.rowHeight*e+o.fixedPadding,i=document.getElementById(o.ID+"inner"),n=document.createElement("div");n.id=o.ID+"row-"+e,n.classList.add("diva-row"),n.style.height=o.rowHeight+"px",n.style.top=t+"px",i.appendChild(n);var a,r,s,c,u,g,v,h,f,m,b,w,I=o.imageDir+"/",y=o.pagesPerRow;for(a=0;y>a&&(r=e*o.pagesPerRow+a,p(r));a++){s=o.pages[r].f,c=d(r,"w"),u=d(r,"h"),g=o.fixedHeightGrid?(o.rowHeight-o.fixedPadding)*c/u:o.gridPageWidth,v=o.fixedHeightGrid?o.rowHeight-o.fixedPadding:g/c*u,h=parseInt(a*(o.fixedPadding+o.gridPageWidth)+o.fixedPadding,10),m=o.pages[r].api,b=m>=2?"default":"native",w=",/0/"+b+".jpg",g=parseInt(g,10),v=parseInt(v,10),h+=o.fixedHeightGrid?(o.gridPageWidth-g)/2:0,f=encodeURI(o.isIIIF?o.pages[r].url+"full/"+g+w:o.iipServerURL+"?FIF="+I+s+"&HEI="+(v+2)+"&CVT=JPEG"),o.pageTopOffsets[r]=t,o.pageLeftOffsets[r]=h;var x=document.createElement("div");x.id=o.ID+"page-"+r;var P=o.selector+"page-"+r;x.classList.add("diva-page","diva-grid-page"),x.style.width=g+"px",x.style.height=v+"px",x.style.left=h+"px",x.setAttribute("data-index",r),x.setAttribute("data-filename",s),o.enableImageTitles&&(x.title="Page "+(r+1)),n.appendChild(x),diva.Events.publish("PageWillLoad",[r,s,P],l),Z(e,r,f,g,v)}}},j=function(e){var t=document.getElementById(o.ID+"row-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},M=function(e){var t=o.rowHeight*(e+1),i=document.getElementById(o.ID+"outer").scrollTop;return i>t},H=function(e){var t=o.rowHeight*e,i=document.getElementById(o.ID+"outer").scrollTop+o.panelHeight;return t>i},A=function(e,t){t>0?S(e)&&(E(e)?(k(e),o.lastRowLoaded=e,A(o.lastRowLoaded+1,t)):M(e)&&A(e+1,t)):S(e)&&(E(e)?(k(e),o.firstRowLoaded=e,A(o.firstRowLoaded-1,t)):H(e)&&A(e-1,t))},F=function(e,t){t>0?S(e)&&M(e)&&(j(e),o.firstRowLoaded++,F(o.firstRowLoaded,t)):S(e)&&H(e)&&(j(e),o.lastRowLoaded--,F(o.lastRowLoaded,t))},R=function(e){0>e?(A(o.firstRowLoaded,-1),W(-1),F(o.lastRowLoaded,-1)):e>0&&(A(o.lastRowLoaded,1),W(1),F(o.firstRowLoaded,1));var t=document.getElementById(o.ID+"outer").scrollTop;s(o.onScroll,t),diva.Events.publish("ViewerDidScroll",[t],l),e>0?(s(o.onScrollDown,t),diva.Events.publish("ViewerDidScrollDown",[t],l)):0>e&&(s(o.onScrollUp,t),diva.Events.publish("ViewerDidScrollUp",[t],l))},Z=function(e,t,i,n,a){var r=function(e,t,i,n,a){if(m(t)){var r=document.createElement("img");r.src=i,r.style.width=n+"px",r.style.height=a+"px",document.getElementById(o.ID+"page-"+t).appendChild(r)}};o.pageTimeouts.push(window.setTimeout(r,o.rowLoadTimeout,e,t,i,n,a))},B=function(e){var t=o.currentPageIndex,i=t+e;if(!p(i))return!1;{var n=o.verticallyOriented?document.getElementById(o.ID+"outer").scrollTop+o.panelHeight/2:document.getElementById(o.ID+"outer").scrollLeft+o.panelWidth/2,a=!1;o.selector+"page-"+i}if(0>e?o.verticallyOriented?i>=0&&o.pageTopOffsets[i]+d(i,"h")+o.verticalPadding>=n&&(a=!0):i>=0&&o.pageLeftOffsets[i]+d(i,"w")+o.horizontalPadding>=n&&(a=!0):e>0&&(o.verticallyOriented?o.pageTopOffsets[t]+d(t,"h")+o.verticalPadding<n&&(a=!0):o.pageLeftOffsets[t]+d(t,"w")+o.horizontalPadding<n&&(a=!0)),a){if(o.currentPageIndex=i,0!==e&&!B(e)){var r=o.pages[i].f;s(o.onSetCurrentPage,i,r),diva.Events.publish("VisiblePageDidChange",[i,r],l)}return!0}return!1},W=function(e){var t=Math.floor(o.currentPageIndex/o.pagesPerRow),i=t+parseInt(e,10),n=document.getElementById(o.ID+"outer").scrollTop,a=n+o.panelHeight/2,r=!1;if(0>e?i>=0&&(o.rowHeight*t>=a||o.rowHeight*i>=n)&&(r=!0):e>0&&o.rowHeight*(t+1)<n&&S(i)&&(r=!0),r){if(o.currentPageIndex=i*o.pagesPerRow,0!==e&&!W(e)){var s=o.currentPageIndex,d=o.pages[s].f;diva.Events.publish("VisiblePageDidChange",[s,d],l)}return!0}return!1},G=function(e){var t=ce(e,"top"),i=ue(e,"center");N(e,t,i)},N=function(e,t,i){i="undefined"!=typeof i?i:0,t="undefined"!=typeof t?t:0;var n=o.pageTopOffsets[e]+t,a=n-parseInt(o.panelHeight/2,10),r=o.pageLeftOffsets[e]+i,d=r-parseInt(o.panelWidth/2,10);if(o.outerObject.scrollTop(a),o.outerObject.scrollLeft(d),e!==o.currentPageIndex){o.currentPageIndex=e;var c=o.pages[e].f;s(o.onSetCurrentPage,e,c),diva.Events.publish("VisiblePageDidChange",[e,c],l)}s(o.onJump,e),diva.Events.publish("ViewerDidJump",[e],l)},V=function(e){var t=Math.floor(e/o.pagesPerRow),i=t*o.rowHeight;o.outerObject.scrollTop(i),o.currentPageIndex=e;var n=o.pages[e].f;diva.Events.publish("VisiblePageDidChange",[e,n],l)},Y=function(){V(o.goDirectlyTo)},_=function(e){return e>=o.minZoomLevel&&e<=o.maxZoomLevel?e:o.minZoomLevel},X=function(e){return e>=o.minPagesPerRow&&e<=o.maxPagesPerRow?e:o.maxPagesPerRow},U=function(){for(o.allTilesLoaded=[],o.outerObject.scrollTop(0),o.innerObject.empty(),o.firstPageLoaded=0,o.firstRowLoaded=-1,o.previousTopScroll=0,o.previousLeftScroll=0,clearTimeout(o.resizeTimer);o.pageTimeouts.length;)clearTimeout(o.pageTimeouts.pop())},q=function(){o.inGrid?J():K()},Q=function(e,t){var i,n=0,a=0;if(o.pageTopOffsets=[],o.pageLeftOffsets=[],o.inBookLayout)if(o.verticallyOriented)for(i=0;i<o.numPages;i++)if(o.pageTopOffsets[i]=n,i%2)o.pageLeftOffsets[i]=e/2-d(i,"w")-o.horizontalPadding;else{o.pageLeftOffsets[i]=e/2-o.horizontalPadding;var r=p(i-1)?Math.max(d(i,"h"),d(i-1,"h")):d(i,"h");n=o.pageTopOffsets[i]+r+o.verticalPadding}else for(i=0;i<o.numPages;i++){o.pageTopOffsets[i]=parseInt((t-d(i,"h"))/2,10),o.pageLeftOffsets[i]=a;var l=d(i,"w"),s=i%2?0:o.horizontalPadding;a=o.pageLeftOffsets[i]+l+s}else for(i=0;i<o.numPages;i++)o.pageTopOffsets[i]=parseInt(o.verticallyOriented?n:(t-d(i,"h"))/2,10),o.pageLeftOffsets[i]=parseInt(o.verticallyOriented?(e-d(i,"w"))/2:a,10),n=o.pageTopOffsets[i]+d(i,"h")+o.verticalPadding,a=o.pageLeftOffsets[i]+d(i,"w")+o.horizontalPadding},K=function(){U(),o.zoomLevel=_(o.zoomLevel);var e=o.zoomLevel;o.totalHeight=o.totalHeights[e]+o.verticalPadding*(o.numPages+1),o.totalWidth=o.totalWidths[e]+o.horizontalPadding*(o.numPages+1);var t=o.inBookLayout?2*(o.maxWidths[e]+o.horizontalPadding):o.maxWidths[e]+2*o.horizontalPadding,n=o.maxHeights[e]+2*o.verticalPadding,a=Math.max(t,o.panelWidth),r=Math.max(n,o.panelHeight),c=document.getElementById(o.ID+"inner");o.verticallyOriented?(c.style.height=Math.round(o.totalHeight)+"px",c.style.width=Math.round(a)+"px"):(c.style.height=Math.round(r)+"px",c.style.width=Math.round(o.totalWidth)+"px"),Q(a,r);var u=o.numPages-1;if(o.inBookLayout)if(o.verticallyOriented){var g=u%2?d(u,"h"):Math.max(d(u,"h"),d(u-1,"h"));c.style.height=o.pageTopOffsets[u]+g+2*o.verticalPadding+"px"}else c.style.width=o.pageLeftOffsets[u]+d(u,"w")+2*o.horizontalPadding+"px";p(o.goDirectlyTo)||(o.goDirectlyTo=0),N(o.goDirectlyTo,o.verticalOffset,o.horizontalOffset);var v=!1;for(i=0;i<o.numPages;i++)if(f(i))b(i),o.lastPageLoaded=i,v=!0;else if(v)break;o.oldZoomLevel>=0?(o.oldZoomLevel<o.zoomLevel?(s(o.onZoomIn,e),diva.Events.publish("ViewerDidZoomIn",[e],l)):(s(o.onZoomOut,e),diva.Events.publish("ViewerDidZoomOut",[e],l)),s(o.onZoom,e)):o.oldZoomLevel=o.zoomLevel,o.scaleWait&&(o.scaleWait=!1);var h=o.pages[o.currentPageIndex].f;s(o.onDocumentLoaded,o.currentPageIndex,h),diva.Events.publish("DocumentDidLoad",[o.currentPageIndex,h],l)},J=function(){var e=o.currentPageIndex;o.verticalOffset=o.verticallyOriented?o.panelHeight/2:d(e,"h")/2,o.horizontalOffset=o.verticallyOriented?d(e,"w")/2:o.panelWidth/2,U(),o.pagesPerRow=X(o.pagesPerRow);var t=o.fixedPadding*(o.pagesPerRow+1),i=(o.panelWidth-t)/o.pagesPerRow;o.gridPageWidth=i,o.rowHeight=o.fixedHeightGrid?o.fixedPadding+o.minRatio*i:o.fixedPadding+o.maxRatio*i,o.numRows=Math.ceil(o.numPages/o.pagesPerRow),o.totalHeight=o.numRows*o.rowHeight+o.fixedPadding;var n=document.getElementById(o.ID+"inner");n.style.height=Math.round(o.totalHeight)+"px",n.style.width=Math.round(o.panelWidth)+"px",Y();var a,r;o.pageTopOffsets=[],o.pageLeftOffsets=[];var l=o.numPages;for(a=0;l>a;a+=o.pagesPerRow)r=Math.floor(a/o.pagesPerRow),E(r)&&(o.firstRowLoaded=o.firstRowLoaded<0?r:o.firstRowLoaded,k(r),o.lastRowLoaded=r)},$=function(e){27==e.keyCode&&ie()},ee=function(t){if(o.outerObject.toggleClass("diva-fullscreen"),e("body").toggleClass("diva-hide-scrollbar"),o.parentObject.toggleClass("diva-full-width"),o.mobileWebkit){var i=parseInt(o.outerObject.css("margin-left"),10)-parseInt(e("body").css("margin-left"),10);o.outerObject.css("margin-left",i)}var n=o.panelHeight,a=o.panelWidth;if(me(),o.oldZoomLevel>=0&&!o.inGrid){var r=o.panelHeight,d=o.panelWidth;o.inFullscreen?(o.verticalOffset-=(r-n)/2,o.horizontalOffset-=(d-a)/2):(o.verticalOffset+=(n-r)/2,o.horizontalOffset+=(a-d)/2)}t?(o.inGrid=!o.inGrid,te()):q(),o.inFullscreen?e(document).on("keyup",$):e(document).off("keyup",$),s(o.onModeToggle,o.inFullscreen),diva.Events.publish("ModeDidSwitch",[o.inFullscreen],l)},te=function(){return q(),s(o.onViewToggle,o.inGrid),diva.Events.publish("ViewDidSwitch",[o.inGrid],l),!0},ie=function(){o.goDirectlyTo=o.currentPageIndex,o.inFullscreen=!o.inFullscreen,ee(!1)},ne=function(e){switch(o.goDirectlyTo=o.currentPageIndex,e){case"document":o.inGrid=!1,o.inBookLayout=!1;break;case"book":o.inGrid=!1,o.inBookLayout=!0;break;case"grid":o.inGrid=!0,o.inBookLayout=!1;break;default:return!1}return te()},ae=function(){return o.verticallyOriented=!o.verticallyOriented,o.verticalOffset=ce(),o.horizontalOffset=ue(),o.goDirectlyTo=o.currentPageIndex,K(),o.verticallyOriented},oe=function(t){var i=e(this).offset();o.doubleClickZoom=!0,o.horizontalOffset=t.pageX-i.left,o.verticalOffset=t.pageY-i.top,o.goDirectlyTo=parseInt(e(this).attr("data-index"),10);var n=t.ctrlKey?o.zoomLevel-1:o.zoomLevel+1;se(n)},re=function(t){var i=parseInt(e(this).attr("data-index"),10);o.goDirectlyTo=i;var n=e(this).offset(),a=d(i,"w")/e(this).width();o.horizontalOffset=(t.pageX-n.left)*a,o.verticalOffset=(t.pageY-n.top)*a,o.inGrid=!1,te()},le=function(t,i){var n=o.zoomLevel;if(t>100&&n<o.maxZoomLevel)n++;else{if(!(-100>t&&n>o.minZoomLevel))return;n--}o.scaleWait=!0;var a=e(this).offset();o.horizontalOffset=i.pageX-a.left,o.verticalOffset=i.pageY-a.top,o.goDirectlyTo=parseInt(e(this).attr("data-index"),10),se(n)},se=function(e){var t=_(e);if(t!==e)return!1;var i=Math.pow(2,t-o.zoomLevel);return o.doubleClickZoom?(o.verticalOffset*=i,o.horizontalOffset*=i,o.doubleClickZoom=!1):(o.goDirectlyTo=o.currentPageIndex,o.verticalOffset=i*ge(),o.horizontalOffset=i*ve()),o.oldZoomLevel=o.zoomLevel,o.zoomLevel=t,diva.Events.publish("ZoomLevelDidChange",[t],l),K(),!0},de=function(e){var t=X(e);return t!==e?!1:(o.pagesPerRow=t,diva.Events.publish("GridRowNumberDidChange",[t],l),o.goDirectlyTo=o.currentPageIndex,J(),!0)},ce=function(e,t){return e="undefined"==typeof e?o.currentPageIndex:e,"center"===t||"centre"===t?parseInt(d(e,"h")/2,10):"bottom"===t?parseInt(d(e,"h")-o.panelHeight/2,10):parseInt(o.panelHeight/2,10)},ue=function(e,t){return e="undefined"==typeof e?o.currentPageIndex:e,"left"===t?parseInt(o.panelWidth/2,10):"right"===t?parseInt(d(e,"w")-o.panelWidth/2,10):parseInt(d(e,"w")/2,10)},ge=function(){var e=document.getElementById(o.ID+"outer").scrollTop,t=o.panelHeight;return e-o.pageTopOffsets[o.currentPageIndex]+parseInt(t/2,10)},ve=function(){var e=document.getElementById(o.ID+"outer").scrollLeft,t=o.panelWidth;return e-o.pageLeftOffsets[o.currentPageIndex]+parseInt(t/2,10)},he=function(){var e={f:o.inFullscreen,g:o.inGrid,z:o.zoomLevel,n:o.pagesPerRow,i:o.enableFilename?o.pages[o.currentPageIndex].f:!1,p:o.enableFilename?!1:o.currentPageIndex+1,y:o.inGrid?!1:ge(),x:o.inGrid?!1:ve()};return e},pe=function(){var e,t=he(),i=[];for(e in t)t[e]!==!1&&i.push(e+o.hashParamSuffix+"="+t[e]);return i.join("&")},fe=function(){return location.protocol+"//"+location.host+location.pathname+"#"+pe()},me=function(){var e=document.getElementById(o.ID+"outer");return o.panelHeight=e.clientHeight-(e.scrollWidth>e.clientWidth?o.scrollbarWidth:0),o.panelWidth=e.clientWidth-(e.scrollHeight>e.clientHeight?o.scrollbarWidth:0),o.horizontalOffset=ve(),o.verticalOffset=ge(),N(o.currentPageIndex,o.verticalOffset,o.horizontalOffset),!0},be=function(){o.mobileWebkit||(o.outerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),o.innerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0})),o.outerObject.on("dblclick",".diva-document-page",function(e){oe.call(this,e)}),o.outerObject.on("contextmenu",".diva-document-page",function(e){return e.ctrlKey?(clearTimeout(o.singleClickTimeout),o.singleClick?(oe.call(this,e),o.singleClick=!1):(o.singleClick=!0,o.singleClickTimeout=setTimeout(function(){o.singleClick=!1},500)),!1):void 0}),o.outerObject.on("dblclick",".diva-row",function(t){re.call(e(t.target).parent(),t)})},we=function(e,t,i,n){return Math.sqrt((e-t)*(e-t)+(i-n)*(i-n))},Ie=function(){o.innerObject.mouseover(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),o.innerObject.mouseout(function(){e(this).removeClass("diva-grab")}),o.innerObject.mousedown(function(){e(this).removeClass("diva-grab").addClass("diva-grabbing")}),o.innerObject.mouseup(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),be();var t=function(){var e,t=document.getElementById(o.ID+"outer").scrollTop,i=document.getElementById(o.ID+"outer").scrollLeft;e=o.verticallyOriented||o.inGrid?t-o.previousTopScroll:i-o.previousLeftScroll,o.inGrid?R(e):T(e),o.previousTopScroll=t,o.previousLeftScroll=i,o.horizontalOffset=ve(),o.verticalOffset=ge()};o.outerObject.scroll(t);var i=38,n=40,a=37,r=39,l=32,s=33,d=34,c=36,u=35;if(e(document).keydown(function(e){if(!o.isActiveDiva)return!0;if(o.enableSpaceScroll&&!e.shiftKey&&e.keyCode===l||o.enableKeyScroll&&e.keyCode===d)return o.outerObject.scrollTop(document.getElementById(o.ID+"outer").scrollTop+o.panelHeight),!1;if(o.enableSpaceScroll||e.keyCode!==l||e.preventDefault(),o.enableKeyScroll)switch(e.keyCode){case s:return o.outerObject.scrollTop(document.getElementById(o.ID+"outer").scrollTop-o.panelHeight),!1;case i:return o.outerObject.scrollTop(document.getElementById(o.ID+"outer").scrollTop-o.arrowScrollAmount),!1;case n:return o.outerObject.scrollTop(document.getElementById(o.ID+"outer").scrollTop+o.arrowScrollAmount),!1;case a:return o.outerObject.scrollLeft(document.getElementById(o.ID+"outer").scrollLeft-o.arrowScrollAmount),!1;case r:return o.outerObject.scrollLeft(document.getElementById(o.ID+"outer").scrollLeft+o.arrowScrollAmount),!1;case c:return o.outerObject.scrollTop(0),!1;case u:return o.outerObject.scrollTop(o.totalHeight),!1;default:return!0}return!0}),o.mobileWebkit){var g=[];g.push('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />'),g.push('<meta name="apple-mobile-web-app-capable" content="yes" />'),g.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />'),e("head").append(g.join("\n")),o.blockMobileMove&&e("body").bind("touchmove",function(e){var t=e.originalEvent;return t.preventDefault(),!1}),o.outerObject.kinetic({triggerHardware:!0});var v=[],h=[],p=0;o.outerObject.on("touchstart",".diva-document-page",function(e){2===e.originalEvent.touches.length&&(v=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY],p=we(v[2],v[0],v[3],v[1]))}),o.outerObject.on("touchmove",".diva-document-page",function(e){if(2===e.originalEvent.touches.length){h=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY];var t=we(h[2],h[0],h[3],h[1]),i=t-p;o.scaleWait||(o.goDirectlyTo=o.currentPageIndex,o.inGrid?(o.inGrid=!1,te()):le.call(this,i,e))}});var f={},m=0,b=function(t){if(o.singleTap){var i={pageX:t.originalEvent.changedTouches[0].clientX,pageY:t.originalEvent.changedTouches[0].clientY};m=we(f.pageX,i.pageX,f.pageY,i.pageY),50>m&&o.zoomLevel<o.maxZoomLevel&&(o.inGrid?re.call(e(t.target).parent(),i):oe.call(this,i)),
o.singleTap=!1,f={}}else o.singleTap=!0,f.pageX=t.originalEvent.changedTouches[0].clientX,f.pageY=t.originalEvent.changedTouches[0].clientY,o.singleTapTimeout=setTimeout(function(){o.singleTap=!1,f={}},250)};o.outerObject.on("touchend",".diva-document-page",b),o.outerObject.on("touchend",".diva-page",b);var w="onorientationchange"in window?"orientationchange":"resize";e(window).bind(w,function(e){var t=o.panelWidth,i=o.panelHeight;me(),o.horizontalOffset-=(o.panelWidth-t)/2,o.verticalOffset-=(o.panelHeight-i)/2,o.goDirectlyTo=o.currentPageIndex,q()})}else e(window).resize(function(){me(),clearTimeout(o.resizeTimer),o.resizeTimer=setTimeout(function(){o.goDirectlyTo=o.currentPageIndex,o.verticalOffset=ge(),o.horizontalOffset=ve(),q()},200)});diva.Events.subscribe("PanelSizeDidChange",me)},ye=function(){var e="",t='<div class="diva-document-icon diva-button" id="'+o.ID+'document-icon" title="Document View"></div>',i='<div class="diva-book-icon diva-button" id="'+o.ID+'book-icon" title="Book View"></div>',n='<div class="diva-grid-icon diva-button" id="'+o.ID+'grid-icon" title="Grid View"></div>',a=document.getElementById(o.ID+"view-icon"),r=" diva-view-icon diva-button";a.className=o.inGrid?"diva-grid-icon"+r:o.inBookLayout?"diva-book-icon"+r:"diva-document-icon"+r;for(var l=0;1>l;l++)(o.inGrid||o.inBookLayout)&&(e+=t),o.inBookLayout||(e+=i),o.inGrid||(e+=n);document.getElementById(o.ID+"view-options").innerHTML=e},xe=function(){var t='<div id="'+o.ID+'view-menu" class="diva-view-menu"><div class="diva-view-icon diva-button" id="'+o.ID+'view-icon" title="Change view"></div><div id="'+o.ID+'view-options" class="diva-view-options"></div></div>',i=o.enableLinkIcon?'<div class="diva-link-icon diva-button" id="'+o.ID+'link-icon" style="'+(o.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"",n="slider"===o.enableZoomControls?'<input type="range" id="'+o.ID+'zoom-slider" class="zoom-slider" value="'+o.zoomLevel+'" min="'+o.minZoomLevel+'" max="'+o.maxZoomLevel+'">':"",a="buttons"===o.enableZoomControls?'<div id="'+o.ID+'zoom-out-button" class="diva-zoom-out-button diva-button" title="Zoom Out"></div><div id="'+o.ID+'zoom-in-button" class="diva-zoom-in-button diva-button" title="Zoom In"></div>':"",r="slider"===o.enableGridControls?'<input type="range" id="'+o.ID+'grid-slider" class="grid-slider" value="'+o.pagesPerRow+'" min="'+o.minPagesPerRow+'" max="'+o.maxPagesPerRow+'">':"",l="buttons"===o.enableGridControls?'<div id="'+o.ID+'grid-out-button" class="diva-grid-out-button diva-button" title="Zoom Out"></div><div id="'+o.ID+'grid-in-button" class="diva-grid-in-button diva-button" title="Zoom In"></div>':"",s=o.enableGotoPage?'<form id="'+o.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+o.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"",d="slider"===o.enableZoomControls?'<div id="'+o.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+o.ID+'zoom-level">'+o.zoomLevel+"</span></div>":"",c="buttons"===o.enableZoomControls?'<div id="'+o.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+o.ID+'zoom-level">'+o.zoomLevel+"</span></div>":"",u="slider"===o.enableGridControls?'<div id="'+o.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+o.ID+'pages-per-row">'+o.pagesPerRow+"</span></div>":"",g="buttons"===o.enableGridControls?'<div id="'+o.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+o.ID+'pages-per-row">'+o.pagesPerRow+"</span></div>":"",v='<div class="diva-page-label">Page <span id="'+o.ID+'current-page">1</span> of <span id="'+o.ID+'num-pages">'+o.numPages+"</span></div>",h=o.enableFullscreen?'<div id="'+o.ID+'fullscreen" class="diva-fullscreen-icon diva-button" title="Toggle fullscreen mode"></div>':"",f='<div id="'+o.ID+'tools-left" class="diva-tools-left">'+n+a+r+l+d+c+u+g+'</div><div id="'+o.ID+'tools-right" class="diva-tools-right">'+h+i+t+'<div id="'+o.ID+'page-nav" class="diva-page-nav">'+s+v+"</div></div>";o.toolbarParentObject.prepend('<div id="'+o.ID+'tools" class="diva-tools">'+f+"</div>"),diva.Events.subscribe("ViewDidSwitch",ye),ye(),e(o.selector+"zoom-slider").on("input",function(e){var t=parseInt(this.value,10);se(t)}),e(o.selector+"zoom-slider").on("change",function(e){var t=parseInt(this.value,10);t!==o.zoomLevel&&se(t)});var m=function(e){se(o.zoomLevel+e)};e(o.selector+"zoom-out-button").click(function(){m(-1)}),e(o.selector+"zoom-in-button").click(function(){m(1)}),e(o.selector+"grid-slider").on("input",function(e){var t=parseInt(this.value,10);de(t)}),e(o.selector+"grid-slider").on("change",function(e){var t=parseInt(this.value,10);t!==o.zoomLevel&&de(t)}),e(o.selector+"fullscreen").click(function(){ie()}),e(o.selector+"grid-out-button").click(function(){de(o.pagesPerRow-1)}),e(o.selector+"grid-in-button").click(function(){de(o.pagesPerRow+1)}),e(o.selector+"view-icon").click(function(){e(o.selector+"view-options").toggle()}),e(o.selector+"view-options").on("click",".diva-button",function(t){var i,n=t.target.classList[0];"diva-document-icon"===n?i="document":"diva-book-icon"===n?i="book":"diva-grid-icon"===n&&(i="grid"),diva.Events.publish("UserDidChooseView",[i]),e(o.selector+"view-options").hide()}),diva.Events.subscribe("UserDidChooseView",ne),e(document).mouseup(function(t){var i=e(o.selector+"view-options");i.is(t.target)||0!==i.has(t.target).length||t.target.id===o.ID+"view-icon"||i.hide()}),e(o.selector+"goto-page").submit(function(){var t=parseInt(e(o.selector+"goto-page-input").val(),10),i=t-1;return p(i)?o.inGrid?V(i):G(i):alert("Invalid page number"),!1});var b=e(o.selector+"link-icon");b.click(function(){if(e("body").prepend('<div id="'+o.ID+'link-popup" class="diva-popup diva-link-popup"><input id="'+o.ID+'link-popup-input" class="diva-input" type="text" value="'+fe()+'"/></div>'),o.inFullscreen)e(o.selector+"link-popup").addClass("in-fullscreen");else{var t=b.offset().left-222+b.outerWidth(),i=b.offset().top+b.outerHeight()-1;e(o.selector+"link-popup").removeClass("in-fullscreen").css({top:i+"px",left:t+"px"})}return e("body").mouseup(function(t){var i=t.target.id;i!==o.ID+"link-popup"&&i!==o.ID+"link-popup-input"&&e(o.selector+"link-popup").remove()}),o.outerObject.scroll(function(){e(o.selector+"link-popup").remove()}),e(o.selector+"link-popup input").click(function(){e(this).focus().select()}),!1});var w=o.inGrid?"grid":"zoom";e(o.selector+w+"-slider").show(),e(o.selector+w+"-out-button").show(),e(o.selector+w+"-in-button").show(),e(o.selector+w+"-slider-label").show(),e(o.selector+w+"-buttons-label").show();var I=function(){e(o.selector+"tools").toggleClass("diva-fullscreen-tools"),o.inFullscreen?e(o.selector+"tools-left").addClass("in-fullscreen"):e(o.selector+"tools-left").removeClass("in-fullscreen")},y=function(t){e(o.selector+w+"-slider").hide(),e(o.selector+w+"-out-button").hide(),e(o.selector+w+"-in-button").hide(),e(o.selector+w+"-slider-label").hide(),e(o.selector+w+"-buttons-label").hide(),w=o.inGrid?"grid":"zoom",e(o.selector+w+"-slider").show(),e(o.selector+w+"-out-button").show(),e(o.selector+w+"-in-button").show(),e(o.selector+w+"-slider-label").show(),e(o.selector+w+"-buttons-label").show()},x={updateCurrentPage:function(){document.getElementById(o.ID+"current-page").textContent=parseInt(o.currentPageIndex,10)+1},setNumPages:function(e){document.getElementById(o.ID+"num-pages").textContent=e},updateZoomSlider:function(){o.zoomLevel!==e(o.selector+"zoom-slider").val()&&e(o.selector+"zoom-slider").val(o.zoomLevel),document.getElementById(o.ID+"zoom-level").textContent=o.zoomLevel},updateZoomButtons:function(){document.getElementById(o.ID+"zoom-level").textContent=o.zoomLevel},updateGridSlider:function(){o.pagesPerRow!==e(o.selector+"grid-slider").val()&&e(o.selector+"grid-slider").val(o.pagesPerRow),document.getElementById(o.ID+"pages-per-row").textContent=o.pagesPerRow},updateGridButtons:function(){document.getElementById(o.ID+"pages-per-row").textContent=o.pagesPerRow},closePopups:function(){e(".diva-popup").css("display","none")},switchView:y,switchMode:I};return x},Pe=function(){if(window.divaPlugins){var t=[];e.each(window.divaPlugins,function(e,i){var n=i.pluginName[0].toUpperCase()+i.pluginName.substring(1);if(o["enable"+n]){var a=i.init(o,l);if(!a)return;var r=i.titleText||n+" plugin";if("function"==typeof i.handleClick){t.push('<div class="diva-'+i.pluginName+'-icon" title="'+r+'"></div>');var s=o.mobileWebkit?"touchend":"click";o.outerObject.on(s,".diva-"+i.pluginName+"-icon",function(e){i.handleClick.call(this,e,o,l)})}o.plugins.push(i)}}),t.length&&(o.pageTools='<div class="diva-page-tools">'+t.join("")+"</div>")}},De=function(){clearTimeout(o.throbberTimeoutID),e(o.selector+"throbber").hide()},Le=function(e){var t=function(e,t){return e/Math.pow(2,t)},i=function(e,t){var i=Math.max(e,t);return Math.ceil(Math.log((i+1)/257)/Math.log(2))},n=function(e,t){for(var i=e.length;i--;)e[i]=t};diva.Events.publish("ManifestDidLoad",[e],this);var a=e.sequences[0];o.documentPaged="paged"===e.viewingHint||"paged"===a.viewingHint;for(var r,l,s,d,c,u,g,v,h=a.canvases,p=new Array(h.length),f=new Array(h.length),m=e.label,b=0,w=h.length;w>b;b++){r=h[b].width,l=h[b].height,g=h[b].images[0].resource,s=g.service["@id"],"/"!==s.slice(-1)&&(s+="/"),d=i(r,l),c=h[b].label;var I="non-paged"!==h[b].viewingHint;u=g.service["@context"],v="http://iiif.io/api/image/2/context.json"===u?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===u?1.1:1,f[b]={mx_w:r,mx_h:l,mx_z:d,fn:c,url:s,api:v,paged:I},p[b]=d}var y=Math.min.apply(Math,p),x=0,P=100,D=new Array(y+1),L=new Array(y+1),O=new Array(y+1),C=new Array(y+1),T=new Array(y+1);n(D,0),n(L,0),n(O,0),n(C,0),n(T,0);for(var S,E,z,k=[],b=0,j=f.length;j>b;b++){S=[];for(var M=0;y+1>M;M++){E=Math.floor(t(f[b].mx_w,y-M)),z=Math.floor(t(f[b].mx_h,y-M)),S[M]={h:z,w:E},D[M]+=E,L[M]+=z,O[M]=Math.max(E,O[M]),C[M]=Math.max(z,C[M]);var H=f[b].mx_h/f[b].mx_w;x=Math.max(H,x),P=Math.min(H,P)}k[b]={d:S,m:f[b].mx_z,f:f[b].fn,url:f[b].url,api:f[b].api,paged:f[b].paged}}for(var A=[],F=[],b=0;y+1>b;b++)A.push(D[b]/f.length),F.push(L[b]/f.length);var R={a_wid:A,a_hei:F,max_w:O,max_h:C,max_ratio:x,min_ratio:P,t_hei:L,t_wid:D},Z={item_title:m,dims:R,max_zoom:y,pgs:k};return Z},Oe=function(e,t,i){De();var n='<div id="'+o.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+t+" "+i+"</p>",a=0===o.objectData.lastIndexOf("http",0);if(a&&""===i){var r=o.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0];location.hostname!==r&&(n+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>')}n+="</div>",o.outerObject.append(n)},Ce=function(t){var i;if(!t.hasOwnProperty("@context")||-1===t["@context"].indexOf("iiif")&&-1===t["@context"].indexOf("shared-canvas")?i=t:(o.isIIIF=!0,i=Le(t)),De(),o.pages=i.pgs,o.maxRatio=i.dims.max_ratio,o.minRatio=i.dims.min_ratio,o.itemTitle=i.item_title,o.numPages=i.pgs.length,o.maxWidths=i.dims.max_w,o.maxHeights=i.dims.max_h,o.averageWidths=i.dims.a_wid,o.averageHeights=i.dims.a_hei,o.totalHeights=i.dims.t_hei,o.totalWidths=i.dims.t_wid,o.realMaxZoom=i.max_zoom,o.maxZoomLevel=o.maxZoomLevel>=0&&o.maxZoomLevel<=i.max_zoom?o.maxZoomLevel:i.max_zoom,o.minZoomLevel=o.minZoomLevel>=0&&o.minZoomLevel<=o.maxZoomLevel?o.minZoomLevel:0,o.zoomLevel=_(o.zoomLevel),o.minPagesPerRow=Math.max(2,o.minPagesPerRow),o.maxPagesPerRow=Math.max(o.minPagesPerRow,o.maxPagesPerRow),o.enableFilename){var n=e.getHashParam("i"+o.hashParamSuffix),a=c(n);p(a)&&(o.goDirectlyTo=a,o.currentPageIndex=a)}else{var r=parseInt(e.getHashParam("p"+o.hashParamSuffix),10)-1;p(r)&&(o.goDirectlyTo=r,o.currentPageIndex=r)}if(diva.Events.publish("NumberOfPagesDidChange",[o.numPages],this),o.enableAutoTitle&&(e(o.selector+"title").length?e(o.selector+"title").html(o.itemTitle):o.parentObject.prepend('<div id="'+o.ID+'title" class="diva-title">'+o.itemTitle+"</div>")),p(parseInt(o.goDirectlyTo),10)||(o.goDirectlyTo=0),o.adaptivePadding>0){var l=o.zoomLevel;o.horizontalPadding=parseInt(o.averageWidths[l]*o.adaptivePadding,10),o.verticalPadding=parseInt(o.averageHeights[l]*o.adaptivePadding,10)}else o.horizontalPadding=o.fixedPadding,o.verticalPadding=o.fixedPadding;o.pageTools.length&&(o.verticalPadding=Math.max(40,o.verticalPadding))},Te=function(){var t='<div id="'+o.ID+'throbber" class="diva-throbber"></div>';o.outerObject.append(t),o.throbberTimeoutID=setTimeout(function(){e(o.selector+"throbber").show()},o.throbberTimeout),e.ajax({url:o.objectData,cache:!0,dataType:"json",error:Oe,success:function(t,i,n){Ce(t),e.each(o.plugins,function(e,t){s(t.setupHook,o)}),o.enableToolbar&&(o.toolbar=xe(),diva.Events.subscribe("VisiblePageDidChange",o.toolbar.updateCurrentPage),diva.Events.subscribe("ModeDidSwitch",o.toolbar.switchMode),diva.Events.subscribe("ViewDidSwitch",o.toolbar.switchView),diva.Events.subscribe("ZoomLevelDidChange",o.toolbar.updateZoomSlider),diva.Events.subscribe("ZoomLevelDidChange",o.toolbar.updateZoomButtons),diva.Events.subscribe("GridRowNumberDidChange",o.toolbar.updateGridSlider),diva.Events.subscribe("ZoomLevelDidChange",o.toolbar.updateGridButtons),diva.Events.subscribe("NumberOfPagesDidChange",o.toolbar.setNumPages)),o.parentObject.parent()[0]===document.body&&(o.parentObject.siblings().not("#diva-canvas-backdrop")[0]||(o.divaIsFullWindow=!0)),me();var a=parseInt(e.getHashParam("y"+o.hashParamSuffix),10);o.verticalOffset=isNaN(a)?ce(o.currentPageIndex,"top"):a;var r=parseInt(e.getHashParam("x"+o.hashParamSuffix),10);o.horizontalOffset=isNaN(r)?ue(o.currentPageIndex,"center"):r,o.inFullscreen?ee(!1):q(),me(),s(o.onReady,o),diva.Events.publish("ViewerDidLoad",[o],l),o.loaded=!0}})},Se=function(){return o.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)},Ee=function(){o.scrollbarWidth=e.getScrollbarWidth(),o.mobileWebkit=void 0!==window.orientation,o.ID=e.generateId("diva-"),o.selector="#"+o.ID;var t=parseInt(o.ID,10);t>1&&(o.hashParamSuffix=t),o.parentObject.append('<div id="'+o.ID+'outer" class="diva-outer"></div>'),o.outerObject=e(o.selector+"outer"),o.outerObject.append('<div id="'+o.ID+'inner" class="diva-inner diva-dragger"></div>'),o.innerObject=e(o.selector+"inner");var i=parseInt(e.getHashParam("n"+o.hashParamSuffix),10);i>=o.minPagesPerRow&&i<=o.maxPagesPerRow&&(o.pagesPerRow=i);var n=e.getHashParam("z"+o.hashParamSuffix);""!==n&&(n=parseInt(n,10),n>=o.minZoomLevel&&(o.zoomLevel=n));var a=e.getHashParam("g"+o.hashParamSuffix),r="true"===a,l=e.getHashParam("f"+o.hashParamSuffix),s="true"===l;o.inGrid=o.inGrid&&"false"!==a||r,o.inFullscreen=o.inFullscreen&&"false"!==l||s,o.documentPaged&&(o.inBookLayout=!0),Te(),Pe(),Ie()};Ee(),this.getItemTitle=function(){return o.itemTitle},this.gotoPageByNumber=function(e,t,i){var n=parseInt(e,10)-1;return p(n)?(N(n,ce(n,i),ue(n,t)),!0):!1},this.gotoPageByIndex=function(e,t,i){return e=parseInt(e,10),p(e)?(N(e,ce(e,i),ue(e,t)),!0):!1},this.getCurrentPage=function(){return console.warn("The call to getCurrentPage is deprecated. Use getCurrentPageIndex instead."),o.currentPageIndex},this.getNumberOfPages=function(){return Se()?o.numPages:!1},this.getPageDimensionsAtZoomLevel=function(e,t){if(!Se())return!1;t>o.maxZoomLevel&&(t=o.maxZoomLevel);var i=o.pages[parseInt(e,10)],n=i.d[parseInt(t,10)];return{width:n.w,height:n.h}},this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(o.currentPageIndex,o.zoomLevel)},this.isReady=function(){return o.loaded},this.getCurrentPageIndex=function(){return o.currentPageIndex},this.getCurrentPageFilename=function(){return o.pages[o.currentPageIndex].f},this.getCurrentPageNumber=function(){return o.currentPageIndex+1},this.getFilenames=function(){for(var e=[],t=0;t<o.numPages;t++)e[t]=o.pages[t].f;return e},this.getZoomLevel=function(){return o.zoomLevel},this.getMaxZoomLevel=function(){return o.maxZoomLevel},this.getMaxZoomLevelForPage=function(e){return Se?o.pages[e].m:!1},this.getMinZoomLevel=function(){return o.minZoomLevel},this.setZoomLevel=function(e){return o.inGrid&&(o.goDirectlyTo=o.currentPageIndex,o.inGrid=!1,te()),se(e)},this.zoomIn=function(){return this.setZoomLevel(o.zoomLevel+1)},this.zoomOut=function(){return this.setZoomLevel(o.zoomLevel-1)},this.inViewport=function(e,t,i,n,a){var r=e-1,l=o.pageTopOffsets[r]+i,s=l+a,d=o.pageLeftOffsets[r]+t,c=d+n;return g(l,s)&&u(d,c)},this.isPageInViewport=function(e){return f(e)},this.isPageLoaded=function(e){return m(e)},this.toggleFullscreenMode=function(){ie()},this.closePopups=function(){o.toolbar.closePopups()},this.enterFullscreenMode=function(){return o.inFullscreen?!1:(ie(),!0)},this.leaveFullscreenMode=function(){return o.inFullscreen?(ie(),!0):!1},this.changeView=function(e){return ne(e)},this.enterGridView=function(){return o.inGrid?!1:(ne("grid"),!0)},this.leaveGridView=function(){return o.inGrid?(o.goDirectlyTo=o.currentPageIndex,o.inGrid=!1,te(),!0):!1},this.gotoPageByName=function(e,t,i){var n=c(e);return p(n)?(N(n,ce(n,i),ue(n,t)),!0):!1},this.getPageIndex=function(e){return c(e)},this.getCurrentURL=function(){return fe()},this.getURLHash=function(){return pe()},this.getState=function(){return he()},this.getInstanceSelector=function(){return o.selector},this.getInstanceId=function(){return o.ID},this.getSettings=function(){return o},this.translateFromMaxZoomLevel=function(e){var t=o.maxZoomLevel-o.zoomLevel;return e/Math.pow(2,t)},this.translateToMaxZoomLevel=function(e){var t=o.maxZoomLevel-o.zoomLevel;return 0===t?e:e*Math.pow(2,t)},this.setState=function(e){var t;t=c(e.i),p(t)?o.goDirectlyTo=t:p(e.p)&&(o.goDirectlyTo=e.p),horizontalOffset=parseInt(e.x,10),verticalOffset=parseInt(e.y,10),e.z>=o.minZoomLevel&&e.z<=o.maxZoomLevel&&(o.zoomLevel=e.z),e.n>=o.minPagesPerRow&&e.n<=o.maxPagesPerRow&&(o.pagesPerRow=e.n),o.inFullscreen!==e.f?(o.inFullscreen=e.f,ee(o.inGrid!==e.g),o.horizontalOffset=horizontalOffset,o.verticalOffset=verticalOffset,N(t,o.verticalOffset,o.horizontalOffset)):(o.horizontalOffset=horizontalOffset,o.verticalOffset=verticalOffset,o.inGrid!==e.g?(o.inGrid=e.g,te()):q())},this.enableScrollable=function(){o.isScrollable||(be(),o.enableKeyScroll=o.initialKeyScroll,o.enableSpaceScroll=o.initialSpaceScroll,o.outerObject.css("overflow","auto"),o.isScrollable=!0)},this.disableScrollable=function(){o.isScrollable&&(o.innerObject.hasClass("diva-dragger")&&o.innerObject.unbind("mousedown"),o.outerObject.unbind("dblclick"),o.outerObject.unbind("contextmenu"),o.outerObject.css("overflow","hidden"),o.initialKeyScroll=o.enableKeyScroll,o.initialSpaceScroll=o.enableSpaceScroll,o.enableKeyScroll=!1,o.enableSpaceScroll=!1,o.isScrollable=!1)},this.toggleOrientation=function(){return ae()},this.getPageOffset=function(e){return{top:parseInt(o.pageTopOffsets[e]),left:parseInt(o.pageLeftOffsets[e])}},this.getCurrentPageOffset=function(){return this.getPageOffset(o.currentPageIndex)},this.getPageDimensionsAtCurrentGridLevel=function(e){e=p(e)?e:o.currentPageIndex;var t=o.rowHeight-o.fixedPadding,i=o.fixedHeightGrid?(o.rowHeight-o.fixedPadding)*d(e,"w")/d(e,"h"):o.gridPageWidth;return{height:parseInt(t,10),width:parseInt(i,10)}},this.getPageIndexForPageXYValues=function(e,t){var i=document.getElementById(o.ID+"outer"),n=i.getBoundingClientRect(),a=n.top,r=n.left,l=n.bottom,s=n.right;if(r>e||e>s)return!1;if(a>t||t>l)return!1;for(var d=document.getElementsByClassName("diva-page"),c=d.length;c--;){var u=d[c],g=u.getBoundingClientRect();if(!(e<g.left||e>g.right||t<g.top||t>g.bottom))return u.getAttribute("data-index")}return!1},this.isVerticallyOriented=function(){return o.verticallyOriented},this.changeObject=function(t){o.loaded=!1,U(),o.throbberTimeoutID=setTimeout(function(){e(o.selector+"throbber").show()},o.throbberTimeout),o.objectData=t,e.ajax({url:o.objectData,cache:!0,dataType:"json",error:Oe,success:function(e,t,i){Ce(e),De(),q(),o.loaded=!0}})},this.activate=function(){o.isActiveDiva=!0},this.deactivate=function(){o.isActiveDiva=!1},this.destroy=function(){e("body").removeClass("diva-hide-scrollbar"),o.parentObject.empty().removeData("diva"),e.each(o.plugins,function(e,t){s(t.destroy,o,l)}),o.parentObject.removeAttr("style").removeAttr("class"),diva.Events.unsubscribeAll()}};e.fn.diva=function(i){return this.each(function(){if(i.parentObject=e(this),!i.parentObject.data("diva")){var n=new t(this,i);i.parentObject.data("diva",n)}})}}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,n){function a(e){return Math.log(e)/Math.log(10)}var o,r,l,s,d;n.startScrolling=function(){return i.currentlyAutoScrolling?void console.warn("You are trying to start autoscrolling, but it is already scrolling."):(e("#"+i.ID+"autoscroll-toggle").text("Turn off"),r&&n.disableScrollable(),i.currentlyAutoScrolling=!0,void restartScrollingInterval())},restartScrollingInterval=function(){clearInterval(i.autoScrollInterval),i.autoScrollInterval=i.verticallyOriented?setInterval(function(){i.outerObject.scrollTop(i.outerObject.scrollTop()+o)},l):setInterval(function(){i.outerObject.scrollLeft(i.outerObject.scrollLeft()+o)},l)},n.stopScrolling=function(){return i.currentlyAutoScrolling?(e("#"+i.ID+"autoscroll-toggle").text("Turn on"),r&&n.enableScrollable(),i.currentlyAutoScrolling=!1,void clearInterval(i.autoScrollInterval)):void console.warn("You are trying to stop autoscrolling, but it is not currently active.")},n.toggleScrolling=function(){i.currentlyAutoScrolling?n.stopScrolling():n.startScrolling()},n.changeRefresh=function(e){l=e,c()},n.changeScrollSpeed=function(t){d=t,c(),e("#"+i.ID+"autoscroll-pps").val(a(d)),i.currentlyAutoScrolling&&restartScrollingInterval()};var c=function(){l=s,o=d/(1e3/l),1>o&&(l*=1/o,o=d/(1e3/l))};if(n.disableManualScroll=function(){r=!0,i.currentlyAutoScrolling&&n.disableScrollable()},n.enableManualScroll=function(){r=!1,i.currentlyAutoScrolling&&n.enableScrollable()},i.currentlyAutoScrolling=!1,i.autoScrollInterval="",r=i.disableManualScroll||!1,l=i.autoScrollRefresh||50,s=l,n.changeScrollSpeed(i.scrollSpeed||10),e(window).on("keyup",function(e){e.shiftKey&&32===e.keyCode&&n.toggleScrolling()}),!i.disableAutoscrollPrefs){var u=function(n){if(i.inFullscreen){var a=e(i.selector+"tools"),o=a.css("right");t.jqObj.css({right:o,"margin-right":0,top:a.offset().top+a.outerHeight()+15})}else t.jqObj.css({right:e(window).width()-(i.outerObject.offset().left+i.outerObject.outerWidth())+i.scrollbarWidth,"margin-right":".6em"}),t.jqObj.offset({top:i.outerObject.offset().top+1})};diva.Events.subscribe("ModeDidSwitch",u),diva.Events.subscribe("ViewerDidLoad",function(o){var r="<div id='"+i.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+i.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+a(d)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+i.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+i.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";e("#"+i.ID+"page-nav").before("<div id='"+i.ID+"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>"),e("body").prepend(r),e("#"+i.ID+"autoscroll-pps").on("change",function(e){n.changeScrollSpeed(Math.pow(10,e.target.value))}),e("#"+i.ID+"autoscroll-manual").on("change",function(e){e.target.checked?n.enableManualScroll():n.disableManualScroll()}),e("#"+i.ID+"autoscroll-toggle").on("click",n.toggleScrolling),e("#"+i.ID+"autoscroll-icon").on("click",function(n){t.jqObj=e("#"+i.ID+"autoscroll-prefs"),"none"===t.jqObj.css("display")?(t.jqObj.css({display:"block"}),u(i.inFullscreen)):t.jqObj.css("display","none")})})}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t,i,n,a={},o={},r={},l={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,onInit:null,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},s=function(e){return e*Math.PI/180},d=function(e,t){var n=e.x-a.centerX,o=-(e.y-a.centerY),r=s(i.rotation.previous-t),l=Math.cos(r)*n-Math.sin(r)*o+a.centerX,d=-(Math.sin(r)*n+Math.cos(r)*o)+a.centerY;return{x:l,y:d}},c=function(e,i){var n=e.context,a=e.size/2,o=-(e.width/2),r=-(e.height/2);n.clearRect(0,0,e.size,e.size),n.save(),n.translate(a,a),n.rotate(s(i)),n.drawImage(t,o,r,e.width,e.height),n.restore(),e.data=n.getImageData(0,0,e.size,e.size)},u=function(){var e;for(e in i)if(i[e].current!==i[e].previous)return!0;return!1},g=function(){var e;for(e in i)i[e].previous=i[e].current},v=function(){c(o,i.rotation.current),m(o)},h=function(){var t=i.rotation.current,n=i.rotation.previous,o=i.zoom.current,l=i.zoom.previous;if(t!==n||o!==l){var s=e("#diva-canvas-wrapper").scrollLeft(),v=e("#diva-canvas-wrapper").scrollTop(),h=r.viewport.width/2,p=r.viewport.height/2,f=d({x:s+h,y:v+p},t),b=Math.pow(2,o-l),w=b*f.x-h,I=b*f.y-p;c(a,t),e("#diva-canvas-wrapper").scrollLeft(w),e("#diva-canvas-wrapper").scrollTop(I)}u()&&(m(a),g())},p=function(e){var t,i,n=e.data,a=e.context.createImageData(n),o=a.data;for(t=0,i=o.length;i>t;t++)o[t]=n.data[t];return a},f=function(e){var t=i[e].current!==i[e].previous,n=i[e].current!==i[e].initial;return t||n},m=function(e){var t,n,a,o,l,s,d,c,u=p(e),g=u.data,v=i.brightness.current,h=i.contrast.current,m=1+Math.min(r.brightnessMax,Math.max(r.brightnessMin,v))/r.brightnessMax,b=m*h,w=128-128*h,I=i.red.current,y=i.green.current,x=i.blue.current,P=f("red"),D=f("green"),L=f("blue"),O=f("brightness"),C=f("contrast"),T=O||C;for(t=0,a=u.width;a>t;t++)for(n=0,o=u.height;o>n;n++)l=4*(n*a+t),s=g[l],d=g[l+1],c=g[l+2],s+d+c>0&&(P&&s&&(s+=I),D&&d&&(d+=y),L&&c&&(c+=x),T&&(s&&(s=s*b+w),d&&(d=d*b+w),c&&(c=c*b+w)),g[l]=s,g[l+1]=d,g[l+2]=c);e.context.clearRect(0,0,a,o),e.context.putImageData(u,0,0)},b=function(){var t=e("#diva-canvas-wrapper").scrollLeft()*o.scaleFactor,i=e("#diva-canvas-wrapper").scrollTop()*o.scaleFactor,n=Math.min(Math.round(r.viewport.height*o.scaleFactor),r.mapSize)-4,a=Math.min(Math.round(r.viewport.width*o.scaleFactor),r.mapSize)-4;e("#diva-map-viewbox").height(n).width(a).css({top:i,left:t})},w=function(t){o.canvas=document.getElementById("diva-canvas-minimap"),o.size=r.mapSize,o.canvas.width=o.size,o.canvas.height=o.size,o.context=o.canvas.getContext("2d"),o.context.fillRect(0,0,o.size,o.size),o.scaleFactor=r.mapSize/a.size,o.cornerX=a.cornerX*o.scaleFactor,o.cornerY=a.cornerY*o.scaleFactor,o.width=t.width*o.scaleFactor,o.height=t.height*o.scaleFactor,o.context.drawImage(t,o.cornerX,o.cornerY,o.width,o.height),o.data=o.context.getImageData(0,0,r.mapSize,r.mapSize),e("#diva-map-viewbox").show(),b()},I=function(i,n){t=new Image,t.crossOrigin="anonymous",t.onload=function(){a.size=Math.sqrt(t.width*t.width+t.height*t.height),a.canvas=document.getElementById("diva-canvas"),a.canvas.width=a.size,a.canvas.height=a.size,a.cornerX=(a.size-t.width)/2,a.cornerY=(a.size-t.height)/2,a.width=t.width,a.height=t.height,a.centerX=a.size/2,a.centerY=a.size/2,a.context=a.canvas.getContext("2d"),a.context.drawImage(t,a.cornerX,a.cornerY,a.width,a.height);try{a.data=a.context.getImageData(0,0,a.size,a.size)}catch(i){var o='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+i.message+"</p>";if("SecurityError"!==i.name)throw i;o+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div>',o+="</div>",e("#diva-canvas-backdrop").append(o),L()}void 0===n&&w(t),v(),h(a),L(),"function"==typeof n&&n.call(n)},t.src=i,(t.complete||void 0===t.complete)&&(t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.src=i)},y=function(){var t=i[n],a=t.current,o=t.transform?t.transform(a):a;e("#diva-canvas-value").html(o)},x=function(){e("#diva-canvas-slider").val(i[n].current)},P=function(e){var t,i=r.zoomWidthRatio*Math.pow(2,e),n=r.imageDir+"/",a=r.selectedPageIndex;if(r.isIIIF){var o=r.pages[a].api>1.1?"default":"native";t=encodeURI(r.pages[a].url+"full/"+i+",/0/"+o+".jpg")}else t=r.iipServerURL+"?FIF="+n+r.filename+"&WID="+i+"&CVT=JPEG";return t},D=function(){(i.zoom.current>0||r.mobileWebkit)&&e(r.selector+"throbber").addClass("canvas-throbber").show()},L=function(){e(r.selector+"throbber").removeClass("canvas-throbber").hide()},O=function(){var e,t={},n=!1,a=r.localStoragePrefix+r.filename;for(e in i)i[e].previous!==i[e].initial&&(t[e]=i[e].previous,n=!0);n?(r.pluginIcon.addClass("new"),localStorage.setObject(a,t)):(r.pluginIcon.removeClass("new"),localStorage.removeItem(a))},C=function(e,t){r.zoomLevel=e;var i=P(e);I(i,function(){o.scaleFactor=o.size/a.size,b(),O()})},T=function(t){var i=38,n=40,a=37,o=39;switch(t.keyCode){case i:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-r.arrowScrollAmount),!1;case n:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+r.arrowScrollAmount),!1;case a:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-r.arrowScrollAmount),!1;case o:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+r.arrowScrollAmount),!1}},S={init:function(t,s){var d=!!window.HTMLCanvasElement;if(!d)return!1;e.extend(r,l,t.canvasPlugin),r.inCanvas=!1,r.iipServerURL=t.iipServerURL,r.imageDir=t.imageDir,r.selector=t.selector,r.mobileWebkit=t.mobileWebkit,r.arrowScrollAmount=t.arrowScrollAmount,i={contrast:{initial:1,min:r.contrastMin,max:r.contrastMax,step:r.contrastStep,transform:function(e){return e.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:r.brightnessMin,max:r.brightnessMax,step:r.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(e){return e+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the blue channel"}};var c=function(){var e,t,n;for(n in i)t=i[n],e=t.initial,t.current=e,t.previous=e};if(c(),e("#diva-canvas-backdrop").length)return!0;var g,p,f,m,w=[];for(m in r.buttons)p=r.buttons[m],f=i[p].title,g='<div class="'+p+'" title="'+f+'"></div>',w.push(g);var I=w.join(""),P='<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+I+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>',S='<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div>',E='<div id="diva-canvas-backdrop">'+P+S+"</div>";

e("body").append(E),r.mapSize=e("#diva-canvas-minimap").width(),e("#diva-canvas-buttons div").click(function(){e("#diva-canvas-buttons .clicked").removeClass("clicked"),z(e(this).attr("class"))});var z=function(t){n=t;var a=i[n];e("#diva-canvas-buttons ."+n).addClass("clicked"),e("#diva-canvas-mode").text(n);var o=a.current,r=a.transform?a.transform(o):o,l=document.getElementById("diva-canvas-slider");l.min=a.min,l.max=a.max,l.step=a.step,e("#diva-canvas-slider").val(o),e("#diva-canvas-value").html(r)};return z("contrast"),e("#diva-canvas-slider").on("input",function(e){i[n].current=parseFloat(this.value),y(),v()}),e("#diva-canvas-reset-all").click(function(){var e;for(e in i)i[e].current=i[e].initial;y(),x(),v()}),e("#diva-canvas-reset").click(function(){i[n].current=i[n].initial,y(),x(),v()}),e("#diva-canvas-apply").click(function(){u()&&(D(),setTimeout(function(){i.zoom.current!==i.zoom.previous?C(i.zoom.current):(h(),L(),O())},r.throbberTimeout))}),e("#diva-canvas-close").click(function(){e("body").removeClass("overflow-hidden"),a.context.clearRect(0,0,a.size,a.size),o.context.clearRect(0,0,o.size,o.size),e("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0),e("#diva-canvas-backdrop").hide(),e("#diva-map-viewbox").hide(),L(),s.enableScrollable(),e(document).off("keydown",T),c(),y(),x(),e("#diva-canvas-buttons .clicked").removeClass("clicked"),z("contrast"),diva.Events.publish("CanvasViewDidHide")}),e("#diva-canvas-minimise").click(function(){e("#diva-canvas-toolwindow").slideToggle("fast")}),e(window).resize(function(){r.viewport={height:window.innerHeight-t.scrollbarWidth,width:window.innerWidth-t.scrollbarWidth},r.inCanvas&&b()}),e("#diva-canvas-wrapper").scroll(function(){r.inCanvas&&b()}),e("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(t){var i=e("#diva-canvas-minimap").offset(),n=(t.pageX-i.left)/o.scaleFactor,a=(t.pageY-i.top)/o.scaleFactor;e("#diva-canvas-wrapper").scrollTop(a-r.viewport.height/2),e("#diva-canvas-wrapper").scrollLeft(n-r.viewport.width/2)}),e("#diva-canvas").mousedown(function(){e(this).addClass("grabbing")}).mouseup(function(){e(this).removeClass("grabbing")}),r.mobileWebkit?e("#diva-canvas-wrapper").kinetic():e("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0}),"function"==typeof r.onInit&&r.onInit.call(this,r),!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(e){r.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},r.minZoomLevel=e.minZoomLevel,r.maxZoomLevel=e.maxZoomLevel,r.mobileWebkit&&(r.maxZoomLevel=Math.min(r.maxZoomLevel,r.mobileWebkitMaxZoom)),i.zoom.min=r.minZoomLevel,i.zoom.max=r.maxZoomLevel},handleClick:function(t,a,o){var l,s=e(this).parent().parent(),d=e(s).attr("data-filename"),c=e(s).attr("data-index"),u=e(s).width()-1,g=a.zoomLevel;r.zoomWidthRatio=u/Math.pow(2,g),r.pluginIcon=e(this),r.pages=a.pages,r.isIIIF=a.isIIIF,r.selectedPageIndex=c,r.mobileWebkit&&(g=Math.min(r.maxZoomLevel,g)),r.filename=d,i.zoom.initial=g,i.zoom.current=g;var v=localStorage.getObject(r.localStoragePrefix+r.filename);if(v)for(l in v)i[l].current=v[l],l===n&&(y(),x()),"zoom"===l&&(g=v[l]);i.zoom.previous=g,e("body").addClass("overflow-hidden"),e("#diva-canvas-backdrop").show(),o.disableScrollable(),e(document).keydown(T),r.inCanvas=!0;var h=P(g);e("#diva-canvas-info").text(e(s).attr("title")),D(),diva.Events.publish("CanvasViewDidActivate",[s]),I(h)},onPageLoad:function(t,i,n){var a=r.localStoragePrefix+i;null!==localStorage.getItem(a)&&e(n).find(".diva-canvas-icon").addClass("new")},destroy:function(t,i){e("#diva-canvas-backdrop").remove()}};return S}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(e,t){return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(t,i){var n,a=e(this).parent().parent(),o=e(a).attr("data-filename"),r=e(a).attr("data-index"),l=e(a).width()-1;if(i.isIIIF){var s=i.pages[r].api>1.1?"default":"native";n=encodeURI(i.pages[r].url+"full/"+l+",/0/"+s+".jpg")}else n=i.iipServerURL+"?FIF="+i.imageDir+"/"+o+"&WID="+l+"&CVT=JPEG";window.open(n)}};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){function i(i,n,a){var l=e.parentObject.data("highlights");if("undefined"!=typeof l){if(l.hasOwnProperty(i)){for(var s=document.getElementById(e.ID+"page-"+i).getElementsByClassName(e.ID+"highlight");s[0];)s[0].parentNode.removeChild(s[0]);var d,c=t.getInstanceId()+"page-"+i,u=document.getElementById(c),g=l[i].regions,v=l[i].colour,h=l[i].divClass,p=t.getMaxZoomLevel();if(e.inGrid){var f=t.getPageDimensionsAtZoomLevel(i,p).width,m=u.clientWidth,b=f/m;d=Math.log(b)/Math.log(2)}else d=p-t.getZoomLevel();for(var w=g.length;w--;){var I=document.createElement("div");I.style.width=r(g[w].width,d)+"px",I.style.height=r(g[w].height,d)+"px",I.style.top=r(g[w].uly,d)+"px",I.style.left=r(g[w].ulx,d)+"px",I.style.background=v,I.style.border="1px solid #555",I.style.position="absolute",I.style.zIndex=100,I.className=h,"undefined"!=typeof g[w].divID&&I.setAttribute("data-highlight-id",g[w].divID),u.appendChild(I)}}o(),diva.Events.publish("HighlightCompleted",[i,n,a])}}e.parentObject.data("highlights",{});var n,a,o=function(){var i,o=e.ID+"selected-highlight",r=document.getElementsByClassName(o);for(i=0;i<r.length;i++)box=r[i],box.id!=n&&(box.className=box.className.replace(" "+o,""),box.style.border="1px solid #555");if(t.isPageLoaded(a))for(boxes=document.querySelectorAll("*[data-highlight-id="+n+"]"),i=0;i<boxes.length;i++)box=boxes[i],box.className=box.className+" "+o,box.style.border="2px solid #000"};diva.Events.subscribe("PageDidLoad",i);var r=function(e,t){return e/Math.pow(2,t)};t.resetHighlights=function(){for(var t=document.getElementById(e.ID+"inner"),i=e.ID+"highlight",n=t.getElementsByClassName(i),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}e.parentObject.data("highlights",{})},t.removeHighlightsOnPage=function(i){var n=e.parentObject.data("highlights");if(n.hasOwnProperty(i)){for(var a=t.getInstanceId()+"page-"+i,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=n[i].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete n[i]}},t.highlightOnPages=function(e,i,n,a){for(var o=e.length;o--;)t.highlightOnPage(e[o],i[o],n,a)},t.highlightOnPage=function(n,a,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.2)"),r="undefined"==typeof r?e.ID+"highlight":e.ID+"highlight "+r;var l=(t.getMaxZoomLevel(),e.parentObject.data("highlights"));return l[n]={regions:a,colour:o,divClass:r},t.isPageLoaded(n)&&i(n,null,null),!0},t.gotoHighlight=function(t){var i=e.parentObject.data("highlights");if(null!==document.getElementById(t)){for(var n=parseInt(document.getElementById(t).parentNode.getAttribute("data-index"),10),a=i[n].regions.length;a--;)if(i[n].regions[a].divID===t)return l(n,i[n].regions[a])}else for(var o=Object.keys(i),r=o.length;r--;)for(var s=i[o[r]].regions,d=s.length;d--;)if(s[d].divID===t)return l(o[r],s[d]);return console.warn("Diva just tried to find a highlight that doesn't exist."),!1};var l=function(i,r){var l=parseFloat(r.uly)+parseFloat(r.height)/2,s=parseFloat(r.ulx)+parseFloat(r.width)/2,d=t.translateFromMaxZoomLevel(l),c=t.translateFromMaxZoomLevel(s);i=parseInt(i,10),t.gotoPageByIndex(i);var u=t.getSettings().outerObject,g=u.scrollTop()+d-u.height()/2+e.verticalPadding,v=u.scrollLeft()+c-u.width()/2+e.horizontalPadding;return u.scrollTop(g),u.scrollLeft(v),n=r.divID,a=i,diva.Events.publish("SelectedHighlightChanged",[n,a]),o(),n},s=function(i){return t.translateFromMaxZoomLevel(e.verticallyOriented?parseFloat(i.uly)+parseFloat(i.height)/2:parseFloat(i.ulx)+parseFloat(i.width)/2)},d=function(i){var o,r,d,c,u,g,v,h,p,f,m=e.parentObject.data("highlights"),b=!1;if(n&&a){for(d=a,c=m[d].regions,u=c.length;u--;)if(c[u].divID==n){p=c[u],r=s(p);break}for(u=c.length,g=t.getPageDimensionsAtZoomLevel(d,t.getZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,f=i?function(e,t,i){return e>t&&i>e}:function(e,t,i){return t>e&&e>i};u--;)p=c[u],v=s(p),p.divID!=n&&f(v,r,o)&&(b=!0,o=v,h=p);if(b)return l(d,h)}else d=0,r=0;var w,I=Object.keys(m),y=I.indexOf(d);for(w=i?y==I.length-1?I[0]:I[y+1]:0===y?I[I.length-1]:I[y-1],c=m[w].regions,u=c.length,g=t.getPageDimensionsAtZoomLevel(w,t.getMaxZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,f=i?function(e,t){return t>e}:function(e,t){return e>t};u--;)p=c[u],v=s(p),f(v,o)&&(b=!0,o=v,h=p);return l(w,h)};return t.gotoNextHighlight=function(){return d(!0)},t.gotoPreviousHighlight=function(){return d(!1)},!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"};return e}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,n){function a(e,a,r){var l=i.parentObject.data("highlights");if("undefined"!=typeof l&&t.highlightsVisible){if(l.hasOwnProperty(e)){var s,d=n.getInstanceId()+"page-"+e,c=document.getElementById(d),u=l[e].regions,g=l[e].colour,v=l[e].divClass,h=n.getMaxZoomLevel();if(i.inGrid){var p=n.getPageDimensionsAtZoomLevel(e,h).width,f=c.clientWidth,m=p/f;s=Math.log(m)/Math.log(2)}else s=h-n.getZoomLevel();for(var b=u.length;b--;){var w=document.createElement("div");w.style.width=o(u[b].width,s)+"px",w.style.height=o(u[b].height,s)+"px",w.style.top=o(u[b].uly,s)+"px",w.style.left=o(u[b].ulx,s)+"px",w.style.background=g,w.style.border="1px solid #555",w.style.position="absolute",w.style.zIndex=100,w.className=v,"undefined"!=typeof u[b].name&&w.setAttribute("data-name",u[b].name),"undefined"!=typeof u[b].divID&&(w.id=u[b].divID),c.appendChild(w)}}diva.Events.publish("HighlightCompleted",[e,a,r])}}i.parentObject.data("highlights",{}),t.highlightedPages=[],diva.Events.subscribe("PageWillLoad",a);var o=function(e,t){return e/Math.pow(2,t)};n.resetHighlights=function(){for(var e=document.getElementById(i.ID+"inner"),t=i.ID+"highlight",n=e.getElementsByClassName(t),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}i.parentObject.data("highlights",{})},n.removeHighlightsOnPage=function(e){var t=i.parentObject.data("highlights");if(t.hasOwnProperty(e)){for(var a=n.getInstanceId()+"page-"+e,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=t[e].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete t[e]}},n.hideHighlights=function(){t.highlightsVisible=!1;for(var e=i.ID+"highlight",n=document.getElementById(i.ID+"inner"),a=n.getElementsByClassName(e),o=a.length;o--;){var r=a[o].parentNode;r.removeChild(a[o])}},n.showHighlights=function(){t.highlightsVisible=!0;for(var e,n=document.getElementById(i.ID+"inner"),o=n.getElementsByClassName("diva-document-page"),r=0;r<o.length;r++){e=parseInt(o[r].getAttribute("data-index"),10);var s=i.parentObject.data("highlights");s.hasOwnProperty(e)?a(e,null,null):l(e)}},n.highlightOnPages=function(e,t,i,a){for(var o=e.length;o--;)n.highlightOnPage(e[o],t[o],i,a)},n.highlightOnPage=function(e,t,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.1)"),r="undefined"==typeof r?i.ID+"highlight":i.ID+"highlight "+r;var l=(n.getMaxZoomLevel(),i.parentObject.data("highlights"));return l[e]={regions:t,colour:o,divClass:r},n.isPageLoaded(e)&&a(e,null,null),!0},n.gotoHighlight=function(e){var t,a,o,r,l=i.parentObject.data("highlights"),s=!1;if(null!==document.getElementById(e)){t=parseInt(document.getElementById(e).parentNode.getAttribute("data-index"),10);for(var d=l[t].regions.length;d--;)if(l[t].regions[d].divID===e){a=l[t].regions[d],o=parseFloat(a.uly)+parseFloat(a.height)/2,r=parseFloat(a.ulx)+parseFloat(a.width)/2,s=!0;break}}else for(var c=Object.keys(l),u=c.length;u--;){for(var g=l[c[u]].regions,v=g.length;v--;)if(g[v].divID===e){t=c[u],a=g[v],o=parseFloat(a.uly)+parseFloat(a.height)/2,r=parseFloat(a.ulx)+parseFloat(a.width)/2,s=!0;break}if(s)break}if(!s)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;var h=n.getSettings().outerObject,p=n.translateFromMaxZoomLevel(o),f=n.translateFromMaxZoomLevel(r);n.gotoPageByIndex(t);var m=h.scrollTop()+p-h.height()/2+i.verticalPadding,b=h.scrollLeft()+f-h.width()/2+i.horizontalPadding;return h.scrollTop(m),h.scrollLeft(b),i.currentHighlight=e,!0};var r=function(e){return function(i,a,o){for(var r=i,l=i.length,s=[],d=0;l>d;d++){var c=r[d],u=c.resource.chars,g=c.on,v=g.slice(g.indexOf("#xywh=")+6),h=v.split(","),p={ulx:parseInt(h[0],10),uly:parseInt(h[1],10),width:parseInt(h[2],10),height:parseInt(h[3],10),name:u};s.push(p)}n.highlightOnPage(e,s),t.highlightedPages.push(e)}},l=function(i){var n=t.manifest.sequences[0].canvases;if(n[i].hasOwnProperty("otherContent"))for(var a=n[i].otherContent,o=0;o<a.length;o++)"sc:AnnotationList"===a[o]["@type"]&&e.ajax({url:a[o]["@id"],cache:!0,dataType:"json",success:r(i)})},s=function(e){t.manifest=e};diva.Events.subscribe("ManifestDidLoad",s),diva.Events.subscribe("PageWillLoad",function(e){if(t.highlightsVisible){for(var i=0;i<t.highlightedPages.length;i++)if(t.highlightedPages[i]===e)return;l(e,t.manifest)}});var d=[];return i.innerObject.on("mouseenter","."+i.ID+"highlight",function(e){var t=e.target,i=t.dataset.name,n=document.createElement("div");n.style.top=t.offsetTop+t.offsetHeight-1+"px",n.style.left=t.style.left,n.style.background="#fff",n.style.border="1px solid #555",n.style.position="absolute",n.style.zIndex=101,n.className="annotation-overlay",n.textContent=i,t.parentNode.appendChild(n),d.push(n)}),i.innerObject.on("mouseleave","."+i.ID+"highlight",function(e){for(;d.length;){var t=d.pop();t.parentNode.removeChild(t)}}),diva.Events.subscribe("ViewerDidLoad",function(){e("#"+i.ID+"page-nav").before('<div id="'+i.ID+'annotations-icon" class="diva-button diva-annotations-icon" title="Turn annotations on or off"></div>'),e(i.selector+"annotations-icon").addClass("annotations-icon-active"),e("#"+i.ID+"annotations-icon").on("click",function(a){t.highlightsVisible?(n.hideHighlights(),e(i.selector+"annotations-icon").removeClass("annotations-icon-active")):(n.showHighlights(),e(i.selector+"annotations-icon").addClass("annotations-icon-active"))})}),t.highlightsVisible=!0,!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(t,i){var n=function(i){var n=function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),n=i.replace("_"," ");return 0===t.indexOf("http://")&&(t='<a href="'+t+'" target="_blank">'+t+"</a>"),'<div class="metadata-row"><span class="metadata-label">'+n+':</span> <span class="metadata-value">'+t+"</span></div>"},a=function(e,t){for(var i=0;i<e.length;i++)if(e[i]["@language"]===t)return e[i]["@value"]},o=function(e){for(var t="",o=0;o<e.length;o++){var r=e[o];if(i.hasOwnProperty(r))if(i[r].constructor===Array){var l=a(i[r],"en");t+=n(r,l)}else t+=n(r,i[r])}return t},r='<div id="'+t.ID+'metadata" class="diva-modal">';if(r+=o(["label"]),i.hasOwnProperty("metadata"))for(var l=i.metadata,s=0;s<l.length;s++)if(l[s].value.constructor===Array){var d=a(l[s].value,"en");r+=n(l[s].label,d)}else r+=n(l[s].label,l[s].value);r+=o(["description","within","see_also","service","license","attribution"]),r+="</div>",t.parentObject.prepend(r),e(t.selector+"metadata").hide()};return diva.Events.subscribe("ManifestDidLoad",n),t.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+t.ID+'metadata-link" class="diva-metadata-link">Details</a></div>'),e(t.selector+"metadata-link").on("click",function(i){e(t.selector+"metadata").fadeToggle("fast")}),!0},destroy:function(e,t){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){void 0===e.pageAliases&&(e.pageAliases={}),void 0===e.pageAliasFunction&&(e.pageAliasFunction=function(){return!1}),t.getAliasForPageIndex=function(t){return e.pageAliases[t]||e.pageAliasFunction(t)||t+1},t.getPageIndexForAlias=function(i){for(var n=0;n<e.numPages;n++)if(t.getAliasForPageIndex(n)==i)return n;return!1},t.getPageIndicesForAlias=function(i){for(var n=[],a=0;a<e.numPages;a++)t.getAliasForPageIndex(a)==i&&n.push(a);return n},t.getCurrentAliasedPageIndex=function(){return t.getAliasForPageIndex(e.currentPageIndex)},t.gotoPageByAliasedNumber=function(e,i,n){return t.gotoPageByIndex(t.getPageIndexForAlias(e),i,n)},updateCurrentAliasedPage=function(){document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex()},initialChanges=function(){var e=this.getSettings(),t=e.numPages;void 0!==e.newTotalPages?t=e.newTotalPages:void 0!==e.totalPageOffset&&(t+=e.totalPageOffset),document.getElementById(this.getSettings().ID+"num-pages").textContent=t,document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex(),diva.Events.unsubscribe(["VisiblePageDidChange",e.toolbar.updateCurrentPage]),diva.Events.subscribe("VisiblePageDidChange",updateCurrentAliasedPage)},diva.Events.subscribe("ViewerDidLoad",initialChanges)},pluginName:"pagealias",titleText:"Re-aliases page indexes"};return e}())}(jQuery);
//# sourceMappingURL=diva.min.js.map