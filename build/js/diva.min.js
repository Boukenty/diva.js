!function(e){var t;if("object"==typeof module&&module.exports)try{t=require("jquery")}catch(i){}e(t||jQuery)}(function(e){Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},function(e){var t=1;e.generateId=function(e){var i;do i=t++ +(e?"-"+e:"");while(document.getElementById(i));return i}}(e),function(e){e.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return i==n&&(n=t.clientWidth),document.body.removeChild(t),i-n}}(e),function(e){e.getHashParam=function(e){var t=window.location.hash;if(""!==t){var i=t.indexOf("&"+e+"=")>0?t.indexOf("&"+e+"="):t.indexOf("#"+e+"=");if(i>=0){i+=e.length+2;var n=t.indexOf("&",i);return n>i?decodeURIComponent(t.substring(i,n)):0>n?decodeURIComponent(t.substring(i)):""}return!1}return!1}}(e),function(e){e.updateHashParam=function(t,i){var n=e.getHashParam(t),a=window.location.hash;if(n!==i)if("string"==typeof n){var o=a.indexOf("&"+t+"=")>0?a.indexOf("&"+t+"="):a.indexOf("#"+t+"="),r=o+t.length+2+n.length,l=0===o?"#":"&";window.location.replace(a.substring(0,o)+l+t+"="+i+a.substring(r))}else 0===a.length?window.location.replace("#"+t+"="+i):window.location.replace(a+"&"+t+"="+i)}}(e),function(e){e.fn.dragscrollable=function(t){var i=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),n={mouseDownHandler:function(t){return 1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this?!1:(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",n.mouseUpHandler,t.data),e.event.add(document,"mousemove",n.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t={left:e.clientX-e.data.lastCoord.left,top:e.clientY-e.data.lastCoord.top};return e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t.left),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-t.top),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault?(e.preventDefault(),!1):void 0},mouseUpHandler:function(t){return e.event.remove(document,"mousemove",n.mouseMoveHandler),e.event.remove(document,"mouseup",n.mouseUpHandler),t.data.preventDefault?(t.preventDefault(),!1):void 0}};this.each(function(){var t={scrollable:e(this),acceptPropagatedEvent:i.acceptPropagatedEvent,preventDefault:i.preventDefault};e(this).find(i.dragSelector).bind("mousedown",t,n.mouseDownHandler)})}}(e),function(e){"use strict";var t={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i="kinetic-settings",n="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var a=function(){return!1},o=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},r=function(e,t){var i=e;return e>0?e>t&&(i=t):0-t>e&&(i=0-t),i},l=function(e,t){this.removeClass(e.movingClass.up).removeClass(e.movingClass.down).removeClass(e.movingClass.left).removeClass(e.movingClass.right).removeClass(e.deceleratingClass.up).removeClass(e.deceleratingClass.down).removeClass(e.deceleratingClass.left).removeClass(e.deceleratingClass.right),e.velocity>0&&this.addClass(t.right),e.velocity<0&&this.addClass(t.left),e.velocityY>0&&this.addClass(t.down),e.velocityY<0&&this.addClass(t.up)},s=function(e,t){t.velocity=0,t.velocityY=0,t.decelerate=!0,"function"==typeof t.stopped&&t.stopped.call(e,t)},c=function(e,t){var i=e[0];t.x&&i.scrollWidth>0?(i.scrollLeft=t.scrollLeft=i.scrollLeft+t.velocity,Math.abs(t.velocity)>0&&(t.velocity=t.decelerate?o(t.velocity,t.slowdown):t.velocity)):t.velocity=0,t.y&&i.scrollHeight>0?(i.scrollTop=t.scrollTop=i.scrollTop+t.velocityY,Math.abs(t.velocityY)>0&&(t.velocityY=t.decelerate?o(t.velocityY,t.slowdown):t.velocityY)):t.velocityY=0,l.call(e,t,t.deceleratingClass),"function"==typeof t.moved&&t.moved.call(e,t),Math.abs(t.velocity)>0||Math.abs(t.velocityY)>0?window.requestAnimationFrame(function(){c(e,t)}):s(e,t)},d=function(t,n){var a=e.kinetic.callMethods[t],o=Array.prototype.slice.call(arguments);a&&this.each(function(){var t=o.slice(1),n=e(this).data(i);t.unshift(n),a.apply(this,t)})},u=function(t,i){t[0];e.support.touch?t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove):t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",a).bind("dragstart",i.events.dragStart)},g=function(t,i){t[0];e.support.touch?t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove):t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove).unbind("scroll",i.events.scroll),t.unbind("click",i.events.inputClick).unbind("selectstart",a),t.unbind("dragstart",i.events.dragStart)},v=function(a){this.addClass(n).each(function(){var n=this,o=e(this);if(!o.data(i)){var s,d,g,v,p=e.extend({},t,a),h=!1,f=!1,m=!1,b=1e3/p.throttleFPS;p.velocity=0,p.velocityY=0;var w=function(){s=!1,d=!1,m=!1};e(document).mouseup(w).click(w);var I=function(){p.velocity=r(h-s,p.maxvelocity),p.velocityY=r(f-d,p.maxvelocity)},y=function(t){return e.isFunction(p.filterTarget)?p.filterTarget.call(n,t)!==!1:!0},x=function(e,t){m=!0,p.velocity=h=0,p.velocityY=f=0,s=e,d=t},P=function(){s&&h&&p.decelerate===!1&&(p.decelerate=!0,I(),s=h=m=!1,c(o,p))},D=function(t,i){(!g||new Date>new Date(g.getTime()+b))&&(g=new Date,m&&(s||d)&&(v&&(e(v).blur(),v=null,o.focus()),p.decelerate=!1,p.velocity=p.velocityY=0,o[0].scrollLeft=p.scrollLeft=p.x?o[0].scrollLeft-(t-s):o[0].scrollLeft,o[0].scrollTop=p.scrollTop=p.y?o[0].scrollTop-(i-d):o[0].scrollTop,h=s,f=d,s=t,d=i,I(),l.call(o,p,p.movingClass),"function"==typeof p.moved&&p.moved.call(o,p)))};p.events={touchStart:function(e){var t;y(e.target)&&(t=e.originalEvent.touches[0],x(t.clientX,t.clientY),e.stopPropagation())},touchMove:function(e){var t;m&&(t=e.originalEvent.touches[0],D(t.clientX,t.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){y(e.target)&&(x(e.clientX,e.clientY),v=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){P(),v=null,e.preventDefault&&e.preventDefault()},inputMove:function(e){m&&(D(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(e){"function"==typeof p.moved&&p.moved.call(o,p),e.preventDefault&&e.preventDefault()},inputClick:function(e){return Math.abs(p.velocity)>0?(e.preventDefault(),!1):void 0},dragStart:function(e){return v?!1:void 0}},u(o,p),o.data(i,p).css("cursor",p.cursor),p.triggerHardware&&o.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};e.kinetic={settingsKey:i,callMethods:{start:function(t,i){var n=e(this);t=e.extend(t,i),t&&(t.decelerate=!1,c(n,t))},end:function(t,i){e(this);t&&(t.decelerate=!0)},stop:function(t,i){var n=e(this);s(n,t)},detach:function(t,i){var a=e(this);g(a,t),a.removeClass(n).css("cursor","")},attach:function(t,i){var a=e(this);u(a,t),a.addClass(n).css("cursor","move")}}},e.fn.kinetic=function(e){return"string"==typeof e?d.apply(this,arguments):v.call(this,e),this}}(e);var t=function(){var e={},t={Events:{publish:function(t,i,n){if(e[t]){var a=e[t];if("undefined"!=typeof a.global)for(var o=a.global,r=o.length;r--;)o[r].apply(n||this,i||[]);if(n&&"undefined"!=typeof n.getInstanceId){var l=n.getInstanceId();if(e[t][l])for(var s=e[t][l],c=s.length;c--;)s[c].apply(n||this,i||[])}}},subscribe:function(t,i,n){e[t]||(e[t]={}),"string"==typeof n?(e[t][n]||(e[t][n]=[]),e[t][n].push(i)):(e[t].global||(e[t].global=[]),e[t].global.push(i));var a=n?[t,i,n]:[t,i];return a},unsubscribe:function(t,i){var n=t[0];if(e[n]){var a,o=3===t.length&&"undefined"!=typeof e[n][t[2]]?t[2]:"global";a=e[n][o];for(var r=a.length;r--;)if(a[r]===t[1])return e[n][o].splice(r,1),i&&delete e[n][o],!0}return!1},unsubscribeAll:function(t){if(t)for(var i,n=Object.keys(e),a=n.length;a--;)i=n[a],"undefined"!==e[i][t]&&delete e[i][t];else e={}}}};return t}();window.diva=t,"object"==typeof module&&module.exports&&(module.exports=t);var i=function(e){return function(){var t;e(document).on("click",function(t){i(e(t.target))});var i=function(i){var n,a,o=i.find(".diva-outer"),r=i.closest(".diva-outer"),l=document.getElementsByClassName("diva-outer"),s=l.length;if(o.length>0)n=o;else{if(!(r.length>0)){for(a=0;s>a;a++)e(l[a].parentElement).data("diva").deactivate();return}n=r}for(n.parent().data("diva").activate(),t=n.parent(),l=document.getElementsByClassName("diva-outer"),a=0;s>a;a++)l[a].getAttribute("id")!=n.attr("id")&&e(l[a].parentElement).data("diva").deactivate()};this.getActive=function(){return t}}}(e);new i;window.divaPlugins=[],function(e){var i=function(i,n){var a=e(i),o={adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inBookLayout:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:a,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},r=e.extend({},o,n),l={allTilesLoaded:[],averageHeights:[],averageWidths:[],currentPageIndex:0,doubleClickZoom:!1,documentPaged:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerObject:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerObject:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,parentObject:a,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0};e.extend(r,l);var s=this,c=function(e,t){return r.pages[e].d[r.zoomLevel][t]},d=function(e){var t,i=r.numPages;for(t=0;i>t;t++)if(r.pages[t].f===e)return t;return-1},u=function(e,t){var i=r.outerObject.scrollLeft()-r.viewportMargin,n=i+r.panelWidth+2*r.viewportMargin,a=e>=i&&n>=e,o=i>=e&&t>=n,l=t>=i&&n>=t;return a||o||l},g=function(e,t){var i=r.outerObject.scrollTop()-r.viewportMargin,n=i+r.panelHeight+2*r.viewportMargin,a=e>=i&&n>=e,o=i>=e&&t>=n,l=t>=i&&n>=t;return a||o||l},v=function(e,t,i){var n,a;r.verticallyOriented?(n=r.pageTopOffsets[e]+t*r.tileHeight+r.verticalPadding,a=r.pageLeftOffsets[e]+i*r.tileWidth):(n=r.pageTopOffsets[e]+t*r.tileHeight,a=r.pageLeftOffsets[e]+i*r.tileWidth+r.horizontalPadding);var o=n+r.tileHeight,l=a+r.tileWidth;return g(n,o)&&u(a,l)},p=function(e,t){return!!document.getElementById(r.ID+"tile-"+e+"-"+t)},h=function(e){return e>=0&&e<r.numPages},f=function(e){var t=r.pageTopOffsets[e],i=t+c(e,"h")+r.verticalPadding,n=r.pageLeftOffsets[e],a=n+c(e,"w")+r.horizontalPadding;return g(t,i)&&u(n,a)},m=function(e){return!!document.getElementById(r.ID+"page-"+e)},b=function(e,i,n,a,o){var l=document.getElementById(r.ID+"page-"+e);if(null!==l&&f(e)){var d,u,g,h,m,b,w,I,y,x,P,D,L,O=r.imageDir+"/",C=Math.ceil(c(e,"h")/r.tileWidth),E=Math.ceil(c(e,"w")/r.tileHeight),T=r.pages[e].m,k=r.iipServerURL+"?FIF="+O+i+"&JTL=",S=!0,z=0,M=a-(C-1)*r.tileHeight,j=n-(E-1)*r.tileWidth;w=r.zoomLevel+T-r.realMaxZoom;var A=r.isIIIF?r.pages[e].url:k+w+",";if(r.isIIIF){L=Math.pow(2,T-w),y=r.tileHeight*L,x=r.tileWidth*L;var H=r.pages[e].api,F=H>=2?"default":"native",B="/0/"+F+".jpg";r.pages[e].hasOwnProperty("xoffset")?(P=r.pages[e].xoffset,D=r.pages[e].yoffset):(P=0,D=0)}else y=r.tileHeight,x=r.tileWidth;for(d=0;C>d;){for(u=0,g=d===C-1?M:r.tileHeight;E>u;){if(m=d*r.tileHeight,b=u*r.tileWidth,h=u===E-1?j:r.tileWidth,I=r.isIIIF?A+(u*x+P)+","+(d*y+D)+","+h*L+","+g*L+"/"+h+","+B:A+z,!p(e,z))if(v(e,d,u)){var R=document.createElement("div");R.id=r.ID+"tile-"+e+"-"+z,R.classList.add("diva-document-tile"),R.style.display="inline",R.style.position="absolute",R.style.top=m+"px",R.style.left=b+"px",R.style.backgroundImage="url('"+I+"')",R.style.height=g+"px",R.style.width=h+"px",l.appendChild(R)}else S=!1;z++,u++}d++}r.allTilesLoaded[e]=S,t.Events.publish("PageDidLoad",[e,i,o],s)}},w=function(e){if(!(m(e)&&r.allTilesLoaded[e]||r.inBookLayout&&r.documentPaged&&!r.pages[e].paged)){var i=r.pages[e].f,n=c(e,"w"),a=c(e,"h"),o=r.pageTopOffsets[e]+r.verticalPadding,l=r.pageLeftOffsets[e]+r.horizontalPadding,d=r.selector+"page-"+e;if(!m(e)){var u=document.getElementById(r.ID+"inner"),g=document.createElement("div");if(g.id=r.ID+"page-"+e,g.classList.add("diva-page","diva-document-page"),g.setAttribute("data-index",e),g.setAttribute("data-filename",i),r.enableImageTitles&&(g.title="Page "+(e+1)),g.innerHTML=r.pageTools,g.style.width=n+"px",g.style.height=a+"px",r.verticallyOriented)if(g.style.top=o+"px",r.inBookLayout)if(g.style.left=l+"px",e%2)g.classList.add("diva-page-book-left");else{if(0===e){var v=document.createElement("div");v.id=r.ID+"page-placeholder",v.classList.add("diva-page","diva-document-page"),v.style.width=n+"px",v.style.height=a+"px",v.style.left=0-n+"px",v.style.border="1px solid #ccc",v.style.background="#fdfdfd",v.style.mozBoxSizing="border-box",v.style.webkitBoxSizing="border-box",v.style.boxSizing="border-box",g.appendChild(v)}g.classList.add("diva-page-book")}else g.classList.add("diva-page-vertical");else g.style.left=l+"px",g.classList.add("diva-page-horizontal");u.appendChild(g),t.Events.publish("PageWillLoad",[e,i,d],s)}r.pageTimeouts.push(setTimeout(b,r.pageLoadTimeout,e,i,n,a))}},I=function(e){var t=document.getElementById(r.ID+"page-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},y=function(e){var t=r.pageTopOffsets[e]+c(e,"h")+r.verticalPadding,i=document.getElementById(r.ID+"outer").scrollTop;return i>t},x=function(e){var t=r.pageTopOffsets[e],i=document.getElementById(r.ID+"outer").scrollTop+r.panelHeight;return t>i},P=function(e){var t=r.pageLeftOffsets[e]+c(e,"w")+r.horizontalPadding,i=document.getElementById(r.ID+"outer").scrollLeft;return i>t},D=function(e){var t=r.pageLeftOffsets[e],i=document.getElementById(r.ID+"outer").scrollLeft+r.panelWidth;return t>i},L=function(e){return r.verticallyOriented?y(e):P(e)},O=function(e){return r.verticallyOriented?x(e):D(e)},C=function(e,t){h(e)&&(t>0?f(e)?(w(e),r.lastPageLoaded=e,C(r.lastPageLoaded+1,t)):h(e+1)&&f(e+1)?(w(e+1),r.lastPageLoaded=e+1,C(r.lastPageLoaded+1,t)):L(e)&&C(e+1,t):f(e)?(w(e),r.firstPageLoaded=e,C(r.firstPageLoaded-1,t)):h(e-1)&&f(e-1)?(w(e-1),r.firstPageLoaded=e-1,C(r.firstPageLoaded-1,t)):O(e)&&C(e-1,t))},E=function(e,t){t>0?h(e)&&L(e)&&(I(e),r.firstPageLoaded=e+1,E(r.firstPageLoaded,t)):h(e)&&O(e)&&(I(e),r.lastPageLoaded=e-1,E(r.lastPageLoaded,t))},T=function(e){var i;if(0>e)C(r.lastPageLoaded,e),W(-1),E(r.lastPageLoaded,e);else if(e>0)C(r.firstPageLoaded,e),W(1),E(r.firstPageLoaded,e);else{var n=r.lastPageLoaded;for(i=Math.max(r.firstPageLoaded,0);n>=i;i++)f(i)&&w(i)}var a=r.verticallyOriented?document.getElementById(r.ID+"outer").scrollTop:document.getElementById(r.ID+"outer").scrollLeft;t.Events.publish("ViewerDidScroll",[a],s),e>0?t.Events.publish("ViewerDidScrollDown",[a],s):0>e&&t.Events.publish("ViewerDidScrollUp",[a],s)},k=function(e){return e>=0&&e<r.numRows},S=function(e){var t=r.rowHeight*e,i=t+r.rowHeight+r.fixedPadding;return g(t,i)},z=function(e){return!!document.getElementById(r.ID+"row-"+e)},M=function(e){if(!z(e)){var i=r.rowHeight*e+r.fixedPadding,n=document.getElementById(r.ID+"inner"),a=document.createElement("div");a.id=r.ID+"row-"+e,a.classList.add("diva-row"),a.style.height=r.rowHeight+"px",a.style.top=i+"px",n.appendChild(a);var o,l,d,u,g,v,p,f,m,b,w,I,y=r.imageDir+"/",x=r.pagesPerRow;for(o=0;x>o&&(l=e*r.pagesPerRow+o,h(l));o++){d=r.pages[l].f,u=c(l,"w"),g=c(l,"h"),v=r.fixedHeightGrid?(r.rowHeight-r.fixedPadding)*u/g:r.gridPageWidth,p=r.fixedHeightGrid?r.rowHeight-r.fixedPadding:v/u*g,f=parseInt(o*(r.fixedPadding+r.gridPageWidth)+r.fixedPadding,10),b=r.pages[l].api,w=b>=2?"default":"native",I=",/0/"+w+".jpg",v=parseInt(v,10),p=parseInt(p,10),f+=r.fixedHeightGrid?(r.gridPageWidth-v)/2:0,m=r.isIIIF?encodeURI(r.pages[l].url+"full/"+v+I):encodeURI(r.iipServerURL+"?FIF="+y+d+"&HEI="+(p+2)+"&CVT=JPEG"),r.pageTopOffsets[l]=i,r.pageLeftOffsets[l]=f;var P=document.createElement("div");P.id=r.ID+"page-"+l;var D=r.selector+"page-"+l;P.classList.add("diva-page","diva-grid-page"),P.style.width=v+"px",P.style.height=p+"px",P.style.left=f+"px",P.setAttribute("data-index",l),P.setAttribute("data-filename",d),r.enableImageTitles&&(P.title="Page "+(l+1)),a.appendChild(P),t.Events.publish("PageWillLoad",[l,d,D],s),Z(e,l,m,v,p)}}},j=function(e){var t=document.getElementById(r.ID+"row-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},A=function(e){var t=r.rowHeight*(e+1),i=document.getElementById(r.ID+"outer").scrollTop;return i>t},H=function(e){var t=r.rowHeight*e,i=document.getElementById(r.ID+"outer").scrollTop+r.panelHeight;return t>i},F=function(e,t){t>0?k(e)&&(S(e)?(M(e),r.lastRowLoaded=e,F(r.lastRowLoaded+1,t)):A(e)&&F(e+1,t)):k(e)&&(S(e)?(M(e),r.firstRowLoaded=e,F(r.firstRowLoaded-1,t)):H(e)&&F(e-1,t))},B=function(e,t){t>0?k(e)&&A(e)&&(j(e),r.firstRowLoaded++,B(r.firstRowLoaded,t)):k(e)&&H(e)&&(j(e),r.lastRowLoaded--,B(r.lastRowLoaded,t))},R=function(e){0>e?(F(r.firstRowLoaded,-1),N(-1),B(r.lastRowLoaded,-1)):e>0&&(F(r.lastRowLoaded,1),N(1),B(r.firstRowLoaded,1));var i=document.getElementById(r.ID+"outer").scrollTop;t.Events.publish("ViewerDidScroll",[i],s),e>0?t.Events.publish("ViewerDidScrollDown",[i],s):0>e&&t.Events.publish("ViewerDidScrollUp",[i],s)},Z=function(e,t,i,n,a){var o=function(e,t,i,n,a){if(m(t)){var o=document.createElement("img");o.src=i,o.style.width=n+"px",o.style.height=a+"px",document.getElementById(r.ID+"page-"+t).appendChild(o)}};r.pageTimeouts.push(window.setTimeout(o,r.rowLoadTimeout,e,t,i,n,a))},W=function(e){var i=r.currentPageIndex,n=i+e;if(!h(n))return!1;var a=r.verticallyOriented?document.getElementById(r.ID+"outer").scrollTop+r.panelHeight/2:document.getElementById(r.ID+"outer").scrollLeft+r.panelWidth/2,o=document.getElementById(r.ID+"outer").scrollLeft+r.panelWidth/2,l=!1;r.selector+"page-"+n;if(0>e?r.verticallyOriented?n>=0&&r.pageTopOffsets[n]+c(n,"h")+r.verticalPadding>=a&&(l=!0):n>=0&&r.pageLeftOffsets[n]+c(n,"w")+r.horizontalPadding>=a&&(l=!0):e>0&&(r.verticallyOriented?r.pageTopOffsets[i]+c(i,"h")+r.verticalPadding<a&&(l=!0):r.pageLeftOffsets[i]+c(i,"w")+r.horizontalPadding<a&&(l=!0)),r.inBookLayout&&r.verticallyOriented){var d=i+1;if(h(d)&&d%2===0&&r.pageLeftOffsets[d]<o&&d!==r.currentPageIndex){r.currentPageIndex=d;var u=r.pages[d].f;t.Events.publish("VisiblePageDidChange",[d,u],s)}}if(l){if(r.currentPageIndex=n,0!==e&&!W(e)){var u=r.pages[n].f;t.Events.publish("VisiblePageDidChange",[n,u],s)}return!0}return!1},N=function(e){var i=Math.floor(r.currentPageIndex/r.pagesPerRow),n=i+parseInt(e,10),a=document.getElementById(r.ID+"outer").scrollTop,o=a+r.panelHeight/2,l=!1;if(0>e?n>=0&&(r.rowHeight*i>=o||r.rowHeight*n>=a)&&(l=!0):e>0&&r.rowHeight*(i+1)<a&&k(n)&&(l=!0),l){if(r.currentPageIndex=n*r.pagesPerRow,0!==e&&!N(e)){var c=r.currentPageIndex,d=r.pages[c].f;t.Events.publish("VisiblePageDidChange",[c,d],s)}return!0}return!1},G=function(e){var t=ue(e,"top"),i=ge(e,"center");V(e,t,i)},V=function(e,i,n){n="undefined"!=typeof n?n:0,i="undefined"!=typeof i?i:0;var a=r.pageTopOffsets[e]+i,o=a-parseInt(r.panelHeight/2,10),l=r.pageLeftOffsets[e]+n,c=l-parseInt(r.panelWidth/2,10);if(r.outerObject.scrollTop(o),r.outerObject.scrollLeft(c),e!==r.currentPageIndex){r.currentPageIndex=e;var d=r.pages[e].f;t.Events.publish("VisiblePageDidChange",[e,d],s)}t.Events.publish("ViewerDidJump",[e],s)},Y=function(e){var i=Math.floor(e/r.pagesPerRow),n=i*r.rowHeight;r.outerObject.scrollTop(n),r.currentPageIndex=e;var a=r.pages[e].f;t.Events.publish("VisiblePageDidChange",[e,a],s)},_=function(){Y(r.goDirectlyTo)},X=function(e){return e>=r.minZoomLevel&&e<=r.maxZoomLevel?e:r.minZoomLevel},U=function(e){return e>=r.minPagesPerRow&&e<=r.maxPagesPerRow?e:r.maxPagesPerRow},q=function(){for(r.allTilesLoaded=[],r.outerObject.scrollTop(0),r.innerObject.empty(),r.firstPageLoaded=0,r.firstRowLoaded=-1,r.previousTopScroll=0,r.previousLeftScroll=0,clearTimeout(r.resizeTimer);r.pageTimeouts.length;)clearTimeout(r.pageTimeouts.pop())},K=function(){r.inGrid?$():Q()},J=function(e,t){var i,n=0,a=0;if(r.pageTopOffsets=[],r.pageLeftOffsets=[],r.inBookLayout){var o=!1;if(r.verticallyOriented)for(i=0;i<r.numPages;i++){if(r.pageTopOffsets[i]=n,o)r.pageLeftOffsets[i]=e/2-c(i,"w")-r.horizontalPadding;else if(r.pageLeftOffsets[i]=e/2-r.horizontalPadding,!r.documentPaged||r.pages[i].paged){var l=h(i-1)?Math.max(c(i,"h"),c(i-1,"h")):c(i,"h");n=r.pageTopOffsets[i]+l+r.verticalPadding}(!r.documentPaged||r.pages[i].paged)&&(o=!o)}else for(i=0;i<r.numPages;i++){r.pageTopOffsets[i]=parseInt((t-c(i,"h"))/2,10),r.pageLeftOffsets[i]=a;var s=c(i,"w"),d=o?0:r.horizontalPadding;a=r.pageLeftOffsets[i]+s+d,(!r.documentPaged||r.pages[i].paged)&&(o=!o)}}else for(i=0;i<r.numPages;i++)r.pageTopOffsets[i]=parseInt(r.verticallyOriented?n:(t-c(i,"h"))/2,10),r.pageLeftOffsets[i]=parseInt(r.verticallyOriented?(e-c(i,"w"))/2:a,10),n=r.pageTopOffsets[i]+c(i,"h")+r.verticalPadding,a=r.pageLeftOffsets[i]+c(i,"w")+r.horizontalPadding},Q=function(){q(),r.zoomLevel=X(r.zoomLevel);var e=r.zoomLevel;r.totalHeight=r.totalHeights[e]+r.verticalPadding*(r.numPages+1),r.totalWidth=r.totalWidths[e]+r.horizontalPadding*(r.numPages+1);var i=r.inBookLayout?2*(r.maxWidths[e]+r.horizontalPadding):r.maxWidths[e]+2*r.horizontalPadding,n=r.maxHeights[e]+2*r.verticalPadding,a=Math.max(i,r.panelWidth),o=Math.max(n,r.panelHeight),l=document.getElementById(r.ID+"inner");r.verticallyOriented?(l.style.height=Math.round(r.totalHeight)+"px",l.style.width=Math.round(a)+"px"):(l.style.height=Math.round(o)+"px",l.style.width=Math.round(r.totalWidth)+"px"),J(a,o);var d=r.numPages-1;if(r.inBookLayout)if(r.verticallyOriented){var u=d%2||0===d?c(d,"h"):Math.max(c(d,"h"),c(d-1,"h"));l.style.height=r.pageTopOffsets[d]+u+2*r.verticalPadding+"px"}else l.style.width=r.pageLeftOffsets[d]+c(d,"w")+2*r.horizontalPadding+"px";h(r.goDirectlyTo)||(r.goDirectlyTo=0),V(r.goDirectlyTo,r.verticalOffset,r.horizontalOffset);for(var g=!1,v=0;v<r.numPages;v++)if(f(v))w(v),r.lastPageLoaded=v,g=!0;else if(g)break;r.oldZoomLevel>=0?(r.oldZoomLevel<r.zoomLevel?t.Events.publish("ViewerDidZoomIn",[e],s):t.Events.publish("ViewerDidZoomOut",[e],s),t.Events.publish("ViewerDidZoom",[e],s)):r.oldZoomLevel=r.zoomLevel,r.scaleWait&&(r.scaleWait=!1);var p=r.pages[r.currentPageIndex].f;t.Events.publish("DocumentDidLoad",[r.currentPageIndex,p],s)},$=function(){var e=r.currentPageIndex;r.verticalOffset=r.verticallyOriented?r.panelHeight/2:c(e,"h")/2,r.horizontalOffset=r.verticallyOriented?c(e,"w")/2:r.panelWidth/2,q(),r.pagesPerRow=U(r.pagesPerRow);var t=r.fixedPadding*(r.pagesPerRow+1),i=(r.panelWidth-t)/r.pagesPerRow;r.gridPageWidth=i,r.rowHeight=r.fixedHeightGrid?r.fixedPadding+r.minRatio*i:r.fixedPadding+r.maxRatio*i,r.numRows=Math.ceil(r.numPages/r.pagesPerRow),r.totalHeight=r.numRows*r.rowHeight+r.fixedPadding;var n=document.getElementById(r.ID+"inner");n.style.height=Math.round(r.totalHeight)+"px",n.style.width=Math.round(r.panelWidth)+"px",_();var a,o;r.pageTopOffsets=[],r.pageLeftOffsets=[];var l=r.numPages;for(a=0;l>a;a+=r.pagesPerRow)o=Math.floor(a/r.pagesPerRow),S(o)&&(r.firstRowLoaded=r.firstRowLoaded<0?o:r.firstRowLoaded,M(o),r.lastRowLoaded=o)},ee=function(e){27==e.keyCode&&ne()},te=function(i){if(r.outerObject.toggleClass("diva-fullscreen"),e("body").toggleClass("diva-hide-scrollbar"),r.parentObject.toggleClass("diva-full-width"),r.mobileWebkit){var n=parseInt(r.outerObject.css("margin-left"),10)-parseInt(e("body").css("margin-left"),10);r.outerObject.css("margin-left",n)}var a=r.panelHeight,o=r.panelWidth;if(be(),r.oldZoomLevel>=0&&!r.inGrid){var l=r.panelHeight,c=r.panelWidth;r.inFullscreen?(r.verticalOffset-=(l-a)/2,r.horizontalOffset-=(c-o)/2):(r.verticalOffset+=(a-l)/2,r.horizontalOffset+=(o-c)/2)}i?(r.inGrid=!r.inGrid,ie()):K(),r.inFullscreen?e(document).on("keyup",ee):e(document).off("keyup",ee),t.Events.publish("ModeDidSwitch",[r.inFullscreen],s)},ie=function(){return K(),t.Events.publish("ViewDidSwitch",[r.inGrid],s),!0},ne=function(){r.goDirectlyTo=r.currentPageIndex,r.inFullscreen=!r.inFullscreen,te(!1)},ae=function(e){switch(r.goDirectlyTo=r.currentPageIndex,e){case"document":r.inGrid=!1,r.inBookLayout=!1;break;case"book":r.inGrid=!1,r.inBookLayout=!0;break;case"grid":r.inGrid=!0;break;default:return!1}return ie()},oe=function(){return r.verticallyOriented=!r.verticallyOriented,r.verticalOffset=ue(),r.horizontalOffset=ge(),r.goDirectlyTo=r.currentPageIndex,r.inGrid?(r.inGrid=!1,ie()):Q(),r.verticallyOriented},re=function(t){var i=e(this).offset();r.doubleClickZoom=!0,r.horizontalOffset=t.pageX-i.left,r.verticalOffset=t.pageY-i.top,r.goDirectlyTo=parseInt(e(this).attr("data-index"),10);var n=t.ctrlKey?r.zoomLevel-1:r.zoomLevel+1;ce(n)},le=function(t){var i=parseInt(e(this).attr("data-index"),10);r.goDirectlyTo=i;var n=e(this).offset(),a=c(i,"w")/e(this).width();r.horizontalOffset=(t.pageX-n.left)*a,r.verticalOffset=(t.pageY-n.top)*a,r.inGrid=!1,ie()},se=function(t,i){var n=r.zoomLevel;if(t>100&&n<r.maxZoomLevel)n++;else{if(!(-100>t&&n>r.minZoomLevel))return;n--}r.scaleWait=!0;var a=e(this).offset();r.horizontalOffset=i.pageX-a.left,r.verticalOffset=i.pageY-a.top,r.goDirectlyTo=parseInt(e(this).attr("data-index"),10),ce(n)},ce=function(e){var i=X(e);if(i!==e)return!1;var n=Math.pow(2,i-r.zoomLevel);return r.doubleClickZoom?(r.verticalOffset*=n,r.horizontalOffset*=n,r.doubleClickZoom=!1):(r.goDirectlyTo=r.currentPageIndex,r.verticalOffset=n*ve(),r.horizontalOffset=n*pe()),r.oldZoomLevel=r.zoomLevel,r.zoomLevel=i,t.Events.publish("ZoomLevelDidChange",[i],s),Q(),!0},de=function(e){var i=U(e);return i!==e?!1:(r.pagesPerRow=i,t.Events.publish("GridRowNumberDidChange",[i],s),r.goDirectlyTo=r.currentPageIndex,$(),!0)},ue=function(e,t){return e="undefined"==typeof e?r.currentPageIndex:e,"center"===t||"centre"===t?parseInt(c(e,"h")/2,10):"bottom"===t?parseInt(c(e,"h")-r.panelHeight/2,10):parseInt(r.panelHeight/2,10)},ge=function(e,t){return e="undefined"==typeof e?r.currentPageIndex:e,"left"===t?parseInt(r.panelWidth/2,10):"right"===t?parseInt(c(e,"w")-r.panelWidth/2,10):parseInt(c(e,"w")/2,10)},ve=function(){var e=document.getElementById(r.ID+"outer").scrollTop,t=r.panelHeight;return e-r.pageTopOffsets[r.currentPageIndex]+parseInt(t/2,10)},pe=function(){var e=document.getElementById(r.ID+"outer").scrollLeft,t=r.panelWidth;return e-r.pageLeftOffsets[r.currentPageIndex]+parseInt(t/2,10)},he=function(){var e;e=r.inGrid?"g":r.inBookLayout?"b":"d";var t={f:r.inFullscreen,v:e,z:r.zoomLevel,n:r.pagesPerRow,i:r.enableFilename?r.pages[r.currentPageIndex].f:!1,p:r.enableFilename?!1:r.currentPageIndex+1,y:r.inGrid?!1:ve(),x:r.inGrid?!1:pe()};return t},fe=function(){var e,t=he(),i=[];for(e in t)t[e]!==!1&&i.push(e+r.hashParamSuffix+"="+encodeURIComponent(t[e]));return i.join("&")},me=function(){return location.protocol+"//"+location.host+location.pathname+location.search+"#"+fe()},be=function(){var e=document.getElementById(r.ID+"outer");return r.panelHeight=e.clientHeight-(e.scrollWidth>e.clientWidth?r.scrollbarWidth:0),r.panelWidth=e.clientWidth-(e.scrollHeight>e.clientHeight?r.scrollbarWidth:0),r.horizontalOffset=pe(),r.verticalOffset=ve(),V(r.currentPageIndex,r.verticalOffset,r.horizontalOffset),!0},we=function(){r.mobileWebkit||(r.outerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),r.innerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0})),r.outerObject.on("dblclick",".diva-document-page",function(e){re.call(this,e)}),r.outerObject.on("contextmenu",".diva-document-page",function(e){return e.ctrlKey?(clearTimeout(r.singleClickTimeout),r.singleClick?(re.call(this,e),r.singleClick=!1):(r.singleClick=!0,r.singleClickTimeout=setTimeout(function(){r.singleClick=!1},500)),!1):void 0}),r.outerObject.on("dblclick",".diva-row",function(t){le.call(e(t.target).parent(),t)})},Ie=function(){var e=r.panelWidth,t=r.panelHeight;be(),r.horizontalOffset-=(r.panelWidth-e)/2,r.verticalOffset-=(r.panelHeight-t)/2,r.goDirectlyTo=r.currentPageIndex,K()},ye=function(){be(),clearTimeout(r.resizeTimer),r.resizeTimer=setTimeout(function(){r.goDirectlyTo=r.currentPageIndex,r.verticalOffset=ve(),r.horizontalOffset=pe(),K()},200)},xe=function(){r.blockMobileMove&&e("body").bind("touchmove",function(e){var t=e.originalEvent;return t.preventDefault(),!1}),r.outerObject.kinetic({triggerHardware:!0});var i=[],n=[],a=0;r.outerObject.on("touchstart",".diva-document-page",function(e){2===e.originalEvent.touches.length&&(i=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY],a=Pe(i[2],i[0],i[3],i[1]))}),r.outerObject.on("touchmove",".diva-document-page",function(e){if(2===e.originalEvent.touches.length){n=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY];var t=Pe(n[2],n[0],n[3],n[1]),i=t-a;r.scaleWait||(r.goDirectlyTo=r.currentPageIndex,r.inGrid?(r.inGrid=!1,ie()):se.call(this,i,e))}});var o={},l=0,s=function(t){if(r.singleTap){var i={pageX:t.originalEvent.changedTouches[0].clientX,pageY:t.originalEvent.changedTouches[0].clientY};l=Pe(o.pageX,i.pageX,o.pageY,i.pageY),50>l&&r.zoomLevel<r.maxZoomLevel&&(r.inGrid?le.call(e(t.target).parent(),i):re.call(this,i)),r.singleTap=!1,o={}}else r.singleTap=!0,o.pageX=t.originalEvent.changedTouches[0].clientX,o.pageY=t.originalEvent.changedTouches[0].clientY,r.singleTapTimeout=setTimeout(function(){r.singleTap=!1,o={}},250)};r.outerObject.on("touchend",".diva-page",s);var c="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(c,Ie,!1),t.Events.subscribe("ViewerDidTerminate",function(){window.removeEventListener(c,Ie,!1)},r.ID)},Pe=function(e,t,i,n){return Math.sqrt((e-t)*(e-t)+(i-n)*(i-n))},De=function(){r.innerObject.mouseover(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),r.innerObject.mouseout(function(){e(this).removeClass("diva-grab")}),r.innerObject.mousedown(function(){e(this).removeClass("diva-grab").addClass("diva-grabbing")}),r.innerObject.mouseup(function(){
e(this).removeClass("diva-grabbing").addClass("diva-grab")}),we();var i=function(){var e,t=document.getElementById(r.ID+"outer").scrollTop,i=document.getElementById(r.ID+"outer").scrollLeft;e=r.verticallyOriented||r.inGrid?t-r.previousTopScroll:i-r.previousLeftScroll,r.inGrid?R(e):T(e),r.previousTopScroll=t,r.previousLeftScroll=i,r.horizontalOffset=pe(),r.verticalOffset=ve()};r.outerObject.scroll(i);var n=38,a=40,o=37,l=39,s=32,c=33,d=34,u=36,g=35;e(document).on("keydown.diva",function(e){if(!r.isActiveDiva)return!0;if(r.enableSpaceScroll&&!e.shiftKey&&e.keyCode===s||r.enableKeyScroll&&e.keyCode===d)return r.outerObject.scrollTop(document.getElementById(r.ID+"outer").scrollTop+r.panelHeight),!1;if(r.enableSpaceScroll||e.keyCode!==s||e.preventDefault(),r.enableKeyScroll){if(e.shiftKey||e.ctrlKey||e.metaKey)return!0;switch(e.keyCode){case c:return r.outerObject.scrollTop(document.getElementById(r.ID+"outer").scrollTop-r.panelHeight),!1;case n:return r.outerObject.scrollTop(document.getElementById(r.ID+"outer").scrollTop-r.arrowScrollAmount),!1;case a:return r.outerObject.scrollTop(document.getElementById(r.ID+"outer").scrollTop+r.arrowScrollAmount),!1;case o:return r.outerObject.scrollLeft(document.getElementById(r.ID+"outer").scrollLeft-r.arrowScrollAmount),!1;case l:return r.outerObject.scrollLeft(document.getElementById(r.ID+"outer").scrollLeft+r.arrowScrollAmount),!1;case u:return r.outerObject.scrollTop(0),!1;case g:return r.outerObject.scrollTop(r.totalHeight),!1;default:return!0}}return!0}),t.Events.subscribe("ViewerDidTerminate",function(){e(document).off("keydown.diva")},r.ID),r.mobileWebkit?xe():(window.addEventListener("resize",ye,!1),t.Events.subscribe("ViewerDidTerminate",function(){window.removeEventListener("resize",ye,!1)},r.ID))},Le=function(e,t){var i=document.createElement("span");return i.id=r.ID+e,i.setAttribute("class","diva-"+e+" diva-button"),i.title=t,i},Oe=function(){var e=document.createElement("div");e.id=r.ID+"view-menu",e.className="diva-view-menu";var t=Le("view-icon","Change view");e.appendChild(t);var i=document.createElement("div");return i.id=r.ID+"view-options",i.className="diva-view-options",e.appendChild(i),e},Ce=function(e,t,i,n){var a=document.createElement("input");return a.id=r.ID+e,a.className=e,a.setAttribute("type","range"),a.setAttribute("value",t),a.setAttribute("min",i),a.setAttribute("max",n),a},Ee=function(e,t,i,n,a){var o=document.createElement("div");o.id=r.ID+t,o.className=e+" diva-label";var l=document.createTextNode(i);o.appendChild(l);var s=document.createElement("span");s.id=r.ID+n;var c=document.createTextNode(a);return s.appendChild(c),o.appendChild(s),o},Te=function(e){var t=document.createElement("span");t.className=e+" diva-label";var i=document.createTextNode("Page "),n=document.createElement("span");n.id=r.ID+"current-page";var a=document.createTextNode(" of "),o=document.createElement("span");return o.id=r.ID+"num-pages",t.appendChild(i),t.appendChild(n),t.appendChild(a),t.appendChild(o),t},ke=function(){var i=document.createElement("div");i.id=r.ID+"tools",i.className="diva-tools";var n=document.createElement("div");n.id=r.ID+"tools-left",n.className="diva-tools-left";var a=document.createElement("div");if(a.id=r.ID+"tools-right",a.className="diva-tools-right","slider"===r.enableZoomControls){var o=Ce("zoom-slider",r.zoomLevel,r.minZoomLevel,r.maxZoomLevel);n.appendChild(o)}else"buttons"===r.enableZoomControls&&(n.appendChild(Le("zoom-out-button","Zoom Out")),n.appendChild(Le("zoom-in-button","Zoom In")));if("slider"===r.enableGridControls){var l=Ce("grid-slider",r.pagesPerRow,r.minPagesPerRow,r.maxPagesPerRow);n.appendChild(l)}else"buttons"===r.enableGridControls&&(n.appendChild(Le("grid-out-button","Zoom Out")),n.appendChild(Le("grid-in-button","Zoom In")));if("slider"===r.enableZoomControls||"buttons"===r.enableZoomControls){var c=Ee("diva-zoom-label","zoom-label","Zoom level: ","zoom-level",r.zoomLevel);n.appendChild(c)}if("slider"===r.enableGridControls||"buttons"===r.enableGridControls){var d=Ee("diva-grid-label","grid-label","Pages per row: ","pages-per-row",r.pagesPerRow);n.appendChild(d)}var u=document.createElement("span");u.id=r.ID+"page-nav",u.className="diva-page-nav";var g=Te("diva-page-label");if(u.appendChild(g),r.enableGotoPage){var v=document.createElement("form");v.id=r.ID+"goto-page",v.className="diva-goto-form";var p=document.createElement("input");p.id=r.ID+"goto-page-input",p.className="diva-input",p.setAttribute("type","text"),v.appendChild(p);var f=document.createElement("input");f.setAttribute("type","submit"),f.setAttribute("value","Go"),v.appendChild(f),u.appendChild(v)}a.appendChild(u);var m=Oe();if(a.appendChild(m),r.enableLinkIcon){var b=Le("link-icon","Link to this page");a.appendChild(b)}if(r.enableFullscreen){var w=Le("fullscreen-icon","Toggle fullscreen mode");a.appendChild(w)}i.appendChild(n),i.appendChild(a),r.toolbarParentObject.prepend(i);var I=function(){var e=document.createDocumentFragment(),t=Le("document-icon","Document View"),i=Le("book-icon","Book View"),n=Le("grid-icon","Grid View"),a=document.getElementById(r.ID+"view-icon"),o=" diva-view-icon diva-button";r.inGrid?a.className="diva-grid-icon"+o:r.inBookLayout?a.className="diva-book-icon"+o:a.className="diva-document-icon"+o,(r.inGrid||r.inBookLayout)&&e.appendChild(t),(r.inGrid||!r.inBookLayout)&&e.appendChild(i),r.inGrid||e.appendChild(n);for(var l=document.getElementById(r.ID+"view-options");l.firstChild;)l.removeChild(l.firstChild);l.appendChild(e)};e(r.selector+"zoom-slider").on("input",function(e){var t=parseInt(this.value,10);ce(t)}),e(r.selector+"zoom-slider").on("change",function(e){var t=parseInt(this.value,10);t!==r.zoomLevel&&ce(t)});var y=function(e){ce(r.zoomLevel+e)};e(r.selector+"zoom-out-button").click(function(){y(-1)}),e(r.selector+"zoom-in-button").click(function(){y(1)}),e(r.selector+"grid-slider").on("input",function(e){var t=parseInt(this.value,10);de(t)}),e(r.selector+"grid-slider").on("change",function(e){var t=parseInt(this.value,10);t!==r.zoomLevel&&de(t)}),e(r.selector+"fullscreen-icon").click(function(){ne()}),e(r.selector+"grid-out-button").click(function(){de(r.pagesPerRow-1)}),e(r.selector+"grid-in-button").click(function(){de(r.pagesPerRow+1)}),e(r.selector+"view-icon").click(function(){e(r.selector+"view-options").toggle()}),e(r.selector+"view-options").on("click",".diva-button",function(i){var n,a=i.target.classList[0];"diva-document-icon"===a?n="document":"diva-book-icon"===a?n="book":"diva-grid-icon"===a&&(n="grid"),t.Events.publish("UserDidChooseView",[n],s),e(r.selector+"view-options").hide()}),t.Events.subscribe("UserDidChooseView",ae,r.ID),e(document).mouseup(function(t){var i=e(r.selector+"view-options");i.is(t.target)||0!==i.has(t.target).length||t.target.id===r.ID+"view-icon"||i.hide()}),e(r.selector+"goto-page").submit(function(){var t=parseInt(e(r.selector+"goto-page-input").val(),10),i=t-1;return h(i)?r.inGrid?Y(i):G(i):alert("Invalid page number"),!1});var x=e(r.selector+"link-icon");x.click(function(){if(e("body").prepend('<div id="'+r.ID+'link-popup" class="diva-popup diva-link-popup"><input id="'+r.ID+'link-popup-input" class="diva-input" type="text" value="'+me()+'"/></div>'),r.inFullscreen)e(r.selector+"link-popup").addClass("in-fullscreen");else{var t=x.offset().left-222+x.outerWidth(),i=x.offset().top+x.outerHeight()-1;e(r.selector+"link-popup").removeClass("in-fullscreen").css({top:i+"px",left:t+"px"})}return e("body").mouseup(function(t){var i=t.target.id;i!==r.ID+"link-popup"&&i!==r.ID+"link-popup-input"&&e(r.selector+"link-popup").remove()}),r.outerObject.scroll(function(){e(r.selector+"link-popup").remove()}),e(r.selector+"link-popup input").click(function(){e(this).focus().select()}),!1});var P=r.inGrid?"grid":"zoom";e(r.selector+P+"-slider").css("display","inline-block"),e(r.selector+P+"-out-button").css("display","inline-block"),e(r.selector+P+"-in-button").css("display","inline-block");var D=r.inFullscreen?"block":"inline-block";e(r.selector+P+"-label").css("display",D);var L={updateCurrentPage:function(){document.getElementById(r.ID+"current-page").textContent=parseInt(r.currentPageIndex,10)+1},setNumPages:function(e){document.getElementById(r.ID+"num-pages").textContent=e},updateZoomLabel:function(){"slider"===r.enableZoomControls&&r.zoomLevel!==e(r.selector+"zoom-slider").val()&&e(r.selector+"zoom-slider").val(r.zoomLevel),document.getElementById(r.ID+"zoom-level").textContent=r.zoomLevel.toString()},updateGridLabel:function(){"slider"===r.enableGridControls&&r.pagesPerRow!==e(r.selector+"grid-slider").val()&&e(r.selector+"grid-slider").val(r.pagesPerRow),document.getElementById(r.ID+"pages-per-row").textContent=r.pagesPerRow},closePopups:function(){e(".diva-popup").css("display","none")},switchView:function(t){e(r.selector+P+"-slider").hide(),e(r.selector+P+"-out-button").hide(),e(r.selector+P+"-in-button").hide(),e(r.selector+P+"-label").hide(),P=r.inGrid?"grid":"zoom",e(r.selector+P+"-slider").css("display","inline-block"),e(r.selector+P+"-out-button").css("display","inline-block"),e(r.selector+P+"-in-button").css("display","inline-block");var i=r.inFullscreen?"block":"inline-block";e(r.selector+P+"-label").css("display",i)},switchMode:function(){var t=document.getElementById(r.ID+"tools-right"),i=document.getElementById(r.ID+"page-nav");if(r.inFullscreen){e(r.selector+"tools").addClass("diva-fullscreen-tools"),t.removeChild(i),t.appendChild(i),P=r.inGrid?"grid":"zoom";var n=r.inFullscreen?"block":"inline-block";e(r.selector+P+"-label").css("display",n)}else{e(r.selector+"tools").removeClass("diva-fullscreen-tools"),t.removeChild(i),t.insertBefore(i,t.firstChild),P=r.inGrid?"grid":"zoom";var n=r.inFullscreen?"block":"inline-block";e(r.selector+P+"-label").css("display",n)}},displayViewMenu:I};return L},Se=function(){if(window.divaPlugins){var t=[];e.each(window.divaPlugins,function(e,i){var n=i.pluginName[0].toUpperCase()+i.pluginName.substring(1);if(r["enable"+n]){var a=i.init(r,s);if(!a)return;var o=i.titleText||n+" plugin";if("function"==typeof i.handleClick){t.push('<div class="diva-'+i.pluginName+'-icon" title="'+o+'"></div>');var l=r.mobileWebkit?"touchend":"click";r.outerObject.on(l,".diva-"+i.pluginName+"-icon",function(e){i.handleClick.call(this,e,r,s)})}r.plugins.push(i)}}),t.length&&(r.pageTools='<div class="diva-page-tools">'+t.join("")+"</div>")}},ze=function(){clearTimeout(r.throbberTimeoutID),e(r.selector+"throbber").hide()},Me=function(e){var t=e;switch(t){case"d":r.inGrid=!1,r.inBookLayout=!1;break;case"b":r.inGrid=!1,r.inBookLayout=!0;break;case"g":r.inGrid=!0,r.inBookLayout=!1}},je=function(e){var t=e["@id"],i=/#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/,n="",a=!0;if(/\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\//.test(t)){var o=t.split("/");n=o[o.length-4]}else if(i.test(t)){var r=i.exec(t);n=r[1]}else e.service&&e.service["@id"]&&(t=e.service["@id"],a=!1);a&&(t=t.split("/").slice(0,-4).join("/"));var l={url:t};if(n.length){var s=n.split(",");l.x=parseInt(s[0],10),l.y=parseInt(s[1],10),l.w=parseInt(s[2],10),l.h=parseInt(s[3],10)}return l},Ae=function(e){var i=function(e,t){return e/Math.pow(2,t)},n=function(e,t){var i=Math.max(e,t);return Math.ceil(Math.log((i+1)/257)/Math.log(2))},a=function(e,t){for(var i=e.length;i--;)e[i]=t};t.Events.publish("ManifestDidLoad",[e],this);var o=e.sequences[0];r.documentPaged="paged"===e.viewingHint||"paged"===o.viewingHint;for(var l,s,c,d,u,g,v,p,h,f=o.canvases,m=new Array(f.length),b=new Array(f.length),w=e.label,I=0,y=f.length;y>I;I++){p=f[I].images[0].resource,l=p.width||f[I].width,s=p.height||f[I].height,d=je(p),c=d.url,"/"!==c.slice(-1)&&(c+="/"),u=n(l,s),g=f[I].label;var x="non-paged"!==f[I].viewingHint;v=p.service["@context"],h="http://iiif.io/api/image/2/context.json"===v?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===v?1.1:1,b[I]={mx_w:l,mx_h:s,mx_z:u,fn:g,url:c,api:h,paged:x},d.hasOwnProperty("x")&&(b[I].xoffset=d.x,b[I].yoffset=d.y),m[I]=u}var P=Math.min.apply(Math,m),D=0,L=100,O=new Array(P+1),C=new Array(P+1),E=new Array(P+1),T=new Array(P+1),k=new Array(P+1);a(O,0),a(C,0),a(E,0),a(T,0),a(k,0);var S,z,M,j=[],A=b.length;for(I=0;A>I;I++){S=[];for(var H=0;P+1>H;H++){z=Math.floor(i(b[I].mx_w,P-H)),M=Math.floor(i(b[I].mx_h,P-H)),S[H]={h:M,w:z},O[H]+=z,C[H]+=M,E[H]=Math.max(z,E[H]),T[H]=Math.max(M,T[H]);var F=b[I].mx_h/b[I].mx_w;D=Math.max(F,D),L=Math.min(F,L)}j[I]={d:S,m:b[I].mx_z,f:b[I].fn,url:b[I].url,api:b[I].api,paged:b[I].paged},b[I].hasOwnProperty("xoffset")&&(j[I].xoffset=b[I].xoffset,j[I].yoffset=b[I].yoffset)}var B=[],R=[];for(I=0;P+1>I;I++)B.push(O[I]/b.length),R.push(C[I]/b.length);var Z={a_wid:B,a_hei:R,max_w:E,max_h:T,max_ratio:D,min_ratio:L,t_hei:C,t_wid:O},W={item_title:w,dims:Z,max_zoom:P,pgs:j};return W},He=function(e,t,i){ze();var n='<div id="'+r.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+t+" "+i+"</p>",a=0===r.objectData.lastIndexOf("http",0);if(a&&""===i){var o=r.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0];location.hostname!==o&&(n+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>')}n+="</div>",r.outerObject.append(n)},Fe=function(i){var n;if(!i.hasOwnProperty("@context")||-1===i["@context"].indexOf("iiif")&&-1===i["@context"].indexOf("shared-canvas")?n=i:(r.isIIIF=!0,n=Ae(i)),ze(),r.pages=n.pgs,r.maxRatio=n.dims.max_ratio,r.minRatio=n.dims.min_ratio,r.itemTitle=n.item_title,r.numPages=n.pgs.length,r.maxWidths=n.dims.max_w,r.maxHeights=n.dims.max_h,r.averageWidths=n.dims.a_wid,r.averageHeights=n.dims.a_hei,r.totalHeights=n.dims.t_hei,r.totalWidths=n.dims.t_wid,r.realMaxZoom=n.max_zoom,r.maxZoomLevel=r.maxZoomLevel>=0&&r.maxZoomLevel<=n.max_zoom?r.maxZoomLevel:n.max_zoom,r.minZoomLevel=r.minZoomLevel>=0&&r.minZoomLevel<=r.maxZoomLevel?r.minZoomLevel:0,r.zoomLevel=X(r.zoomLevel),r.minPagesPerRow=Math.max(2,r.minPagesPerRow),r.maxPagesPerRow=Math.max(r.minPagesPerRow,r.maxPagesPerRow),r.enableFilename){var a=e.getHashParam("i"+r.hashParamSuffix),o=d(a);h(o)&&(r.goDirectlyTo=o,r.currentPageIndex=o)}else{var l=parseInt(e.getHashParam("p"+r.hashParamSuffix),10)-1;h(l)&&(r.goDirectlyTo=l,r.currentPageIndex=l)}if(t.Events.publish("NumberOfPagesDidChange",[r.numPages],this),r.enableAutoTitle&&(e(r.selector+"title").length?e(r.selector+"title").html(r.itemTitle):r.parentObject.prepend('<div id="'+r.ID+'title" class="diva-title">'+r.itemTitle+"</div>")),h(parseInt(r.goDirectlyTo),10)||(r.goDirectlyTo=0),r.adaptivePadding>0){var s=r.zoomLevel;r.horizontalPadding=parseInt(r.averageWidths[s]*r.adaptivePadding,10),r.verticalPadding=parseInt(r.averageHeights[s]*r.adaptivePadding,10)}else r.horizontalPadding=r.fixedPadding,r.verticalPadding=r.fixedPadding;r.pageTools.length&&(r.verticalPadding=Math.max(40,r.verticalPadding)),r.documentPaged&&(r.inBookLayout=!0);var c=e.getHashParam("v"+r.hashParamSuffix);Me(c)},Be=function(){var i='<div id="'+r.ID+'throbber" class="diva-throbber"></div>';r.outerObject.append(i),r.throbberTimeoutID=setTimeout(function(){e(r.selector+"throbber").show()},r.throbberTimeout),e.ajax({url:r.objectData,cache:!0,dataType:"json",error:He,success:function(i,n,a){Fe(i),t.Events.publish("ObjectDidLoad",[r],s),be();var o=parseInt(e.getHashParam("y"+r.hashParamSuffix),10);isNaN(o)?r.verticalOffset=ue(r.currentPageIndex,"top"):r.verticalOffset=o;var l=parseInt(e.getHashParam("x"+r.hashParamSuffix),10);isNaN(l)?0===r.goDirectlyTo&&r.inBookLayout&&r.verticallyOriented?r.horizontalOffset=0+r.horizontalPadding:r.horizontalOffset=ge(r.currentPageIndex,"center"):r.horizontalOffset=l,r.inFullscreen?te(!1):K(),be(),t.Events.publish("ViewerDidLoad",[r],s),r.loaded=!0}})},Re=function(){return r.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)},Ze=function(){r.scrollbarWidth=e.getScrollbarWidth(),r.mobileWebkit=void 0!==window.orientation,r.ID=e.generateId("diva-"),r.selector="#"+r.ID;var i=parseInt(r.ID,10);i>1&&(r.hashParamSuffix=i),r.parentObject.append('<div id="'+r.ID+'outer" class="diva-outer"></div>'),r.outerObject=e(r.selector+"outer"),r.outerObject.append('<div id="'+r.ID+'inner" class="diva-inner diva-dragger"></div>'),r.innerObject=e(r.selector+"inner");var n=parseInt(e.getHashParam("n"+r.hashParamSuffix),10);n>=r.minPagesPerRow&&n<=r.maxPagesPerRow&&(r.pagesPerRow=n);var a=e.getHashParam("z"+r.hashParamSuffix);""!==a&&(a=parseInt(a,10),a>=r.minZoomLevel&&(r.zoomLevel=a)),r.enableToolbar&&(r.toolbar=ke(),t.Events.subscribe("VisiblePageDidChange",r.toolbar.updateCurrentPage,r.ID),t.Events.subscribe("ModeDidSwitch",r.toolbar.switchMode,r.ID),t.Events.subscribe("ViewDidSwitch",r.toolbar.switchView,r.ID),t.Events.subscribe("ViewDidSwitch",r.toolbar.displayViewMenu,r.ID),t.Events.subscribe("ZoomLevelDidChange",r.toolbar.updateZoomLabel,r.ID),t.Events.subscribe("GridRowNumberDidChange",r.toolbar.updateGridLabel,r.ID),t.Events.subscribe("NumberOfPagesDidChange",r.toolbar.setNumPages,r.ID),t.Events.subscribe("ObjectDidLoad",r.toolbar.displayViewMenu,r.ID),t.Events.subscribe("ObjectDidLoad",r.toolbar.switchView,r.ID),t.Events.subscribe("ObjectDidLoad",function(){r.toolbar.setNumPages(r.numPages)},r.ID),t.Events.subscribe("ViewerDidLoad",r.toolbar.switchMode,r.ID),t.Events.subscribe("ViewerDidLoad",function(){r.toolbar.updateCurrentPage(r.currentPageIndex)},r.ID),t.Events.subscribe("ViewerDidLoad",function(){r.toolbar.updateZoomLabel(r.zoomLevel)},r.ID));var o=e.getHashParam("f"+r.hashParamSuffix),l="true"===o;r.inFullscreen=r.inFullscreen&&"false"!==o||l,Be(),Se(),De()};Ze(),this.getItemTitle=function(){return r.itemTitle},this.gotoPageByNumber=function(e,t,i){var n=parseInt(e,10)-1;return h(n)?(V(n,ue(n,i),ge(n,t)),!0):!1},this.gotoPageByIndex=function(e,t,i){return e=parseInt(e,10),h(e)?(V(e,ue(e,i),ge(e,t)),!0):!1},this.getNumberOfPages=function(){return Re()?r.numPages:!1},this.getPageDimensionsAtZoomLevel=function(e,t){if(!Re())return!1;t>r.maxZoomLevel&&(t=r.maxZoomLevel);var i=r.pages[parseInt(e,10)],n=i.d[parseInt(t,10)];return{width:n.w,height:n.h}},this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(r.currentPageIndex,r.zoomLevel)},this.isReady=function(){return r.loaded},this.getCurrentPageIndex=function(){return r.currentPageIndex},this.getCurrentPageFilename=function(){return r.pages[r.currentPageIndex].f},this.getCurrentPageNumber=function(){return r.currentPageIndex+1},this.getFilenames=function(){for(var e=[],t=0;t<r.numPages;t++)e[t]=r.pages[t].f;return e},this.getZoomLevel=function(){return r.zoomLevel},this.getMaxZoomLevel=function(){return r.maxZoomLevel},this.getMaxZoomLevelForPage=function(e){return Re?r.pages[e].m:!1},this.getMinZoomLevel=function(){return r.minZoomLevel},this.setZoomLevel=function(e){return r.inGrid&&(r.goDirectlyTo=r.currentPageIndex,r.inGrid=!1,ie()),ce(e)},this.zoomIn=function(){return this.setZoomLevel(r.zoomLevel+1)},this.zoomOut=function(){return this.setZoomLevel(r.zoomLevel-1)},this.inViewport=function(e,t,i,n,a){var o=e-1,l=r.pageTopOffsets[o]+i,s=l+a,c=r.pageLeftOffsets[o]+t,d=c+n;return g(l,s)&&u(c,d)},this.isPageInViewport=function(e){return f(e)},this.isPageLoaded=function(e){return m(e)},this.toggleFullscreenMode=function(){ne()},this.closePopups=function(){r.toolbar.closePopups()},this.enterFullscreenMode=function(){return r.inFullscreen?!1:(ne(),!0)},this.leaveFullscreenMode=function(){return r.inFullscreen?(ne(),!0):!1},this.changeView=function(e){return ae(e)},this.enterGridView=function(){return r.inGrid?!1:(ae("grid"),!0)},this.leaveGridView=function(){return r.inGrid?(r.goDirectlyTo=r.currentPageIndex,r.inGrid=!1,ie(),!0):!1},this.gotoPageByName=function(e,t,i){var n=d(e);return h(n)?(V(n,ue(n,i),ge(n,t)),!0):!1},this.getPageIndex=function(e){return d(e)},this.getCurrentURL=function(){return me()},this.getURLHash=function(){return fe()},this.getState=function(){return he()},this.getInstanceSelector=function(){return r.selector},this.getInstanceId=function(){return r.ID},this.getSettings=function(){return r},this.translateFromMaxZoomLevel=function(e){var t=r.maxZoomLevel-r.zoomLevel;return e/Math.pow(2,t)},this.translateToMaxZoomLevel=function(e){var t=r.maxZoomLevel-r.zoomLevel;return 0===t?e:e*Math.pow(2,t)},this.setState=function(e){var t;t=d(e.i),h(t)?r.goDirectlyTo=t:h(e.p)&&(r.goDirectlyTo=e.p);var i=parseInt(e.x,10),n=parseInt(e.y,10);e.z>=r.minZoomLevel&&e.z<=r.maxZoomLevel&&(r.zoomLevel=e.z),e.n>=r.minPagesPerRow&&e.n<=r.maxPagesPerRow&&(r.pagesPerRow=e.n),r.inFullscreen!==e.f?(Me(e.v),r.inFullscreen=e.f,te(!1),r.horizontalOffset=i,r.verticalOffset=n,V(t,r.verticalOffset,r.horizontalOffset)):(r.horizontalOffset=i,r.verticalOffset=n,"g"===e.v&&(!r.inGrid||r.inBookLayout)||"d"===e.v&&(r.inGrid||r.inBookLayout)||"b"===e.v&&!r.inBookLayout?(Me(e.v),ie()):K())},this.enableScrollable=function(){r.isScrollable||(we(),r.enableKeyScroll=r.initialKeyScroll,r.enableSpaceScroll=r.initialSpaceScroll,r.outerObject.css("overflow","auto"),r.isScrollable=!0)},this.disableScrollable=function(){r.isScrollable&&(r.innerObject.hasClass("diva-dragger")&&r.innerObject.unbind("mousedown"),r.outerObject.unbind("dblclick"),r.outerObject.unbind("contextmenu"),r.outerObject.css("overflow","hidden"),r.initialKeyScroll=r.enableKeyScroll,r.initialSpaceScroll=r.enableSpaceScroll,r.enableKeyScroll=!1,r.enableSpaceScroll=!1,r.isScrollable=!1)},this.toggleOrientation=function(){return oe()},this.getPageOffset=function(e){return{top:parseInt(r.pageTopOffsets[e]),left:parseInt(r.pageLeftOffsets[e])}},this.getCurrentPageOffset=function(){return this.getPageOffset(r.currentPageIndex)},this.getPageDimensionsAtCurrentGridLevel=function(e){e=h(e)?e:r.currentPageIndex;var t=r.rowHeight-r.fixedPadding,i=r.fixedHeightGrid?(r.rowHeight-r.fixedPadding)*c(e,"w")/c(e,"h"):r.gridPageWidth;return{height:parseInt(t,10),width:parseInt(i,10)}},this.getPageIndexForPageXYValues=function(e,t){var i=document.getElementById(r.ID+"outer"),n=i.getBoundingClientRect(),a=n.top,o=n.left,l=n.bottom,s=n.right;if(o>e||e>s)return!1;if(a>t||t>l)return!1;for(var c=document.getElementsByClassName("diva-page"),d=c.length;d--;){var u=c[d],g=u.getBoundingClientRect();if(!(e<g.left||e>g.right||t<g.top||t>g.bottom))return u.getAttribute("data-index")}return!1},this.isVerticallyOriented=function(){return r.verticallyOriented},this.changeObject=function(t){r.loaded=!1,q(),r.throbberTimeoutID=setTimeout(function(){e(r.selector+"throbber").show()},r.throbberTimeout),r.objectData=t,e.ajax({url:r.objectData,cache:!0,dataType:"json",error:He,success:function(e,t,i){Fe(e),ze(),K(),r.loaded=!0}})},this.activate=function(){r.isActiveDiva=!0},this.deactivate=function(){r.isActiveDiva=!1},this.destroy=function(){e("body").removeClass("diva-hide-scrollbar"),r.parentObject.empty().removeData("diva"),t.Events.publish("ViewerDidTerminate",[r],s),r.parentObject.removeAttr("style").removeAttr("class"),t.Events.unsubscribeAll(r.ID)}};e.fn.diva=function(t){return this.each(function(){var n=e(this);if(!n.data("diva")){var a=new i(this,t);n.data("diva",a)}})}}(e),function(e){window.divaPlugins.push(function(){var i={},n={init:function(n,a){function o(e){return Math.log(e)/Math.log(10)}var r,l,s,c,d;a.startScrolling=function(){return n.currentlyAutoScrolling?void console.warn("You are trying to start autoscrolling, but it is already scrolling."):(e("#"+n.ID+"autoscroll-toggle").text("Turn off"),l&&a.disableScrollable(),n.currentlyAutoScrolling=!0,void restartScrollingInterval())},restartScrollingInterval=function(){clearInterval(n.autoScrollInterval),n.verticallyOriented?n.autoScrollInterval=setInterval(function(){n.outerObject.scrollTop(n.outerObject.scrollTop()+r)},s):n.autoScrollInterval=setInterval(function(){n.outerObject.scrollLeft(n.outerObject.scrollLeft()+r)},s)},a.stopScrolling=function(){return n.currentlyAutoScrolling?(e("#"+n.ID+"autoscroll-toggle").text("Turn on"),l&&a.enableScrollable(),n.currentlyAutoScrolling=!1,void clearInterval(n.autoScrollInterval)):void console.warn("You are trying to stop autoscrolling, but it is not currently active.")},a.toggleScrolling=function(){n.currentlyAutoScrolling?a.stopScrolling():a.startScrolling()},a.changeRefresh=function(e){s=e,u()},a.changeScrollSpeed=function(t){d=t,u(),e("#"+n.ID+"autoscroll-pps").val(o(d)),n.currentlyAutoScrolling&&restartScrollingInterval()};var u=function(){s=c,r=d/(1e3/s),1>r&&(s*=1/r,r=d/(1e3/s))};if(a.disableManualScroll=function(){l=!0,n.currentlyAutoScrolling&&a.disableScrollable()},a.enableManualScroll=function(){l=!1,n.currentlyAutoScrolling&&a.enableScrollable()},n.currentlyAutoScrolling=!1,n.autoScrollInterval="",l=n.disableManualScroll||!1,s=n.autoScrollRefresh||50,c=s,a.changeScrollSpeed(n.scrollSpeed||10),e(window).on("keyup",function(e){e.shiftKey&&32===e.keyCode&&a.toggleScrolling()}),!n.disableAutoscrollPrefs){var g=function(t){if(n.inFullscreen){var a=e(n.selector+"tools"),o=a.css("right");i.jqObj.css({right:o,"margin-right":0,top:a.offset().top+a.outerHeight()+15})}else i.jqObj.css({right:e(window).width()-(n.outerObject.offset().left+n.outerObject.outerWidth())+n.scrollbarWidth,"margin-right":".6em"}),i.jqObj.offset({top:n.outerObject.offset().top+1})};t.Events.subscribe("ModeDidSwitch",g,n.ID),t.Events.subscribe("ViewerDidLoad",function(t){var r="<div id='"+n.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+n.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+o(d)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+n.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+n.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";e("#"+n.ID+"page-nav").before("<div id='"+n.ID+"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>"),e("body").prepend(r),e("#"+n.ID+"autoscroll-pps").on("change",function(e){a.changeScrollSpeed(Math.pow(10,e.target.value))}),e("#"+n.ID+"autoscroll-manual").on("change",function(e){e.target.checked?a.enableManualScroll():a.disableManualScroll()}),e("#"+n.ID+"autoscroll-toggle").on("click",a.toggleScrolling),e("#"+n.ID+"autoscroll-icon").on("click",function(t){i.jqObj=e("#"+n.ID+"autoscroll-prefs"),"none"===i.jqObj.css("display")?(i.jqObj.css({display:"block"}),g(n.inFullscreen)):i.jqObj.css("display","none")})},n.ID)}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"};return n}())}(e),function(e){window.divaPlugins.push(function(){var i,n,a,o={},r={},l={},s={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},c=function(e){return e*Math.PI/180},d=function(e,t){var i=e.x-o.centerX,a=-(e.y-o.centerY),r=c(n.rotation.previous-t),l=Math.cos(r)*i-Math.sin(r)*a+o.centerX,s=-(Math.sin(r)*i+Math.cos(r)*a)+o.centerY;return{x:l,y:s}},u=function(e,t){var n=e.context,a=e.size/2,o=-(e.width/2),r=-(e.height/2);n.clearRect(0,0,e.size,e.size),n.save(),n.translate(a,a),n.rotate(c(t)),n.drawImage(i,o,r,e.width,e.height),n.restore(),e.data=n.getImageData(0,0,e.size,e.size)},g=function(){var e;for(e in n)if(n[e].current!==n[e].previous)return!0;return!1},v=function(){var e;for(e in n)n[e].previous=n[e].current},p=function(){u(r,n.rotation.current),b(r)},h=function(){var t=n.rotation.current,i=n.rotation.previous,a=n.zoom.current,r=n.zoom.previous;if(t!==i||a!==r){var s=e("#diva-canvas-wrapper").scrollLeft(),c=e("#diva-canvas-wrapper").scrollTop(),p=l.viewport.width/2,h=l.viewport.height/2,f=d({x:s+p,y:c+h},t),m=Math.pow(2,a-r),w=m*f.x-p,I=m*f.y-h;u(o,t),e("#diva-canvas-wrapper").scrollLeft(w),e("#diva-canvas-wrapper").scrollTop(I)}g()&&(b(o),v())},f=function(e){var t,i,n=e.data,a=e.context.createImageData(n),o=a.data;for(t=0,i=o.length;i>t;t++)o[t]=n.data[t];return a},m=function(e){var t=n[e].current!==n[e].previous,i=n[e].current!==n[e].initial;return t||i},b=function(e){var t,i,a,o,r,s,c,d,u=f(e),g=u.data,v=n.brightness.current,p=n.contrast.current,h=1+Math.min(l.brightnessMax,Math.max(l.brightnessMin,v))/l.brightnessMax,b=h*p,w=128-128*p,I=n.red.current,y=n.green.current,x=n.blue.current,P=m("red"),D=m("green"),L=m("blue"),O=m("brightness"),C=m("contrast"),E=O||C;for(t=0,a=u.width;a>t;t++)for(i=0,o=u.height;o>i;i++)r=4*(i*a+t),s=g[r],c=g[r+1],d=g[r+2],s+c+d>0&&(P&&s&&(s+=I),D&&c&&(c+=y),L&&d&&(d+=x),E&&(s&&(s=s*b+w),c&&(c=c*b+w),d&&(d=d*b+w)),g[r]=s,g[r+1]=c,g[r+2]=d);e.context.clearRect(0,0,a,o),e.context.putImageData(u,0,0)},w=function(){var t=e("#diva-canvas-wrapper").scrollLeft()*r.scaleFactor,i=e("#diva-canvas-wrapper").scrollTop()*r.scaleFactor,n=Math.min(Math.round(l.viewport.height*r.scaleFactor),l.mapSize)-4,a=Math.min(Math.round(l.viewport.width*r.scaleFactor),l.mapSize)-4;e("#diva-map-viewbox").height(n).width(a).css({top:i,left:t})},I=function(t){r.canvas=document.getElementById("diva-canvas-minimap"),r.size=l.mapSize,r.canvas.width=r.size,r.canvas.height=r.size,r.context=r.canvas.getContext("2d"),r.context.fillRect(0,0,r.size,r.size),r.scaleFactor=l.mapSize/o.size,r.cornerX=o.cornerX*r.scaleFactor,r.cornerY=o.cornerY*r.scaleFactor,r.width=t.width*r.scaleFactor,r.height=t.height*r.scaleFactor,r.context.drawImage(t,r.cornerX,r.cornerY,r.width,r.height),r.data=r.context.getImageData(0,0,l.mapSize,l.mapSize),e("#diva-map-viewbox").show(),w()},y=function(t,n){i=new Image,i.crossOrigin="anonymous",i.onload=function(){o.size=Math.sqrt(i.width*i.width+i.height*i.height),o.canvas=document.getElementById("diva-canvas"),o.canvas.width=o.size,o.canvas.height=o.size,o.cornerX=(o.size-i.width)/2,o.cornerY=(o.size-i.height)/2,o.width=i.width,o.height=i.height,o.centerX=o.size/2,o.centerY=o.size/2,o.context=o.canvas.getContext("2d"),o.context.drawImage(i,o.cornerX,o.cornerY,o.width,o.height);try{o.data=o.context.getImageData(0,0,o.size,o.size)}catch(t){var a='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+t.message+"</p>";if("SecurityError"!==t.name)throw t;a+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div>',a+="</div>",e("#diva-canvas-backdrop").append(a),O()}void 0===n&&I(i),p(),h(o),O(),"function"==typeof n&&n.call(n)},i.src=t,(i.complete||void 0===i.complete)&&(i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i.src=t)},x=function(){var t=n[a],i=t.current,o=t.transform?t.transform(i):i;e("#diva-canvas-value").html(o)},P=function(){e("#diva-canvas-slider").val(n[a].current)},D=function(e){var t,i=l.zoomWidthRatio*Math.pow(2,e),n=l.imageDir+"/",a=l.selectedPageIndex;if(l.isIIIF){var o=l.pages[a].api>1.1?"default":"native";t=encodeURI(l.pages[a].url+"full/"+i+",/0/"+o+".jpg")}else t=l.iipServerURL+"?FIF="+n+l.filename+"&WID="+i+"&CVT=JPEG";return t},L=function(){(n.zoom.current>0||l.mobileWebkit)&&e(l.selector+"throbber").addClass("canvas-throbber").show()},O=function(){e(l.selector+"throbber").removeClass("canvas-throbber").hide()},C=function(){var e,t={},i=!1,a=l.localStoragePrefix+l.filename;for(e in n)n[e].previous!==n[e].initial&&(t[e]=n[e].previous,i=!0);i?(l.pluginIcon.addClass("new"),
localStorage.setObject(a,t)):(l.pluginIcon.removeClass("new"),localStorage.removeItem(a))},E=function(e,t){l.zoomLevel=e;var i=D(e);y(i,function(){r.scaleFactor=r.size/o.size,w(),C()})},T=function(t){var i=38,n=40,a=37,o=39;switch(t.keyCode){case i:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-l.arrowScrollAmount),!1;case n:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+l.arrowScrollAmount),!1;case a:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-l.arrowScrollAmount),!1;case o:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+l.arrowScrollAmount),!1}},k={init:function(i,c){var d=!!window.HTMLCanvasElement;if(!d)return!1;e.extend(l,s,i.canvasPlugin),l.inCanvas=!1,l.iipServerURL=i.iipServerURL,l.imageDir=i.imageDir,l.selector=i.selector,l.mobileWebkit=i.mobileWebkit,l.arrowScrollAmount=i.arrowScrollAmount,n={contrast:{initial:1,min:l.contrastMin,max:l.contrastMax,step:l.contrastStep,transform:function(e){return e.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:l.brightnessMin,max:l.brightnessMax,step:l.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(e){return e+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:l.rgbMin,max:l.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:l.rgbMin,max:l.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:l.rgbMin,max:l.rgbMax,step:1,title:"Adjust the blue channel"}};var u=function(){var e,t,i;for(i in n)t=n[i],e=t.initial,t.current=e,t.previous=e};if(u(),e("#diva-canvas-backdrop").length)return!0;var v,f,m,b,I=[];for(b in l.buttons)f=l.buttons[b],m=n[f].title,v='<div class="'+f+'" title="'+m+'"></div>',I.push(v);var y=I.join(""),D='<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+y+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>',k='<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div>',S='<div id="diva-canvas-backdrop">'+D+k+"</div>";e("body").append(S),l.mapSize=e("#diva-canvas-minimap").width(),e("#diva-canvas-buttons div").click(function(){e("#diva-canvas-buttons .clicked").removeClass("clicked"),z(e(this).attr("class"))});var z=function(t){a=t;var i=n[a];e("#diva-canvas-buttons ."+a).addClass("clicked"),e("#diva-canvas-mode").text(a);var o=i.current,r=i.transform?i.transform(o):o,l=document.getElementById("diva-canvas-slider");l.min=i.min,l.max=i.max,l.step=i.step,e("#diva-canvas-slider").val(o),e("#diva-canvas-value").html(r)};return z("contrast"),e("#diva-canvas-slider").on("input",function(e){n[a].current=parseFloat(this.value),x(),p()}),e("#diva-canvas-reset-all").click(function(){var e;for(e in n)n[e].current=n[e].initial;x(),P(),p()}),e("#diva-canvas-reset").click(function(){n[a].current=n[a].initial,x(),P(),p()}),e("#diva-canvas-apply").click(function(){g()&&(L(),setTimeout(function(){n.zoom.current!==n.zoom.previous?E(n.zoom.current):(h(),O(),C())},l.throbberTimeout))}),e("#diva-canvas-close").click(function(){e("body").removeClass("overflow-hidden"),o.context.clearRect(0,0,o.size,o.size),r.context.clearRect(0,0,r.size,r.size),e("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0),e("#diva-canvas-backdrop").hide(),e("#diva-map-viewbox").hide(),O(),c.enableScrollable(),e(document).off("keydown",T),u(),x(),P(),e("#diva-canvas-buttons .clicked").removeClass("clicked"),z("contrast"),t.Events.publish("CanvasViewDidHide")}),e("#diva-canvas-minimise").click(function(){e("#diva-canvas-toolwindow").slideToggle("fast")}),e(window).resize(function(){l.viewport={height:window.innerHeight-i.scrollbarWidth,width:window.innerWidth-i.scrollbarWidth},l.inCanvas&&w()}),e("#diva-canvas-wrapper").scroll(function(){l.inCanvas&&w()}),e("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(t){var i=e("#diva-canvas-minimap").offset(),n=(t.pageX-i.left)/r.scaleFactor,a=(t.pageY-i.top)/r.scaleFactor;e("#diva-canvas-wrapper").scrollTop(a-l.viewport.height/2),e("#diva-canvas-wrapper").scrollLeft(n-l.viewport.width/2)}),e("#diva-canvas").mousedown(function(){e(this).addClass("grabbing")}).mouseup(function(){e(this).removeClass("grabbing")}),l.mobileWebkit?e("#diva-canvas-wrapper").kinetic():e("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0}),t.Events.subscribe("ObjectDidLoad",this.setupHook,i.ID),t.Events.subscribe("ViewerDidTerminate",this.destroy,i.ID),t.Events.subscribe("PageDidLoad",this.onPageLoad,i.ID),!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(e){l.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},l.minZoomLevel=e.minZoomLevel,l.maxZoomLevel=e.maxZoomLevel,l.mobileWebkit&&(l.maxZoomLevel=Math.min(l.maxZoomLevel,l.mobileWebkitMaxZoom)),n.zoom.min=l.minZoomLevel,n.zoom.max=l.maxZoomLevel},handleClick:function(i,o,r){var s,c=e(this).parent().parent(),d=e(c).attr("data-filename"),u=e(c).attr("data-index"),g=e(c).width()-1,v=o.zoomLevel;l.zoomWidthRatio=g/Math.pow(2,v),l.pluginIcon=e(this),l.pages=o.pages,l.isIIIF=o.isIIIF,l.selectedPageIndex=u,l.mobileWebkit&&(v=Math.min(l.maxZoomLevel,v)),l.filename=d,n.zoom.initial=v,n.zoom.current=v;var p=localStorage.getObject(l.localStoragePrefix+l.filename);if(p)for(s in p)n[s].current=p[s],s===a&&(x(),P()),"zoom"===s&&(v=p[s]);n.zoom.previous=v,e("body").addClass("overflow-hidden"),e("#diva-canvas-backdrop").show(),r.disableScrollable(),e(document).keydown(T),l.inCanvas=!0;var h=D(v);e("#diva-canvas-info").text(e(c).attr("title")),L(),t.Events.publish("CanvasViewDidActivate",[c]),y(h)},onPageLoad:function(t,i,n){var a=l.localStoragePrefix+i;null!==localStorage.getItem(a)&&e(n).find(".diva-canvas-icon").addClass("new")},destroy:function(t,i){e("#diva-canvas-backdrop").remove()}};return k}())}(e),function(e){window.divaPlugins.push(function(){var t={init:function(e,t){return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(t,i){var n,a=e(this).parent().parent(),o=e(a).attr("data-filename"),r=e(a).attr("data-index"),l=e(a).width()-1;if(i.isIIIF){var s=i.pages[r].api>1.1?"default":"native";n=encodeURI(i.pages[r].url+"full/"+l+",/0/"+s+".jpg")}else n=i.iipServerURL+"?FIF="+i.imageDir+"/"+o+"&WID="+l+"&CVT=JPEG";window.open(n)}};return t}())}(e),function(e){window.divaPlugins.push(function(){var e={init:function(e,i){function n(n,a,o){var s=e.parentObject.data("highlights");if("undefined"!=typeof s){if(s.hasOwnProperty(n)){for(var c=document.getElementById(e.ID+"page-"+n).getElementsByClassName(e.ID+"highlight");c[0];)c[0].parentNode.removeChild(c[0]);var d,u=i.getInstanceId()+"page-"+n,g=document.getElementById(u),v=s[n].regions,p=s[n].colour,h=s[n].divClass,f=i.getMaxZoomLevel();if(e.inGrid){var m=i.getPageDimensionsAtZoomLevel(n,f).width,b=g.clientWidth,w=m/b;d=Math.log(w)/Math.log(2)}else d=f-i.getZoomLevel();for(var I=v.length;I--;){var y=document.createElement("div");y.style.width=l(v[I].width,d)+"px",y.style.height=l(v[I].height,d)+"px",y.style.top=l(v[I].uly,d)+"px",y.style.left=l(v[I].ulx,d)+"px",y.style.background=p,y.style.border="1px solid #555",y.style.position="absolute",y.style.zIndex=100,y.className=h,"undefined"!=typeof v[I].divID&&y.setAttribute("data-highlight-id",v[I].divID),g.appendChild(y)}}r(),t.Events.publish("HighlightCompleted",[n,a,o])}}e.parentObject.data("highlights",{});var a,o,r=function(){var t,n,r,l=e.ID+"selected-highlight",s=document.getElementsByClassName(l);for(t=0;t<s.length;t++)n=s[t],n.id!==a&&(n.className=n.className.replace(" "+l,""),n.style.border="1px solid #555");if(i.isPageLoaded(o))for(r=document.querySelectorAll("*[data-highlight-id="+a+"]"),t=0;t<r.length;t++)n=r[t],n.className=n.className+" "+l,n.style.border="2px solid #000"};t.Events.subscribe("PageDidLoad",n,e.ID);var l=function(e,t){return e/Math.pow(2,t)};i.resetHighlights=function(){for(var t=document.getElementById(e.ID+"inner"),i=e.ID+"highlight",n=t.getElementsByClassName(i),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}e.parentObject.data("highlights",{})},i.removeHighlightsOnPage=function(t){var n=e.parentObject.data("highlights");if(n.hasOwnProperty(t)){for(var a=i.getInstanceId()+"page-"+t,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=n[t].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete n[t]}},i.highlightOnPages=function(e,t,n,a){for(var o=e.length;o--;)i.highlightOnPage(e[o],t[o],n,a)},i.highlightOnPage=function(t,a,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.2)"),r="undefined"==typeof r?e.ID+"highlight":e.ID+"highlight "+r;var l=(i.getMaxZoomLevel(),e.parentObject.data("highlights"));return l[t]={regions:a,colour:o,divClass:r},i.isPageLoaded(t)&&n(t,null,null),!0},i.gotoHighlight=function(t){var i=e.parentObject.data("highlights");if(null!==document.getElementById(t)){for(var n=parseInt(document.getElementById(t).parentNode.getAttribute("data-index"),10),a=i[n].regions.length;a--;)if(i[n].regions[a].divID===t)return s(n,i[n].regions[a])}else for(var o=Object.keys(i),r=o.length;r--;)for(var l=i[o[r]].regions,c=l.length;c--;)if(l[c].divID===t)return s(o[r],l[c]);return console.warn("Diva just tried to find a highlight that doesn't exist."),!1};var s=function(n,l){var s=parseFloat(l.uly)+parseFloat(l.height)/2,c=parseFloat(l.ulx)+parseFloat(l.width)/2,d=i.translateFromMaxZoomLevel(s),u=i.translateFromMaxZoomLevel(c);n=parseInt(n,10),i.gotoPageByIndex(n);var g=i.getSettings().outerObject,v=g.scrollTop()+d-g.height()/2+e.verticalPadding,p=g.scrollLeft()+u-g.width()/2+e.horizontalPadding;return g.scrollTop(v),g.scrollLeft(p),a=l.divID,o=n,t.Events.publish("SelectedHighlightChanged",[a,o]),r(),a},c=function(t){return e.verticallyOriented?i.translateFromMaxZoomLevel(parseFloat(t.uly)+parseFloat(t.height)/2):i.translateFromMaxZoomLevel(parseFloat(t.ulx)+parseFloat(t.width)/2)},d=function(t){var n,r,l,d,u,g,v,p,h,f,m=e.parentObject.data("highlights"),b=!1;if(a&&o){for(l=o,d=m[l].regions,u=d.length;u--;)if(d[u].divID==a){h=d[u],r=c(h);break}for(u=d.length,g=i.getPageDimensionsAtZoomLevel(l,i.getZoomLevel()),n=t?e.verticallyOriented?g.height:g.width:0,f=t?function(e,t,i){return e>t&&i>e}:function(e,t,i){return t>e&&e>i};u--;)h=d[u],v=c(h),h.divID!==a&&f(v,r,n)&&(b=!0,n=v,p=h);if(b)return s(l,p)}else l=0,r=0;var w,I=Object.keys(m),y=I.indexOf(l);for(w=t?y==I.length-1?I[0]:I[y+1]:0===y?I[I.length-1]:I[y-1],d=m[w].regions,u=d.length,g=i.getPageDimensionsAtZoomLevel(w,i.getMaxZoomLevel()),n=t?e.verticallyOriented?g.height:g.width:0,f=t?function(e,t){return t>e}:function(e,t){return e>t};u--;)h=d[u],v=c(h),f(v,n)&&(b=!0,n=v,p=h);return s(w,p)};return i.gotoNextHighlight=function(){return d(!0)},i.gotoPreviousHighlight=function(){return d(!1)},t.Events.subscribe("ViewerDidTerminate",this.destroy,e.ID),!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"};return e}())}(e),function(e){window.divaPlugins.push(function(){var i={},n={init:function(n,a){function o(e,o,l){var s=n.parentObject.data("highlights");if("undefined"!=typeof s&&i.highlightsVisible){if(s.hasOwnProperty(e)){var c,d=a.getInstanceId()+"page-"+e,u=document.getElementById(d),g=s[e].regions,v=s[e].colour,p=s[e].divClass,h=a.getMaxZoomLevel();if(n.inGrid){var f=a.getPageDimensionsAtZoomLevel(e,h).width,m=u.clientWidth,b=f/m;c=Math.log(b)/Math.log(2)}else c=h-a.getZoomLevel();for(var w=g.length;w--;){var I=document.createElement("div");I.style.width=r(g[w].width,c)+"px",I.style.height=r(g[w].height,c)+"px",I.style.top=r(g[w].uly,c)+"px",I.style.left=r(g[w].ulx,c)+"px",I.style.background=v,I.style.border="1px solid #555",I.style.position="absolute",I.style.zIndex=100,I.className=p,"undefined"!=typeof g[w].name&&I.setAttribute("data-name",g[w].name),"undefined"!=typeof g[w].divID&&(I.id=g[w].divID),u.appendChild(I)}}t.Events.publish("HighlightCompleted",[e,o,l])}}n.parentObject.data("highlights",{}),i.highlightedPages=[],t.Events.subscribe("PageWillLoad",o,n.ID);var r=function(e,t){return e/Math.pow(2,t)};a.resetHighlights=function(){for(var e=document.getElementById(n.ID+"inner"),t=n.ID+"highlight",i=e.getElementsByClassName(t),a=i.length;a--;){var o=i[a].parentNode;o.removeChild(i[a])}n.parentObject.data("highlights",{})},a.removeHighlightsOnPage=function(e){var t=n.parentObject.data("highlights");if(t.hasOwnProperty(e)){for(var i=a.getInstanceId()+"page-"+e,o=document.getElementById(i),r=o.getElementsByTagName("div"),l=t[e].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete t[e]}},a.hideHighlights=function(){i.highlightsVisible=!1;for(var e=n.ID+"highlight",t=document.getElementById(n.ID+"inner"),a=t.getElementsByClassName(e),o=a.length;o--;){var r=a[o].parentNode;r.removeChild(a[o])}},a.showHighlights=function(){i.highlightsVisible=!0;for(var e,t=document.getElementById(n.ID+"inner"),a=t.getElementsByClassName("diva-document-page"),r=0;r<a.length;r++){e=parseInt(a[r].getAttribute("data-index"),10);var l=n.parentObject.data("highlights");l.hasOwnProperty(e)?o(e,null,null):s(e)}},a.highlightOnPages=function(e,t,i,n){for(var o=e.length;o--;)a.highlightOnPage(e[o],t[o],i,n)},a.highlightOnPage=function(e,t,i,r){"undefined"==typeof i&&(i="rgba(255, 0, 0, 0.1)"),r="undefined"==typeof r?n.ID+"highlight":n.ID+"highlight "+r;var l=(a.getMaxZoomLevel(),n.parentObject.data("highlights"));return l[e]={regions:t,colour:i,divClass:r},a.isPageLoaded(e)&&o(e,null,null),!0},a.gotoHighlight=function(e){var t,i,o,r,l=n.parentObject.data("highlights"),s=!1;if(null!==document.getElementById(e)){t=parseInt(document.getElementById(e).parentNode.getAttribute("data-index"),10);for(var c=l[t].regions.length;c--;)if(l[t].regions[c].divID===e){i=l[t].regions[c],o=parseFloat(i.uly)+parseFloat(i.height)/2,r=parseFloat(i.ulx)+parseFloat(i.width)/2,s=!0;break}}else for(var d=Object.keys(l),u=d.length;u--;){for(var g=l[d[u]].regions,v=g.length;v--;)if(g[v].divID===e){t=d[u],i=g[v],o=parseFloat(i.uly)+parseFloat(i.height)/2,r=parseFloat(i.ulx)+parseFloat(i.width)/2,s=!0;break}if(s)break}if(!s)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;var p=a.getSettings().outerObject,h=a.translateFromMaxZoomLevel(o),f=a.translateFromMaxZoomLevel(r);a.gotoPageByIndex(t);var m=p.scrollTop()+h-p.height()/2+n.verticalPadding,b=p.scrollLeft()+f-p.width()/2+n.horizontalPadding;return p.scrollTop(m),p.scrollLeft(b),n.currentHighlight=e,!0};var l=function(e){return function(t,n,o){for(var r=t,l=t.length,s=[],c=0;l>c;c++){var d=r[c],u=d.resource.chars,g=d.on,v=g.slice(g.indexOf("#xywh=")+6),p=v.split(","),h={ulx:parseInt(p[0],10),uly:parseInt(p[1],10),width:parseInt(p[2],10),height:parseInt(p[3],10),name:u};s.push(h)}a.highlightOnPage(e,s),i.highlightedPages.push(e)}},s=function(t){var n=i.manifest.sequences[0].canvases;if(n[t].hasOwnProperty("otherContent"))for(var a=n[t].otherContent,o=0;o<a.length;o++)"sc:AnnotationList"===a[o]["@type"]&&e.ajax({url:a[o]["@id"],cache:!0,dataType:"json",success:l(t)})},c=function(e){i.manifest=e};t.Events.subscribe("ManifestDidLoad",c,n.ID),t.Events.subscribe("PageWillLoad",function(e){if(i.highlightsVisible){for(var t=0;t<i.highlightedPages.length;t++)if(i.highlightedPages[t]===e)return;s(e,i.manifest)}},n.ID);var d=[];return n.innerObject.on("mouseenter","."+n.ID+"highlight",function(e){var t=e.target,i=t.dataset.name,n=document.createElement("div");n.style.top=t.offsetTop+t.offsetHeight-1+"px",n.style.left=t.style.left,n.style.background="#fff",n.style.border="1px solid #555",n.style.position="absolute",n.style.zIndex=101,n.className="annotation-overlay",n.textContent=i,t.parentNode.appendChild(n),d.push(n)}),n.innerObject.on("mouseleave","."+n.ID+"highlight",function(e){for(;d.length;){var t=d.pop();t.parentNode.removeChild(t)}}),t.Events.subscribe("ViewerDidLoad",function(){e("#"+n.ID+"page-nav").before('<div id="'+n.ID+'annotations-icon" class="diva-button diva-annotations-icon" title="Turn annotations on or off"></div>'),e(n.selector+"annotations-icon").addClass("annotations-icon-active"),e("#"+n.ID+"annotations-icon").on("click",function(t){i.highlightsVisible?(a.hideHighlights(),e(n.selector+"annotations-icon").removeClass("annotations-icon-active")):(a.showHighlights(),e(n.selector+"annotations-icon").addClass("annotations-icon-active"))})},n.ID),i.highlightsVisible=!0,!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"};return n}())}(e),function(e){window.divaPlugins.push(function(){var i={init:function(i,n){var a=function(t){var n=function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),n=i.replace("_"," ");return 0===t.indexOf("http://")&&(t='<a href="'+t+'" target="_blank">'+t+"</a>"),'<div class="metadata-row"><span class="metadata-label">'+n+':</span> <span class="metadata-value">'+t+"</span></div>"},a=function(e,t){for(var i=0;i<e.length;i++)if(e[i]["@language"]===t)return e[i]["@value"]},o=function(e){for(var i="",o=0;o<e.length;o++){var r=e[o];if(t.hasOwnProperty(r))if(t[r].constructor===Array){var l=a(t[r],"en");i+=n(r,l)}else i+=n(r,t[r])}return i},r='<div id="'+i.ID+'metadata" class="diva-modal">';if(r+=o(["label"]),t.hasOwnProperty("metadata"))for(var l=t.metadata,s=0;s<l.length;s++)if(l[s].value.constructor===Array){var c=a(l[s].value,"en");r+=n(l[s].label,c)}else r+=n(l[s].label,l[s].value);r+=o(["description","within","see_also","service","license","attribution"]),r+="</div>",i.parentObject.prepend(r),e(i.selector+"metadata").hide()};return t.Events.subscribe("ManifestDidLoad",a,i.ID),i.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+i.ID+'metadata-link" class="diva-metadata-link">Details</a></div>'),e(i.selector+"metadata-link").on("click",function(t){e(i.selector+"metadata").fadeToggle("fast")}),!0},destroy:function(e,t){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"};return i}())}(e),function(e){window.divaPlugins.push(function(){var e={init:function(e,i){void 0===e.pageAliases&&(e.pageAliases={}),void 0===e.pageAliasFunction&&(e.pageAliasFunction=function(){return!1}),i.getAliasForPageIndex=function(t){return e.pageAliases[t]||e.pageAliasFunction(t)||t+1},i.getPageIndexForAlias=function(t){for(var n=0;n<e.numPages;n++)if(i.getAliasForPageIndex(n)==t)return n;return!1},i.getPageIndicesForAlias=function(t){for(var n=[],a=0;a<e.numPages;a++)i.getAliasForPageIndex(a)==t&&n.push(a);return n},i.getCurrentAliasedPageIndex=function(){return i.getAliasForPageIndex(e.currentPageIndex)},i.gotoPageByAliasedNumber=function(e,t,n){return i.gotoPageByIndex(i.getPageIndexForAlias(e),t,n)};var n=function(){document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex()},a=function(){var i=this.getSettings(),a=i.numPages;void 0!==i.newTotalPages?a=i.newTotalPages:void 0!==i.totalPageOffset&&(a+=i.totalPageOffset),document.getElementById(this.getSettings().ID+"num-pages").textContent=a,document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex(),t.Events.unsubscribe(["VisiblePageDidChange",i.toolbar.updateCurrentPage,e.ID]),t.Events.subscribe("VisiblePageDidChange",n,e.ID)};t.Events.subscribe("ViewerDidLoad",a,e.ID)},pluginName:"pagealias",titleText:"Re-aliases page indexes"};return e}())}(e)});
//# sourceMappingURL=diva.min.js.map