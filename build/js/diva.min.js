Storage.prototype.setObject=function(b,f){this.setItem(b,JSON.stringify(f))};Storage.prototype.getObject=function(b){return(b=this.getItem(b))&&JSON.parse(b)};(function(b){var f=1;b.generateId=function(b){var c;do c=f++ +(b?"-"+b:"");while(document.getElementById(c));return c}})(jQuery);
(function(b){b.getScrollbarWidth=function(){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";var e=document.createElement("div");e.style.position="absolute";e.style.top="0px";e.style.left="0px";e.style.visibility="hidden";e.style.width="200px";e.style.height="150px";e.style.overflow="hidden";e.appendChild(b);document.body.appendChild(e);var c=b.offsetWidth;e.style.overflow="scroll";b=b.offsetWidth;c==b&&(b=e.clientWidth);document.body.removeChild(e);return c-b}})(jQuery);
(function(b){b.getHashParam=function(b){var e=window.location.hash;if(""!==e){var c=0<e.indexOf("&"+b+"=")?e.indexOf("&"+b+"="):e.indexOf("#"+b+"=");if(0<=c)return c+=b.length+2,b=e.indexOf("&",c),b>c?e.substring(c,b):0>b?e.substring(c):""}return!1}})(jQuery);
(function(b){b.updateHashParam=function(f,e){var c=b.getHashParam(f),a=window.location.hash;if(c!==e)if("string"==typeof c){var m=0<a.indexOf("&"+f+"=")?a.indexOf("&"+f+"="):a.indexOf("#"+f+"="),c=m+f.length+2+c.length,h=0===m?"#":"&";window.location.replace(a.substring(0,m)+h+f+"="+e+a.substring(c))}else 0===a.length?window.location.replace("#"+f+"="+e):window.location.replace(a+"&"+f+"="+e)}})(jQuery);
(function(b){b.fn.dragscrollable=function(f){var e=b.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},f||{}),c={mouseDownHandler:function(a){if(1!=a.which||!a.data.acceptPropagatedEvent&&a.target!=this)return!1;a.data.lastCoord={left:a.clientX,top:a.clientY};b.event.add(document,"mouseup",c.mouseUpHandler,a.data);b.event.add(document,"mousemove",c.mouseMoveHandler,a.data);if(a.data.preventDefault)return a.preventDefault(),!1},mouseMoveHandler:function(a){var b=a.clientX-
a.data.lastCoord.left,c=a.clientY-a.data.lastCoord.top;a.data.scrollable.scrollLeft(a.data.scrollable.scrollLeft()-b);a.data.scrollable.scrollTop(a.data.scrollable.scrollTop()-c);a.data.lastCoord={left:a.clientX,top:a.clientY};if(a.data.preventDefault)return a.preventDefault(),!1},mouseUpHandler:function(a){b.event.remove(document,"mousemove",c.mouseMoveHandler);b.event.remove(document,"mouseup",c.mouseUpHandler);if(a.data.preventDefault)return a.preventDefault(),!1}};this.each(function(){var a={scrollable:b(this),
acceptPropagatedEvent:e.acceptPropagatedEvent,preventDefault:e.preventDefault};b(this).find(e.dragSelector).bind("mousedown",a,c.mouseDownHandler)})}})(jQuery);
(function(b){var f={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:0.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}};window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}());b.support=b.support||{};b.extend(b.support,{touch:"ontouchend"in document});var e=function(){return!1},c=function(a,b){return 0===Math.floor(Math.abs(a))?0:a*b},a=function(a,b){var c=a;0<a?a>b&&(c=b):a<0-b&&(c=0-b);return c},m=function(a,b){this.removeClass(a.movingClass.up).removeClass(a.movingClass.down).removeClass(a.movingClass.left).removeClass(a.movingClass.right).removeClass(a.deceleratingClass.up).removeClass(a.deceleratingClass.down).removeClass(a.deceleratingClass.left).removeClass(a.deceleratingClass.right);
0<a.velocity&&this.addClass(b.right);0>a.velocity&&this.addClass(b.left);0<a.velocityY&&this.addClass(b.down);0>a.velocityY&&this.addClass(b.up)},h=function(a,b){b.velocity=0;b.velocityY=0;b.decelerate=!0;"function"===typeof b.stopped&&b.stopped.call(a,b)},l=function(a,b){var e=a[0];b.x&&0<e.scrollWidth?(e.scrollLeft=b.scrollLeft=e.scrollLeft+b.velocity,0<Math.abs(b.velocity)&&(b.velocity=b.decelerate?c(b.velocity,b.slowdown):b.velocity)):b.velocity=0;b.y&&0<e.scrollHeight?(e.scrollTop=b.scrollTop=
e.scrollTop+b.velocityY,0<Math.abs(b.velocityY)&&(b.velocityY=b.decelerate?c(b.velocityY,b.slowdown):b.velocityY)):b.velocityY=0;m.call(a,b,b.deceleratingClass);"function"===typeof b.moved&&b.moved.call(a,b);0<Math.abs(b.velocity)||0<Math.abs(b.velocityY)?window.requestAnimationFrame(function(){l(a,b)}):h(a,b)},r=function(a,c){var e=b.kinetic.callMethods[a],f=Array.prototype.slice.call(arguments);e&&this.each(function(){var a=f.slice(1),c=b(this).data("kinetic-settings");a.unshift(c);e.apply(this,
a)})},v=function(a,c){b.support.touch?a.bind("touchstart",c.events.touchStart).bind("touchend",c.events.inputEnd).bind("touchmove",c.events.touchMove):a.mousedown(c.events.inputDown).mouseup(c.events.inputEnd).mousemove(c.events.inputMove);a.click(c.events.inputClick).scroll(c.events.scroll).bind("selectstart",e).bind("dragstart",c.events.dragStart)},n=function(c){this.addClass("kinetic-active").each(function(){var e=this,h=b(this);if(!h.data("kinetic-settings")){var g=b.extend({},f,c),n,r=!1,w,A=
!1,z=!1,H=1E3/g.throttleFPS,I,C;g.velocity=0;g.velocityY=0;var P=function(){z=w=n=!1};b(document).mouseup(P).click(P);var k=function(){g.velocity=a(r-n,g.maxvelocity);g.velocityY=a(A-w,g.maxvelocity)},p=function(a){return b.isFunction(g.filterTarget)?!1!==g.filterTarget.call(e,a):!0},q=function(a,c){if(!I||new Date>new Date(I.getTime()+H))I=new Date,z&&(n||w)&&(C&&(b(C).blur(),C=null,h.focus()),g.decelerate=!1,g.velocity=g.velocityY=0,h[0].scrollLeft=g.scrollLeft=g.x?h[0].scrollLeft-(a-n):h[0].scrollLeft,
h[0].scrollTop=g.scrollTop=g.y?h[0].scrollTop-(c-w):h[0].scrollTop,r=n,A=w,n=a,w=c,k(),m.call(h,g,g.movingClass),"function"===typeof g.moved&&g.moved.call(h,g))};g.events={touchStart:function(a){var b;if(p(a.target)){b=a.originalEvent.touches[0];var c=b.clientX;b=b.clientY;z=!0;g.velocity=r=0;g.velocityY=A=0;n=c;w=b;a.stopPropagation()}},touchMove:function(a){var b;z&&(b=a.originalEvent.touches[0],q(b.clientX,b.clientY),a.preventDefault&&a.preventDefault())},inputDown:function(a){if(p(a.target)){var b=
a.clientX,c=a.clientY;z=!0;g.velocity=r=0;g.velocityY=A=0;n=b;w=c;C=a.target;"IMG"===a.target.nodeName&&a.preventDefault();a.stopPropagation()}},inputEnd:function(a){n&&r&&!1===g.decelerate&&(g.decelerate=!0,k(),n=r=z=!1,l(h,g));C=null;a.preventDefault&&a.preventDefault()},inputMove:function(a){z&&(q(a.clientX,a.clientY),a.preventDefault&&a.preventDefault())},scroll:function(a){"function"===typeof g.moved&&g.moved.call(h,g);a.preventDefault&&a.preventDefault()},inputClick:function(a){if(0<Math.abs(g.velocity))return a.preventDefault(),
!1},dragStart:function(a){if(C)return!1}};v(h,g);h.data("kinetic-settings",g).css("cursor",g.cursor);g.triggerHardware&&h.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};b.kinetic={settingsKey:"kinetic-settings",callMethods:{start:function(a,c){var e=b(this);if(a=b.extend(a,c))a.decelerate=!1,l(e,a)},end:function(a,c){b(this);a&&(a.decelerate=!0)},stop:function(a,c){var e=b(this);h(e,a)},detach:function(a,c){var f=b(this);b.support.touch?
f.unbind("touchstart",a.events.touchStart).unbind("touchend",a.events.inputEnd).unbind("touchmove",a.events.touchMove):f.unbind("mousedown",a.events.inputDown).unbind("mouseup",a.events.inputEnd).unbind("mousemove",a.events.inputMove).unbind("scroll",a.events.scroll);f.unbind("click",a.events.inputClick).unbind("selectstart",e);f.unbind("dragstart",a.events.dragStart);f.removeClass("kinetic-active").css("cursor","")},attach:function(a,c){var e=b(this);v(e,a);e.addClass("kinetic-active").css("cursor",
"move")}}};b.fn.kinetic=function(a){"string"===typeof a?r.apply(this,arguments):n.call(this,a);return this}})(window.jQuery||window.Zepto);
var diva=function(){var b={};return{Events:{publish:function(f,e,c){if(b[f]){f=b[f];for(var a=f.length;a--;)f[a].apply(c||this,e||[])}},subscribe:function(f,e){b[f]||(b[f]=[]);b[f].push(e);return[f,e]},unsubscribe:function(f,e){var c=f[0],a=b[c].length;if(b[c])for(;a--;)b[c][a]===f[1]&&(b[c].splice(a,1),e&&delete b[c])},unsubscribeAll:function(){b={}}}}}(),multiDiva,multiDivaController=function(){var b;$(document).on("click",function(f){a:{var e=$(f.target);f=e.find(".diva-outer");e=e.closest(".diva-outer");
if(!(0<f.length))if(0<e.length)f=e;else break a;f.parent().data("diva").activate();b=f.parent();for(e=$(".diva-outer").length;e--;)$($(".diva-outer")[e]).attr("id")!=f.attr("id")&&$($(".diva-outer")[e]).parent().data("diva").deactivate()}});this.getActive=function(){return b}};diva.Events.subscribe("ViewerDidLoad",function(b){1<$(".diva-outer").length&&(this.deactivate(),multiDiva||(multiDiva=new multiDivaController))});window.divaPlugins=[];
(function(b){var f=function(e,c){var a=b.extend({},{adaptivePadding:0.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,
minZoomLevel:0,onDocumentLoaded:null,onModeToggle:null,onViewToggle:null,onJump:null,onPageLoad:null,onPageLoaded:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onSetCurrentPage:null,onZoom:null,onZoomIn:null,onZoomOut:null,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentSelector:c.parentSelector,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},c);b.extend(a,{allTilesLoaded:[],averageHeights:[],averageWidths:[],
currentPageIndex:0,divaIsFullWindow:!1,doubleClickZoom:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerSelector:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerSelector:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],
pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0});var f=this,h=function(a){var b=!0;return function(a){var d,c,e;if("function"===typeof a){d=[];c=1;for(e=arguments.length;c<e;c++)d.push(arguments[c]);b&&
(console.warn('The use of callback functions is deprecated. Use diva.Events.subscribe("Event", function) instead.'),b=!1);a.apply(f,d);return!0}return!1}}(),l=function(d,b){return a.pages[d].d[a.zoomLevel][b]},r=function(d){var b,c=a.numPages;for(b=0;b<c;b++)if(a.pages[b].f===d)return b;return-1},v=function(d,K){var c=b("#"+a.ID+"outer").scrollLeft()-a.viewportMargin,e=c+a.panelWidth+2*a.viewportMargin;return d>=c&&d<=e||d<=c&&K>=e||K>=c&&K<=e},n=function(d,K){var c=b("#"+a.ID+"outer").scrollTop()-
a.viewportMargin,e=c+a.panelHeight+2*a.viewportMargin;return d>=c&&d<=e||d<=c&&K>=e||K>=c&&K<=e},u=function(d){return 0<=d&&d<a.numPages},G=function(d){var b=a.pageTopOffsets[d],c=b+l(d,"h")+a.verticalPadding,e=a.pageLeftOffsets[d];d=e+l(d,"w")+a.horizontalPadding;return n(b,c)&&v(e,d)},R=function(d){if(!document.getElementById(a.ID+"page-"+d)||!a.allTilesLoaded[d]){var b=a.pages[d].f,c=l(d,"w"),e=l(d,"h"),k=a.pageTopOffsets[d]+a.verticalPadding,p=a.pageLeftOffsets[d]+a.horizontalPadding,D=a.selector+
"page-"+d,g;if(!document.getElementById(a.ID+"page-"+d)){var s=document.getElementById(a.ID+"inner"),y=document.createElement("div");y.id=a.ID+"page-"+d;y.classList.add("diva-document-page");y.setAttribute("data-index",d);y.setAttribute("data-filename",b);y.title="Page "+(d+1);y.innerHTML=a.pageTools;y.style.width=c+"px";y.style.height=e+"px";a.verticallyOriented?(y.style.top=k+"px",y.classList.add("diva-page-vertical")):(y.style.left=p+"px",y.classList.add("diva-page-horizontal"));s.appendChild(y);
h(a.onPageLoad,d,b,D);diva.Events.publish("PageWillLoad",[d,b,D],f);for(g in a.plugins)h(a.plugins[g].onPageLoad,d,b,D)}a.pageTimeouts.push(setTimeout(function(d){var k=document.getElementById(a.ID+"page-"+d);if(G(d)){var p=a.imageDir+"/",aa=Math.ceil(l(d,"h")/a.tileWidth),g=Math.ceil(l(d,"w")/a.tileHeight),s=a.pages[d].m,y=a.iipServerURL+"?FIF="+p+b+"&JTL=",p=!0,q=0,sa=e-(aa-1)*a.tileHeight,ta=c-(g-1)*a.tileWidth,x,E,Y,U,r,w,J,u;x=a.zoomLevel+s-a.realMaxZoom;y=a.isIIIF?a.pages[d].url:y+x+",";if(a.isIIIF){var z=
Math.pow(2,s-x);J=a.tileHeight*z;u=a.tileWidth*z;var F="/0/"+(2<=a.pages[d].api?"default":"native")+".jpg"}else J=a.tileHeight,u=a.tileWidth;for(s=0;s<aa;){for(x=0;x<g;){U=s*a.tileHeight;r=x*a.tileWidth;E=s===aa-1?sa:a.tileHeight;Y=x===g-1?ta:a.tileWidth;w=a.isIIIF?y+x*u+","+s*J+","+Y*z+","+E*z+"/"+Y+","+F:y+q;if(!document.getElementById(a.ID+"tile-"+d+"-"+q)){var t=void 0,B=void 0;a.verticallyOriented?(t=a.pageTopOffsets[d]+s*a.tileHeight+a.verticalPadding,B=a.pageLeftOffsets[d]+x*a.tileWidth):(t=
a.pageTopOffsets[d]+s*a.tileHeight,B=a.pageLeftOffsets[d]+x*a.tileWidth+a.horizontalPadding);var V=B+a.tileWidth;n(t,t+a.tileHeight)&&v(B,V)?(t=document.createElement("div"),t.id=a.ID+"tile-"+d+"-"+q,t.classList.add("diva-document-tile"),t.style.display="inline",t.style.position="absolute",t.style.top=U+"px",t.style.left=r+"px",t.style.backgroundImage="url('"+w+"')",t.style.height=E+"px",t.style.width=Y+"px",k.appendChild(t)):p=!1}q++;x++}s++}a.allTilesLoaded[d]=p;h(a.onPageLoaded,d,b,D);diva.Events.publish("PageDidLoad",
[d,b,D],f)}}(d),a.pageLoadTimeout))}},g=function(d){d=document.getElementById(a.ID+"page-"+d);if(null!==d){for(;d.firstChild;)d.removeChild(d.firstChild);d.parentNode.removeChild(d)}},W=function(d){if(a.verticallyOriented){d=a.pageTopOffsets[d]+l(d,"h")+a.verticalPadding;var b=document.getElementById(a.ID+"outer").scrollTop}else d=a.pageLeftOffsets[d]+l(d,"w")+a.horizontalPadding,b=document.getElementById(a.ID+"outer").scrollLeft;return d=d<b},O=function(d){if(a.verticallyOriented){d=a.pageTopOffsets[d];
var b=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight}else d=a.pageLeftOffsets[d],b=document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth;return d=d>b},w=function(d,b){0<b?u(d)&&(G(d)?(R(d),a.lastPageLoaded=d,w(a.lastPageLoaded+1,b)):W(d)&&w(d+1,b)):u(d)&&(G(d)?(R(d),a.firstPageLoaded=d,w(a.firstPageLoaded-1,b)):O(d)&&w(d-1,b))},A=function(d,b){0<b?u(d)&&W(d)&&(g(d),a.firstPageLoaded=d+1,A(a.firstPageLoaded,b)):u(d)&&O(d)&&(g(d),a.lastPageLoaded=d-1,A(a.lastPageLoaded,b))},z=
function(d){return 0<=d&&d<a.numRows},H=function(d){d*=a.rowHeight;return n(d,d+a.rowHeight+a.fixedPadding)},I=function(d){if(!document.getElementById(a.ID+"row-"+d)){var b=a.rowHeight*d+a.fixedPadding,c=document.getElementById(a.ID+"inner"),e=document.createElement("div");e.id=a.ID+"row-"+d;e.classList.add("diva-row");e.style.height=a.rowHeight+"px";e.style.top=b+"px";c.appendChild(e);for(var k,h,D,p,g,y,q=a.imageDir+"/",x=a.pagesPerRow,c=0;c<x;c++){k=d*a.pagesPerRow+c;if(!u(k))break;h=a.pages[k].f;
D=l(k,"w");p=l(k,"h");g=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*D/p:a.gridPageWidth;D=a.fixedHeightGrid?a.rowHeight-a.fixedPadding:g/D*p;p=parseInt(c*(a.fixedPadding+a.gridPageWidth)+a.fixedPadding,10);y=a.pages[k].api;y=2<=y?"default":"native";y=",/0/"+y+".jpg";g=parseInt(g,10);D=parseInt(D,10);p+=a.fixedHeightGrid?(a.gridPageWidth-g)/2:0;y=a.isIIIF?encodeURI(a.pages[k].url+"full/"+g+y):encodeURI(a.iipServerURL+"?FIF="+q+h+"&HEI="+(D+2)+"&CVT=JPEG");a.pageTopOffsets[k]=b;a.pageLeftOffsets[k]=
p;var L=document.createElement("div");L.id=a.ID+"page-"+k;var E=a.selector+"page-"+k;L.classList.add("diva-page");L.style.width=g+"px";L.style.height=D+"px";L.style.left=p+"px";L.setAttribute("data-index",k);L.setAttribute("data-filename",h);L.title="Page "+(k+1);e.appendChild(L);diva.Events.publish("PageWillLoad",[k,h,E],f);s(d,k,y,g,D)}}},C=function(d){d=document.getElementById(a.ID+"row-"+d);if(null!==d){for(;d.firstChild;)d.removeChild(d.firstChild);d.parentNode.removeChild(d)}},P=function(d){d=
a.rowHeight*(d+1);var b=document.getElementById(a.ID+"outer").scrollTop;return d<b},k=function(d){d*=a.rowHeight;var b=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return d>b},p=function(d,b){0<b?z(d)&&(H(d)?(I(d),a.lastRowLoaded=d,p(a.lastRowLoaded+1,b)):P(d)&&p(d+1,b)):z(d)&&(H(d)?(I(d),a.firstRowLoaded=d,p(a.firstRowLoaded-1,b)):k(d)&&p(d-1,b))},q=function(d,b){0<b?z(d)&&P(d)&&(C(d),a.firstRowLoaded++,q(a.firstRowLoaded,b)):z(d)&&k(d)&&(C(d),a.lastRowLoaded--,q(a.lastRowLoaded,
b))},s=function(d,b,c,e,f){a.pageTimeouts.push(window.setTimeout(function(d,b,c,e,K){H(d)&&(d=document.createElement("img"),d.src=c,d.style.width=e+"px",d.style.height=K+"px",document.getElementById(a.ID+"page-"+b).appendChild(d))}(d,b,c,e,f),a.rowLoadTimeout))},E=function(d){var b=a.currentPageIndex,c=b+d;if(!u(c))return!1;var e=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop+a.panelHeight/2:document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth/2,k=!1;0>d?a.verticallyOriented?
0<=c&&a.pageTopOffsets[c]+l(c,"h")+a.verticalPadding>=e&&(k=!0):0<=c&&a.pageLeftOffsets[c]+l(c,"w")+a.horizontalPadding>=e&&(k=!0):0<d&&(a.verticallyOriented?a.pageTopOffsets[b]+l(b,"h")+a.verticalPadding<e&&(k=!0):a.pageLeftOffsets[b]+l(b,"w")+a.horizontalPadding<e&&(k=!0));return k?(a.currentPageIndex=c,0===d||E(d)||(d=a.pages[c].f,h(a.onSetCurrentPage,c,d),diva.Events.publish("VisiblePageDidChange",[c,d],f)),!0):!1},U=function(d){var b=Math.floor(a.currentPageIndex/a.pagesPerRow),c=b+parseInt(d,
10),e=document.getElementById(a.ID+"outer").scrollTop,k=e+a.panelHeight/2,h=!1;0>d?0<=c&&(a.rowHeight*b>=k||a.rowHeight*c>=e)&&(h=!0):0<d&&a.rowHeight*(b+1)<e&&z(c)&&(h=!0);return h?(a.currentPageIndex=c*a.pagesPerRow,0===d||U(d)||(d=a.currentPageIndex,diva.Events.publish("VisiblePageDidChange",[d,a.pages[d].f],f)),!0):!1},V=function(a){var b=M(!1,a),c=N(!1,a);Q(a,b,c)},Q=function(d,c,e){e="undefined"!==typeof e?e:0;c=a.pageTopOffsets[d]+("undefined"!==typeof c?c:0)-parseInt(a.panelHeight/2,10);e=
a.pageLeftOffsets[d]+e-parseInt(a.panelWidth/2,10);b(a.outerSelector).scrollTop(c);b(a.outerSelector).scrollLeft(e);a.currentPageIndex=d;e=a.pages[d].f;h(a.onSetCurrentPage,d,e);diva.Events.publish("VisiblePageDidChange",[d,e],f);h(a.onJump,d);diva.Events.publish("ViewerDidJump",[d],f)},x=function(d){var c=Math.floor(d/a.pagesPerRow)*a.rowHeight;b(a.outerSelector).scrollTop(c);a.currentPageIndex=d;diva.Events.publish("VisiblePageDidChange",[d,a.pages[d].f],f)},J=function(b){return b>=a.minZoomLevel&&
b<=a.maxZoomLevel?b:a.minZoomLevel},ha=function(b){return b>=a.minPagesPerRow&&b<=a.maxPagesPerRow?b:a.maxPagesPerRow},ba=function(){a.allTilesLoaded=[];b(a.outerSelector).scrollTop(0);b(a.innerSelector).empty();a.firstPageLoaded=0;a.firstRowLoaded=-1;a.previousTopScroll=0;a.previousLeftScroll=0;for(clearTimeout(a.resizeTimer);a.pageTimeouts.length;)clearTimeout(a.pageTimeouts.pop())},S=function(){a.inGrid?ia():ca()},ca=function(){ba();a.zoomLevel=J(a.zoomLevel);var b=a.zoomLevel;a.totalHeight=a.totalHeights[b]+
a.verticalPadding*(a.numPages+1);a.totalWidth=a.totalWidths[b]+a.horizontalPadding*(a.numPages+1);var c=a.maxHeights[b]+2*a.verticalPadding,e=Math.max(a.maxWidths[b]+2*a.horizontalPadding,a.panelWidth),c=Math.max(c,a.panelHeight),k=document.getElementById(a.ID+"inner");a.verticallyOriented?(k.style.height=Math.round(a.totalHeight)+"px",k.style.width=Math.round(e)+"px"):(k.style.height=Math.round(c)+"px",k.style.width=Math.round(a.totalWidth)+"px");var p=0,g=0;a.pageTopOffsets=[];a.pageLeftOffsets=
[];for(k=0;k<a.numPages;k++)a.pageTopOffsets[k]=parseInt(a.verticallyOriented?p:(c-l(k,"h"))/2,10),a.pageLeftOffsets[k]=parseInt(a.verticallyOriented?(e-l(k,"w"))/2:g,10),p=a.pageTopOffsets[k]+l(k,"h")+a.verticalPadding,g=a.pageLeftOffsets[k]+l(k,"w")+a.horizontalPadding;u(a.goDirectlyTo)||(a.goDirectlyTo=0);Q(a.goDirectlyTo,a.verticalOffset,a.horizontalOffset);e=!1;for(k=0;k<a.numPages;k++)if(G(k))R(k),a.lastPageLoaded=k,e=!0;else if(e)break;0<=a.oldZoomLevel?(a.oldZoomLevel<a.zoomLevel?(h(a.onZoomIn,
b),diva.Events.publish("ViewerDidZoomIn",[b],f)):(h(a.onZoomOut,b),diva.Events.publish("ViewerDidZoomOut",[b],f)),h(a.onZoom,b)):a.oldZoomLevel=a.zoomLevel;a.scaleWait&&(a.scaleWait=!1);b=a.pages[a.currentPageIndex].f;h(a.onDocumentLoaded,a.currentPageIndex,b);diva.Events.publish("DocumentDidLoad",[a.currentPageIndex,b],f)},ia=function(){var b=a.currentPageIndex;a.verticalOffset=a.verticallyOriented?a.panelHeight/2:l(b,"h")/2;a.horizontalOffset=a.verticallyOriented?l(b,"w")/2:a.panelWidth/2;ba();
a.pagesPerRow=ha(a.pagesPerRow);b=(a.panelWidth-a.fixedPadding*(a.pagesPerRow+1))/a.pagesPerRow;a.gridPageWidth=b;a.rowHeight=a.fixedHeightGrid?a.fixedPadding+a.minRatio*b:a.fixedPadding+a.maxRatio*b;a.numRows=Math.ceil(a.numPages/a.pagesPerRow);a.totalHeight=a.numRows*a.rowHeight+a.fixedPadding;b=document.getElementById(a.ID+"inner");b.style.height=Math.round(a.totalHeight)+"px";b.style.width=Math.round(a.panelWidth)+"px";x(a.goDirectlyTo);var c;a.pageTopOffsets=[];a.pageLeftOffsets=[];for(var e=
a.numPages,b=0;b<e;b+=a.pagesPerRow)c=Math.floor(b/a.pagesPerRow),H(c)&&(a.firstRowLoaded=0>a.firstRowLoaded?c:a.firstRowLoaded,I(c),a.lastRowLoaded=c)},ja=function(a){27==a.keyCode&&F()},da=function(d){var c=M(!0),e=N(!0),k=document.getElementById(a.ID+"outer");a.panelHeight=k.clientHeight-(k.scrollWidth>k.clientWidth?a.scrollbarWidth:0);a.panelWidth=k.clientWidth-(k.scrollHeight>k.clientHeight?a.scrollbarWidth:0);var k=a.panelHeight,p=a.panelWidth;b(a.outerSelector).toggleClass("diva-fullscreen");
b("body").toggleClass("diva-hide-scrollbar");b(a.parentSelector).toggleClass("diva-full-width");if(a.mobileWebkit){var g=parseInt(b(a.outerSelector).css("margin-left"),10)-parseInt(b("body").css("margin-left"),10);b(a.outerSelector).css("margin-left",g)}h(a.onModeToggle,a.inFullscreen);diva.Events.publish("ModeDidSwitch",[a.inFullscreen],f);a.inFullscreen||X();if(0<=a.oldZoomLevel&&!a.inGrid){var g=a.panelHeight,D=a.panelWidth;a.inFullscreen?(a.verticalOffset=(g-k)/2+c,a.horizontalOffset=(D-p)/2+
e):(a.verticalOffset=c-(k-g)/2,a.verticalOffset=e-(p-D)/2)}d?(a.inGrid=!a.inGrid,t()):S();if(a.inFullscreen)b(document).on("keyup",ja);else b(document).off("keyup",ja)},t=function(){S();h(a.onViewToggle,a.inGrid);diva.Events.publish("ViewDidSwitch",[a.inGrid],f)},F=function(){a.goDirectlyTo=a.currentPageIndex;a.inFullscreen=!a.inFullscreen;da(!1)},B=function(){a.goDirectlyTo=a.currentPageIndex;a.inGrid=!a.inGrid;t()},ea=function(d){var c=b(this).offset();a.doubleClickZoom=!0;a.horizontalOffset=d.pageX-
c.left;a.verticalOffset=d.pageY-c.top;a.goDirectlyTo=parseInt(b(this).attr("data-index"),10);T(d.ctrlKey?a.zoomLevel-1:a.zoomLevel+1)},ka=function(d){var c=parseInt(b(this).attr("data-index"),10);a.goDirectlyTo=c;var e=b(this).offset(),c=l(c,"w")/b(this).width();a.horizontalOffset=(d.pageX-e.left)*c;a.verticalOffset=(d.pageY-e.top)*c;a.inGrid=!1;t()},T=function(b){var c=J(b);if(c!==b)return!1;b=Math.pow(2,c-a.zoomLevel);a.doubleClickZoom?(a.verticalOffset*=b,a.horizontalOffset*=b,a.doubleClickZoom=
!1):(a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=b*M(!0),a.horizontalOffset=b*N(!0));a.oldZoomLevel=a.zoomLevel;a.zoomLevel=c;diva.Events.publish("ZoomLevelDidChange",[c],f);ca();return!0},Z=function(b){var c=ha(b);if(c!==b)return!1;a.pagesPerRow=c;diva.Events.publish("GridRowNumberDidChange",[c],f);a.goDirectlyTo=a.currentPageIndex;ia();return!0},M=function(b,c){var e;c="undefined"===typeof c?a.currentPageIndex:c;e=b?document.getElementById(a.ID+"outer").scrollTop-a.pageTopOffsets[c]+a.panelHeight/
2:a.verticallyOriented?a.panelHeight/2:l(c,"h")/2;return parseInt(e,10)},N=function(b,c){var e;c="undefined"===typeof c?a.currentPageIndex:c;e=b?document.getElementById(a.ID+"outer").scrollLeft-a.pageLeftOffsets[c]+parseInt(a.panelWidth/2,10):a.verticallyOriented?l(c,"w")/2:a.panelWidth/2;return parseInt(e,10)},la=function(){return{f:a.inFullscreen,g:a.inGrid,z:a.zoomLevel,n:a.pagesPerRow,i:a.enableFilename?a.pages[a.currentPageIndex].f:!1,p:a.enableFilename?!1:a.currentPageIndex+1,y:a.inGrid?!1:
M(!0),x:a.inGrid?!1:N(!0)}},ma=function(){var b=la(),c=[],e;for(e in b)!1!==b[e]&&c.push(e+a.hashParamSuffix+"="+b[e]);return c.join("&")},na=function(){return location.protocol+"//"+location.host+location.pathname+"#"+ma()},X=function(){var b=document.getElementById(a.ID+"outer");a.panelHeight=b.clientHeight-(b.scrollWidth>b.clientWidth?a.scrollbarWidth:0);a.panelWidth=b.clientWidth-(b.scrollHeight>b.clientHeight?a.scrollbarWidth:0);a.horizontalOffset=N(!0);a.verticalOffset=M(!0);Q(a.currentPageIndex,
a.verticalOffset,a.horizontalOffset);return!0},oa=function(){a.mobileWebkit||b(a.outerSelector+", "+a.innerSelector).dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0});b(a.outerSelector).on("dblclick",".diva-document-page",function(a){ea.call(this,a)});b(a.outerSelector).on("contextmenu",".diva-document-page",function(b){if(b.ctrlKey)return clearTimeout(a.singleClickTimeout),a.singleClick?(ea.call(this,b),a.singleClick=!1):(a.singleClick=!0,a.singleClickTimeout=setTimeout(function(){a.singleClick=
!1},500)),!1});b(a.outerSelector).on("dblclick",".diva-row",function(a){ka.call(b(a.target).parent(),a)})},fa=function(a,b,c,e){return Math.sqrt((a-b)*(a-b)+(c-e)*(c-e))},ua=function(){b(a.innerSelector).mouseover(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});b(a.innerSelector).mouseout(function(){b(this).removeClass("diva-grab")});b(a.innerSelector).mousedown(function(){b(this).removeClass("diva-grab").addClass("diva-grabbing")});b(a.innerSelector).mouseup(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});
oa();b(a.outerSelector).scroll(function(){var b,d=document.getElementById(a.ID+"outer").scrollTop,c=document.getElementById(a.ID+"outer").scrollLeft;b=a.verticallyOriented||a.inGrid?d-a.previousTopScroll:c-a.previousLeftScroll;if(a.inGrid){0>b?(p(a.firstRowLoaded,-1),U(-1),q(a.lastRowLoaded,-1)):0<b&&(p(a.lastRowLoaded,1),U(1),q(a.firstRowLoaded,1));var e=document.getElementById(a.ID+"outer").scrollTop}else{if(0>b)w(a.firstPageLoaded,b),E(-1),A(a.lastPageLoaded,b);else if(0<b)w(a.lastPageLoaded,b),
E(1),A(a.firstPageLoaded,b);else for(var k=a.lastPageLoaded,e=Math.max(a.firstPageLoaded,0);e<=k;e++)G(e)&&R(e);e=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop:document.getElementById(a.ID+"outer").scrollLeft}h(a.onScroll,e);diva.Events.publish("ViewerDidScroll",[e],f);0<b?(h(a.onScrollDown,e),diva.Events.publish("ViewerDidScrollDown",[e],f)):0>b&&(h(a.onScrollUp,e),diva.Events.publish("ViewerDidScrollUp",[e],f));a.previousTopScroll=d;a.previousLeftScroll=c;a.horizontalOffset=
N(!0);a.verticalOffset=M(!0)});if(a.mobileWebkit){var d=[];d.push('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />');d.push('<meta name="apple-mobile-web-app-capable" content="yes" />');d.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');b("head").append(d.join("\n"));a.blockMobileMove&&b("body").bind("touchmove",function(a){a.originalEvent.preventDefault();return!1});b(a.outerSelector).kinetic({triggerHardware:!0});
var c=[],e=[],k=0;b(a.outerSelector).on("touchstart",".diva-document-page",function(a){2===a.originalEvent.touches.length&&(c=[a.originalEvent.touches[0].clientX,a.originalEvent.touches[0].clientY,a.originalEvent.touches[1].clientX,a.originalEvent.touches[1].clientY],k=fa(c[2],c[0],c[3],c[1]))});b(a.outerSelector).on("touchmove",".diva-document-page",function(d){if(2===d.originalEvent.touches.length){e=[d.originalEvent.touches[0].clientX,d.originalEvent.touches[0].clientY,d.originalEvent.touches[1].clientX,
d.originalEvent.touches[1].clientY];var c=fa(e[2],e[0],e[3],e[1])-k;if(!a.scaleWait)if(a.goDirectlyTo=a.currentPageIndex,a.inGrid)a.inGrid=!1,t();else a:{var f=a.zoomLevel;if(100<c&&f<a.maxZoomLevel)f++;else if(-100>c&&f>a.minZoomLevel)f--;else break a;a.scaleWait=!0;c=b(this).offset();a.horizontalOffset=d.pageX-c.left;a.verticalOffset=d.pageY-c.top;a.goDirectlyTo=parseInt(b(this).attr("data-index"),10);T(f)}}});var g={},s=0,d=function(d){if(a.singleTap){var c={pageX:d.originalEvent.changedTouches[0].clientX,
pageY:d.originalEvent.changedTouches[0].clientY};s=fa(g.pageX,c.pageX,g.pageY,c.pageY);50>s&&a.zoomLevel<a.maxZoomLevel&&(a.inGrid?ka.call(b(d.target).parent(),c):ea.call(this,c));a.singleTap=!1;g={}}else a.singleTap=!0,g.pageX=d.originalEvent.changedTouches[0].clientX,g.pageY=d.originalEvent.changedTouches[0].clientY,a.singleTapTimeout=setTimeout(function(){a.singleTap=!1;g={}},250)};b(a.outerSelector).on("touchend",".diva-document-page",d);b(a.outerSelector).on("touchend",".diva-page",d)}if(a.enableSpaceScroll||
a.enableKeyScroll)b(document).keydown(function(d){if(a.isActiveDiva){if(a.enableSpaceScroll&&32===d.keyCode||a.enableKeyScroll&&34===d.keyCode)return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.panelHeight),!1;if(a.enableKeyScroll)switch(d.keyCode){case 33:return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.panelHeight),!1;case 38:return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.arrowScrollAmount),
!1;case 40:return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.arrowScrollAmount),!1;case 37:return b(a.outerSelector).scrollLeft(document.getElementById(a.ID+"outer").scrollLeft-a.arrowScrollAmount),!1;case 39:return b(a.outerSelector).scrollLeft(document.getElementById(a.ID+"outer").scrollLeft+a.arrowScrollAmount),!1;case 36:return b(a.outerSelector).scrollTop(0),!1;case 35:return b(a.outerSelector).scrollTop(a.totalHeight),!1}}}),a.mobileWebkit?(d="onorientationchange"in
window?"orientationchange":"resize",b(window).bind(d,function(b){b=a.panelWidth;var d=a.panelHeight;X();a.horizontalOffset-=(a.panelWidth-b)/2;a.verticalOffset-=(a.panelHeight-d)/2;a.goDirectlyTo=a.currentPageIndex;S()})):b(window).resize(function(){X();clearTimeout(a.resizeTimer);a.resizeTimer=setTimeout(function(){a.goDirectlyTo=a.currentPageIndex;a.verticalOffset=M(!0);a.horizontalOffset=N(!0);S()},200)})},va=function(){var d='<div id="'+a.ID+'tools-left" class="diva-tools-left">'+("slider"===
a.enableZoomControls?'<input type="range" id="'+a.ID+'zoom-slider" class="zoom-slider" value="'+a.zoomLevel+'" min="'+a.minZoomLevel+'" max="'+a.maxZoomLevel+'">':"")+("buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-out-button" class="diva-zoom-out-button button" title="Zoom Out"></div><div id="'+a.ID+'zoom-in-button" class="diva-zoom-in-button button" title="Zoom In"></div>':"")+("slider"===a.enableGridControls?'<input type="range" id="'+a.ID+'grid-slider" class="grid-slider" value="'+a.pagesPerRow+
'" min="'+a.minPagesPerRow+'" max="'+a.maxPagesPerRow+'">':"")+("buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-out-button" class="diva-grid-out-button button" title="Zoom Out"></div><div id="'+a.ID+'grid-in-button" class="diva-grid-in-button button" title="Zoom In"></div>':"")+("slider"===a.enableZoomControls?'<div id="'+a.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"")+("buttons"===a.enableZoomControls?'<div id="'+
a.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"")+("slider"===a.enableGridControls?'<div id="'+a.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"")+("buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"")+'</div><div id="'+
a.ID+'tools-right" class="diva-tools-right">'+(a.enableFullscreen?'<div id="'+a.ID+'fullscreen" class="diva-fullscreen-icon button" title="Toggle fullscreen mode"></div>':"")+(a.enableLinkIcon?'<div class="diva-link-icon button" id="'+a.ID+'link-icon" style="'+(a.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"")+(a.enableGridIcon?'<div class="diva-grid-icon button'+(a.inGrid?" diva-in-grid":"")+'" id="'+a.ID+'grid-icon" title="Toggle grid view"></div>':"")+'<div class="diva-page-nav">'+
(a.enableGotoPage?'<form id="'+a.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+a.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"")+('<div class="diva-page-label">Page <span id="'+a.ID+'current-page">1</span> of <span id="'+a.ID+'num-pages">'+a.numPages+"</span></div>")+"</div></div>";b(a.toolbarParentSelector).prepend('<div id="'+a.ID+'tools" class="diva-tools">'+d+"</div>");b(a.selector+"zoom-slider").on("input",function(a){a=
parseInt(this.value,10);T(a)});b(a.selector+"zoom-slider").on("change",function(b){b=parseInt(this.value,10);b!==a.zoomLevel&&T(b)});b(a.selector+"zoom-out-button").click(function(){T(a.zoomLevel+-1)});b(a.selector+"zoom-in-button").click(function(){T(a.zoomLevel+1)});b(a.selector+"grid-slider").on("input",function(a){a=parseInt(this.value,10);Z(a)});b(a.selector+"grid-slider").on("change",function(b){b=parseInt(this.value,10);b!==a.zoomLevel&&Z(b)});b(a.selector+"fullscreen").click(function(){F()});
b(a.selector+"grid-out-button").click(function(){Z(a.pagesPerRow-1)});b(a.selector+"grid-in-button").click(function(){Z(a.pagesPerRow+1)});b(a.selector+"grid-icon").click(function(){B()});b(a.selector+"goto-page").submit(function(){var d=parseInt(b(a.selector+"goto-page-input").val(),10)-1;u(d)?a.inGrid?x(d):V(d):alert("Invalid page number");return!1});b(a.selector+"link-icon").click(function(){b("body").prepend('<div id="'+a.ID+'link-popup" class="diva-link-popup"><input id="'+a.ID+'link-popup-input" class="diva-input" type="text" value="'+
na()+'"/></div>');if(a.inFullscreen)b(a.selector+"link-popup").addClass("in-fullscreen");else{var d=b(a.outerSelector).offset().left+a.panelWidth,d=d+(a.scrollbarWidth-240-1),c=b(a.outerSelector).offset().top+1;b(a.selector+"link-popup").removeClass("in-fullscreen").css({top:c+"px",left:d+"px"})}b("body").mouseup(function(d){d=d.target.id;d!==a.ID+"link-popup"&&d!==a.ID+"link-popup-input"&&b(a.selector+"link-popup").remove()});b(a.outerSelector).scroll(function(){b(a.selector+"link-popup").remove()});
b(a.selector+"link-popup input").click(function(){b(this).focus().select()});return!1});var c=a.inGrid?"grid":"zoom";b(a.selector+c+"-slider").show();b(a.selector+c+"-out-button").show();b(a.selector+c+"-in-button").show();b(a.selector+c+"-slider-label").show();b(a.selector+c+"-buttons-label").show();return{updateCurrentPage:function(){document.getElementById(a.ID+"current-page").textContent=a.currentPageIndex+1},setNumPages:function(b){document.getElementById(a.ID+"num-pages").textContent=b},updateZoomSlider:function(){a.zoomLevel!==
b(a.selector+"zoom-slider").val()&&b(a.selector+"zoom-slider").val(a.zoomLevel);document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateZoomButtons:function(){document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateGridSlider:function(){a.pagesPerRow!==b(a.selector+"grid-slider").val()&&b(a.selector+"grid-slider").val(a.pagesPerRow);document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},updateGridButtons:function(){document.getElementById(a.ID+
"pages-per-row").textContent=a.pagesPerRow},switchView:function(){b(a.selector+c+"-slider").hide();b(a.selector+c+"-out-button").hide();b(a.selector+c+"-in-button").hide();b(a.selector+c+"-slider-label").hide();b(a.selector+c+"-buttons-label").hide();c=a.inGrid?"grid":"zoom";b(a.selector+c+"-slider").show();b(a.selector+c+"-out-button").show();b(a.selector+c+"-in-button").show();b(a.selector+c+"-slider-label").show();b(a.selector+c+"-buttons-label").show();b(a.selector+"grid-icon").toggleClass("diva-in-grid")},
switchMode:function(){b(a.selector+"tools").toggleClass("diva-fullscreen-tools");a.inFullscreen?b(a.selector+"tools-left").addClass("in-fullscreen"):b(a.selector+"tools-left").removeClass("in-fullscreen")}}},wa=function(){if(window.divaPlugins){var d=[];b.each(window.divaPlugins,function(c,e){var k=e.pluginName[0].toUpperCase()+e.pluginName.substring(1);a["enable"+k]&&e.init(a,f)&&(k=e.titleText||k+" plugin","function"===typeof e.handleClick&&(d.push('<div class="diva-'+e.pluginName+'-icon" title="'+
k+'"></div>'),k=a.mobileWebkit?"touchend":"click",b(a.outerSelector).on(k,".diva-"+e.pluginName+"-icon",function(b){e.handleClick.call(this,b,a,f)})),a.plugins.push(e))});d.length&&(a.pageTools='<div class="diva-page-tools">'+d.join("")+"</div>")}},pa=function(){clearTimeout(a.throbberTimeoutID);b(a.selector+"throbber").hide()},xa=function(a){var b=function(a,b){var d=Math.max(a,b);return Math.ceil(Math.log((d+1)/257)/Math.log(2))},c=function(a,b){for(var d=a.length;d--;)a[d]=b},e=a.sequences[0].canvases,
k=Array(e.length),f=Array(e.length),p,h,g,m,s,q;a=a.label;for(var l=0,x=e.length;l<x;l++)p=e[l].width,h=e[l].height,q=e[l].images[0].resource,g=q.service["@id"],"/"!==g.slice(-1)&&(g+="/"),m=b(p,h),s=e[l].label,q=q.service["@context"],q="http://iiif.io/api/image/2/context.json"===q?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===q?1.1:1,f[l]={mx_w:p,mx_h:h,mx_z:m,fn:s,url:g,api:q},k[l]=m;b=Math.min.apply(Math,k);e=0;k=100;p=Array(b+1);h=Array(b+1);g=Array(b+1);m=Array(b+1);c(p,0);
c(h,0);c(g,0);c(m,0);for(var c=[],E,n,l=0,x=f.length;l<x;l++){s=[];for(q=0;q<b+1;q++)E=Math.floor(f[l].mx_w/Math.pow(2,b-q)),n=Math.floor(f[l].mx_h/Math.pow(2,b-q)),s[q]={h:n,w:E},p[q]+=E,h[q]+=n,g[q]=Math.max(E,g[q]),m[q]=Math.max(n,m[q]),E=f[l].mx_h/f[l].mx_w,e=Math.max(E,e),k=Math.min(E,k);c[l]={d:s,m:f[l].mx_z,f:f[l].fn,url:f[l].url,api:f[l].api}}s=[];x=[];for(l=0;l<b+1;l++)s.push(p[l]/f.length),x.push(h[l]/f.length);return{item_title:a,dims:{a_wid:s,a_hei:x,max_w:g,max_h:m,max_ratio:e,min_ratio:k,
t_hei:h,t_wid:p},max_zoom:b,pgs:c}},qa=function(d,c,e){pa();d='<div id="'+a.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+c+" "+e+"</p>";0===a.objectData.lastIndexOf("http",0)&&""===e&&(e=a.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0],location.hostname!==e&&(d+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>'));
d+="</div>";b(a.outerSelector).append(d)},ra=function(d){!d.hasOwnProperty("@context")||-1===d["@context"].indexOf("iiif")&&-1===d["@context"].indexOf("shared-canvas")||(a.isIIIF=!0,d=xa(d));pa();a.pages=d.pgs;a.maxRatio=d.dims.max_ratio;a.minRatio=d.dims.min_ratio;a.itemTitle=d.item_title;a.numPages=d.pgs.length;a.maxWidths=d.dims.max_w;a.maxHeights=d.dims.max_h;a.averageWidths=d.dims.a_wid;a.averageHeights=d.dims.a_hei;a.totalHeights=d.dims.t_hei;a.totalWidths=d.dims.t_wid;a.realMaxZoom=d.max_zoom;
a.maxZoomLevel=0<=a.maxZoomLevel&&a.maxZoomLevel<=d.max_zoom?a.maxZoomLevel:d.max_zoom;a.minZoomLevel=0<=a.minZoomLevel&&a.minZoomLevel<=a.maxZoomLevel?a.minZoomLevel:0;a.zoomLevel=J(a.zoomLevel);a.minPagesPerRow=Math.max(2,a.minPagesPerRow);a.maxPagesPerRow=Math.max(a.minPagesPerRow,a.maxPagesPerRow);a.enableFilename?(d=b.getHashParam("i"+a.hashParamSuffix),d=r(d)):d=parseInt(b.getHashParam("p"+a.hashParamSuffix),10)-1;u(d)&&(a.goDirectlyTo=d,a.currentPageIndex=d);diva.Events.publish("NumberOfPagesDidChange",
[a.numPages],this);a.enableAutoTitle&&(b(a.selector+"title").length?b(a.selector+"title").html(a.itemTitle):b(a.parentSelector).prepend('<div id="'+a.ID+'title" class="diva-title">'+a.itemTitle+"</div>"));u(parseInt(a.goDirectlyTo),10)||(a.goDirectlyTo=0);0<a.adaptivePadding?(d=a.zoomLevel,a.horizontalPadding=parseInt(a.averageWidths[d]*a.adaptivePadding,10),a.verticalPadding=parseInt(a.averageHeights[d]*a.adaptivePadding,10)):(a.horizontalPadding=a.fixedPadding,a.verticalPadding=a.fixedPadding);
a.pageTools.length&&(a.verticalPadding=Math.max(40,a.verticalPadding))},ya=function(){var d='<div id="'+a.ID+'throbber" class="diva-throbber"></div>';b(a.outerSelector).append(d);a.throbberTimeoutID=setTimeout(function(){b(a.selector+"throbber").show()},a.throbberTimeout);b.ajax({url:a.objectData,cache:!0,dataType:"json",error:qa,success:function(d,c,e){ra(d);b.each(a.plugins,function(b,d){h(d.setupHook,a)});a.enableToolbar&&(a.toolbar=va(),diva.Events.subscribe("VisiblePageDidChange",a.toolbar.updateCurrentPage),
diva.Events.subscribe("ModeDidSwitch",a.toolbar.switchMode),diva.Events.subscribe("ViewDidSwitch",a.toolbar.switchView),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomButtons),diva.Events.subscribe("GridRowNumberDidChange",a.toolbar.updateGridSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateGridButtons),diva.Events.subscribe("NumberOfPagesDidChange",a.toolbar.setNumPages));b(a.parentSelector).parent()[0]!==
document.body||b(a.parentSelector).siblings().not("#diva-canvas-backdrop")[0]||(a.divaIsFullWindow=!0);X();d=parseInt(b.getHashParam("y"+a.hashParamSuffix),10);isNaN(d)?a.verticalOffset=M(!1):a.verticalOffset=d;d=parseInt(b.getHashParam("x"+a.hashParamSuffix),10);isNaN(d)?a.horizontalOffset=N(!1):a.horizontalOffset=d;a.inFullscreen?da(!1):S();X();h(a.onReady,a);diva.Events.publish("ViewerDidLoad",[a],f);a.loaded=!0}})},ga=function(){return a.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),
!1)};(function(){a.scrollbarWidth=b.getScrollbarWidth();a.mobileWebkit=void 0!==window.orientation;a.ID=b.generateId("diva-");a.selector="#"+a.ID;var d=parseInt(a.ID,10);1<d&&(a.hashParamSuffix=d);a.outerSelector=a.selector+"outer";a.innerSelector=a.selector+"inner";b(a.parentSelector).append('<div id="'+a.ID+'outer" class="diva-outer"></div>');b(a.outerSelector).append('<div id="'+a.ID+'inner" class="diva-inner diva-dragger"></div>');d=parseInt(b.getHashParam("n"+a.hashParamSuffix),10);d>=a.minPagesPerRow&&
d<=a.maxPagesPerRow&&(a.pagesPerRow=d);d=b.getHashParam("z"+a.hashParamSuffix);""!==d&&(d=parseInt(d,10),d>=a.minZoomLevel&&(a.zoomLevel=d));var d=b.getHashParam("g"+a.hashParamSuffix),c="true"===d,e=b.getHashParam("f"+a.hashParamSuffix);a.inGrid=a.inGrid&&"false"!==d||c;a.inFullscreen=a.inFullscreen&&"false"!==e||"true"===e;ya();wa();ua()})();this.getItemTitle=function(){return a.itemTitle};this.gotoPageByNumber=function(a){a-=1;return u(a)?(V(a),!0):!1};this.gotoPageByIndex=function(a){return u(a)?
(V(a),!0):!1};this.getCurrentPage=function(){console.warn("The call to getCurrentPage is deprecated. Use getCurrentPageIndex instead.");return a.currentPageIndex};this.getNumberOfPages=function(){return ga()?a.numPages:!1};this.getPageDimensionsAtZoomLevel=function(b,c){if(!ga())return!1;c>a.maxZoomLevel&&(c=a.maxZoomLevel);var e=a.pages[b].d[parseInt(c,10)];return{width:e.w,height:e.h}};this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(a.currentPageIndex,
a.zoomLevel)};this.isReady=function(){return a.loaded};this.getCurrentPageIndex=function(){return a.currentPageIndex};this.getCurrentPageFilename=function(){return a.pages[a.currentPageIndex].f};this.getCurrentPageNumber=function(){return a.currentPageIndex+1};this.getFilenames=function(){for(var b=[],c=0;c<a.numPages;c++)b[c]=a.pages[c].f;return b};this.getZoomLevel=function(){return a.zoomLevel};this.getMaxZoomLevel=function(){return a.maxZoomLevel};this.getMaxZoomLevelForPage=function(b){return ga?
a.pages[b].m:!1};this.getMinZoomLevel=function(){return a.minZoomLevel};this.setZoomLevel=function(b){a.inGrid&&B();return T(b)};this.zoomIn=function(){return this.setZoomLevel(a.zoomLevel+1)};this.zoomOut=function(){return this.setZoomLevel(a.zoomLevel-1)};this.inViewport=function(b,c,e,k,f){b-=1;e=a.pageTopOffsets[b]+e;c=a.pageLeftOffsets[b]+c;k=c+k;return n(e,e+f)&&v(c,k)};this.isPageInViewport=function(a){return G(a)};this.toggleFullscreenMode=function(){F()};this.enterFullscreenMode=function(){return a.inFullscreen?
!1:(F(),!0)};this.leaveFullscreenMode=function(){return a.inFullscreen?(F(),!0):!1};this.toggleGridView=function(){B()};this.enterGridView=function(){return a.inGrid?!1:(B(),!0)};this.leaveGridView=function(){return a.inGrid?(B(),!0):!1};this.gotoPageByName=function(a){a=r(a);return u(a)?(V(a),!0):!1};this.getPageIndex=function(a){return r(a)};this.getCurrentURL=function(){return na()};this.getURLHash=function(){return ma()};this.getState=function(){return la()};this.getInstanceSelector=function(){return a.selector};
this.getInstanceId=function(){return a.ID};this.getSettings=function(){return a};this.translateFromMaxZoomLevel=function(b){return b/Math.pow(2,a.maxZoomLevel-a.zoomLevel)};this.translateToMaxZoomLevel=function(b){var c=a.maxZoomLevel-a.zoomLevel;return 0===c?b:b*Math.pow(2,c)};this.setState=function(b){var c;c=r(b.i);u(c)?a.goDirectlyTo=c:u(b.p)&&(a.goDirectlyTo=b.p);horizontalOffset=parseInt(b.x,10);verticalOffset=parseInt(b.y,10);b.z>=a.minZoomLevel&&b.z<=a.maxZoomLevel&&(a.zoomLevel=b.z);b.n>=
a.minPagesPerRow&&b.n<=a.maxPagesPerRow&&(a.pagesPerRow=b.n);a.inFullscreen!==b.f?(a.inFullscreen=b.f,da(a.inGrid!==b.g),a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,Q(c,a.verticalOffset,a.horizontalOffset)):(a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,a.inGrid!==b.g?(a.inGrid=b.g,t()):S())};this.enableScrollable=function(){a.isScrollable||(oa(),a.enableKeyScroll=a.initialKeyScroll,a.enableSpaceScroll=a.initialSpaceScroll,b(a.outerSelector).css("overflow",
"auto"),a.isScrollable=!0)};this.disableScrollable=function(){a.isScrollable&&(b(a.innerSelector+".diva-dragger").unbind("mousedown"),b(a.outerSelector).unbind("dblclick"),b(a.outerSelector).unbind("contextmenu"),b(a.outerSelector).css("overflow","hidden"),a.initialKeyScroll=a.enableKeyScroll,a.initialSpaceScroll=a.enableSpaceScroll,a.enableKeyScroll=!1,a.enableSpaceScroll=!1,a.isScrollable=!1)};this.toggleOrientation=function(){a.verticallyOriented=!a.verticallyOriented;a.verticalOffset=M(!1);a.horizontalOffset=
N(!1);a.goDirectlyTo=a.currentPageIndex;ca();return a.verticallyOriented};this.getPageOffset=function(b){return{top:parseInt(a.pageTopOffsets[b]),left:parseInt(a.pageLeftOffsets[b])}};this.getPageDimensionsAtCurrentGridLevel=function(b){b=u(b)?b:a.currentPageIndex;var c=a.rowHeight-a.fixedPadding;b=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*l(b,"w")/l(b,"h"):a.gridPageWidth;return{height:parseInt(c,10),width:parseInt(b,10)}};this.changeObject=function(c){a.loaded=!1;ba();a.objectData=c;b.ajax({url:a.objectData,
cache:!0,dataType:"json",error:qa,success:function(b,c,d){ra(b);S();a.loaded=!0}})};this.activate=function(){a.isActiveDiva=!0};this.deactivate=function(){a.isActiveDiva=!1};this.destroy=function(){b("body").removeClass("diva-hide-scrollbar");b(a.parentSelector).empty().removeData("diva");b.each(a.plugins,function(b,c){h(c.destroy,a,f)});b(a.parentSelector).removeAttr("style").removeAttr("class");diva.Events.unsubscribeAll()}};b.fn.diva=function(e){return this.each(function(){var c=b(this);if(!c.data("diva")){e.parentSelector=
c;var a=new f(this,e);c.data("diva",a)}})}})(jQuery);(function(b){window.divaPlugins.push(function(){var f={},e={},c={},a,m,h,l={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:0.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,onInit:null,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},r=function(b,c){var e=b.context,f=b.size/2,h=-(b.width/2),g=-(b.height/2);e.clearRect(0,0,b.size,b.size);e.save();e.translate(f,f);e.rotate(c*Math.PI/
180);e.drawImage(a,h,g,b.width,b.height);e.restore();b.data=e.getImageData(0,0,b.size,b.size)},v=function(){for(var a in m)if(m[a].current!==m[a].previous)return!0;return!1},n=function(){r(e,m.rotation.current);R(e)},u=function(){var a=m.rotation.current,e=m.zoom.current,h=m.zoom.previous;if(a!==m.rotation.previous||e!==h){var g=b("#diva-canvas-wrapper").scrollLeft(),l=b("#diva-canvas-wrapper").scrollTop(),n=c.viewport.width/2,u=c.viewport.height/2,g=g+n-f.centerX,w=-(l+u-f.centerY),x=(m.rotation.previous-
a)*Math.PI/180,l=Math.cos(x)*g-Math.sin(x)*w+f.centerX,g=-(Math.sin(x)*g+Math.cos(x)*w)+f.centerY,e=Math.pow(2,e-h),n=e*l-n,u=e*g-u;r(f,a);b("#diva-canvas-wrapper").scrollLeft(n);b("#diva-canvas-wrapper").scrollTop(u)}if(v()){R(f);for(var J in m)m[J].previous=m[J].current}},G=function(a){var b=m[a].current!==m[a].initial;return m[a].current!==m[a].previous||b},R=function(a){var b=a.data,e=a.context.createImageData(b),f=e.data,g,h;g=0;for(h=f.length;g<h;g++)f[g]=b.data[g];b=e.data;g=m.contrast.current;
f=(1+Math.min(c.brightnessMax,Math.max(c.brightnessMin,m.brightness.current))/c.brightnessMax)*g;g=128-128*g;h=m.red.current;var l=m.green.current,n=m.blue.current,x=G("red"),u=G("green"),r=G("blue"),w=G("brightness"),v=G("contrast"),w=w||v,z,A,H,C,t,F,B,v=0;for(A=e.width;v<A;v++)for(z=0,H=e.height;z<H;z++)C=4*(z*A+v),t=b[C],F=b[C+1],B=b[C+2],0<t+F+B&&(x&&t&&(t+=h),u&&F&&(F+=l),r&&B&&(B+=n),w&&(t&&(t=t*f+g),F&&(F=F*f+g),B&&(B=B*f+g)),b[C]=t,b[C+1]=F,b[C+2]=B);a.context.clearRect(0,0,A,H);a.context.putImageData(e,
0,0)},g=function(){var a=b("#diva-canvas-wrapper").scrollLeft()*e.scaleFactor,f=b("#diva-canvas-wrapper").scrollTop()*e.scaleFactor,g=Math.min(Math.round(c.viewport.height*e.scaleFactor),c.mapSize)-4,h=Math.min(Math.round(c.viewport.width*e.scaleFactor),c.mapSize)-4;b("#diva-map-viewbox").height(g).width(h).css({top:f,left:a})},W=function(k,h){a=new Image;a.src=k;a.crossOrigin="Anonymous";a.onload=function(){f.size=Math.sqrt(a.width*a.width+a.height*a.height);f.canvas=document.getElementById("diva-canvas");
f.canvas.width=f.size;f.canvas.height=f.size;f.cornerX=(f.size-a.width)/2;f.cornerY=(f.size-a.height)/2;f.width=a.width;f.height=a.height;f.centerX=f.size/2;f.centerY=f.size/2;f.context=f.canvas.getContext("2d");f.context.drawImage(a,f.cornerX,f.cornerY,f.width,f.height);try{f.data=f.context.getImageData(0,0,f.size,f.size)}catch(k){var m='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+k.message+"</p>";if("SecurityError"!==k.name)throw k;m+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div></div>';
b("#diva-canvas-backdrop").append(m);H()}void 0===h&&(m=a,e.canvas=document.getElementById("diva-canvas-minimap"),e.size=c.mapSize,e.canvas.width=e.size,e.canvas.height=e.size,e.context=e.canvas.getContext("2d"),e.context.fillRect(0,0,e.size,e.size),e.scaleFactor=c.mapSize/f.size,e.cornerX=f.cornerX*e.scaleFactor,e.cornerY=f.cornerY*e.scaleFactor,e.width=m.width*e.scaleFactor,e.height=m.height*e.scaleFactor,e.context.drawImage(m,e.cornerX,e.cornerY,e.width,e.height),e.data=e.context.getImageData(0,
0,c.mapSize,c.mapSize),b("#diva-map-viewbox").show(),g());n();u(f);H();"function"===typeof h&&h.call(h)}},O=function(){var a=m[h],c=a.current,a=a.transform?a.transform(c):c;b("#diva-canvas-value").html(a)},w=function(){b("#diva-canvas-slider").val(m[h].current)},A=function(a){a=c.zoomWidthRatio*Math.pow(2,a);return c.proxyURL?c.proxyURL+"?f="+c.filename+"&w="+a:c.iipServerURL+"?FIF="+(c.imageDir+"/")+c.filename+"&WID="+a+"&CVT=JPEG"},z=function(){(0<m.zoom.current||c.mobileWebkit)&&b(c.selector+"throbber").addClass("canvas-throbber").show()},
H=function(){b(c.selector+"throbber").removeClass("canvas-throbber").hide()},I=function(){var a={},b=!1,e=c.localStoragePrefix+c.filename,f;for(f in m)m[f].previous!==m[f].initial&&(a[f]=m[f].previous,b=!0);b?(c.pluginIcon.addClass("new"),localStorage.setObject(e,a)):(c.pluginIcon.removeClass("new"),localStorage.removeItem(e))},C=function(a,b){c.zoomLevel=a;var h=A(a);W(h,function(){e.scaleFactor=e.size/f.size;g();I()})},P=function(a){switch(a.keyCode){case 38:return b("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-
c.arrowScrollAmount),!1;case 40:return b("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+c.arrowScrollAmount),!1;case 37:return b("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-c.arrowScrollAmount),!1;case 39:return b("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+c.arrowScrollAmount),!1}};return{init:function(a,p){if(!window.HTMLCanvasElement)return!1;b.extend(c,
l,a.canvasPlugin);c.inCanvas=!1;c.iipServerURL=a.iipServerURL;c.imageDir=a.imageDir;c.selector=a.selector;c.mobileWebkit=a.mobileWebkit;c.arrowScrollAmount=a.arrowScrollAmount;m={contrast:{initial:1,min:c.contrastMin,max:c.contrastMax,step:c.contrastStep,transform:function(a){return a.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:c.brightnessMin,max:c.brightnessMax,step:c.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(a){return a+
"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the blue channel"}};var q=function(){var a,b,c;for(c in m)b=m[c],a=b.initial,b.current=a,b.previous=a};q();if(b("#diva-canvas-backdrop").length)return!0;var s=[],r,A,G;for(G in c.buttons)r=
c.buttons[G],A=m[r].title,r='<div class="'+r+'" title="'+A+'"></div>',s.push(r);s='<div id="diva-canvas-backdrop">'+('<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+s.join("")+
'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>')+'<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div></div>';b("body").append(s);
c.mapSize=b("#diva-canvas-minimap").width();b("#diva-canvas-buttons div").click(function(){b("#diva-canvas-buttons .clicked").removeClass("clicked");Q(b(this).attr("class"))});var Q=function(a){h=a;a=m[h];b("#diva-canvas-buttons ."+h).addClass("clicked");b("#diva-canvas-mode").text(h);var c=a.current,e=a.transform?a.transform(c):c,f=document.getElementById("diva-canvas-slider");f.min=a.min;f.max=a.max;f.step=a.step;b("#diva-canvas-slider").val(c);b("#diva-canvas-value").html(e)};Q("contrast");b("#diva-canvas-slider").on("input",
function(a){m[h].current=parseFloat(this.value);O();n()});b("#diva-canvas-reset-all").click(function(){for(var a in m)m[a].current=m[a].initial;O();w();n()});b("#diva-canvas-reset").click(function(){m[h].current=m[h].initial;O();w();n()});b("#diva-canvas-apply").click(function(){v()&&(z(),setTimeout(function(){m.zoom.current!==m.zoom.previous?C(m.zoom.current):(u(),H(),I())},c.throbberTimeout))});b("#diva-canvas-close").click(function(){b("body").removeClass("overflow-hidden");f.context.clearRect(0,
0,f.size,f.size);e.context.clearRect(0,0,e.size,e.size);b("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0);b("#diva-canvas-backdrop").hide();b("#diva-map-viewbox").hide();H();p.enableScrollable();b(document).off("keydown",P);q();O();w();b("#diva-canvas-buttons .clicked").removeClass("clicked");Q("contrast");diva.Events.publish("CanvasViewDidHide")});b("#diva-canvas-minimise").click(function(){b("#diva-canvas-toolwindow").slideToggle("fast")});b(window).resize(function(){c.viewport={height:window.innerHeight-
a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};c.inCanvas&&g()});b("#diva-canvas-wrapper").scroll(function(){c.inCanvas&&g()});b("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(a){var f=b("#diva-canvas-minimap").offset(),g=(a.pageX-f.left)/e.scaleFactor;a=(a.pageY-f.top)/e.scaleFactor;b("#diva-canvas-wrapper").scrollTop(a-c.viewport.height/2);b("#diva-canvas-wrapper").scrollLeft(g-c.viewport.width/2)});b("#diva-canvas").mousedown(function(){b(this).addClass("grabbing")}).mouseup(function(){b(this).removeClass("grabbing")});
c.mobileWebkit?b("#diva-canvas-wrapper").kinetic():b("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0});"function"===typeof c.onInit&&c.onInit.call(this,c);return!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(a){c.viewport={height:window.innerHeight-a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};c.minZoomLevel=a.minZoomLevel;c.maxZoomLevel=a.maxZoomLevel;c.mobileWebkit&&(c.maxZoomLevel=Math.min(c.maxZoomLevel,
c.mobileWebkitMaxZoom));m.zoom.min=c.minZoomLevel;m.zoom.max=c.maxZoomLevel},handleClick:function(a,e,f){a=b(this).parent().parent();var g=b(a).attr("data-filename"),l=b(a).width()-1;e=e.zoomLevel;var n;c.zoomWidthRatio=l/Math.pow(2,e);c.pluginIcon=b(this);c.mobileWebkit&&(e=Math.min(c.maxZoomLevel,e));c.filename=g;m.zoom.initial=e;m.zoom.current=e;if(g=localStorage.getObject(c.localStoragePrefix+c.filename))for(n in g)m[n].current=g[n],n===h&&(O(),w()),"zoom"===n&&(e=g[n]);m.zoom.previous=e;b("body").addClass("overflow-hidden");
b("#diva-canvas-backdrop").show();f.disableScrollable();b(document).keydown(P);c.inCanvas=!0;f=A(e);b("#diva-canvas-info").text(b(a).attr("title"));z();diva.Events.publish("CanvasViewDidActivate",[a]);W(f)},onPageLoad:function(a,e,f){null!==localStorage.getItem(c.localStoragePrefix+e)&&b(f).find(".diva-canvas-icon").addClass("new")},destroy:function(a,c){b("#diva-canvas-backdrop").remove()}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){var f,e;return{init:function(b,a){f=b.iipServerURL;e=b.imageDir;return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(c){var a=b(this).parent().parent();c=b(a).attr("data-filename");a=b(a).width()-1;window.open(f+"?FIF="+(e+"/")+c+"&WID="+a+"&CVT=JPEG")}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){return{init:function(b,e){function c(a,c,h){var l=b.parentSelector.data("highlights");if("undefined"!==typeof l){if(l.hasOwnProperty(a)){c=e.getInstanceId()+"page-"+a;c=document.getElementById(c);h=l[a].regions;var r=l[a].colour,l=l[a].divClass,v=e.getMaxZoomLevel();b.inGrid?(a=e.getPageDimensionsAtZoomLevel(a,v).width,a=Math.log(a/c.clientWidth)/Math.log(2)):a=v-e.getZoomLevel();for(v=h.length;v--;){var n=document.createElement("div");n.style.width=
h[v].width/Math.pow(2,a)+"px";n.style.height=h[v].height/Math.pow(2,a)+"px";n.style.top=h[v].uly/Math.pow(2,a)+"px";n.style.left=h[v].ulx/Math.pow(2,a)+"px";n.style.background=r;n.style.border="1px solid #555";n.style.position="absolute";n.style.zIndex=100;n.className=l;"undefined"!==typeof h[v].divID&&(n.id=h[v].divID);c.appendChild(n)}}diva.Events.publish("HighlightCompleted")}}b.parentSelector.data("highlights",{});diva.Events.subscribe("PageWillLoad",c);e.resetHighlights=function(){for(var a=
document.getElementById(b.ID+"inner").getElementsByClassName(b.ID+"highlight"),c=a.length;c--;)a[c].parentNode.removeChild(a[c]);b.parentSelector.data("highlights",{})};e.removeHighlightsOnPage=function(a){var c=b.parentSelector.data("highlights");if(c.hasOwnProperty(a)){for(var h=e.getInstanceId()+"page-"+a,h=document.getElementById(h),l=h.getElementsByTagName("div"),r=c[a].divClass,v=l.length;v--;)l[v].className===r&&h.removeChild(l[v]);delete c[a]}};e.highlightOnPages=function(a,b,c,f){for(var r=
a.length;r--;)e.highlightOnPage(a[r],b,c,f)};e.highlightOnPage=function(a,m,h,l){"undefined"===typeof h&&(h="rgba(255, 0, 0, 0.2)");l="undefined"===typeof l?b.ID+"highlight":b.ID+"highlight "+l;e.getMaxZoomLevel();b.parentSelector.data("highlights")[a]={regions:m,colour:h,divClass:l};e.isPageInViewport(a)&&c(a,null,null);return!0};return!0},destroy:function(b,e){b.parentSelector.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"}}())})(jQuery);
