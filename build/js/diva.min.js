<<<<<<< HEAD
Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},function(e){var t=1;e.generateId=function(e){var i;do i=t++ +(e?"-"+e:"");while(document.getElementById(i));return i}}(jQuery),function(e){e.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return i==n&&(n=t.clientWidth),document.body.removeChild(t),i-n}}(jQuery),function(e){e.getHashParam=function(e){var t=window.location.hash;if(""!==t){var i=t.indexOf(t.indexOf("&"+e+"=")>0?"&"+e+"=":"#"+e+"=");if(i>=0){i+=e.length+2;var n=t.indexOf("&",i);return n>i?t.substring(i,n):0>n?t.substring(i):""}return!1}return!1}}(jQuery),function(e){e.updateHashParam=function(t,i){var n=e.getHashParam(t),a=window.location.hash;if(n!==i)if("string"==typeof n){var o=a.indexOf(a.indexOf("&"+t+"=")>0?"&"+t+"=":"#"+t+"="),r=o+t.length+2+n.length,l=0===o?"#":"&";window.location.replace(a.substring(0,o)+l+t+"="+i+a.substring(r))}else window.location.replace(0===a.length?"#"+t+"="+i:a+"&"+t+"="+i)}}(jQuery),function(e){e.fn.dragscrollable=function(t){var i=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),n={mouseDownHandler:function(t){return 1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this?!1:(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",n.mouseUpHandler,t.data),e.event.add(document,"mousemove",n.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t={left:e.clientX-e.data.lastCoord.left,top:e.clientY-e.data.lastCoord.top};return e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t.left),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-t.top),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault?(e.preventDefault(),!1):void 0},mouseUpHandler:function(t){return e.event.remove(document,"mousemove",n.mouseMoveHandler),e.event.remove(document,"mouseup",n.mouseUpHandler),t.data.preventDefault?(t.preventDefault(),!1):void 0}};this.each(function(){var t={scrollable:e(this),acceptPropagatedEvent:i.acceptPropagatedEvent,preventDefault:i.preventDefault};e(this).find(i.dragSelector).bind("mousedown",t,n.mouseDownHandler)})}}(jQuery),function(e){"use strict";var t={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i="kinetic-settings",n="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var a=function(){return!1},o=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},r=function(e,t){var i=e;return e>0?e>t&&(i=t):0-t>e&&(i=0-t),i},l=function(e,t){this.removeClass(e.movingClass.up).removeClass(e.movingClass.down).removeClass(e.movingClass.left).removeClass(e.movingClass.right).removeClass(e.deceleratingClass.up).removeClass(e.deceleratingClass.down).removeClass(e.deceleratingClass.left).removeClass(e.deceleratingClass.right),e.velocity>0&&this.addClass(t.right),e.velocity<0&&this.addClass(t.left),e.velocityY>0&&this.addClass(t.down),e.velocityY<0&&this.addClass(t.up)},s=function(e,t){t.velocity=0,t.velocityY=0,t.decelerate=!0,"function"==typeof t.stopped&&t.stopped.call(e,t)},c=function(e,t){var i=e[0];t.x&&i.scrollWidth>0?(i.scrollLeft=t.scrollLeft=i.scrollLeft+t.velocity,Math.abs(t.velocity)>0&&(t.velocity=t.decelerate?o(t.velocity,t.slowdown):t.velocity)):t.velocity=0,t.y&&i.scrollHeight>0?(i.scrollTop=t.scrollTop=i.scrollTop+t.velocityY,Math.abs(t.velocityY)>0&&(t.velocityY=t.decelerate?o(t.velocityY,t.slowdown):t.velocityY)):t.velocityY=0,l.call(e,t,t.deceleratingClass),"function"==typeof t.moved&&t.moved.call(e,t),Math.abs(t.velocity)>0||Math.abs(t.velocityY)>0?window.requestAnimationFrame(function(){c(e,t)}):s(e,t)},d=function(t,n){var a=e.kinetic.callMethods[t],o=Array.prototype.slice.call(arguments);a&&this.each(function(){var t=o.slice(1),n=e(this).data(i);t.unshift(n),a.apply(this,t)})},u=function(t,i){t[0];e.support.touch?t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove):t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",a).bind("dragstart",i.events.dragStart)},g=function(t,i){t[0];e.support.touch?t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove):t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove).unbind("scroll",i.events.scroll),t.unbind("click",i.events.inputClick).unbind("selectstart",a),t.unbind("dragstart",i.events.dragStart)},v=function(a){this.addClass(n).each(function(){var n=this,o=e(this);if(!o.data(i)){var s,d,g,v,h=e.extend({},t,a),p=!1,f=!1,m=!1,b=1e3/h.throttleFPS;h.velocity=0,h.velocityY=0;var w=function(){s=!1,d=!1,m=!1};e(document).mouseup(w).click(w);var I=function(){h.velocity=r(p-s,h.maxvelocity),h.velocityY=r(f-d,h.maxvelocity)},y=function(t){return e.isFunction(h.filterTarget)?h.filterTarget.call(n,t)!==!1:!0},x=function(e,t){m=!0,h.velocity=p=0,h.velocityY=f=0,s=e,d=t},P=function(){s&&p&&h.decelerate===!1&&(h.decelerate=!0,I(),s=p=m=!1,c(o,h))},D=function(t,i){(!g||new Date>new Date(g.getTime()+b))&&(g=new Date,m&&(s||d)&&(v&&(e(v).blur(),v=null,o.focus()),h.decelerate=!1,h.velocity=h.velocityY=0,o[0].scrollLeft=h.scrollLeft=h.x?o[0].scrollLeft-(t-s):o[0].scrollLeft,o[0].scrollTop=h.scrollTop=h.y?o[0].scrollTop-(i-d):o[0].scrollTop,p=s,f=d,s=t,d=i,I(),l.call(o,h,h.movingClass),"function"==typeof h.moved&&h.moved.call(o,h)))};h.events={touchStart:function(e){var t;y(e.target)&&(t=e.originalEvent.touches[0],x(t.clientX,t.clientY),e.stopPropagation())},touchMove:function(e){var t;m&&(t=e.originalEvent.touches[0],D(t.clientX,t.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){y(e.target)&&(x(e.clientX,e.clientY),v=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){P(),v=null,e.preventDefault&&e.preventDefault()},inputMove:function(e){m&&(D(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(e){"function"==typeof h.moved&&h.moved.call(o,h),e.preventDefault&&e.preventDefault()},inputClick:function(e){return Math.abs(h.velocity)>0?(e.preventDefault(),!1):void 0},dragStart:function(e){return v?!1:void 0}},u(o,h),o.data(i,h).css("cursor",h.cursor),h.triggerHardware&&o.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};e.kinetic={settingsKey:i,callMethods:{start:function(t,i){var n=e(this);t=e.extend(t,i),t&&(t.decelerate=!1,c(n,t))},end:function(t,i){e(this);t&&(t.decelerate=!0)},stop:function(t,i){var n=e(this);s(n,t)},detach:function(t,i){var a=e(this);g(a,t),a.removeClass(n).css("cursor","")},attach:function(t,i){var a=e(this);u(a,t),a.addClass(n).css("cursor","move")}}},e.fn.kinetic=function(e){return"string"==typeof e?d.apply(this,arguments):v.call(this,e),this}}(window.jQuery||window.Zepto);var diva=function(){var e={},t={Events:{publish:function(t,i,n){if(e[t])for(var a=e[t],o=a.length;o--;)a[o].apply(n||this,i||[])},subscribe:function(t,i){return e[t]||(e[t]=[]),e[t].push(i),[t,i]},unsubscribe:function(t,i){var n=t[0];if(e[n])for(var a=e[n].length;a--;)if(e[n][a]===t[1])return e[n].splice(a,1),i&&delete e[n],!0;return!1},unsubscribeAll:function(){e={}}}};return t}(),activeDivaController=function(){var e;$(document).on("click",function(e){t($(e.target))});var t=function(t){var i,n,a=t.find(".diva-outer"),o=t.closest(".diva-outer"),r=document.getElementsByClassName("diva-outer"),l=r.length;if(a.length>0)i=a;else{if(!(o.length>0)){for(n=0;l>n;n++)$(r[n].parentElement).data("diva").deactivate();return}i=o}for(i.parent().data("diva").activate(),e=i.parent(),r=document.getElementsByClassName("diva-outer"),n=0;l>n;n++)r[n].getAttribute("id")!=i.attr("id")&&$(r[n].parentElement).data("diva").deactivate()};this.getActive=function(){return e}},activeDiva=new activeDivaController;window.divaPlugins=[],function(e){var t=function(t,i){var n={adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:i.parentObject,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},a=e.extend({},n,i),o={allTilesLoaded:[],averageHeights:[],averageWidths:[],currentPageIndex:0,divaIsFullWindow:!1,doubleClickZoom:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerObject:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerObject:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0};e.extend(a,o);var r=this,l=function(e,t){return a.pages[e].d[a.zoomLevel][t]},s=function(e){var t,i=a.numPages;for(t=0;i>t;t++)if(a.pages[t].f===e)return t;return-1},c=function(e,t){var i=a.outerObject.scrollLeft()-a.viewportMargin,n=i+a.panelWidth+2*a.viewportMargin,o=e>=i&&n>=e,r=i>=e&&t>=n,l=t>=i&&n>=t;return o||r||l},d=function(e,t){var i=a.outerObject.scrollTop()-a.viewportMargin,n=i+a.panelHeight+2*a.viewportMargin,o=e>=i&&n>=e,r=i>=e&&t>=n,l=t>=i&&n>=t;return o||r||l},u=function(e,t,i){var n,o;a.verticallyOriented?(n=a.pageTopOffsets[e]+t*a.tileHeight+a.verticalPadding,o=a.pageLeftOffsets[e]+i*a.tileWidth):(n=a.pageTopOffsets[e]+t*a.tileHeight,o=a.pageLeftOffsets[e]+i*a.tileWidth+a.horizontalPadding);var r=n+a.tileHeight,l=o+a.tileWidth;return d(n,r)&&c(o,l)},g=function(e,t){return!!document.getElementById(a.ID+"tile-"+e+"-"+t)},v=function(e){return e>=0&&e<a.numPages},h=function(e){var t=a.pageTopOffsets[e],i=t+l(e,"h")+a.verticalPadding,n=a.pageLeftOffsets[e],o=n+l(e,"w")+a.horizontalPadding;return d(t,i)&&c(n,o)},p=function(e){return!!document.getElementById(a.ID+"page-"+e)},f=function(e){if(!p(e)||!a.allTilesLoaded[e]){var t=a.pages[e].f,i=l(e,"w"),n=l(e,"h"),o=a.pageTopOffsets[e]+a.verticalPadding,s=a.pageLeftOffsets[e]+a.horizontalPadding,c=a.selector+"page-"+e;if(!p(e)){var d=document.getElementById(a.ID+"inner"),v=document.createElement("div");v.id=a.ID+"page-"+e,v.classList.add("diva-document-page"),v.setAttribute("data-index",e),v.setAttribute("data-filename",t),a.enableImageTitles&&(v.title="Page "+(e+1)),v.innerHTML=a.pageTools,v.style.width=i+"px",v.style.height=n+"px",a.verticallyOriented?(v.style.top=o+"px",v.classList.add("diva-page-vertical")):(v.style.left=s+"px",v.classList.add("diva-page-horizontal")),d.appendChild(v),diva.Events.publish("PageWillLoad",[e,t,c],r)}var f=function(e){var o=document.getElementById(a.ID+"page-"+e);if(null!==o&&h(e)){var s,d,v,p,f,m,b,w,I,y,x,P,D,L=a.imageDir+"/",O=Math.ceil(l(e,"h")/a.tileWidth),C=Math.ceil(l(e,"w")/a.tileHeight),T=a.pages[e].m,E=a.iipServerURL+"?FIF="+L+t+"&JTL=",S=!0,z=0,j=n-(O-1)*a.tileHeight,M=i-(C-1)*a.tileWidth;b=a.zoomLevel+T-a.realMaxZoom;var k=a.isIIIF?a.pages[e].url:E+b+",";if(a.isIIIF){D=Math.pow(2,T-b),I=a.tileHeight*D,y=a.tileWidth*D;var A=a.pages[e].api,H=A>=2?"default":"native",F="/0/"+H+".jpg";a.pages[e].hasOwnProperty("xoffset")?(x=a.pages[e].xoffset,P=a.pages[e].yoffset):(x=0,P=0)}else I=a.tileHeight,y=a.tileWidth;for(s=0;O>s;){for(d=0,v=s===O-1?j:a.tileHeight;C>d;){if(f=s*a.tileHeight,m=d*a.tileWidth,p=d===C-1?M:a.tileWidth,w=a.isIIIF?k+(d*y+x)+","+(s*I+P)+","+p*D+","+v*D+"/"+p+","+F:k+z,!g(e,z))if(u(e,s,d)){var R=document.createElement("div");R.id=a.ID+"tile-"+e+"-"+z,R.classList.add("diva-document-tile"),R.style.display="inline",R.style.position="absolute",R.style.top=f+"px",R.style.left=m+"px",R.style.backgroundImage="url('"+w+"')",R.style.height=v+"px",R.style.width=p+"px",o.appendChild(R)}else S=!1;z++,d++}s++}a.allTilesLoaded[e]=S,diva.Events.publish("PageDidLoad",[e,t,c],r)}};a.pageTimeouts.push(setTimeout(f,a.pageLoadTimeout,e))}},m=function(e){var t=document.getElementById(a.ID+"page-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},b=function(e){var t=a.pageTopOffsets[e]+l(e,"h")+a.verticalPadding,i=document.getElementById(a.ID+"outer").scrollTop;return i>t},w=function(e){var t=a.pageTopOffsets[e],i=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return t>i},I=function(e){var t=a.pageLeftOffsets[e]+l(e,"w")+a.horizontalPadding,i=document.getElementById(a.ID+"outer").scrollLeft;return i>t},y=function(e){var t=a.pageLeftOffsets[e],i=document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth;return t>i},x=function(e){return a.verticallyOriented?b(e):I(e)},P=function(e){return a.verticallyOriented?w(e):y(e)},D=function(e,t){t>0?v(e)&&(h(e)?(f(e),a.lastPageLoaded=e,D(a.lastPageLoaded+1,t)):x(e)&&D(e+1,t)):v(e)&&(h(e)?(f(e),a.firstPageLoaded=e,D(a.firstPageLoaded-1,t)):P(e)&&D(e-1,t))},L=function(e,t){t>0?v(e)&&x(e)&&(m(e),a.firstPageLoaded=e+1,L(a.firstPageLoaded,t)):v(e)&&P(e)&&(m(e),a.lastPageLoaded=e-1,L(a.lastPageLoaded,t))},O=function(e){var t;if(0>e)D(a.firstPageLoaded,e),R(-1),L(a.lastPageLoaded,e);else if(e>0)D(a.lastPageLoaded,e),R(1),L(a.firstPageLoaded,e);else{var i=a.lastPageLoaded;for(t=Math.max(a.firstPageLoaded,0);i>=t;t++)h(t)&&f(t)}var n=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop:document.getElementById(a.ID+"outer").scrollLeft;diva.Events.publish("ViewerDidScroll",[n],r),e>0?diva.Events.publish("ViewerDidScrollDown",[n],r):0>e&&diva.Events.publish("ViewerDidScrollUp",[n],r)},C=function(e){return e>=0&&e<a.numRows},T=function(e){var t=a.rowHeight*e,i=t+a.rowHeight+a.fixedPadding;return d(t,i)},E=function(e){return!!document.getElementById(a.ID+"row-"+e)},S=function(e){if(!E(e)){var t=a.rowHeight*e+a.fixedPadding,i=document.getElementById(a.ID+"inner"),n=document.createElement("div");n.id=a.ID+"row-"+e,n.classList.add("diva-row"),n.style.height=a.rowHeight+"px",n.style.top=t+"px",i.appendChild(n);var o,s,c,d,u,g,h,p,f,m,b,w,I=a.imageDir+"/",y=a.pagesPerRow;for(o=0;y>o&&(s=e*a.pagesPerRow+o,v(s));o++){c=a.pages[s].f,d=l(s,"w"),u=l(s,"h"),g=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*d/u:a.gridPageWidth,h=a.fixedHeightGrid?a.rowHeight-a.fixedPadding:g/d*u,p=parseInt(o*(a.fixedPadding+a.gridPageWidth)+a.fixedPadding,10),m=a.pages[s].api,b=m>=2?"default":"native",w=",/0/"+b+".jpg",g=parseInt(g,10),h=parseInt(h,10),p+=a.fixedHeightGrid?(a.gridPageWidth-g)/2:0,f=encodeURI(a.isIIIF?a.pages[s].url+"full/"+g+w:a.iipServerURL+"?FIF="+I+c+"&HEI="+(h+2)+"&CVT=JPEG"),a.pageTopOffsets[s]=t,a.pageLeftOffsets[s]=p;var x=document.createElement("div");x.id=a.ID+"page-"+s;var P=a.selector+"page-"+s;x.classList.add("diva-page"),x.style.width=g+"px",x.style.height=h+"px",x.style.left=p+"px",x.setAttribute("data-index",s),x.setAttribute("data-filename",c),a.enableImageTitles&&(x.title="Page "+(s+1)),n.appendChild(x),diva.Events.publish("PageWillLoad",[s,c,P],r),F(e,s,f,g,h)}}},z=function(e){var t=document.getElementById(a.ID+"row-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},j=function(e){var t=a.rowHeight*(e+1),i=document.getElementById(a.ID+"outer").scrollTop;return i>t},M=function(e){var t=a.rowHeight*e,i=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return t>i},k=function(e,t){t>0?C(e)&&(T(e)?(S(e),a.lastRowLoaded=e,k(a.lastRowLoaded+1,t)):j(e)&&k(e+1,t)):C(e)&&(T(e)?(S(e),a.firstRowLoaded=e,k(a.firstRowLoaded-1,t)):M(e)&&k(e-1,t))},A=function(e,t){t>0?C(e)&&j(e)&&(z(e),a.firstRowLoaded++,A(a.firstRowLoaded,t)):C(e)&&M(e)&&(z(e),a.lastRowLoaded--,A(a.lastRowLoaded,t))},H=function(e){0>e?(k(a.firstRowLoaded,-1),Z(-1),A(a.lastRowLoaded,-1)):e>0&&(k(a.lastRowLoaded,1),Z(1),A(a.firstRowLoaded,1));var t=document.getElementById(a.ID+"outer").scrollTop;diva.Events.publish("ViewerDidScroll",[t],r),e>0?diva.Events.publish("ViewerDidScrollDown",[t],r):0>e&&diva.Events.publish("ViewerDidScrollUp",[t],r)},F=function(e,t,i,n,o){var r=function(e,t,i,n,o){if(p(t)){var r=document.createElement("img");r.src=i,r.style.width=n+"px",r.style.height=o+"px",document.getElementById(a.ID+"page-"+t).appendChild(r)}};a.pageTimeouts.push(window.setTimeout(r,a.rowLoadTimeout,e,t,i,n,o))},R=function(e){var t=a.currentPageIndex,i=t+e;if(!v(i))return!1;{var n=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop+a.panelHeight/2:document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth/2,o=!1;a.selector+"page-"+i}if(0>e?a.verticallyOriented?i>=0&&a.pageTopOffsets[i]+l(i,"h")+a.verticalPadding>=n&&(o=!0):i>=0&&a.pageLeftOffsets[i]+l(i,"w")+a.horizontalPadding>=n&&(o=!0):e>0&&(a.verticallyOriented?a.pageTopOffsets[t]+l(t,"h")+a.verticalPadding<n&&(o=!0):a.pageLeftOffsets[t]+l(t,"w")+a.horizontalPadding<n&&(o=!0)),o){if(a.currentPageIndex=i,0!==e&&!R(e)){var s=a.pages[i].f;diva.Events.publish("VisiblePageDidChange",[i,s],r)}return!0}return!1},Z=function(e){var t=Math.floor(a.currentPageIndex/a.pagesPerRow),i=t+parseInt(e,10),n=document.getElementById(a.ID+"outer").scrollTop,o=n+a.panelHeight/2,l=!1;if(0>e?i>=0&&(a.rowHeight*t>=o||a.rowHeight*i>=n)&&(l=!0):e>0&&a.rowHeight*(t+1)<n&&C(i)&&(l=!0),l){if(a.currentPageIndex=i*a.pagesPerRow,0!==e&&!Z(e)){var s=a.currentPageIndex,c=a.pages[s].f;diva.Events.publish("VisiblePageDidChange",[s,c],r)}return!0}return!1},W=function(e){var t=le(e,"top"),i=se(e,"center");B(e,t,i)},B=function(e,t,i){i="undefined"!=typeof i?i:0,t="undefined"!=typeof t?t:0;var n=a.pageTopOffsets[e]+t,o=n-parseInt(a.panelHeight/2,10),l=a.pageLeftOffsets[e]+i,s=l-parseInt(a.panelWidth/2,10);if(a.outerObject.scrollTop(o),a.outerObject.scrollLeft(s),e!==a.currentPageIndex){a.currentPageIndex=e;var c=a.pages[e].f;diva.Events.publish("VisiblePageDidChange",[e,c],r)}diva.Events.publish("ViewerDidJump",[e],r)},G=function(e){var t=Math.floor(e/a.pagesPerRow),i=t*a.rowHeight;a.outerObject.scrollTop(i),a.currentPageIndex=e;var n=a.pages[e].f;diva.Events.publish("VisiblePageDidChange",[e,n],r)},N=function(){G(a.goDirectlyTo)},Y=function(e){return e>=a.minZoomLevel&&e<=a.maxZoomLevel?e:a.minZoomLevel},V=function(e){return e>=a.minPagesPerRow&&e<=a.maxPagesPerRow?e:a.maxPagesPerRow},_=function(){for(a.allTilesLoaded=[],a.outerObject.scrollTop(0),a.innerObject.empty(),a.firstPageLoaded=0,a.firstRowLoaded=-1,a.previousTopScroll=0,a.previousLeftScroll=0,clearTimeout(a.resizeTimer);a.pageTimeouts.length;)clearTimeout(a.pageTimeouts.pop())},X=function(){a.inGrid?U():q()},q=function(){_(),a.zoomLevel=Y(a.zoomLevel);var e=a.zoomLevel;a.totalHeight=a.totalHeights[e]+a.verticalPadding*(a.numPages+1),a.totalWidth=a.totalWidths[e]+a.horizontalPadding*(a.numPages+1);var t=a.maxWidths[e]+2*a.horizontalPadding,i=a.maxHeights[e]+2*a.verticalPadding,n=Math.max(t,a.panelWidth),o=Math.max(i,a.panelHeight),s=document.getElementById(a.ID+"inner");a.verticallyOriented?(s.style.height=Math.round(a.totalHeight)+"px",s.style.width=Math.round(n)+"px"):(s.style.height=Math.round(o)+"px",s.style.width=Math.round(a.totalWidth)+"px");var c,d=0,u=0;for(a.pageTopOffsets=[],a.pageLeftOffsets=[],c=0;c<a.numPages;c++)a.pageTopOffsets[c]=parseInt(a.verticallyOriented?d:(o-l(c,"h"))/2,10),a.pageLeftOffsets[c]=parseInt(a.verticallyOriented?(n-l(c,"w"))/2:u,10),d=a.pageTopOffsets[c]+l(c,"h")+a.verticalPadding,u=a.pageLeftOffsets[c]+l(c,"w")+a.horizontalPadding;v(a.goDirectlyTo)||(a.goDirectlyTo=0),B(a.goDirectlyTo,a.verticalOffset,a.horizontalOffset);var g=!1;for(c=0;c<a.numPages;c++)if(h(c))f(c),a.lastPageLoaded=c,g=!0;else if(g)break;a.oldZoomLevel>=0?(a.oldZoomLevel<a.zoomLevel?diva.Events.publish("ViewerDidZoomIn",[e],r):diva.Events.publish("ViewerDidZoomOut",[e],r),diva.Events.publish("ViewerDidZoom",[e],r)):a.oldZoomLevel=a.zoomLevel,a.scaleWait&&(a.scaleWait=!1);var p=a.pages[a.currentPageIndex].f;diva.Events.publish("DocumentDidLoad",[a.currentPageIndex,p],r)},U=function(){var e=a.currentPageIndex;a.verticalOffset=a.verticallyOriented?a.panelHeight/2:l(e,"h")/2,a.horizontalOffset=a.verticallyOriented?l(e,"w")/2:a.panelWidth/2,_(),a.pagesPerRow=V(a.pagesPerRow);var t=a.fixedPadding*(a.pagesPerRow+1),i=(a.panelWidth-t)/a.pagesPerRow;a.gridPageWidth=i,a.rowHeight=a.fixedHeightGrid?a.fixedPadding+a.minRatio*i:a.fixedPadding+a.maxRatio*i,a.numRows=Math.ceil(a.numPages/a.pagesPerRow),a.totalHeight=a.numRows*a.rowHeight+a.fixedPadding;var n=document.getElementById(a.ID+"inner");n.style.height=Math.round(a.totalHeight)+"px",n.style.width=Math.round(a.panelWidth)+"px",N();var o,r;a.pageTopOffsets=[],a.pageLeftOffsets=[];var s=a.numPages;for(o=0;s>o;o+=a.pagesPerRow)r=Math.floor(o/a.pagesPerRow),T(r)&&(a.firstRowLoaded=a.firstRowLoaded<0?r:a.firstRowLoaded,S(r),a.lastRowLoaded=r)},Q=function(e){27==e.keyCode&&$()},K=function(t){if(a.outerObject.toggleClass("diva-fullscreen"),e("body").toggleClass("diva-hide-scrollbar"),a.parentObject.toggleClass("diva-full-width"),a.mobileWebkit){var i=parseInt(a.outerObject.css("margin-left"),10)-parseInt(e("body").css("margin-left"),10);a.outerObject.css("margin-left",i)}var n=a.panelHeight,o=a.panelWidth;if(he(),a.oldZoomLevel>=0&&!a.inGrid){var l=a.panelHeight,s=a.panelWidth;a.inFullscreen?(a.verticalOffset-=(l-n)/2,a.horizontalOffset-=(s-o)/2):(a.verticalOffset+=(n-l)/2,a.horizontalOffset+=(o-s)/2)}t?(a.inGrid=!a.inGrid,J()):X(),a.inFullscreen?e(document).on("keyup",Q):e(document).off("keyup",Q),diva.Events.publish("ModeDidSwitch",[a.inFullscreen],r)},J=function(){X(),diva.Events.publish("ViewDidSwitch",[a.inGrid],r)},$=function(){a.goDirectlyTo=a.currentPageIndex,a.inFullscreen=!a.inFullscreen,K(!1)},ee=function(){a.goDirectlyTo=a.currentPageIndex,a.inGrid=!a.inGrid,J()},te=function(){return a.verticallyOriented=!a.verticallyOriented,a.verticalOffset=le(),a.horizontalOffset=se(),a.goDirectlyTo=a.currentPageIndex,q(),a.verticallyOriented},ie=function(t){var i=e(this).offset();a.doubleClickZoom=!0,a.horizontalOffset=t.pageX-i.left,a.verticalOffset=t.pageY-i.top,a.goDirectlyTo=parseInt(e(this).attr("data-index"),10);var n=t.ctrlKey?a.zoomLevel-1:a.zoomLevel+1;oe(n)},ne=function(t){var i=parseInt(e(this).attr("data-index"),10);a.goDirectlyTo=i;var n=e(this).offset(),o=l(i,"w")/e(this).width();a.horizontalOffset=(t.pageX-n.left)*o,a.verticalOffset=(t.pageY-n.top)*o,a.inGrid=!1,J()},ae=function(t,i){var n=a.zoomLevel;if(t>100&&n<a.maxZoomLevel)n++;else{if(!(-100>t&&n>a.minZoomLevel))return;n--}a.scaleWait=!0;var o=e(this).offset();a.horizontalOffset=i.pageX-o.left,a.verticalOffset=i.pageY-o.top,a.goDirectlyTo=parseInt(e(this).attr("data-index"),10),oe(n)},oe=function(e){var t=Y(e);if(t!==e)return!1;var i=Math.pow(2,t-a.zoomLevel);return a.doubleClickZoom?(a.verticalOffset*=i,a.horizontalOffset*=i,a.doubleClickZoom=!1):(a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=i*ce(),a.horizontalOffset=i*de()),a.oldZoomLevel=a.zoomLevel,a.zoomLevel=t,diva.Events.publish("ZoomLevelDidChange",[t],r),q(),!0},re=function(e){var t=V(e);return t!==e?!1:(a.pagesPerRow=t,diva.Events.publish("GridRowNumberDidChange",[t],r),a.goDirectlyTo=a.currentPageIndex,U(),!0)},le=function(e,t){return e="undefined"==typeof e?a.currentPageIndex:e,"center"===t||"centre"===t?parseInt(l(e,"h")/2,10):"bottom"===t?parseInt(l(e,"h")-a.panelHeight/2,10):parseInt(a.panelHeight/2,10)},se=function(e,t){return e="undefined"==typeof e?a.currentPageIndex:e,"left"===t?parseInt(a.panelWidth/2,10):"right"===t?parseInt(l(e,"w")-a.panelWidth/2,10):parseInt(l(e,"w")/2,10)},ce=function(){var e=document.getElementById(a.ID+"outer").scrollTop,t=a.panelHeight;return e-a.pageTopOffsets[a.currentPageIndex]+parseInt(t/2,10)},de=function(){var e=document.getElementById(a.ID+"outer").scrollLeft,t=a.panelWidth;return e-a.pageLeftOffsets[a.currentPageIndex]+parseInt(t/2,10)},ue=function(){var e={f:a.inFullscreen,g:a.inGrid,z:a.zoomLevel,n:a.pagesPerRow,i:a.enableFilename?a.pages[a.currentPageIndex].f:!1,p:a.enableFilename?!1:a.currentPageIndex+1,y:a.inGrid?!1:ce(),x:a.inGrid?!1:de()};return e},ge=function(){var e,t=ue(),i=[];for(e in t)t[e]!==!1&&i.push(e+a.hashParamSuffix+"="+t[e]);return i.join("&")},ve=function(){return location.protocol+"//"+location.host+location.pathname+"#"+ge()},he=function(){var e=document.getElementById(a.ID+"outer");return a.panelHeight=e.clientHeight-(e.scrollWidth>e.clientWidth?a.scrollbarWidth:0),a.panelWidth=e.clientWidth-(e.scrollHeight>e.clientHeight?a.scrollbarWidth:0),a.horizontalOffset=de(),a.verticalOffset=ce(),B(a.currentPageIndex,a.verticalOffset,a.horizontalOffset),!0},pe=function(){a.mobileWebkit||(a.outerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),a.innerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0})),a.outerObject.on("dblclick",".diva-document-page",function(e){ie.call(this,e)}),a.outerObject.on("contextmenu",".diva-document-page",function(e){return e.ctrlKey?(clearTimeout(a.singleClickTimeout),a.singleClick?(ie.call(this,e),a.singleClick=!1):(a.singleClick=!0,a.singleClickTimeout=setTimeout(function(){a.singleClick=!1},500)),!1):void 0}),a.outerObject.on("dblclick",".diva-row",function(t){ne.call(e(t.target).parent(),t)})},fe=function(){a.blockMobileMove&&e("body").bind("touchmove",function(e){var t=e.originalEvent;return t.preventDefault(),!1}),a.outerObject.kinetic({triggerHardware:!0});var t=[],i=[],n=0;a.outerObject.on("touchstart",".diva-document-page",function(e){2===e.originalEvent.touches.length&&(t=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY],n=me(t[2],t[0],t[3],t[1]))}),a.outerObject.on("touchmove",".diva-document-page",function(e){if(2===e.originalEvent.touches.length){i=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY];var t=me(i[2],i[0],i[3],i[1]),o=t-n;a.scaleWait||(a.goDirectlyTo=a.currentPageIndex,a.inGrid?(a.inGrid=!1,J()):ae.call(this,o,e))}});var o={},r=0,l=function(t){if(a.singleTap){var i={pageX:t.originalEvent.changedTouches[0].clientX,pageY:t.originalEvent.changedTouches[0].clientY};r=me(o.pageX,i.pageX,o.pageY,i.pageY),50>r&&a.zoomLevel<a.maxZoomLevel&&(a.inGrid?ne.call(e(t.target).parent(),i):ie.call(this,i)),a.singleTap=!1,o={}}else a.singleTap=!0,o.pageX=t.originalEvent.changedTouches[0].clientX,o.pageY=t.originalEvent.changedTouches[0].clientY,a.singleTapTimeout=setTimeout(function(){a.singleTap=!1,o={}},250)};a.outerObject.on("touchend",".diva-document-page",l),a.outerObject.on("touchend",".diva-page",l);var s="onorientationchange"in window?"orientationchange":"resize";e(window).bind(s,function(e){var t=a.panelWidth,i=a.panelHeight;he(),a.horizontalOffset-=(a.panelWidth-t)/2,a.verticalOffset-=(a.panelHeight-i)/2,a.goDirectlyTo=a.currentPageIndex,X()})},me=function(e,t,i,n){return Math.sqrt((e-t)*(e-t)+(i-n)*(i-n))},be=function(){a.innerObject.mouseover(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),a.innerObject.mouseout(function(){e(this).removeClass("diva-grab")}),a.innerObject.mousedown(function(){e(this).removeClass("diva-grab").addClass("diva-grabbing")}),a.innerObject.mouseup(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),pe();var t=function(){var e,t=document.getElementById(a.ID+"outer").scrollTop,i=document.getElementById(a.ID+"outer").scrollLeft;e=a.verticallyOriented||a.inGrid?t-a.previousTopScroll:i-a.previousLeftScroll,a.inGrid?H(e):O(e),a.previousTopScroll=t,a.previousLeftScroll=i,a.horizontalOffset=de(),a.verticalOffset=ce()};a.outerObject.scroll(t);var i=38,n=40,o=37,r=39,l=32,s=33,c=34,d=36,u=35;e(document).keydown(function(e){if(!a.isActiveDiva)return!0;if(a.enableSpaceScroll&&!e.shiftKey&&e.keyCode===l||a.enableKeyScroll&&e.keyCode===c)return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.panelHeight),!1;if(a.enableSpaceScroll||e.keyCode!==l||e.preventDefault(),a.enableKeyScroll)switch(e.keyCode){case s:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.panelHeight),!1;case i:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.arrowScrollAmount),!1;case n:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.arrowScrollAmount),!1;case o:return a.outerObject.scrollLeft(document.getElementById(a.ID+"outer").scrollLeft-a.arrowScrollAmount),!1;case r:return a.outerObject.scrollLeft(document.getElementById(a.ID+"outer").scrollLeft+a.arrowScrollAmount),!1;case d:return a.outerObject.scrollTop(0),!1;case u:return a.outerObject.scrollTop(a.totalHeight),!1;default:return!0}return!0}),a.mobileWebkit?fe():e(window).resize(function(){he(),clearTimeout(a.resizeTimer),a.resizeTimer=setTimeout(function(){a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=ce(),a.horizontalOffset=de(),X()},200)}),diva.Events.subscribe("PanelSizeDidChange",he)},we=function(){var t=a.enableGridIcon?'<div class="diva-grid-icon button'+(a.inGrid?" diva-in-grid":"")+'" id="'+a.ID+'grid-icon" title="Toggle grid view"></div>':"",i=a.enableLinkIcon?'<div class="diva-link-icon button" id="'+a.ID+'link-icon" style="'+(a.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"",n="slider"===a.enableZoomControls?'<input type="range" id="'+a.ID+'zoom-slider" class="zoom-slider" value="'+a.zoomLevel+'" min="'+a.minZoomLevel+'" max="'+a.maxZoomLevel+'">':"",o="buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-out-button" class="diva-zoom-out-button button" title="Zoom Out"></div><div id="'+a.ID+'zoom-in-button" class="diva-zoom-in-button button" title="Zoom In"></div>':"",r="slider"===a.enableGridControls?'<input type="range" id="'+a.ID+'grid-slider" class="grid-slider" value="'+a.pagesPerRow+'" min="'+a.minPagesPerRow+'" max="'+a.maxPagesPerRow+'">':"",l="buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-out-button" class="diva-grid-out-button button" title="Zoom Out"></div><div id="'+a.ID+'grid-in-button" class="diva-grid-in-button button" title="Zoom In"></div>':"",s=a.enableGotoPage?'<form id="'+a.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+a.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"",c="slider"===a.enableZoomControls?'<div id="'+a.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"",d="buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"",u="slider"===a.enableGridControls?'<div id="'+a.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"",g="buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"",h='<div class="diva-page-label">Page <span id="'+a.ID+'current-page">1</span> of <span id="'+a.ID+'num-pages">'+a.numPages+"</span></div>",p=a.enableFullscreen?'<div id="'+a.ID+'fullscreen" class="diva-fullscreen-icon button" title="Toggle fullscreen mode"></div>':"",f='<div id="'+a.ID+'tools-left" class="diva-tools-left">'+n+o+r+l+c+d+u+g+'</div><div id="'+a.ID+'tools-right" class="diva-tools-right">'+p+i+t+'<div id="'+a.ID+'page-nav" class="diva-page-nav">'+s+h+"</div></div>";

a.toolbarParentObject.prepend('<div id="'+a.ID+'tools" class="diva-tools">'+f+"</div>"),e(a.selector+"zoom-slider").on("input",function(e){var t=parseInt(this.value,10);oe(t)}),e(a.selector+"zoom-slider").on("change",function(e){var t=parseInt(this.value,10);t!==a.zoomLevel&&oe(t)});var m=function(e){oe(a.zoomLevel+e)};e(a.selector+"zoom-out-button").click(function(){m(-1)}),e(a.selector+"zoom-in-button").click(function(){m(1)}),e(a.selector+"grid-slider").on("input",function(e){var t=parseInt(this.value,10);re(t)}),e(a.selector+"grid-slider").on("change",function(e){var t=parseInt(this.value,10);t!==a.zoomLevel&&re(t)}),e(a.selector+"fullscreen").click(function(){$()}),e(a.selector+"grid-out-button").click(function(){re(a.pagesPerRow-1)}),e(a.selector+"grid-in-button").click(function(){re(a.pagesPerRow+1)}),e(a.selector+"grid-icon").click(function(){ee()}),e(a.selector+"goto-page").submit(function(){var t=parseInt(e(a.selector+"goto-page-input").val(),10),i=t-1;return v(i)?a.inGrid?G(i):W(i):alert("Invalid page number"),!1});var b=e(a.selector+"link-icon");b.click(function(){if(e("body").prepend('<div id="'+a.ID+'link-popup" class="diva-popup diva-link-popup"><input id="'+a.ID+'link-popup-input" class="diva-input" type="text" value="'+ve()+'"/></div>'),a.inFullscreen)e(a.selector+"link-popup").addClass("in-fullscreen");else{var t=b.offset().left-222+b.outerWidth(),i=b.offset().top+b.outerHeight()-1;e(a.selector+"link-popup").removeClass("in-fullscreen").css({top:i+"px",left:t+"px"})}return e("body").mouseup(function(t){var i=t.target.id;i!==a.ID+"link-popup"&&i!==a.ID+"link-popup-input"&&e(a.selector+"link-popup").remove()}),a.outerObject.scroll(function(){e(a.selector+"link-popup").remove()}),e(a.selector+"link-popup input").click(function(){e(this).focus().select()}),!1});var w=a.inGrid?"grid":"zoom";e(a.selector+w+"-slider").show(),e(a.selector+w+"-out-button").show(),e(a.selector+w+"-in-button").show(),e(a.selector+w+"-slider-label").show(),e(a.selector+w+"-buttons-label").show();var I=function(){e(a.selector+"tools").toggleClass("diva-fullscreen-tools"),a.inFullscreen?e(a.selector+"tools-left").addClass("in-fullscreen"):e(a.selector+"tools-left").removeClass("in-fullscreen")},y=function(){e(a.selector+w+"-slider").hide(),e(a.selector+w+"-out-button").hide(),e(a.selector+w+"-in-button").hide(),e(a.selector+w+"-slider-label").hide(),e(a.selector+w+"-buttons-label").hide(),w=a.inGrid?"grid":"zoom",e(a.selector+w+"-slider").show(),e(a.selector+w+"-out-button").show(),e(a.selector+w+"-in-button").show(),e(a.selector+w+"-slider-label").show(),e(a.selector+w+"-buttons-label").show(),e(a.selector+"grid-icon").toggleClass("diva-in-grid")},x={updateCurrentPage:function(){document.getElementById(a.ID+"current-page").textContent=parseInt(a.currentPageIndex,10)+1},setNumPages:function(e){document.getElementById(a.ID+"num-pages").textContent=e},updateZoomSlider:function(){a.zoomLevel!==e(a.selector+"zoom-slider").val()&&e(a.selector+"zoom-slider").val(a.zoomLevel),document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateZoomButtons:function(){document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateGridSlider:function(){a.pagesPerRow!==e(a.selector+"grid-slider").val()&&e(a.selector+"grid-slider").val(a.pagesPerRow),document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},updateGridButtons:function(){document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},closePopups:function(){e(".diva-popup").css("display","none")},switchView:y,switchMode:I};return x},Ie=function(){if(window.divaPlugins){var t=[];e.each(window.divaPlugins,function(e,i){var n=i.pluginName[0].toUpperCase()+i.pluginName.substring(1);if(a["enable"+n]){var o=i.init(a,r);if(!o)return;var l=i.titleText||n+" plugin";if("function"==typeof i.handleClick){t.push('<div class="diva-'+i.pluginName+'-icon" title="'+l+'"></div>');var s=a.mobileWebkit?"touchend":"click";a.outerObject.on(s,".diva-"+i.pluginName+"-icon",function(e){i.handleClick.call(this,e,a,r)})}a.plugins.push(i)}}),t.length&&(a.pageTools='<div class="diva-page-tools">'+t.join("")+"</div>")}},ye=function(){clearTimeout(a.throbberTimeoutID),e(a.selector+"throbber").hide()},xe=function(e){var t=e["@id"],i=/#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/,n="",a=!0;if(/\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\//.test(t)){var o=t.split("/");n=o[o.length-4]}else if(i.test(t)){var r=i.exec(t);n=r[1]}else e.service&&e.service["@id"]&&(t=e.service["@id"],a=!1);a&&(t=t.split("/").slice(0,-4).join("/"));var l={url:t};if(n.length){var s=n.split(",");l.x=parseInt(s[0],10),l.y=parseInt(s[1],10),l.w=parseInt(s[2],10),l.h=parseInt(s[3],10)}return l},Pe=function(e){var t=function(e,t){return e/Math.pow(2,t)},i=function(e,t){var i=Math.max(e,t);return Math.ceil(Math.log((i+1)/257)/Math.log(2))},n=function(e,t){for(var i=e.length;i--;)e[i]=t};diva.Events.publish("ManifestDidLoad",[e],this);for(var a,o,r,l,s,c,d,u,g,v=e.sequences[0].canvases,h=new Array(v.length),p=new Array(v.length),f=e.label,m=0,b=v.length;b>m;m++)u=v[m].images[0].resource,a=u.width||v[m].width,o=u.height||v[m].height,l=xe(u),r=l.url,"/"!==r.slice(-1)&&(r+="/"),s=i(a,o),c=v[m].label,d=u.service["@context"],g="http://iiif.io/api/image/2/context.json"===d?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===d?1.1:1,p[m]={mx_w:a,mx_h:o,mx_z:s,fn:c,url:r,api:g},l.hasOwnProperty("x")&&(p[m].xoffset=l.x,p[m].yoffset=l.y),h[m]=s;var w=Math.min.apply(Math,h),I=0,y=100,x=new Array(w+1),P=new Array(w+1),D=new Array(w+1),L=new Array(w+1);n(x,0),n(P,0),n(D,0),n(L,0);for(var O,C,T,E=[],m=0,S=p.length;S>m;m++){O=[];for(var z=0;w+1>z;z++){C=Math.floor(t(p[m].mx_w,w-z)),T=Math.floor(t(p[m].mx_h,w-z)),O[z]={h:T,w:C},x[z]+=C,P[z]+=T,D[z]=Math.max(C,D[z]),L[z]=Math.max(T,L[z]);var j=p[m].mx_h/p[m].mx_w;I=Math.max(j,I),y=Math.min(j,y)}E[m]={d:O,m:p[m].mx_z,f:p[m].fn,url:p[m].url,api:p[m].api},p[m].hasOwnProperty("xoffset")&&(E[m].xoffset=p[m].xoffset,E[m].yoffset=p[m].yoffset)}for(var M=[],k=[],m=0;w+1>m;m++)M.push(x[m]/p.length),k.push(P[m]/p.length);var A={a_wid:M,a_hei:k,max_w:D,max_h:L,max_ratio:I,min_ratio:y,t_hei:P,t_wid:x},H={item_title:f,dims:A,max_zoom:w,pgs:E};return H},De=function(e,t,i){ye();var n='<div id="'+a.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+t+" "+i+"</p>",o=0===a.objectData.lastIndexOf("http",0);if(o&&""===i){var r=a.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0];location.hostname!==r&&(n+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>')}n+="</div>",a.outerObject.append(n)},Le=function(t){var i;if(!t.hasOwnProperty("@context")||-1===t["@context"].indexOf("iiif")&&-1===t["@context"].indexOf("shared-canvas")?i=t:(a.isIIIF=!0,i=Pe(t)),ye(),a.pages=i.pgs,a.maxRatio=i.dims.max_ratio,a.minRatio=i.dims.min_ratio,a.itemTitle=i.item_title,a.numPages=i.pgs.length,a.maxWidths=i.dims.max_w,a.maxHeights=i.dims.max_h,a.averageWidths=i.dims.a_wid,a.averageHeights=i.dims.a_hei,a.totalHeights=i.dims.t_hei,a.totalWidths=i.dims.t_wid,a.realMaxZoom=i.max_zoom,a.maxZoomLevel=a.maxZoomLevel>=0&&a.maxZoomLevel<=i.max_zoom?a.maxZoomLevel:i.max_zoom,a.minZoomLevel=a.minZoomLevel>=0&&a.minZoomLevel<=a.maxZoomLevel?a.minZoomLevel:0,a.zoomLevel=Y(a.zoomLevel),a.minPagesPerRow=Math.max(2,a.minPagesPerRow),a.maxPagesPerRow=Math.max(a.minPagesPerRow,a.maxPagesPerRow),a.enableFilename){var n=e.getHashParam("i"+a.hashParamSuffix),o=s(n);v(o)&&(a.goDirectlyTo=o,a.currentPageIndex=o)}else{var r=parseInt(e.getHashParam("p"+a.hashParamSuffix),10)-1;v(r)&&(a.goDirectlyTo=r,a.currentPageIndex=r)}if(diva.Events.publish("NumberOfPagesDidChange",[a.numPages],this),a.enableAutoTitle&&(e(a.selector+"title").length?e(a.selector+"title").html(a.itemTitle):a.parentObject.prepend('<div id="'+a.ID+'title" class="diva-title">'+a.itemTitle+"</div>")),v(parseInt(a.goDirectlyTo),10)||(a.goDirectlyTo=0),a.adaptivePadding>0){var l=a.zoomLevel;a.horizontalPadding=parseInt(a.averageWidths[l]*a.adaptivePadding,10),a.verticalPadding=parseInt(a.averageHeights[l]*a.adaptivePadding,10)}else a.horizontalPadding=a.fixedPadding,a.verticalPadding=a.fixedPadding;a.pageTools.length&&(a.verticalPadding=Math.max(40,a.verticalPadding))},Oe=function(){var t='<div id="'+a.ID+'throbber" class="diva-throbber"></div>';a.outerObject.append(t),a.throbberTimeoutID=setTimeout(function(){e(a.selector+"throbber").show()},a.throbberTimeout),e.ajax({url:a.objectData,cache:!0,dataType:"json",error:De,success:function(t,i,n){Le(t),diva.Events.publish("ObjectDidLoad",[a],r),a.enableToolbar&&(a.toolbar=we(),diva.Events.subscribe("VisiblePageDidChange",a.toolbar.updateCurrentPage),diva.Events.subscribe("ModeDidSwitch",a.toolbar.switchMode),diva.Events.subscribe("ViewDidSwitch",a.toolbar.switchView),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomButtons),diva.Events.subscribe("GridRowNumberDidChange",a.toolbar.updateGridSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateGridButtons),diva.Events.subscribe("NumberOfPagesDidChange",a.toolbar.setNumPages)),a.parentObject.parent()[0]===document.body&&(a.parentObject.siblings().not("#diva-canvas-backdrop")[0]||(a.divaIsFullWindow=!0)),he();var o=parseInt(e.getHashParam("y"+a.hashParamSuffix),10);a.verticalOffset=isNaN(o)?le(a.currentPageIndex,"top"):o;var l=parseInt(e.getHashParam("x"+a.hashParamSuffix),10);a.horizontalOffset=isNaN(l)?se(a.currentPageIndex,"center"):l,a.inFullscreen?K(!1):X(),he(),diva.Events.publish("ViewerDidLoad",[a],r),a.loaded=!0}})},Ce=function(){return a.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)},Te=function(){a.scrollbarWidth=e.getScrollbarWidth(),a.mobileWebkit=void 0!==window.orientation,a.ID=e.generateId("diva-"),a.selector="#"+a.ID;var t=parseInt(a.ID,10);t>1&&(a.hashParamSuffix=t),a.parentObject.append('<div id="'+a.ID+'outer" class="diva-outer"></div>'),a.outerObject=e(a.selector+"outer"),a.outerObject.append('<div id="'+a.ID+'inner" class="diva-inner diva-dragger"></div>'),a.innerObject=e(a.selector+"inner");var i=parseInt(e.getHashParam("n"+a.hashParamSuffix),10);i>=a.minPagesPerRow&&i<=a.maxPagesPerRow&&(a.pagesPerRow=i);var n=e.getHashParam("z"+a.hashParamSuffix);""!==n&&(n=parseInt(n,10),n>=a.minZoomLevel&&(a.zoomLevel=n));var o=e.getHashParam("g"+a.hashParamSuffix),r="true"===o,l=e.getHashParam("f"+a.hashParamSuffix),s="true"===l;a.inGrid=a.inGrid&&"false"!==o||r,a.inFullscreen=a.inFullscreen&&"false"!==l||s,Oe(),Ie(),be()};Te(),this.getItemTitle=function(){return a.itemTitle},this.gotoPageByNumber=function(e,t,i){var n=parseInt(e,10)-1;return v(n)?(B(n,le(n,i),se(n,t)),!0):!1},this.gotoPageByIndex=function(e,t,i){return e=parseInt(e,10),v(e)?(B(e,le(e,i),se(e,t)),!0):!1},this.getNumberOfPages=function(){return Ce()?a.numPages:!1},this.getPageDimensionsAtZoomLevel=function(e,t){if(!Ce())return!1;t>a.maxZoomLevel&&(t=a.maxZoomLevel);var i=a.pages[parseInt(e,10)],n=i.d[parseInt(t,10)];return{width:n.w,height:n.h}},this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(a.currentPageIndex,a.zoomLevel)},this.isReady=function(){return a.loaded},this.getCurrentPageIndex=function(){return a.currentPageIndex},this.getCurrentPageFilename=function(){return a.pages[a.currentPageIndex].f},this.getCurrentPageNumber=function(){return a.currentPageIndex+1},this.getFilenames=function(){for(var e=[],t=0;t<a.numPages;t++)e[t]=a.pages[t].f;return e},this.getZoomLevel=function(){return a.zoomLevel},this.getMaxZoomLevel=function(){return a.maxZoomLevel},this.getMaxZoomLevelForPage=function(e){return Ce?a.pages[e].m:!1},this.getMinZoomLevel=function(){return a.minZoomLevel},this.setZoomLevel=function(e){return a.inGrid&&ee(),oe(e)},this.zoomIn=function(){return this.setZoomLevel(a.zoomLevel+1)},this.zoomOut=function(){return this.setZoomLevel(a.zoomLevel-1)},this.inViewport=function(e,t,i,n,o){var r=e-1,l=a.pageTopOffsets[r]+i,s=l+o,u=a.pageLeftOffsets[r]+t,g=u+n;return d(l,s)&&c(u,g)},this.isPageInViewport=function(e){return h(e)},this.isPageLoaded=function(e){return p(e)},this.toggleFullscreenMode=function(){$()},this.closePopups=function(){a.toolbar.closePopups()},this.enterFullscreenMode=function(){return a.inFullscreen?!1:($(),!0)},this.leaveFullscreenMode=function(){return a.inFullscreen?($(),!0):!1},this.toggleGridView=function(){ee()},this.enterGridView=function(){return a.inGrid?!1:(ee(),!0)},this.leaveGridView=function(){return a.inGrid?(ee(),!0):!1},this.gotoPageByName=function(e,t,i){var n=s(e);return v(n)?(B(n,le(n,i),se(n,t)),!0):!1},this.getPageIndex=function(e){return s(e)},this.getCurrentURL=function(){return ve()},this.getURLHash=function(){return ge()},this.getState=function(){return ue()},this.getInstanceSelector=function(){return a.selector},this.getInstanceId=function(){return a.ID},this.getSettings=function(){return a},this.translateFromMaxZoomLevel=function(e){var t=a.maxZoomLevel-a.zoomLevel;return e/Math.pow(2,t)},this.translateToMaxZoomLevel=function(e){var t=a.maxZoomLevel-a.zoomLevel;return 0===t?e:e*Math.pow(2,t)},this.setState=function(e){var t;t=s(e.i),v(t)?a.goDirectlyTo=t:v(e.p)&&(a.goDirectlyTo=e.p),horizontalOffset=parseInt(e.x,10),verticalOffset=parseInt(e.y,10),e.z>=a.minZoomLevel&&e.z<=a.maxZoomLevel&&(a.zoomLevel=e.z),e.n>=a.minPagesPerRow&&e.n<=a.maxPagesPerRow&&(a.pagesPerRow=e.n),a.inFullscreen!==e.f?(a.inFullscreen=e.f,K(a.inGrid!==e.g),a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,B(t,a.verticalOffset,a.horizontalOffset)):(a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,a.inGrid!==e.g?(a.inGrid=e.g,J()):X())},this.enableScrollable=function(){a.isScrollable||(pe(),a.enableKeyScroll=a.initialKeyScroll,a.enableSpaceScroll=a.initialSpaceScroll,a.outerObject.css("overflow","auto"),a.isScrollable=!0)},this.disableScrollable=function(){a.isScrollable&&(a.innerObject.hasClass("diva-dragger")&&a.innerObject.unbind("mousedown"),a.outerObject.unbind("dblclick"),a.outerObject.unbind("contextmenu"),a.outerObject.css("overflow","hidden"),a.initialKeyScroll=a.enableKeyScroll,a.initialSpaceScroll=a.enableSpaceScroll,a.enableKeyScroll=!1,a.enableSpaceScroll=!1,a.isScrollable=!1)},this.toggleOrientation=function(){return te()},this.getPageOffset=function(e){return{top:parseInt(a.pageTopOffsets[e]),left:parseInt(a.pageLeftOffsets[e])}},this.getCurrentPageOffset=function(){return this.getPageOffset(a.currentPageIndex)},this.getPageDimensionsAtCurrentGridLevel=function(e){e=v(e)?e:a.currentPageIndex;var t=a.rowHeight-a.fixedPadding,i=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*l(e,"w")/l(e,"h"):a.gridPageWidth;return{height:parseInt(t,10),width:parseInt(i,10)}},this.getPageIndexForPageXYValues=function(e,t){var i=document.getElementById(a.ID+"outer"),n=i.getBoundingClientRect(),o=n.top,r=n.left,l=n.bottom,s=n.right;if(r>e||e>s)return!1;if(o>t||t>l)return!1;for(var c=document.getElementsByClassName("diva-document-page"),d=c.length;d--;){var u=c[d],g=u.getBoundingClientRect();if(!(e<g.left||e>g.right||t<g.top||t>g.bottom))return u.getAttribute("data-index")}return!1},this.isVerticallyOriented=function(){return a.verticallyOriented},this.changeObject=function(t){a.loaded=!1,_(),a.throbberTimeoutID=setTimeout(function(){e(a.selector+"throbber").show()},a.throbberTimeout),a.objectData=t,e.ajax({url:a.objectData,cache:!0,dataType:"json",error:De,success:function(e,t,i){Le(e),ye(),X(),a.loaded=!0}})},this.activate=function(){a.isActiveDiva=!0},this.deactivate=function(){a.isActiveDiva=!1},this.destroy=function(){e("body").removeClass("diva-hide-scrollbar"),a.parentObject.empty().removeData("diva"),diva.Events.publish("ViewerDidTerminate",[a],r),a.parentObject.removeAttr("style").removeAttr("class"),diva.Events.unsubscribeAll()}};e.fn.diva=function(i){return this.each(function(){if(i.parentObject=e(this),!i.parentObject.data("diva")){var n=new t(this,i);i.parentObject.data("diva",n)}})}}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,n){function a(e){return Math.log(e)/Math.log(10)}var o,r,l,s,c;n.startScrolling=function(){return i.currentlyAutoScrolling?void console.warn("You are trying to start autoscrolling, but it is already scrolling."):(e("#"+i.ID+"autoscroll-toggle").text("Turn off"),r&&n.disableScrollable(),i.currentlyAutoScrolling=!0,void restartScrollingInterval())},restartScrollingInterval=function(){clearInterval(i.autoScrollInterval),i.autoScrollInterval=i.verticallyOriented?setInterval(function(){i.outerObject.scrollTop(i.outerObject.scrollTop()+o)},l):setInterval(function(){i.outerObject.scrollLeft(i.outerObject.scrollLeft()+o)},l)},n.stopScrolling=function(){return i.currentlyAutoScrolling?(e("#"+i.ID+"autoscroll-toggle").text("Turn on"),r&&n.enableScrollable(),i.currentlyAutoScrolling=!1,void clearInterval(i.autoScrollInterval)):void console.warn("You are trying to stop autoscrolling, but it is not currently active.")},n.toggleScrolling=function(){i.currentlyAutoScrolling?n.stopScrolling():n.startScrolling()},n.changeRefresh=function(e){l=e,d()},n.changeScrollSpeed=function(t){c=t,d(),e("#"+i.ID+"autoscroll-pps").val(a(c)),i.currentlyAutoScrolling&&restartScrollingInterval()};var d=function(){l=s,o=c/(1e3/l),1>o&&(l*=1/o,o=c/(1e3/l))};if(n.disableManualScroll=function(){r=!0,i.currentlyAutoScrolling&&n.disableScrollable()},n.enableManualScroll=function(){r=!1,i.currentlyAutoScrolling&&n.enableScrollable()},i.currentlyAutoScrolling=!1,i.autoScrollInterval="",r=i.disableManualScroll||!1,l=i.autoScrollRefresh||50,s=l,n.changeScrollSpeed(i.scrollSpeed||10),e(window).on("keyup",function(e){e.shiftKey&&32===e.keyCode&&n.toggleScrolling()}),!i.disableAutoscrollPrefs){var u=function(n){if(i.inFullscreen){var a=e(i.selector+"tools"),o=a.css("right");t.jqObj.css({right:o,"margin-right":0,top:a.offset().top+a.outerHeight()+15})}else t.jqObj.css({right:e(window).width()-(i.outerObject.offset().left+i.outerObject.outerWidth())+i.scrollbarWidth,"margin-right":".6em"}),t.jqObj.offset({top:i.outerObject.offset().top+1})};diva.Events.subscribe("ModeDidSwitch",u),diva.Events.subscribe("ViewerDidLoad",function(o){var r="<div id='"+i.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+i.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+a(c)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+i.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+i.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";e("#"+i.ID+"page-nav").before("<div id='"+i.ID+"autoscroll-icon' class='button diva-autoscroll-icon' title='Expand autoscroll options'></div>"),e("body").prepend(r),e("#"+i.ID+"autoscroll-pps").on("change",function(e){n.changeScrollSpeed(Math.pow(10,e.target.value))}),e("#"+i.ID+"autoscroll-manual").on("change",function(e){e.target.checked?n.enableManualScroll():n.disableManualScroll()}),e("#"+i.ID+"autoscroll-toggle").on("click",n.toggleScrolling),e("#"+i.ID+"autoscroll-icon").on("click",function(n){t.jqObj=e("#"+i.ID+"autoscroll-prefs"),"none"===t.jqObj.css("display")?(t.jqObj.css({display:"block"}),u(i.inFullscreen)):t.jqObj.css("display","none")})})}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t,i,n,a={},o={},r={},l={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},s=function(e){return e*Math.PI/180},c=function(e,t){var n=e.x-a.centerX,o=-(e.y-a.centerY),r=s(i.rotation.previous-t),l=Math.cos(r)*n-Math.sin(r)*o+a.centerX,c=-(Math.sin(r)*n+Math.cos(r)*o)+a.centerY;return{x:l,y:c}},d=function(e,i){var n=e.context,a=e.size/2,o=-(e.width/2),r=-(e.height/2);n.clearRect(0,0,e.size,e.size),n.save(),n.translate(a,a),n.rotate(s(i)),n.drawImage(t,o,r,e.width,e.height),n.restore(),e.data=n.getImageData(0,0,e.size,e.size)},u=function(){var e;for(e in i)if(i[e].current!==i[e].previous)return!0;return!1},g=function(){var e;for(e in i)i[e].previous=i[e].current},v=function(){d(o,i.rotation.current),m(o)},h=function(){var t=i.rotation.current,n=i.rotation.previous,o=i.zoom.current,l=i.zoom.previous;if(t!==n||o!==l){var s=e("#diva-canvas-wrapper").scrollLeft(),v=e("#diva-canvas-wrapper").scrollTop(),h=r.viewport.width/2,p=r.viewport.height/2,f=c({x:s+h,y:v+p},t),b=Math.pow(2,o-l),w=b*f.x-h,I=b*f.y-p;d(a,t),e("#diva-canvas-wrapper").scrollLeft(w),e("#diva-canvas-wrapper").scrollTop(I)}u()&&(m(a),g())},p=function(e){var t,i,n=e.data,a=e.context.createImageData(n),o=a.data;for(t=0,i=o.length;i>t;t++)o[t]=n.data[t];return a},f=function(e){var t=i[e].current!==i[e].previous,n=i[e].current!==i[e].initial;return t||n},m=function(e){var t,n,a,o,l,s,c,d,u=p(e),g=u.data,v=i.brightness.current,h=i.contrast.current,m=1+Math.min(r.brightnessMax,Math.max(r.brightnessMin,v))/r.brightnessMax,b=m*h,w=128-128*h,I=i.red.current,y=i.green.current,x=i.blue.current,P=f("red"),D=f("green"),L=f("blue"),O=f("brightness"),C=f("contrast"),T=O||C;for(t=0,a=u.width;a>t;t++)for(n=0,o=u.height;o>n;n++)l=4*(n*a+t),s=g[l],c=g[l+1],d=g[l+2],s+c+d>0&&(P&&s&&(s+=I),D&&c&&(c+=y),L&&d&&(d+=x),T&&(s&&(s=s*b+w),c&&(c=c*b+w),d&&(d=d*b+w)),g[l]=s,g[l+1]=c,g[l+2]=d);e.context.clearRect(0,0,a,o),e.context.putImageData(u,0,0)},b=function(){var t=e("#diva-canvas-wrapper").scrollLeft()*o.scaleFactor,i=e("#diva-canvas-wrapper").scrollTop()*o.scaleFactor,n=Math.min(Math.round(r.viewport.height*o.scaleFactor),r.mapSize)-4,a=Math.min(Math.round(r.viewport.width*o.scaleFactor),r.mapSize)-4;e("#diva-map-viewbox").height(n).width(a).css({top:i,left:t})},w=function(t){o.canvas=document.getElementById("diva-canvas-minimap"),o.size=r.mapSize,o.canvas.width=o.size,o.canvas.height=o.size,o.context=o.canvas.getContext("2d"),o.context.fillRect(0,0,o.size,o.size),o.scaleFactor=r.mapSize/a.size,o.cornerX=a.cornerX*o.scaleFactor,o.cornerY=a.cornerY*o.scaleFactor,o.width=t.width*o.scaleFactor,o.height=t.height*o.scaleFactor,o.context.drawImage(t,o.cornerX,o.cornerY,o.width,o.height),o.data=o.context.getImageData(0,0,r.mapSize,r.mapSize),e("#diva-map-viewbox").show(),b()},I=function(i,n){t=new Image,t.crossOrigin="anonymous",t.onload=function(){a.size=Math.sqrt(t.width*t.width+t.height*t.height),a.canvas=document.getElementById("diva-canvas"),a.canvas.width=a.size,a.canvas.height=a.size,a.cornerX=(a.size-t.width)/2,a.cornerY=(a.size-t.height)/2,a.width=t.width,a.height=t.height,a.centerX=a.size/2,a.centerY=a.size/2,a.context=a.canvas.getContext("2d"),a.context.drawImage(t,a.cornerX,a.cornerY,a.width,a.height);try{a.data=a.context.getImageData(0,0,a.size,a.size)}catch(i){var o='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+i.message+"</p>";if("SecurityError"!==i.name)throw i;o+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div>',o+="</div>",e("#diva-canvas-backdrop").append(o),L()}void 0===n&&w(t),v(),h(a),L(),"function"==typeof n&&n.call(n)},t.src=i,(t.complete||void 0===t.complete)&&(t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.src=i)},y=function(){var t=i[n],a=t.current,o=t.transform?t.transform(a):a;e("#diva-canvas-value").html(o)},x=function(){e("#diva-canvas-slider").val(i[n].current)},P=function(e){var t,i=r.zoomWidthRatio*Math.pow(2,e),n=r.imageDir+"/",a=r.selectedPageIndex;if(r.isIIIF){var o=r.pages[a].api>1.1?"default":"native";t=encodeURI(r.pages[a].url+"full/"+i+",/0/"+o+".jpg")}else t=r.iipServerURL+"?FIF="+n+r.filename+"&WID="+i+"&CVT=JPEG";return t},D=function(){(i.zoom.current>0||r.mobileWebkit)&&e(r.selector+"throbber").addClass("canvas-throbber").show()},L=function(){e(r.selector+"throbber").removeClass("canvas-throbber").hide()},O=function(){var e,t={},n=!1,a=r.localStoragePrefix+r.filename;for(e in i)i[e].previous!==i[e].initial&&(t[e]=i[e].previous,n=!0);n?(r.pluginIcon.addClass("new"),localStorage.setObject(a,t)):(r.pluginIcon.removeClass("new"),localStorage.removeItem(a))},C=function(e,t){r.zoomLevel=e;var i=P(e);I(i,function(){o.scaleFactor=o.size/a.size,b(),O()})},T=function(t){var i=38,n=40,a=37,o=39;switch(t.keyCode){case i:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-r.arrowScrollAmount),!1;case n:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+r.arrowScrollAmount),!1;case a:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-r.arrowScrollAmount),!1;case o:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+r.arrowScrollAmount),!1}},E={init:function(t,s){var c=!!window.HTMLCanvasElement;if(!c)return!1;e.extend(r,l,t.canvasPlugin),r.inCanvas=!1,r.iipServerURL=t.iipServerURL,r.imageDir=t.imageDir,r.selector=t.selector,r.mobileWebkit=t.mobileWebkit,r.arrowScrollAmount=t.arrowScrollAmount,i={contrast:{initial:1,min:r.contrastMin,max:r.contrastMax,step:r.contrastStep,transform:function(e){return e.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:r.brightnessMin,max:r.brightnessMax,step:r.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(e){return e+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the blue channel"}};var d=function(){var e,t,n;for(n in i)t=i[n],e=t.initial,t.current=e,t.previous=e};if(d(),e("#diva-canvas-backdrop").length)return!0;var g,p,f,m,w=[];for(m in r.buttons)p=r.buttons[m],f=i[p].title,g='<div class="'+p+'" title="'+f+'"></div>',w.push(g);var I=w.join(""),P='<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+I+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>',E='<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div>',S='<div id="diva-canvas-backdrop">'+P+E+"</div>";e("body").append(S),r.mapSize=e("#diva-canvas-minimap").width(),e("#diva-canvas-buttons div").click(function(){e("#diva-canvas-buttons .clicked").removeClass("clicked"),z(e(this).attr("class"))});var z=function(t){n=t;var a=i[n];e("#diva-canvas-buttons ."+n).addClass("clicked"),e("#diva-canvas-mode").text(n);var o=a.current,r=a.transform?a.transform(o):o,l=document.getElementById("diva-canvas-slider");l.min=a.min,l.max=a.max,l.step=a.step,e("#diva-canvas-slider").val(o),e("#diva-canvas-value").html(r)};return z("contrast"),e("#diva-canvas-slider").on("input",function(e){i[n].current=parseFloat(this.value),y(),v()}),e("#diva-canvas-reset-all").click(function(){var e;for(e in i)i[e].current=i[e].initial;y(),x(),v()}),e("#diva-canvas-reset").click(function(){i[n].current=i[n].initial,y(),x(),v()}),e("#diva-canvas-apply").click(function(){u()&&(D(),setTimeout(function(){i.zoom.current!==i.zoom.previous?C(i.zoom.current):(h(),L(),O())},r.throbberTimeout))}),e("#diva-canvas-close").click(function(){e("body").removeClass("overflow-hidden"),a.context.clearRect(0,0,a.size,a.size),o.context.clearRect(0,0,o.size,o.size),e("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0),e("#diva-canvas-backdrop").hide(),e("#diva-map-viewbox").hide(),L(),s.enableScrollable(),e(document).off("keydown",T),d(),y(),x(),e("#diva-canvas-buttons .clicked").removeClass("clicked"),z("contrast"),diva.Events.publish("CanvasViewDidHide")}),e("#diva-canvas-minimise").click(function(){e("#diva-canvas-toolwindow").slideToggle("fast")}),e(window).resize(function(){r.viewport={height:window.innerHeight-t.scrollbarWidth,width:window.innerWidth-t.scrollbarWidth},r.inCanvas&&b()}),e("#diva-canvas-wrapper").scroll(function(){r.inCanvas&&b()}),e("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(t){var i=e("#diva-canvas-minimap").offset(),n=(t.pageX-i.left)/o.scaleFactor,a=(t.pageY-i.top)/o.scaleFactor;e("#diva-canvas-wrapper").scrollTop(a-r.viewport.height/2),e("#diva-canvas-wrapper").scrollLeft(n-r.viewport.width/2)}),e("#diva-canvas").mousedown(function(){e(this).addClass("grabbing")}).mouseup(function(){e(this).removeClass("grabbing")}),r.mobileWebkit?e("#diva-canvas-wrapper").kinetic():e("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0}),diva.Events.subscribe("ObjectDidLoad",this.setupHook),diva.Events.subscribe("ViewerDidTerminate",this.destroy),diva.Events.subscribe("PageDidLoad",this.onPageLoad),!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(e){r.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},r.minZoomLevel=e.minZoomLevel,r.maxZoomLevel=e.maxZoomLevel,r.mobileWebkit&&(r.maxZoomLevel=Math.min(r.maxZoomLevel,r.mobileWebkitMaxZoom)),i.zoom.min=r.minZoomLevel,i.zoom.max=r.maxZoomLevel},handleClick:function(t,a,o){var l,s=e(this).parent().parent(),c=e(s).attr("data-filename"),d=e(s).attr("data-index"),u=e(s).width()-1,g=a.zoomLevel;r.zoomWidthRatio=u/Math.pow(2,g),r.pluginIcon=e(this),r.pages=a.pages,r.isIIIF=a.isIIIF,r.selectedPageIndex=d,r.mobileWebkit&&(g=Math.min(r.maxZoomLevel,g)),r.filename=c,i.zoom.initial=g,i.zoom.current=g;var v=localStorage.getObject(r.localStoragePrefix+r.filename);if(v)for(l in v)i[l].current=v[l],l===n&&(y(),x()),"zoom"===l&&(g=v[l]);i.zoom.previous=g,e("body").addClass("overflow-hidden"),e("#diva-canvas-backdrop").show(),o.disableScrollable(),e(document).keydown(T),r.inCanvas=!0;var h=P(g);e("#diva-canvas-info").text(e(s).attr("title")),D(),diva.Events.publish("CanvasViewDidActivate",[s]),I(h)},onPageLoad:function(t,i,n){var a=r.localStoragePrefix+i;null!==localStorage.getItem(a)&&e(n).find(".diva-canvas-icon").addClass("new")},destroy:function(t,i){e("#diva-canvas-backdrop").remove()}};return E}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(e,t){return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(t,i){var n,a=e(this).parent().parent(),o=e(a).attr("data-filename"),r=e(a).attr("data-index"),l=e(a).width()-1;if(i.isIIIF){var s=i.pages[r].api>1.1?"default":"native";

n=encodeURI(i.pages[r].url+"full/"+l+",/0/"+s+".jpg")}else n=i.iipServerURL+"?FIF="+i.imageDir+"/"+o+"&WID="+l+"&CVT=JPEG";window.open(n)}};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){function i(i,n,a){var l=e.parentObject.data("highlights");if("undefined"!=typeof l){if(l.hasOwnProperty(i)){for(var s=document.getElementById(e.ID+"page-"+i).getElementsByClassName(e.ID+"highlight");s[0];)s[0].parentNode.removeChild(s[0]);var c,d=t.getInstanceId()+"page-"+i,u=document.getElementById(d),g=l[i].regions,v=l[i].colour,h=l[i].divClass,p=t.getMaxZoomLevel();if(e.inGrid){var f=t.getPageDimensionsAtZoomLevel(i,p).width,m=u.clientWidth,b=f/m;c=Math.log(b)/Math.log(2)}else c=p-t.getZoomLevel();for(var w=g.length;w--;){var I=document.createElement("div");I.style.width=r(g[w].width,c)+"px",I.style.height=r(g[w].height,c)+"px",I.style.top=r(g[w].uly,c)+"px",I.style.left=r(g[w].ulx,c)+"px",I.style.background=v,I.style.border="1px solid #555",I.style.position="absolute",I.style.zIndex=100,I.className=h,"undefined"!=typeof g[w].divID&&I.setAttribute("data-highlight-id",g[w].divID),u.appendChild(I)}}o(),diva.Events.publish("HighlightCompleted",[i,n,a])}}e.parentObject.data("highlights",{});var n,a,o=function(){var i,o=e.ID+"selected-highlight",r=document.getElementsByClassName(o);for(i=0;i<r.length;i++)box=r[i],box.id!=n&&(box.className=box.className.replace(" "+o,""),box.style.border="1px solid #555");if(t.isPageLoaded(a))for(boxes=document.querySelectorAll("*[data-highlight-id="+n+"]"),i=0;i<boxes.length;i++)box=boxes[i],box.className=box.className+" "+o,box.style.border="2px solid #000"};diva.Events.subscribe("PageDidLoad",i);var r=function(e,t){return e/Math.pow(2,t)};t.resetHighlights=function(){for(var t=document.getElementById(e.ID+"inner"),i=e.ID+"highlight",n=t.getElementsByClassName(i),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}e.parentObject.data("highlights",{})},t.removeHighlightsOnPage=function(i){var n=e.parentObject.data("highlights");if(n.hasOwnProperty(i)){for(var a=t.getInstanceId()+"page-"+i,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=n[i].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete n[i]}},t.highlightOnPages=function(e,i,n,a){for(var o=e.length;o--;)t.highlightOnPage(e[o],i[o],n,a)},t.highlightOnPage=function(n,a,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.2)"),r="undefined"==typeof r?e.ID+"highlight":e.ID+"highlight "+r;var l=(t.getMaxZoomLevel(),e.parentObject.data("highlights"));return l[n]={regions:a,colour:o,divClass:r},t.isPageLoaded(n)&&i(n,null,null),!0},t.gotoHighlight=function(t){var i=e.parentObject.data("highlights");if(null!==document.getElementById(t)){for(var n=parseInt(document.getElementById(t).parentNode.getAttribute("data-index"),10),a=i[n].regions.length;a--;)if(i[n].regions[a].divID===t)return l(n,i[n].regions[a])}else for(var o=Object.keys(i),r=o.length;r--;)for(var s=i[o[r]].regions,c=s.length;c--;)if(s[c].divID===t)return l(o[r],s[c]);return console.warn("Diva just tried to find a highlight that doesn't exist."),!1};var l=function(i,r){var l=parseFloat(r.uly)+parseFloat(r.height)/2,s=parseFloat(r.ulx)+parseFloat(r.width)/2,c=t.translateFromMaxZoomLevel(l),d=t.translateFromMaxZoomLevel(s);i=parseInt(i,10),t.gotoPageByIndex(i);var u=t.getSettings().outerObject,g=u.scrollTop()+c-u.height()/2+e.verticalPadding,v=u.scrollLeft()+d-u.width()/2+e.horizontalPadding;return u.scrollTop(g),u.scrollLeft(v),n=r.divID,a=i,diva.Events.publish("SelectedHighlightChanged",[n,a]),o(),n},s=function(i){return t.translateFromMaxZoomLevel(e.verticallyOriented?parseFloat(i.uly)+parseFloat(i.height)/2:parseFloat(i.ulx)+parseFloat(i.width)/2)},c=function(i){var o,r,c,d,u,g,v,h,p,f,m=e.parentObject.data("highlights"),b=!1;if(n&&a){for(c=a,d=m[c].regions,u=d.length;u--;)if(d[u].divID==n){p=d[u],r=s(p);break}for(u=d.length,g=t.getPageDimensionsAtZoomLevel(c,t.getZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,f=i?function(e,t,i){return e>t&&i>e}:function(e,t,i){return t>e&&e>i};u--;)p=d[u],v=s(p),p.divID!=n&&f(v,r,o)&&(b=!0,o=v,h=p);if(b)return l(c,h)}else c=0,r=0;var w,I=Object.keys(m),y=I.indexOf(c);for(w=i?y==I.length-1?I[0]:I[y+1]:0===y?I[I.length-1]:I[y-1],d=m[w].regions,u=d.length,g=t.getPageDimensionsAtZoomLevel(w,t.getMaxZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,f=i?function(e,t){return t>e}:function(e,t){return e>t};u--;)p=d[u],v=s(p),f(v,o)&&(b=!0,o=v,h=p);return l(w,h)};return t.gotoNextHighlight=function(){return c(!0)},t.gotoPreviousHighlight=function(){return c(!1)},diva.Events.subscribe("ViewerDidTerminate",this.destroy),!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"};return e}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,n){function a(e,a,r){var l=i.parentObject.data("highlights");if("undefined"!=typeof l&&t.highlightsVisible){if(l.hasOwnProperty(e)){var s,c=n.getInstanceId()+"page-"+e,d=document.getElementById(c),u=l[e].regions,g=l[e].colour,v=l[e].divClass,h=n.getMaxZoomLevel();if(i.inGrid){var p=n.getPageDimensionsAtZoomLevel(e,h).width,f=d.clientWidth,m=p/f;s=Math.log(m)/Math.log(2)}else s=h-n.getZoomLevel();for(var b=u.length;b--;){var w=document.createElement("div");w.style.width=o(u[b].width,s)+"px",w.style.height=o(u[b].height,s)+"px",w.style.top=o(u[b].uly,s)+"px",w.style.left=o(u[b].ulx,s)+"px",w.style.background=g,w.style.border="1px solid #555",w.style.position="absolute",w.style.zIndex=100,w.className=v,"undefined"!=typeof u[b].name&&w.setAttribute("data-name",u[b].name),"undefined"!=typeof u[b].divID&&(w.id=u[b].divID),d.appendChild(w)}}diva.Events.publish("HighlightCompleted",[e,a,r])}}i.parentObject.data("highlights",{}),t.highlightedPages=[],diva.Events.subscribe("PageWillLoad",a);var o=function(e,t){return e/Math.pow(2,t)};n.resetHighlights=function(){for(var e=document.getElementById(i.ID+"inner"),t=i.ID+"highlight",n=e.getElementsByClassName(t),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}i.parentObject.data("highlights",{})},n.removeHighlightsOnPage=function(e){var t=i.parentObject.data("highlights");if(t.hasOwnProperty(e)){for(var a=n.getInstanceId()+"page-"+e,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=t[e].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete t[e]}},n.hideHighlights=function(){t.highlightsVisible=!1;for(var e=i.ID+"highlight",n=document.getElementById(i.ID+"inner"),a=n.getElementsByClassName(e),o=a.length;o--;){var r=a[o].parentNode;r.removeChild(a[o])}},n.showHighlights=function(){t.highlightsVisible=!0;for(var e,n=document.getElementById(i.ID+"inner"),o=n.getElementsByClassName("diva-document-page"),r=0;r<o.length;r++){e=parseInt(o[r].getAttribute("data-index"),10);var s=i.parentObject.data("highlights");s.hasOwnProperty(e)?a(e,null,null):l(e)}},n.highlightOnPages=function(e,t,i,a){for(var o=e.length;o--;)n.highlightOnPage(e[o],t[o],i,a)},n.highlightOnPage=function(e,t,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.1)"),r="undefined"==typeof r?i.ID+"highlight":i.ID+"highlight "+r;var l=(n.getMaxZoomLevel(),i.parentObject.data("highlights"));return l[e]={regions:t,colour:o,divClass:r},n.isPageLoaded(e)&&a(e,null,null),!0},n.gotoHighlight=function(e){var t,a,o,r,l=i.parentObject.data("highlights"),s=!1;if(null!==document.getElementById(e)){t=parseInt(document.getElementById(e).parentNode.getAttribute("data-index"),10);for(var c=l[t].regions.length;c--;)if(l[t].regions[c].divID===e){a=l[t].regions[c],o=parseFloat(a.uly)+parseFloat(a.height)/2,r=parseFloat(a.ulx)+parseFloat(a.width)/2,s=!0;break}}else for(var d=Object.keys(l),u=d.length;u--;){for(var g=l[d[u]].regions,v=g.length;v--;)if(g[v].divID===e){t=d[u],a=g[v],o=parseFloat(a.uly)+parseFloat(a.height)/2,r=parseFloat(a.ulx)+parseFloat(a.width)/2,s=!0;break}if(s)break}if(!s)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;var h=n.getSettings().outerObject,p=n.translateFromMaxZoomLevel(o),f=n.translateFromMaxZoomLevel(r);n.gotoPageByIndex(t);var m=h.scrollTop()+p-h.height()/2+i.verticalPadding,b=h.scrollLeft()+f-h.width()/2+i.horizontalPadding;return h.scrollTop(m),h.scrollLeft(b),i.currentHighlight=e,!0};var r=function(e){return function(i,a,o){for(var r=i,l=i.length,s=[],c=0;l>c;c++){var d=r[c],u=d.resource.chars,g=d.on,v=g.slice(g.indexOf("#xywh=")+6),h=v.split(","),p={ulx:parseInt(h[0],10),uly:parseInt(h[1],10),width:parseInt(h[2],10),height:parseInt(h[3],10),name:u};s.push(p)}n.highlightOnPage(e,s),t.highlightedPages.push(e)}},l=function(i){var n=t.manifest.sequences[0].canvases;if(n[i].hasOwnProperty("otherContent"))for(var a=n[i].otherContent,o=0;o<a.length;o++)"sc:AnnotationList"===a[o]["@type"]&&e.ajax({url:a[o]["@id"],cache:!0,dataType:"json",success:r(i)})},s=function(e){t.manifest=e};diva.Events.subscribe("ManifestDidLoad",s),diva.Events.subscribe("PageWillLoad",function(e){if(t.highlightsVisible){for(var i=0;i<t.highlightedPages.length;i++)if(t.highlightedPages[i]===e)return;l(e,t.manifest)}});var c=[];return i.innerObject.on("mouseenter","."+i.ID+"highlight",function(e){var t=e.target,i=t.dataset.name,n=document.createElement("div");n.style.top=t.offsetTop+t.offsetHeight-1+"px",n.style.left=t.style.left,n.style.background="#fff",n.style.border="1px solid #555",n.style.position="absolute",n.style.zIndex=101,n.className="annotation-overlay",n.textContent=i,t.parentNode.appendChild(n),c.push(n)}),i.innerObject.on("mouseleave","."+i.ID+"highlight",function(e){for(;c.length;){var t=c.pop();t.parentNode.removeChild(t)}}),diva.Events.subscribe("ViewerDidLoad",function(){e("#"+i.ID+"page-nav").before('<div id="'+i.ID+'annotations-icon" class="button diva-annotations-icon" title="Turn annotations on or off"></div>'),e(i.selector+"annotations-icon").addClass("annotations-icon-active"),e("#"+i.ID+"annotations-icon").on("click",function(a){t.highlightsVisible?(n.hideHighlights(),e(i.selector+"annotations-icon").removeClass("annotations-icon-active")):(n.showHighlights(),e(i.selector+"annotations-icon").addClass("annotations-icon-active"))})}),t.highlightsVisible=!0,!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(t,i){var n=function(i){var n=function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),n=i.replace("_"," ");return 0===t.indexOf("http://")&&(t='<a href="'+t+'" target="_blank">'+t+"</a>"),'<div class="metadata-row"><span class="metadata-label">'+n+':</span> <span class="metadata-value">'+t+"</span></div>"},a=function(e,t){for(var i=0;i<e.length;i++)if(e[i]["@language"]===t)return e[i]["@value"]},o=function(e){for(var t="",o=0;o<e.length;o++){var r=e[o];if(i.hasOwnProperty(r))if(i[r].constructor===Array){var l=a(i[r],"en");t+=n(r,l)}else t+=n(r,i[r])}return t},r='<div id="'+t.ID+'metadata" class="diva-modal">';if(r+=o(["label"]),i.hasOwnProperty("metadata"))for(var l=i.metadata,s=0;s<l.length;s++)if(l[s].value.constructor===Array){var c=a(l[s].value,"en");r+=n(l[s].label,c)}else r+=n(l[s].label,l[s].value);r+=o(["description","within","see_also","service","license","attribution"]),r+="</div>",t.parentObject.prepend(r),e(t.selector+"metadata").hide()};return diva.Events.subscribe("ManifestDidLoad",n),t.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+t.ID+'metadata-link" class="diva-metadata-link">Details</a></div>'),e(t.selector+"metadata-link").on("click",function(i){e(t.selector+"metadata").fadeToggle("fast")}),!0},destroy:function(e,t){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){void 0===e.pageAliases&&(e.pageAliases={}),void 0===e.pageAliasFunction&&(e.pageAliasFunction=function(){return!1}),t.getAliasForPageIndex=function(t){return e.pageAliases[t]||e.pageAliasFunction(t)||t+1},t.getPageIndexForAlias=function(i){for(var n=0;n<e.numPages;n++)if(t.getAliasForPageIndex(n)==i)return n;return!1},t.getPageIndicesForAlias=function(i){for(var n=[],a=0;a<e.numPages;a++)t.getAliasForPageIndex(a)==i&&n.push(a);return n},t.getCurrentAliasedPageIndex=function(){return t.getAliasForPageIndex(e.currentPageIndex)},t.gotoPageByAliasedNumber=function(e,i,n){return t.gotoPageByIndex(t.getPageIndexForAlias(e),i,n)},updateCurrentAliasedPage=function(){document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex()},initialChanges=function(){var e=this.getSettings(),t=e.numPages;void 0!==e.newTotalPages?t=e.newTotalPages:void 0!==e.totalPageOffset&&(t+=e.totalPageOffset),document.getElementById(this.getSettings().ID+"num-pages").textContent=t,document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex(),diva.Events.unsubscribe(["VisiblePageDidChange",e.toolbar.updateCurrentPage]),diva.Events.subscribe("VisiblePageDidChange",updateCurrentAliasedPage)},diva.Events.subscribe("ViewerDidLoad",initialChanges)},pluginName:"pagealias",titleText:"Re-aliases page indexes"};return e}())}(jQuery);
=======
Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},function(e){var t=1;e.generateId=function(e){var i;do i=t++ +(e?"-"+e:"");while(document.getElementById(i));return i}}(jQuery),function(e){e.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return i==n&&(n=t.clientWidth),document.body.removeChild(t),i-n}}(jQuery),function(e){e.getHashParam=function(e){var t=window.location.hash;if(""!==t){var i=t.indexOf(t.indexOf("&"+e+"=")>0?"&"+e+"=":"#"+e+"=");if(i>=0){i+=e.length+2;var n=t.indexOf("&",i);return n>i?t.substring(i,n):0>n?t.substring(i):""}return!1}return!1}}(jQuery),function(e){e.updateHashParam=function(t,i){var n=e.getHashParam(t),a=window.location.hash;if(n!==i)if("string"==typeof n){var o=a.indexOf(a.indexOf("&"+t+"=")>0?"&"+t+"=":"#"+t+"="),r=o+t.length+2+n.length,l=0===o?"#":"&";window.location.replace(a.substring(0,o)+l+t+"="+i+a.substring(r))}else window.location.replace(0===a.length?"#"+t+"="+i:a+"&"+t+"="+i)}}(jQuery),function(e){e.fn.dragscrollable=function(t){var i=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),n={mouseDownHandler:function(t){return 1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this?!1:(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",n.mouseUpHandler,t.data),e.event.add(document,"mousemove",n.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t={left:e.clientX-e.data.lastCoord.left,top:e.clientY-e.data.lastCoord.top};return e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t.left),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-t.top),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault?(e.preventDefault(),!1):void 0},mouseUpHandler:function(t){return e.event.remove(document,"mousemove",n.mouseMoveHandler),e.event.remove(document,"mouseup",n.mouseUpHandler),t.data.preventDefault?(t.preventDefault(),!1):void 0}};this.each(function(){var t={scrollable:e(this),acceptPropagatedEvent:i.acceptPropagatedEvent,preventDefault:i.preventDefault};e(this).find(i.dragSelector).bind("mousedown",t,n.mouseDownHandler)})}}(jQuery),function(e){"use strict";var t={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i="kinetic-settings",n="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var a=function(){return!1},o=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},r=function(e,t){var i=e;return e>0?e>t&&(i=t):0-t>e&&(i=0-t),i},l=function(e,t){this.removeClass(e.movingClass.up).removeClass(e.movingClass.down).removeClass(e.movingClass.left).removeClass(e.movingClass.right).removeClass(e.deceleratingClass.up).removeClass(e.deceleratingClass.down).removeClass(e.deceleratingClass.left).removeClass(e.deceleratingClass.right),e.velocity>0&&this.addClass(t.right),e.velocity<0&&this.addClass(t.left),e.velocityY>0&&this.addClass(t.down),e.velocityY<0&&this.addClass(t.up)},s=function(e,t){t.velocity=0,t.velocityY=0,t.decelerate=!0,"function"==typeof t.stopped&&t.stopped.call(e,t)},d=function(e,t){var i=e[0];t.x&&i.scrollWidth>0?(i.scrollLeft=t.scrollLeft=i.scrollLeft+t.velocity,Math.abs(t.velocity)>0&&(t.velocity=t.decelerate?o(t.velocity,t.slowdown):t.velocity)):t.velocity=0,t.y&&i.scrollHeight>0?(i.scrollTop=t.scrollTop=i.scrollTop+t.velocityY,Math.abs(t.velocityY)>0&&(t.velocityY=t.decelerate?o(t.velocityY,t.slowdown):t.velocityY)):t.velocityY=0,l.call(e,t,t.deceleratingClass),"function"==typeof t.moved&&t.moved.call(e,t),Math.abs(t.velocity)>0||Math.abs(t.velocityY)>0?window.requestAnimationFrame(function(){d(e,t)}):s(e,t)},c=function(t,n){var a=e.kinetic.callMethods[t],o=Array.prototype.slice.call(arguments);a&&this.each(function(){var t=o.slice(1),n=e(this).data(i);t.unshift(n),a.apply(this,t)})},u=function(t,i){t[0];e.support.touch?t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove):t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",a).bind("dragstart",i.events.dragStart)},g=function(t,i){t[0];e.support.touch?t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove):t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove).unbind("scroll",i.events.scroll),t.unbind("click",i.events.inputClick).unbind("selectstart",a),t.unbind("dragstart",i.events.dragStart)},v=function(a){this.addClass(n).each(function(){var n=this,o=e(this);if(!o.data(i)){var s,c,g,v,h=e.extend({},t,a),p=!1,f=!1,m=!1,b=1e3/h.throttleFPS;h.velocity=0,h.velocityY=0;var w=function(){s=!1,c=!1,m=!1};e(document).mouseup(w).click(w);var I=function(){h.velocity=r(p-s,h.maxvelocity),h.velocityY=r(f-c,h.maxvelocity)},y=function(t){return e.isFunction(h.filterTarget)?h.filterTarget.call(n,t)!==!1:!0},x=function(e,t){m=!0,h.velocity=p=0,h.velocityY=f=0,s=e,c=t},P=function(){s&&p&&h.decelerate===!1&&(h.decelerate=!0,I(),s=p=m=!1,d(o,h))},L=function(t,i){(!g||new Date>new Date(g.getTime()+b))&&(g=new Date,m&&(s||c)&&(v&&(e(v).blur(),v=null,o.focus()),h.decelerate=!1,h.velocity=h.velocityY=0,o[0].scrollLeft=h.scrollLeft=h.x?o[0].scrollLeft-(t-s):o[0].scrollLeft,o[0].scrollTop=h.scrollTop=h.y?o[0].scrollTop-(i-c):o[0].scrollTop,p=s,f=c,s=t,c=i,I(),l.call(o,h,h.movingClass),"function"==typeof h.moved&&h.moved.call(o,h)))};h.events={touchStart:function(e){var t;y(e.target)&&(t=e.originalEvent.touches[0],x(t.clientX,t.clientY),e.stopPropagation())},touchMove:function(e){var t;m&&(t=e.originalEvent.touches[0],L(t.clientX,t.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){y(e.target)&&(x(e.clientX,e.clientY),v=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){P(),v=null,e.preventDefault&&e.preventDefault()},inputMove:function(e){m&&(L(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(e){"function"==typeof h.moved&&h.moved.call(o,h),e.preventDefault&&e.preventDefault()},inputClick:function(e){return Math.abs(h.velocity)>0?(e.preventDefault(),!1):void 0},dragStart:function(e){return v?!1:void 0}},u(o,h),o.data(i,h).css("cursor",h.cursor),h.triggerHardware&&o.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};e.kinetic={settingsKey:i,callMethods:{start:function(t,i){var n=e(this);t=e.extend(t,i),t&&(t.decelerate=!1,d(n,t))},end:function(t,i){e(this);t&&(t.decelerate=!0)},stop:function(t,i){var n=e(this);s(n,t)},detach:function(t,i){var a=e(this);g(a,t),a.removeClass(n).css("cursor","")},attach:function(t,i){var a=e(this);u(a,t),a.addClass(n).css("cursor","move")}}},e.fn.kinetic=function(e){return"string"==typeof e?c.apply(this,arguments):v.call(this,e),this}}(window.jQuery||window.Zepto);var diva=function(){var e={},t={Events:{publish:function(t,i,n){if(e[t])for(var a=e[t],o=a.length;o--;)a[o].apply(n||this,i||[])},subscribe:function(t,i){return e[t]||(e[t]=[]),e[t].push(i),[t,i]},unsubscribe:function(t,i){var n=t[0];if(e[n])for(var a=e[n].length;a--;)if(e[n][a]===t[1])return e[n].splice(a,1),i&&delete e[n],!0;return!1},unsubscribeAll:function(){e={}}}};return t}(),activeDivaController=function(){var e;$(document).on("click",function(e){t($(e.target))});var t=function(t){var i,n,a=t.find(".diva-outer"),o=t.closest(".diva-outer"),r=document.getElementsByClassName("diva-outer"),l=r.length;if(a.length>0)i=a;else{if(!(o.length>0)){for(n=0;l>n;n++)$(r[n].parentElement).data("diva").deactivate();return}i=o}for(i.parent().data("diva").activate(),e=i.parent(),r=document.getElementsByClassName("diva-outer"),n=0;l>n;n++)r[n].getAttribute("id")!=i.attr("id")&&$(r[n].parentElement).data("diva").deactivate()};this.getActive=function(){return e}},activeDiva=new activeDivaController;window.divaPlugins=[],function(e){var t=function(t,i){var n={adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inBookLayout:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,onDocumentLoaded:null,onModeToggle:null,onViewToggle:null,onJump:null,onPageLoad:null,onPageLoaded:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onSetCurrentPage:null,onZoom:null,onZoomIn:null,onZoomOut:null,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:i.parentObject,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},a=e.extend({},n,i),o={allTilesLoaded:[],averageHeights:[],averageWidths:[],currentPageIndex:0,divaIsFullWindow:!1,doubleClickZoom:!1,documentPaged:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerObject:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerObject:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0};e.extend(a,o);var r=this,l=function(e){var t=!0;return function(e){var i,n,a;if("function"==typeof e){for(i=[],n=1,a=arguments.length;a>n;n++)i.push(arguments[n]);return t&&(console.warn('The use of callback functions is deprecated. Use diva.Events.subscribe("Event", function) instead.'),t=!1),e.apply(r,i),!0}return!1}}(),s=function(e,t){return a.pages[e].d[a.zoomLevel][t]},d=function(e){var t,i=a.numPages;for(t=0;i>t;t++)if(a.pages[t].f===e)return t;return-1},c=function(e,t){var i=a.outerObject.scrollLeft()-a.viewportMargin,n=i+a.panelWidth+2*a.viewportMargin,o=e>=i&&n>=e,r=i>=e&&t>=n,l=t>=i&&n>=t;return o||r||l},u=function(e,t){var i=a.outerObject.scrollTop()-a.viewportMargin,n=i+a.panelHeight+2*a.viewportMargin,o=e>=i&&n>=e,r=i>=e&&t>=n,l=t>=i&&n>=t;return o||r||l},g=function(e,t,i){var n,o;a.verticallyOriented?(n=a.pageTopOffsets[e]+t*a.tileHeight+a.verticalPadding,o=a.pageLeftOffsets[e]+i*a.tileWidth):(n=a.pageTopOffsets[e]+t*a.tileHeight,o=a.pageLeftOffsets[e]+i*a.tileWidth+a.horizontalPadding);var r=n+a.tileHeight,l=o+a.tileWidth;return u(n,r)&&c(o,l)},v=function(e,t){return!!document.getElementById(a.ID+"tile-"+e+"-"+t)},h=function(e){return e>=0&&e<a.numPages},p=function(e){var t=a.pageTopOffsets[e],i=t+s(e,"h")+a.verticalPadding,n=a.pageLeftOffsets[e],o=n+s(e,"w")+a.horizontalPadding;return u(t,i)&&c(n,o)},f=function(e){return!!document.getElementById(a.ID+"page-"+e)},m=function(e){if(!f(e)||!a.allTilesLoaded[e]){var t,i=a.pages[e].f,n=s(e,"w"),o=s(e,"h"),d=a.pageTopOffsets[e]+a.verticalPadding,c=a.pageLeftOffsets[e]+a.horizontalPadding,u=a.selector+"page-"+e;if(!f(e)){var h=document.getElementById(a.ID+"inner"),m=document.createElement("div");m.id=a.ID+"page-"+e,m.classList.add("diva-page","diva-document-page"),m.setAttribute("data-index",e),m.setAttribute("data-filename",i),a.enableImageTitles&&(m.title="Page "+(e+1)),m.innerHTML=a.pageTools,m.style.width=n+"px",m.style.height=o+"px",a.verticallyOriented?(m.style.top=d+"px",a.inBookLayout?(m.style.left=c+"px",m.classList.add(e%2?"diva-page-book-left":"diva-page-book")):m.classList.add("diva-page-vertical")):(m.style.left=c+"px",m.classList.add("diva-page-horizontal")),h.appendChild(m),l(a.onPageLoad,e,i,u),diva.Events.publish("PageWillLoad",[e,i,u],r);for(t in a.plugins)l(a.plugins[t].onPageLoad,e,i,u)}var b=function(e){var t=document.getElementById(a.ID+"page-"+e);if(null!==t&&p(e)){var d,c,h,f,m,b,w,I,y,x,P=a.imageDir+"/",L=Math.ceil(s(e,"h")/a.tileWidth),D=Math.ceil(s(e,"w")/a.tileHeight),O=a.pages[e].m,C=a.iipServerURL+"?FIF="+P+i+"&JTL=",T=!0,S=0,k=o-(L-1)*a.tileHeight,E=n-(D-1)*a.tileWidth;w=a.zoomLevel+O-a.realMaxZoom;var z=a.isIIIF?a.pages[e].url:C+w+",";if(a.isIIIF){var j=Math.pow(2,O-w);y=a.tileHeight*j,x=a.tileWidth*j;var M=a.pages[e].api,H=M>=2?"default":"native",A="/0/"+H+".jpg"}else y=a.tileHeight,x=a.tileWidth;for(d=0;L>d;){for(c=0,h=d===L-1?k:a.tileHeight;D>c;){if(m=d*a.tileHeight,b=c*a.tileWidth,f=c===D-1?E:a.tileWidth,I=a.isIIIF?z+c*x+","+d*y+","+f*j+","+h*j+"/"+f+","+A:z+S,!v(e,S))if(g(e,d,c)){var B=document.createElement("div");B.id=a.ID+"tile-"+e+"-"+S,B.classList.add("diva-document-tile"),B.style.display="inline",B.style.position="absolute",B.style.top=m+"px",B.style.left=b+"px",B.style.backgroundImage="url('"+I+"')",B.style.height=h+"px",B.style.width=f+"px",t.appendChild(B)}else T=!1;S++,c++}d++}a.allTilesLoaded[e]=T,l(a.onPageLoaded,e,i,u),diva.Events.publish("PageDidLoad",[e,i,u],r)}};a.pageTimeouts.push(setTimeout(b,a.pageLoadTimeout,e))}},b=function(e){var t=document.getElementById(a.ID+"page-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},w=function(e){var t=a.pageTopOffsets[e]+s(e,"h")+a.verticalPadding,i=document.getElementById(a.ID+"outer").scrollTop;return i>t},I=function(e){var t=a.pageTopOffsets[e],i=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return t>i},y=function(e){var t=a.pageLeftOffsets[e]+s(e,"w")+a.horizontalPadding,i=document.getElementById(a.ID+"outer").scrollLeft;return i>t},x=function(e){var t=a.pageLeftOffsets[e],i=document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth;return t>i},P=function(e){return a.verticallyOriented?w(e):y(e)},L=function(e){return a.verticallyOriented?I(e):x(e)},D=function(e,t){h(e)&&(t>0?p(e)?(m(e),a.lastPageLoaded=e,D(a.lastPageLoaded+1,t)):h(e+1)&&p(e+1)?(m(e+1),a.lastPageLoaded=e+1,D(a.lastPageLoaded+1,t)):P(e)&&D(e+1,t):p(e)?(m(e),a.firstPageLoaded=e,D(a.firstPageLoaded-1,t)):h(e-1)&&p(e-1)?(m(e-1),a.firstPageLoaded=e-1,D(a.firstPageLoaded-1,t)):L(e)&&D(e-1,t))},O=function(e,t){t>0?h(e)&&P(e)&&(b(e),a.firstPageLoaded=e+1,O(a.firstPageLoaded,t)):h(e)&&L(e)&&(b(e),a.lastPageLoaded=e-1,O(a.lastPageLoaded,t))},C=function(e){var t;if(0>e)D(a.lastPageLoaded,e),R(-1),O(a.lastPageLoaded,e);else if(e>0)D(a.firstPageLoaded,e),R(1),O(a.firstPageLoaded,e);else{var i=a.lastPageLoaded;for(t=Math.max(a.firstPageLoaded,0);i>=t;t++)p(t)&&m(t)}var n=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop:document.getElementById(a.ID+"outer").scrollLeft;l(a.onScroll,n),diva.Events.publish("ViewerDidScroll",[n],r),e>0?(l(a.onScrollDown,n),diva.Events.publish("ViewerDidScrollDown",[n],r)):0>e&&(l(a.onScrollUp,n),diva.Events.publish("ViewerDidScrollUp",[n],r))},T=function(e){return e>=0&&e<a.numRows},S=function(e){var t=a.rowHeight*e,i=t+a.rowHeight+a.fixedPadding;return u(t,i)},k=function(e){return!!document.getElementById(a.ID+"row-"+e)},E=function(e){if(!k(e)){var t=a.rowHeight*e+a.fixedPadding,i=document.getElementById(a.ID+"inner"),n=document.createElement("div");n.id=a.ID+"row-"+e,n.classList.add("diva-row"),n.style.height=a.rowHeight+"px",n.style.top=t+"px",i.appendChild(n);var o,l,d,c,u,g,v,p,f,m,b,w,I=a.imageDir+"/",y=a.pagesPerRow;for(o=0;y>o&&(l=e*a.pagesPerRow+o,h(l));o++){d=a.pages[l].f,c=s(l,"w"),u=s(l,"h"),g=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*c/u:a.gridPageWidth,v=a.fixedHeightGrid?a.rowHeight-a.fixedPadding:g/c*u,p=parseInt(o*(a.fixedPadding+a.gridPageWidth)+a.fixedPadding,10),m=a.pages[l].api,b=m>=2?"default":"native",w=",/0/"+b+".jpg",g=parseInt(g,10),v=parseInt(v,10),p+=a.fixedHeightGrid?(a.gridPageWidth-g)/2:0,f=encodeURI(a.isIIIF?a.pages[l].url+"full/"+g+w:a.iipServerURL+"?FIF="+I+d+"&HEI="+(v+2)+"&CVT=JPEG"),a.pageTopOffsets[l]=t,a.pageLeftOffsets[l]=p;var x=document.createElement("div");x.id=a.ID+"page-"+l;var P=a.selector+"page-"+l;x.classList.add("diva-page","diva-grid-page"),x.style.width=g+"px",x.style.height=v+"px",x.style.left=p+"px",x.setAttribute("data-index",l),x.setAttribute("data-filename",d),a.enableImageTitles&&(x.title="Page "+(l+1)),n.appendChild(x),diva.Events.publish("PageWillLoad",[l,d,P],r),F(e,l,f,g,v)}}},z=function(e){var t=document.getElementById(a.ID+"row-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},j=function(e){var t=a.rowHeight*(e+1),i=document.getElementById(a.ID+"outer").scrollTop;return i>t},M=function(e){var t=a.rowHeight*e,i=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return t>i},H=function(e,t){t>0?T(e)&&(S(e)?(E(e),a.lastRowLoaded=e,H(a.lastRowLoaded+1,t)):j(e)&&H(e+1,t)):T(e)&&(S(e)?(E(e),a.firstRowLoaded=e,H(a.firstRowLoaded-1,t)):M(e)&&H(e-1,t))},A=function(e,t){t>0?T(e)&&j(e)&&(z(e),a.firstRowLoaded++,A(a.firstRowLoaded,t)):T(e)&&M(e)&&(z(e),a.lastRowLoaded--,A(a.lastRowLoaded,t))},B=function(e){0>e?(H(a.firstRowLoaded,-1),Z(-1),A(a.lastRowLoaded,-1)):e>0&&(H(a.lastRowLoaded,1),Z(1),A(a.firstRowLoaded,1));var t=document.getElementById(a.ID+"outer").scrollTop;l(a.onScroll,t),diva.Events.publish("ViewerDidScroll",[t],r),e>0?(l(a.onScrollDown,t),diva.Events.publish("ViewerDidScrollDown",[t],r)):0>e&&(l(a.onScrollUp,t),diva.Events.publish("ViewerDidScrollUp",[t],r))},F=function(e,t,i,n,o){var r=function(e,t,i,n,o){if(f(t)){var r=document.createElement("img");r.src=i,r.style.width=n+"px",r.style.height=o+"px",document.getElementById(a.ID+"page-"+t).appendChild(r)}};a.pageTimeouts.push(window.setTimeout(r,a.rowLoadTimeout,e,t,i,n,o))},R=function(e){var t=a.currentPageIndex,i=t+e;if(!h(i))return!1;{var n=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop+a.panelHeight/2:document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth/2,o=document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth/2,d=!1;a.selector+"page-"+i}if(0>e?a.verticallyOriented?i>=0&&a.pageTopOffsets[i]+s(i,"h")+a.verticalPadding>=n&&(d=!0):i>=0&&a.pageLeftOffsets[i]+s(i,"w")+a.horizontalPadding>=n&&(d=!0):e>0&&(a.verticallyOriented?a.pageTopOffsets[t]+s(t,"h")+a.verticalPadding<n&&(d=!0):a.pageLeftOffsets[t]+s(t,"w")+a.horizontalPadding<n&&(d=!0)),a.inBookLayout&&a.verticallyOriented){var c=t+1;if(h(c)&&c%2===0&&a.pageLeftOffsets[c]<o&&c!==a.currentPageIndex){a.currentPageIndex=c;var u=a.pages[c].f;l(a.onSetCurrentPage,c,u),diva.Events.publish("VisiblePageDidChange",[c,u],r),console.log(c+1)}}if(d){if(a.currentPageIndex=i,0!==e&&!R(e)){var u=a.pages[i].f;l(a.onSetCurrentPage,i,u),diva.Events.publish("VisiblePageDidChange",[i,u],r)}return!0}return!1},Z=function(e){var t=Math.floor(a.currentPageIndex/a.pagesPerRow),i=t+parseInt(e,10),n=document.getElementById(a.ID+"outer").scrollTop,o=n+a.panelHeight/2,l=!1;if(0>e?i>=0&&(a.rowHeight*t>=o||a.rowHeight*i>=n)&&(l=!0):e>0&&a.rowHeight*(t+1)<n&&T(i)&&(l=!0),l){if(a.currentPageIndex=i*a.pagesPerRow,0!==e&&!Z(e)){var s=a.currentPageIndex,d=a.pages[s].f;diva.Events.publish("VisiblePageDidChange",[s,d],r)}return!0}return!1},W=function(e){var t=de(e,"top"),i=ce(e,"center");G(e,t,i)},G=function(e,t,i){i="undefined"!=typeof i?i:0,t="undefined"!=typeof t?t:0;var n=a.pageTopOffsets[e]+t,o=n-parseInt(a.panelHeight/2,10),s=a.pageLeftOffsets[e]+i,d=s-parseInt(a.panelWidth/2,10);if(a.outerObject.scrollTop(o),a.outerObject.scrollLeft(d),e!==a.currentPageIndex){a.currentPageIndex=e;var c=a.pages[e].f;l(a.onSetCurrentPage,e,c),diva.Events.publish("VisiblePageDidChange",[e,c],r)}l(a.onJump,e),diva.Events.publish("ViewerDidJump",[e],r)},N=function(e){var t=Math.floor(e/a.pagesPerRow),i=t*a.rowHeight;a.outerObject.scrollTop(i),a.currentPageIndex=e;var n=a.pages[e].f;diva.Events.publish("VisiblePageDidChange",[e,n],r)},V=function(){N(a.goDirectlyTo)},Y=function(e){return e>=a.minZoomLevel&&e<=a.maxZoomLevel?e:a.minZoomLevel},_=function(e){return e>=a.minPagesPerRow&&e<=a.maxPagesPerRow?e:a.maxPagesPerRow},X=function(){for(a.allTilesLoaded=[],a.outerObject.scrollTop(0),a.innerObject.empty(),a.firstPageLoaded=0,a.firstRowLoaded=-1,a.previousTopScroll=0,a.previousLeftScroll=0,clearTimeout(a.resizeTimer);a.pageTimeouts.length;)clearTimeout(a.pageTimeouts.pop())},U=function(){a.inGrid?K():Q()},q=function(e,t){var i,n=0,o=0;if(a.pageTopOffsets=[],a.pageLeftOffsets=[],a.inBookLayout)if(a.verticallyOriented)for(i=0;i<a.numPages;i++)if(a.pageTopOffsets[i]=n,i%2)a.pageLeftOffsets[i]=e/2-s(i,"w")-a.horizontalPadding;else{a.pageLeftOffsets[i]=e/2-a.horizontalPadding;var r=h(i-1)?Math.max(s(i,"h"),s(i-1,"h")):s(i,"h");n=a.pageTopOffsets[i]+r+a.verticalPadding}else for(i=0;i<a.numPages;i++){a.pageTopOffsets[i]=parseInt((t-s(i,"h"))/2,10),a.pageLeftOffsets[i]=o;var l=s(i,"w"),d=i%2?0:a.horizontalPadding;o=a.pageLeftOffsets[i]+l+d}else for(i=0;i<a.numPages;i++)a.pageTopOffsets[i]=parseInt(a.verticallyOriented?n:(t-s(i,"h"))/2,10),a.pageLeftOffsets[i]=parseInt(a.verticallyOriented?(e-s(i,"w"))/2:o,10),n=a.pageTopOffsets[i]+s(i,"h")+a.verticalPadding,o=a.pageLeftOffsets[i]+s(i,"w")+a.horizontalPadding},Q=function(){X(),a.zoomLevel=Y(a.zoomLevel);var e=a.zoomLevel;a.totalHeight=a.totalHeights[e]+a.verticalPadding*(a.numPages+1),a.totalWidth=a.totalWidths[e]+a.horizontalPadding*(a.numPages+1);var t=a.inBookLayout?2*(a.maxWidths[e]+a.horizontalPadding):a.maxWidths[e]+2*a.horizontalPadding,i=a.maxHeights[e]+2*a.verticalPadding,n=Math.max(t,a.panelWidth),o=Math.max(i,a.panelHeight),d=document.getElementById(a.ID+"inner");a.verticallyOriented?(d.style.height=Math.round(a.totalHeight)+"px",d.style.width=Math.round(n)+"px"):(d.style.height=Math.round(o)+"px",d.style.width=Math.round(a.totalWidth)+"px"),q(n,o);var c=a.numPages-1;if(a.inBookLayout)if(a.verticallyOriented){var u=c%2?s(c,"h"):Math.max(s(c,"h"),s(c-1,"h"));d.style.height=a.pageTopOffsets[c]+u+2*a.verticalPadding+"px"}else d.style.width=a.pageLeftOffsets[c]+s(c,"w")+2*a.horizontalPadding+"px";h(a.goDirectlyTo)||(a.goDirectlyTo=0),G(a.goDirectlyTo,a.verticalOffset,a.horizontalOffset);for(var g=!1,v=0;v<a.numPages;v++)if(p(v))m(v),a.lastPageLoaded=v,g=!0;else if(g)break;a.oldZoomLevel>=0?(a.oldZoomLevel<a.zoomLevel?(l(a.onZoomIn,e),diva.Events.publish("ViewerDidZoomIn",[e],r)):(l(a.onZoomOut,e),diva.Events.publish("ViewerDidZoomOut",[e],r)),l(a.onZoom,e)):a.oldZoomLevel=a.zoomLevel,a.scaleWait&&(a.scaleWait=!1);var f=a.pages[a.currentPageIndex].f;l(a.onDocumentLoaded,a.currentPageIndex,f),diva.Events.publish("DocumentDidLoad",[a.currentPageIndex,f],r)},K=function(){var e=a.currentPageIndex;a.verticalOffset=a.verticallyOriented?a.panelHeight/2:s(e,"h")/2,a.horizontalOffset=a.verticallyOriented?s(e,"w")/2:a.panelWidth/2,X(),a.pagesPerRow=_(a.pagesPerRow);var t=a.fixedPadding*(a.pagesPerRow+1),i=(a.panelWidth-t)/a.pagesPerRow;a.gridPageWidth=i,a.rowHeight=a.fixedHeightGrid?a.fixedPadding+a.minRatio*i:a.fixedPadding+a.maxRatio*i,a.numRows=Math.ceil(a.numPages/a.pagesPerRow),a.totalHeight=a.numRows*a.rowHeight+a.fixedPadding;var n=document.getElementById(a.ID+"inner");n.style.height=Math.round(a.totalHeight)+"px",n.style.width=Math.round(a.panelWidth)+"px",V();var o,r;a.pageTopOffsets=[],a.pageLeftOffsets=[];var l=a.numPages;for(o=0;l>o;o+=a.pagesPerRow)r=Math.floor(o/a.pagesPerRow),S(r)&&(a.firstRowLoaded=a.firstRowLoaded<0?r:a.firstRowLoaded,E(r),a.lastRowLoaded=r)},J=function(e){27==e.keyCode&&te()},$=function(t){if(a.outerObject.toggleClass("diva-fullscreen"),e("body").toggleClass("diva-hide-scrollbar"),a.parentObject.toggleClass("diva-full-width"),a.mobileWebkit){var i=parseInt(a.outerObject.css("margin-left"),10)-parseInt(e("body").css("margin-left"),10);a.outerObject.css("margin-left",i)}var n=a.panelHeight,o=a.panelWidth;if(fe(),a.oldZoomLevel>=0&&!a.inGrid){var s=a.panelHeight,d=a.panelWidth;a.inFullscreen?(a.verticalOffset-=(s-n)/2,a.horizontalOffset-=(d-o)/2):(a.verticalOffset+=(n-s)/2,a.horizontalOffset+=(o-d)/2)}t?(a.inGrid=!a.inGrid,ee()):U(),a.inFullscreen?e(document).on("keyup",J):e(document).off("keyup",J),l(a.onModeToggle,a.inFullscreen),diva.Events.publish("ModeDidSwitch",[a.inFullscreen],r)},ee=function(){return U(),l(a.onViewToggle,a.inGrid),diva.Events.publish("ViewDidSwitch",[a.inGrid],r),!0},te=function(){a.goDirectlyTo=a.currentPageIndex,a.inFullscreen=!a.inFullscreen,$(!1)},ie=function(e){switch(a.goDirectlyTo=a.currentPageIndex,e){case"document":a.inGrid=!1,a.inBookLayout=!1;break;case"book":a.inGrid=!1,a.inBookLayout=!0;break;case"grid":a.inGrid=!0,a.inBookLayout=!1;break;default:return!1}return ee()},ne=function(){return a.verticallyOriented=!a.verticallyOriented,a.verticalOffset=de(),a.horizontalOffset=ce(),a.goDirectlyTo=a.currentPageIndex,Q(),a.verticallyOriented},ae=function(t){var i=e(this).offset();a.doubleClickZoom=!0,a.horizontalOffset=t.pageX-i.left,a.verticalOffset=t.pageY-i.top,a.goDirectlyTo=parseInt(e(this).attr("data-index"),10);var n=t.ctrlKey?a.zoomLevel-1:a.zoomLevel+1;le(n)},oe=function(t){var i=parseInt(e(this).attr("data-index"),10);a.goDirectlyTo=i;var n=e(this).offset(),o=s(i,"w")/e(this).width();a.horizontalOffset=(t.pageX-n.left)*o,a.verticalOffset=(t.pageY-n.top)*o,a.inGrid=!1,ee()},re=function(t,i){var n=a.zoomLevel;if(t>100&&n<a.maxZoomLevel)n++;else{if(!(-100>t&&n>a.minZoomLevel))return;n--}a.scaleWait=!0;var o=e(this).offset();a.horizontalOffset=i.pageX-o.left,a.verticalOffset=i.pageY-o.top,a.goDirectlyTo=parseInt(e(this).attr("data-index"),10),le(n)},le=function(e){var t=Y(e);if(t!==e)return!1;var i=Math.pow(2,t-a.zoomLevel);return a.doubleClickZoom?(a.verticalOffset*=i,a.horizontalOffset*=i,a.doubleClickZoom=!1):(a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=i*ue(),a.horizontalOffset=i*ge()),a.oldZoomLevel=a.zoomLevel,a.zoomLevel=t,diva.Events.publish("ZoomLevelDidChange",[t],r),Q(),!0},se=function(e){var t=_(e);return t!==e?!1:(a.pagesPerRow=t,diva.Events.publish("GridRowNumberDidChange",[t],r),a.goDirectlyTo=a.currentPageIndex,K(),!0)},de=function(e,t){return e="undefined"==typeof e?a.currentPageIndex:e,"center"===t||"centre"===t?parseInt(s(e,"h")/2,10):"bottom"===t?parseInt(s(e,"h")-a.panelHeight/2,10):parseInt(a.panelHeight/2,10)},ce=function(e,t){return e="undefined"==typeof e?a.currentPageIndex:e,"left"===t?parseInt(a.panelWidth/2,10):"right"===t?parseInt(s(e,"w")-a.panelWidth/2,10):parseInt(s(e,"w")/2,10)},ue=function(){var e=document.getElementById(a.ID+"outer").scrollTop,t=a.panelHeight;return e-a.pageTopOffsets[a.currentPageIndex]+parseInt(t/2,10)},ge=function(){var e=document.getElementById(a.ID+"outer").scrollLeft,t=a.panelWidth;return e-a.pageLeftOffsets[a.currentPageIndex]+parseInt(t/2,10)},ve=function(){var e;e=a.inGrid?"g":a.inBookLayout?"b":"d";var t={f:a.inFullscreen,v:e,z:a.zoomLevel,n:a.pagesPerRow,i:a.enableFilename?a.pages[a.currentPageIndex].f:!1,p:a.enableFilename?!1:a.currentPageIndex+1,y:a.inGrid?!1:ue(),x:a.inGrid?!1:ge()};return t},he=function(){var e,t=ve(),i=[];for(e in t)t[e]!==!1&&i.push(e+a.hashParamSuffix+"="+t[e]);return i.join("&")},pe=function(){return location.protocol+"//"+location.host+location.pathname+"#"+he()},fe=function(){var e=document.getElementById(a.ID+"outer");return a.panelHeight=e.clientHeight-(e.scrollWidth>e.clientWidth?a.scrollbarWidth:0),a.panelWidth=e.clientWidth-(e.scrollHeight>e.clientHeight?a.scrollbarWidth:0),a.horizontalOffset=ge(),a.verticalOffset=ue(),G(a.currentPageIndex,a.verticalOffset,a.horizontalOffset),!0},me=function(){a.mobileWebkit||(a.outerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),a.innerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0})),a.outerObject.on("dblclick",".diva-document-page",function(e){ae.call(this,e)}),a.outerObject.on("contextmenu",".diva-document-page",function(e){return e.ctrlKey?(clearTimeout(a.singleClickTimeout),a.singleClick?(ae.call(this,e),a.singleClick=!1):(a.singleClick=!0,a.singleClickTimeout=setTimeout(function(){a.singleClick=!1},500)),!1):void 0}),a.outerObject.on("dblclick",".diva-row",function(t){oe.call(e(t.target).parent(),t)})},be=function(e,t,i,n){return Math.sqrt((e-t)*(e-t)+(i-n)*(i-n))},we=function(){a.innerObject.mouseover(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),a.innerObject.mouseout(function(){e(this).removeClass("diva-grab")}),a.innerObject.mousedown(function(){e(this).removeClass("diva-grab").addClass("diva-grabbing")}),a.innerObject.mouseup(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),me();var t=function(){var e,t=document.getElementById(a.ID+"outer").scrollTop,i=document.getElementById(a.ID+"outer").scrollLeft;e=a.verticallyOriented||a.inGrid?t-a.previousTopScroll:i-a.previousLeftScroll,a.inGrid?B(e):C(e),a.previousTopScroll=t,a.previousLeftScroll=i,a.horizontalOffset=ge(),a.verticalOffset=ue()};a.outerObject.scroll(t);var i=38,n=40,o=37,r=39,l=32,s=33,d=34,c=36,u=35;if(e(document).keydown(function(e){if(!a.isActiveDiva)return!0;if(a.enableSpaceScroll&&!e.shiftKey&&e.keyCode===l||a.enableKeyScroll&&e.keyCode===d)return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.panelHeight),!1;if(a.enableSpaceScroll||e.keyCode!==l||e.preventDefault(),a.enableKeyScroll)switch(e.keyCode){case s:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.panelHeight),!1;case i:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.arrowScrollAmount),!1;case n:return a.outerObject.scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.arrowScrollAmount),!1;case o:return a.outerObject.scrollLeft(document.getElementById(a.ID+"outer").scrollLeft-a.arrowScrollAmount),!1;case r:return a.outerObject.scrollLeft(document.getElementById(a.ID+"outer").scrollLeft+a.arrowScrollAmount),!1;case c:return a.outerObject.scrollTop(0),!1;case u:return a.outerObject.scrollTop(a.totalHeight),!1;default:return!0}return!0}),a.mobileWebkit){var g=[];g.push('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />'),g.push('<meta name="apple-mobile-web-app-capable" content="yes" />'),g.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />'),e("head").append(g.join("\n")),a.blockMobileMove&&e("body").bind("touchmove",function(e){var t=e.originalEvent;return t.preventDefault(),!1}),a.outerObject.kinetic({triggerHardware:!0});var v=[],h=[],p=0;a.outerObject.on("touchstart",".diva-document-page",function(e){2===e.originalEvent.touches.length&&(v=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY],p=be(v[2],v[0],v[3],v[1]))}),a.outerObject.on("touchmove",".diva-document-page",function(e){if(2===e.originalEvent.touches.length){
h=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY];var t=be(h[2],h[0],h[3],h[1]),i=t-p;a.scaleWait||(a.goDirectlyTo=a.currentPageIndex,a.inGrid?(a.inGrid=!1,ee()):re.call(this,i,e))}});var f={},m=0,b=function(t){if(a.singleTap){var i={pageX:t.originalEvent.changedTouches[0].clientX,pageY:t.originalEvent.changedTouches[0].clientY};m=be(f.pageX,i.pageX,f.pageY,i.pageY),50>m&&a.zoomLevel<a.maxZoomLevel&&(a.inGrid?oe.call(e(t.target).parent(),i):ae.call(this,i)),a.singleTap=!1,f={}}else a.singleTap=!0,f.pageX=t.originalEvent.changedTouches[0].clientX,f.pageY=t.originalEvent.changedTouches[0].clientY,a.singleTapTimeout=setTimeout(function(){a.singleTap=!1,f={}},250)};a.outerObject.on("touchend",".diva-document-page",b),a.outerObject.on("touchend",".diva-page",b);var w="onorientationchange"in window?"orientationchange":"resize";e(window).bind(w,function(e){var t=a.panelWidth,i=a.panelHeight;fe(),a.horizontalOffset-=(a.panelWidth-t)/2,a.verticalOffset-=(a.panelHeight-i)/2,a.goDirectlyTo=a.currentPageIndex,U()})}else e(window).resize(function(){fe(),clearTimeout(a.resizeTimer),a.resizeTimer=setTimeout(function(){a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=ue(),a.horizontalOffset=ge(),U()},200)});diva.Events.subscribe("PanelSizeDidChange",fe)},Ie=function(){var e="",t='<div class="diva-document-icon diva-button" id="'+a.ID+'document-icon" title="Document View"></div>',i='<div class="diva-book-icon diva-button" id="'+a.ID+'book-icon" title="Book View"></div>',n='<div class="diva-grid-icon diva-button" id="'+a.ID+'grid-icon" title="Grid View"></div>',o=document.getElementById(a.ID+"view-icon"),r=" diva-view-icon diva-button";o.className=a.inGrid?"diva-grid-icon"+r:a.inBookLayout?"diva-book-icon"+r:"diva-document-icon"+r;for(var l=0;1>l;l++)(a.inGrid||a.inBookLayout)&&(e+=t),a.inBookLayout||(e+=i),a.inGrid||(e+=n);document.getElementById(a.ID+"view-options").innerHTML=e},ye=function(){var t='<div id="'+a.ID+'view-menu" class="diva-view-menu"><div class="diva-view-icon diva-button" id="'+a.ID+'view-icon" title="Change view"></div><div id="'+a.ID+'view-options" class="diva-view-options"></div></div>',i=a.enableLinkIcon?'<div class="diva-link-icon diva-button" id="'+a.ID+'link-icon" style="'+(a.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"",n="slider"===a.enableZoomControls?'<input type="range" id="'+a.ID+'zoom-slider" class="zoom-slider" value="'+a.zoomLevel+'" min="'+a.minZoomLevel+'" max="'+a.maxZoomLevel+'">':"",o="buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-out-button" class="diva-zoom-out-button diva-button" title="Zoom Out"></div><div id="'+a.ID+'zoom-in-button" class="diva-zoom-in-button diva-button" title="Zoom In"></div>':"",r="slider"===a.enableGridControls?'<input type="range" id="'+a.ID+'grid-slider" class="grid-slider" value="'+a.pagesPerRow+'" min="'+a.minPagesPerRow+'" max="'+a.maxPagesPerRow+'">':"",l="buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-out-button" class="diva-grid-out-button diva-button" title="Zoom Out"></div><div id="'+a.ID+'grid-in-button" class="diva-grid-in-button diva-button" title="Zoom In"></div>':"",s=a.enableGotoPage?'<form id="'+a.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+a.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"",d="slider"===a.enableZoomControls?'<div id="'+a.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"",c="buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"",u="slider"===a.enableGridControls?'<div id="'+a.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"",g="buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"",v='<div class="diva-page-label">Page <span id="'+a.ID+'current-page">1</span> of <span id="'+a.ID+'num-pages">'+a.numPages+"</span></div>",p=a.enableFullscreen?'<div id="'+a.ID+'fullscreen" class="diva-fullscreen-icon diva-button" title="Toggle fullscreen mode"></div>':"",f='<div id="'+a.ID+'tools-left" class="diva-tools-left">'+n+o+r+l+d+c+u+g+'</div><div id="'+a.ID+'tools-right" class="diva-tools-right">'+p+i+t+'<div id="'+a.ID+'page-nav" class="diva-page-nav">'+s+v+"</div></div>";a.toolbarParentObject.prepend('<div id="'+a.ID+'tools" class="diva-tools">'+f+"</div>"),diva.Events.subscribe("ViewDidSwitch",Ie),Ie(),e(a.selector+"zoom-slider").on("input",function(e){var t=parseInt(this.value,10);le(t)}),e(a.selector+"zoom-slider").on("change",function(e){var t=parseInt(this.value,10);t!==a.zoomLevel&&le(t)});var m=function(e){le(a.zoomLevel+e)};e(a.selector+"zoom-out-button").click(function(){m(-1)}),e(a.selector+"zoom-in-button").click(function(){m(1)}),e(a.selector+"grid-slider").on("input",function(e){var t=parseInt(this.value,10);se(t)}),e(a.selector+"grid-slider").on("change",function(e){var t=parseInt(this.value,10);t!==a.zoomLevel&&se(t)}),e(a.selector+"fullscreen").click(function(){te()}),e(a.selector+"grid-out-button").click(function(){se(a.pagesPerRow-1)}),e(a.selector+"grid-in-button").click(function(){se(a.pagesPerRow+1)}),e(a.selector+"view-icon").click(function(){e(a.selector+"view-options").toggle()}),e(a.selector+"view-options").on("click",".diva-button",function(t){var i,n=t.target.classList[0];"diva-document-icon"===n?i="document":"diva-book-icon"===n?i="book":"diva-grid-icon"===n&&(i="grid"),diva.Events.publish("UserDidChooseView",[i]),e(a.selector+"view-options").hide()}),diva.Events.subscribe("UserDidChooseView",ie),e(document).mouseup(function(t){var i=e(a.selector+"view-options");i.is(t.target)||0!==i.has(t.target).length||t.target.id===a.ID+"view-icon"||i.hide()}),e(a.selector+"goto-page").submit(function(){var t=parseInt(e(a.selector+"goto-page-input").val(),10),i=t-1;return h(i)?a.inGrid?N(i):W(i):alert("Invalid page number"),!1});var b=e(a.selector+"link-icon");b.click(function(){if(e("body").prepend('<div id="'+a.ID+'link-popup" class="diva-popup diva-link-popup"><input id="'+a.ID+'link-popup-input" class="diva-input" type="text" value="'+pe()+'"/></div>'),a.inFullscreen)e(a.selector+"link-popup").addClass("in-fullscreen");else{var t=b.offset().left-222+b.outerWidth(),i=b.offset().top+b.outerHeight()-1;e(a.selector+"link-popup").removeClass("in-fullscreen").css({top:i+"px",left:t+"px"})}return e("body").mouseup(function(t){var i=t.target.id;i!==a.ID+"link-popup"&&i!==a.ID+"link-popup-input"&&e(a.selector+"link-popup").remove()}),a.outerObject.scroll(function(){e(a.selector+"link-popup").remove()}),e(a.selector+"link-popup input").click(function(){e(this).focus().select()}),!1});var w=a.inGrid?"grid":"zoom";e(a.selector+w+"-slider").show(),e(a.selector+w+"-out-button").show(),e(a.selector+w+"-in-button").show(),e(a.selector+w+"-slider-label").show(),e(a.selector+w+"-buttons-label").show();var I=function(){e(a.selector+"tools").toggleClass("diva-fullscreen-tools"),a.inFullscreen?e(a.selector+"tools-left").addClass("in-fullscreen"):e(a.selector+"tools-left").removeClass("in-fullscreen")},y=function(t){e(a.selector+w+"-slider").hide(),e(a.selector+w+"-out-button").hide(),e(a.selector+w+"-in-button").hide(),e(a.selector+w+"-slider-label").hide(),e(a.selector+w+"-buttons-label").hide(),w=a.inGrid?"grid":"zoom",e(a.selector+w+"-slider").show(),e(a.selector+w+"-out-button").show(),e(a.selector+w+"-in-button").show(),e(a.selector+w+"-slider-label").show(),e(a.selector+w+"-buttons-label").show()},x={updateCurrentPage:function(){document.getElementById(a.ID+"current-page").textContent=parseInt(a.currentPageIndex,10)+1},setNumPages:function(e){document.getElementById(a.ID+"num-pages").textContent=e},updateZoomSlider:function(){a.zoomLevel!==e(a.selector+"zoom-slider").val()&&e(a.selector+"zoom-slider").val(a.zoomLevel),document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateZoomButtons:function(){document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateGridSlider:function(){a.pagesPerRow!==e(a.selector+"grid-slider").val()&&e(a.selector+"grid-slider").val(a.pagesPerRow),document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},updateGridButtons:function(){document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},closePopups:function(){e(".diva-popup").css("display","none")},switchView:y,switchMode:I};return x},xe=function(){if(window.divaPlugins){var t=[];e.each(window.divaPlugins,function(e,i){var n=i.pluginName[0].toUpperCase()+i.pluginName.substring(1);if(a["enable"+n]){var o=i.init(a,r);if(!o)return;var l=i.titleText||n+" plugin";if("function"==typeof i.handleClick){t.push('<div class="diva-'+i.pluginName+'-icon" title="'+l+'"></div>');var s=a.mobileWebkit?"touchend":"click";a.outerObject.on(s,".diva-"+i.pluginName+"-icon",function(e){i.handleClick.call(this,e,a,r)})}a.plugins.push(i)}}),t.length&&(a.pageTools='<div class="diva-page-tools">'+t.join("")+"</div>")}},Pe=function(){clearTimeout(a.throbberTimeoutID),e(a.selector+"throbber").hide()},Le=function(e){var t=e;switch(t){case"d":a.inGrid=!1,a.inBookLayout=!1;break;case"b":a.inGrid=!1,a.inBookLayout=!0;break;case"g":a.inGrid=!0,a.inBookLayout=!1}},De=function(e){var t=function(e,t){return e/Math.pow(2,t)},i=function(e,t){var i=Math.max(e,t);return Math.ceil(Math.log((i+1)/257)/Math.log(2))},n=function(e,t){for(var i=e.length;i--;)e[i]=t};diva.Events.publish("ManifestDidLoad",[e],this);var o=e.sequences[0];a.documentPaged="paged"===e.viewingHint||"paged"===o.viewingHint;for(var r,l,s,d,c,u,g,v,h=o.canvases,p=new Array(h.length),f=new Array(h.length),m=e.label,b=0,w=h.length;w>b;b++){r=h[b].width,l=h[b].height,g=h[b].images[0].resource,s=g.service["@id"],"/"!==s.slice(-1)&&(s+="/"),d=i(r,l),c=h[b].label;var I="non-paged"!==h[b].viewingHint;u=g.service["@context"],v="http://iiif.io/api/image/2/context.json"===u?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===u?1.1:1,f[b]={mx_w:r,mx_h:l,mx_z:d,fn:c,url:s,api:v,paged:I},p[b]=d}var y=Math.min.apply(Math,p),x=0,P=100,L=new Array(y+1),D=new Array(y+1),O=new Array(y+1),C=new Array(y+1),T=new Array(y+1);n(L,0),n(D,0),n(O,0),n(C,0),n(T,0);var S,k,E,z=[],j=f.length;for(b=0;j>b;b++){S=[];for(var M=0;y+1>M;M++){k=Math.floor(t(f[b].mx_w,y-M)),E=Math.floor(t(f[b].mx_h,y-M)),S[M]={h:E,w:k},L[M]+=k,D[M]+=E,O[M]=Math.max(k,O[M]),C[M]=Math.max(E,C[M]);var H=f[b].mx_h/f[b].mx_w;x=Math.max(H,x),P=Math.min(H,P)}z[b]={d:S,m:f[b].mx_z,f:f[b].fn,url:f[b].url,api:f[b].api,paged:f[b].paged}}var A=[],B=[];for(b=0;y+1>b;b++)A.push(L[b]/f.length),B.push(D[b]/f.length);var F={a_wid:A,a_hei:B,max_w:O,max_h:C,max_ratio:x,min_ratio:P,t_hei:D,t_wid:L},R={item_title:m,dims:F,max_zoom:y,pgs:z};return R},Oe=function(e,t,i){Pe();var n='<div id="'+a.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+t+" "+i+"</p>",o=0===a.objectData.lastIndexOf("http",0);if(o&&""===i){var r=a.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0];location.hostname!==r&&(n+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>')}n+="</div>",a.outerObject.append(n)},Ce=function(t){var i;if(!t.hasOwnProperty("@context")||-1===t["@context"].indexOf("iiif")&&-1===t["@context"].indexOf("shared-canvas")?i=t:(a.isIIIF=!0,i=De(t)),Pe(),a.pages=i.pgs,a.maxRatio=i.dims.max_ratio,a.minRatio=i.dims.min_ratio,a.itemTitle=i.item_title,a.numPages=i.pgs.length,a.maxWidths=i.dims.max_w,a.maxHeights=i.dims.max_h,a.averageWidths=i.dims.a_wid,a.averageHeights=i.dims.a_hei,a.totalHeights=i.dims.t_hei,a.totalWidths=i.dims.t_wid,a.realMaxZoom=i.max_zoom,a.maxZoomLevel=a.maxZoomLevel>=0&&a.maxZoomLevel<=i.max_zoom?a.maxZoomLevel:i.max_zoom,a.minZoomLevel=a.minZoomLevel>=0&&a.minZoomLevel<=a.maxZoomLevel?a.minZoomLevel:0,a.zoomLevel=Y(a.zoomLevel),a.minPagesPerRow=Math.max(2,a.minPagesPerRow),a.maxPagesPerRow=Math.max(a.minPagesPerRow,a.maxPagesPerRow),a.enableFilename){var n=e.getHashParam("i"+a.hashParamSuffix),o=d(n);h(o)&&(a.goDirectlyTo=o,a.currentPageIndex=o)}else{var r=parseInt(e.getHashParam("p"+a.hashParamSuffix),10)-1;h(r)&&(a.goDirectlyTo=r,a.currentPageIndex=r)}if(diva.Events.publish("NumberOfPagesDidChange",[a.numPages],this),a.enableAutoTitle&&(e(a.selector+"title").length?e(a.selector+"title").html(a.itemTitle):a.parentObject.prepend('<div id="'+a.ID+'title" class="diva-title">'+a.itemTitle+"</div>")),h(parseInt(a.goDirectlyTo),10)||(a.goDirectlyTo=0),a.adaptivePadding>0){var l=a.zoomLevel;a.horizontalPadding=parseInt(a.averageWidths[l]*a.adaptivePadding,10),a.verticalPadding=parseInt(a.averageHeights[l]*a.adaptivePadding,10)}else a.horizontalPadding=a.fixedPadding,a.verticalPadding=a.fixedPadding;a.pageTools.length&&(a.verticalPadding=Math.max(40,a.verticalPadding)),a.documentPaged&&(a.inBookLayout=!0);var s=e.getHashParam("v"+a.hashParamSuffix);Le(s)},Te=function(){var t='<div id="'+a.ID+'throbber" class="diva-throbber"></div>';a.outerObject.append(t),a.throbberTimeoutID=setTimeout(function(){e(a.selector+"throbber").show()},a.throbberTimeout),e.ajax({url:a.objectData,cache:!0,dataType:"json",error:Oe,success:function(t,i,n){Ce(t),e.each(a.plugins,function(e,t){l(t.setupHook,a)}),a.enableToolbar&&(a.toolbar=ye(),diva.Events.subscribe("VisiblePageDidChange",a.toolbar.updateCurrentPage),diva.Events.subscribe("ModeDidSwitch",a.toolbar.switchMode),diva.Events.subscribe("ViewDidSwitch",a.toolbar.switchView),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomButtons),diva.Events.subscribe("GridRowNumberDidChange",a.toolbar.updateGridSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateGridButtons),diva.Events.subscribe("NumberOfPagesDidChange",a.toolbar.setNumPages)),a.parentObject.parent()[0]===document.body&&(a.parentObject.siblings().not("#diva-canvas-backdrop")[0]||(a.divaIsFullWindow=!0)),fe();var o=parseInt(e.getHashParam("y"+a.hashParamSuffix),10);a.verticalOffset=isNaN(o)?de(a.currentPageIndex,"top"):o;var s=parseInt(e.getHashParam("x"+a.hashParamSuffix),10);a.horizontalOffset=isNaN(s)?ce(a.currentPageIndex,"center"):s,a.inFullscreen?$(!1):U(),fe(),l(a.onReady,a),diva.Events.publish("ViewerDidLoad",[a],r),a.loaded=!0}})},Se=function(){return a.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)},ke=function(){a.scrollbarWidth=e.getScrollbarWidth(),a.mobileWebkit=void 0!==window.orientation,a.ID=e.generateId("diva-"),a.selector="#"+a.ID;var t=parseInt(a.ID,10);t>1&&(a.hashParamSuffix=t),a.parentObject.append('<div id="'+a.ID+'outer" class="diva-outer"></div>'),a.outerObject=e(a.selector+"outer"),a.outerObject.append('<div id="'+a.ID+'inner" class="diva-inner diva-dragger"></div>'),a.innerObject=e(a.selector+"inner");var i=parseInt(e.getHashParam("n"+a.hashParamSuffix),10);i>=a.minPagesPerRow&&i<=a.maxPagesPerRow&&(a.pagesPerRow=i);var n=e.getHashParam("z"+a.hashParamSuffix);""!==n&&(n=parseInt(n,10),n>=a.minZoomLevel&&(a.zoomLevel=n));var o=e.getHashParam("f"+a.hashParamSuffix),r="true"===o;a.inFullscreen=a.inFullscreen&&"false"!==o||r,Te(),xe(),we()};ke(),this.getItemTitle=function(){return a.itemTitle},this.gotoPageByNumber=function(e,t,i){var n=parseInt(e,10)-1;return h(n)?(G(n,de(n,i),ce(n,t)),!0):!1},this.gotoPageByIndex=function(e,t,i){return e=parseInt(e,10),h(e)?(G(e,de(e,i),ce(e,t)),!0):!1},this.getCurrentPage=function(){return console.warn("The call to getCurrentPage is deprecated. Use getCurrentPageIndex instead."),a.currentPageIndex},this.getNumberOfPages=function(){return Se()?a.numPages:!1},this.getPageDimensionsAtZoomLevel=function(e,t){if(!Se())return!1;t>a.maxZoomLevel&&(t=a.maxZoomLevel);var i=a.pages[parseInt(e,10)],n=i.d[parseInt(t,10)];return{width:n.w,height:n.h}},this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(a.currentPageIndex,a.zoomLevel)},this.isReady=function(){return a.loaded},this.getCurrentPageIndex=function(){return a.currentPageIndex},this.getCurrentPageFilename=function(){return a.pages[a.currentPageIndex].f},this.getCurrentPageNumber=function(){return a.currentPageIndex+1},this.getFilenames=function(){for(var e=[],t=0;t<a.numPages;t++)e[t]=a.pages[t].f;return e},this.getZoomLevel=function(){return a.zoomLevel},this.getMaxZoomLevel=function(){return a.maxZoomLevel},this.getMaxZoomLevelForPage=function(e){return Se?a.pages[e].m:!1},this.getMinZoomLevel=function(){return a.minZoomLevel},this.setZoomLevel=function(e){return a.inGrid&&(a.goDirectlyTo=a.currentPageIndex,a.inGrid=!1,ee()),le(e)},this.zoomIn=function(){return this.setZoomLevel(a.zoomLevel+1)},this.zoomOut=function(){return this.setZoomLevel(a.zoomLevel-1)},this.inViewport=function(e,t,i,n,o){var r=e-1,l=a.pageTopOffsets[r]+i,s=l+o,d=a.pageLeftOffsets[r]+t,g=d+n;return u(l,s)&&c(d,g)},this.isPageInViewport=function(e){return p(e)},this.isPageLoaded=function(e){return f(e)},this.toggleFullscreenMode=function(){te()},this.closePopups=function(){a.toolbar.closePopups()},this.enterFullscreenMode=function(){return a.inFullscreen?!1:(te(),!0)},this.leaveFullscreenMode=function(){return a.inFullscreen?(te(),!0):!1},this.changeView=function(e){return ie(e)},this.enterGridView=function(){return a.inGrid?!1:(ie("grid"),!0)},this.leaveGridView=function(){return a.inGrid?(a.goDirectlyTo=a.currentPageIndex,a.inGrid=!1,ee(),!0):!1},this.gotoPageByName=function(e,t,i){var n=d(e);return h(n)?(G(n,de(n,i),ce(n,t)),!0):!1},this.getPageIndex=function(e){return d(e)},this.getCurrentURL=function(){return pe()},this.getURLHash=function(){return he()},this.getState=function(){return ve()},this.getInstanceSelector=function(){return a.selector},this.getInstanceId=function(){return a.ID},this.getSettings=function(){return a},this.translateFromMaxZoomLevel=function(e){var t=a.maxZoomLevel-a.zoomLevel;return e/Math.pow(2,t)},this.translateToMaxZoomLevel=function(e){var t=a.maxZoomLevel-a.zoomLevel;return 0===t?e:e*Math.pow(2,t)},this.setState=function(e){var t;t=d(e.i),h(t)?a.goDirectlyTo=t:h(e.p)&&(a.goDirectlyTo=e.p);var i=parseInt(e.x,10),n=parseInt(e.y,10);e.z>=a.minZoomLevel&&e.z<=a.maxZoomLevel&&(a.zoomLevel=e.z),e.n>=a.minPagesPerRow&&e.n<=a.maxPagesPerRow&&(a.pagesPerRow=e.n),a.inFullscreen!==e.f?(Le(e.v),a.inFullscreen=e.f,$(!1),a.horizontalOffset=i,a.verticalOffset=n,G(t,a.verticalOffset,a.horizontalOffset)):(a.horizontalOffset=i,a.verticalOffset=n,"g"===e.v&&(!a.inGrid||a.inBookLayout)||"d"===e.v&&(a.inGrid||a.inBookLayout)||"b"===e.v&&!a.inBookLayout?(Le(e.v),ee()):U())},this.enableScrollable=function(){a.isScrollable||(me(),a.enableKeyScroll=a.initialKeyScroll,a.enableSpaceScroll=a.initialSpaceScroll,a.outerObject.css("overflow","auto"),a.isScrollable=!0)},this.disableScrollable=function(){a.isScrollable&&(a.innerObject.hasClass("diva-dragger")&&a.innerObject.unbind("mousedown"),a.outerObject.unbind("dblclick"),a.outerObject.unbind("contextmenu"),a.outerObject.css("overflow","hidden"),a.initialKeyScroll=a.enableKeyScroll,a.initialSpaceScroll=a.enableSpaceScroll,a.enableKeyScroll=!1,a.enableSpaceScroll=!1,a.isScrollable=!1)},this.toggleOrientation=function(){return ne()},this.getPageOffset=function(e){return{top:parseInt(a.pageTopOffsets[e]),left:parseInt(a.pageLeftOffsets[e])}},this.getCurrentPageOffset=function(){return this.getPageOffset(a.currentPageIndex)},this.getPageDimensionsAtCurrentGridLevel=function(e){e=h(e)?e:a.currentPageIndex;var t=a.rowHeight-a.fixedPadding,i=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*s(e,"w")/s(e,"h"):a.gridPageWidth;return{height:parseInt(t,10),width:parseInt(i,10)}},this.getPageIndexForPageXYValues=function(e,t){var i=document.getElementById(a.ID+"outer"),n=i.getBoundingClientRect(),o=n.top,r=n.left,l=n.bottom,s=n.right;if(r>e||e>s)return!1;if(o>t||t>l)return!1;for(var d=document.getElementsByClassName("diva-page"),c=d.length;c--;){var u=d[c],g=u.getBoundingClientRect();if(!(e<g.left||e>g.right||t<g.top||t>g.bottom))return u.getAttribute("data-index")}return!1},this.isVerticallyOriented=function(){return a.verticallyOriented},this.changeObject=function(t){a.loaded=!1,X(),a.throbberTimeoutID=setTimeout(function(){e(a.selector+"throbber").show()},a.throbberTimeout),a.objectData=t,e.ajax({url:a.objectData,cache:!0,dataType:"json",error:Oe,success:function(e,t,i){Ce(e),Pe(),U(),a.loaded=!0}})},this.activate=function(){a.isActiveDiva=!0},this.deactivate=function(){a.isActiveDiva=!1},this.destroy=function(){e("body").removeClass("diva-hide-scrollbar"),a.parentObject.empty().removeData("diva"),e.each(a.plugins,function(e,t){l(t.destroy,a,r)}),a.parentObject.removeAttr("style").removeAttr("class"),diva.Events.unsubscribeAll()}};e.fn.diva=function(i){return this.each(function(){if(i.parentObject=e(this),!i.parentObject.data("diva")){var n=new t(this,i);i.parentObject.data("diva",n)}})}}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,n){function a(e){return Math.log(e)/Math.log(10)}var o,r,l,s,d;n.startScrolling=function(){return i.currentlyAutoScrolling?void console.warn("You are trying to start autoscrolling, but it is already scrolling."):(e("#"+i.ID+"autoscroll-toggle").text("Turn off"),r&&n.disableScrollable(),i.currentlyAutoScrolling=!0,void restartScrollingInterval())},restartScrollingInterval=function(){clearInterval(i.autoScrollInterval),i.autoScrollInterval=i.verticallyOriented?setInterval(function(){i.outerObject.scrollTop(i.outerObject.scrollTop()+o)},l):setInterval(function(){i.outerObject.scrollLeft(i.outerObject.scrollLeft()+o)},l)},n.stopScrolling=function(){return i.currentlyAutoScrolling?(e("#"+i.ID+"autoscroll-toggle").text("Turn on"),r&&n.enableScrollable(),i.currentlyAutoScrolling=!1,void clearInterval(i.autoScrollInterval)):void console.warn("You are trying to stop autoscrolling, but it is not currently active.")},n.toggleScrolling=function(){i.currentlyAutoScrolling?n.stopScrolling():n.startScrolling()},n.changeRefresh=function(e){l=e,c()},n.changeScrollSpeed=function(t){d=t,c(),e("#"+i.ID+"autoscroll-pps").val(a(d)),i.currentlyAutoScrolling&&restartScrollingInterval()};var c=function(){l=s,o=d/(1e3/l),1>o&&(l*=1/o,o=d/(1e3/l))};if(n.disableManualScroll=function(){r=!0,i.currentlyAutoScrolling&&n.disableScrollable()},n.enableManualScroll=function(){r=!1,i.currentlyAutoScrolling&&n.enableScrollable()},i.currentlyAutoScrolling=!1,i.autoScrollInterval="",r=i.disableManualScroll||!1,l=i.autoScrollRefresh||50,s=l,n.changeScrollSpeed(i.scrollSpeed||10),e(window).on("keyup",function(e){e.shiftKey&&32===e.keyCode&&n.toggleScrolling()}),!i.disableAutoscrollPrefs){var u=function(n){if(i.inFullscreen){var a=e(i.selector+"tools"),o=a.css("right");t.jqObj.css({right:o,"margin-right":0,top:a.offset().top+a.outerHeight()+15})}else t.jqObj.css({right:e(window).width()-(i.outerObject.offset().left+i.outerObject.outerWidth())+i.scrollbarWidth,"margin-right":".6em"}),t.jqObj.offset({top:i.outerObject.offset().top+1})};diva.Events.subscribe("ModeDidSwitch",u),diva.Events.subscribe("ViewerDidLoad",function(o){var r="<div id='"+i.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+i.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+a(d)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+i.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+i.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";e("#"+i.ID+"page-nav").before("<div id='"+i.ID+"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>"),e("body").prepend(r),e("#"+i.ID+"autoscroll-pps").on("change",function(e){n.changeScrollSpeed(Math.pow(10,e.target.value))}),e("#"+i.ID+"autoscroll-manual").on("change",function(e){e.target.checked?n.enableManualScroll():n.disableManualScroll()}),e("#"+i.ID+"autoscroll-toggle").on("click",n.toggleScrolling),e("#"+i.ID+"autoscroll-icon").on("click",function(n){t.jqObj=e("#"+i.ID+"autoscroll-prefs"),"none"===t.jqObj.css("display")?(t.jqObj.css({display:"block"}),u(i.inFullscreen)):t.jqObj.css("display","none")})})}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t,i,n,a={},o={},r={},l={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,onInit:null,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},s=function(e){return e*Math.PI/180},d=function(e,t){var n=e.x-a.centerX,o=-(e.y-a.centerY),r=s(i.rotation.previous-t),l=Math.cos(r)*n-Math.sin(r)*o+a.centerX,d=-(Math.sin(r)*n+Math.cos(r)*o)+a.centerY;return{x:l,y:d}},c=function(e,i){var n=e.context,a=e.size/2,o=-(e.width/2),r=-(e.height/2);n.clearRect(0,0,e.size,e.size),n.save(),n.translate(a,a),n.rotate(s(i)),n.drawImage(t,o,r,e.width,e.height),n.restore(),e.data=n.getImageData(0,0,e.size,e.size)},u=function(){var e;for(e in i)if(i[e].current!==i[e].previous)return!0;return!1},g=function(){var e;for(e in i)i[e].previous=i[e].current},v=function(){c(o,i.rotation.current),m(o)},h=function(){var t=i.rotation.current,n=i.rotation.previous,o=i.zoom.current,l=i.zoom.previous;if(t!==n||o!==l){var s=e("#diva-canvas-wrapper").scrollLeft(),v=e("#diva-canvas-wrapper").scrollTop(),h=r.viewport.width/2,p=r.viewport.height/2,f=d({x:s+h,y:v+p},t),b=Math.pow(2,o-l),w=b*f.x-h,I=b*f.y-p;c(a,t),e("#diva-canvas-wrapper").scrollLeft(w),e("#diva-canvas-wrapper").scrollTop(I)}u()&&(m(a),g())},p=function(e){var t,i,n=e.data,a=e.context.createImageData(n),o=a.data;for(t=0,i=o.length;i>t;t++)o[t]=n.data[t];return a},f=function(e){var t=i[e].current!==i[e].previous,n=i[e].current!==i[e].initial;return t||n},m=function(e){var t,n,a,o,l,s,d,c,u=p(e),g=u.data,v=i.brightness.current,h=i.contrast.current,m=1+Math.min(r.brightnessMax,Math.max(r.brightnessMin,v))/r.brightnessMax,b=m*h,w=128-128*h,I=i.red.current,y=i.green.current,x=i.blue.current,P=f("red"),L=f("green"),D=f("blue"),O=f("brightness"),C=f("contrast"),T=O||C;for(t=0,a=u.width;a>t;t++)for(n=0,o=u.height;o>n;n++)l=4*(n*a+t),s=g[l],d=g[l+1],c=g[l+2],s+d+c>0&&(P&&s&&(s+=I),L&&d&&(d+=y),D&&c&&(c+=x),T&&(s&&(s=s*b+w),d&&(d=d*b+w),c&&(c=c*b+w)),g[l]=s,g[l+1]=d,g[l+2]=c);e.context.clearRect(0,0,a,o),e.context.putImageData(u,0,0)},b=function(){var t=e("#diva-canvas-wrapper").scrollLeft()*o.scaleFactor,i=e("#diva-canvas-wrapper").scrollTop()*o.scaleFactor,n=Math.min(Math.round(r.viewport.height*o.scaleFactor),r.mapSize)-4,a=Math.min(Math.round(r.viewport.width*o.scaleFactor),r.mapSize)-4;e("#diva-map-viewbox").height(n).width(a).css({top:i,left:t})},w=function(t){o.canvas=document.getElementById("diva-canvas-minimap"),o.size=r.mapSize,o.canvas.width=o.size,o.canvas.height=o.size,o.context=o.canvas.getContext("2d"),o.context.fillRect(0,0,o.size,o.size),o.scaleFactor=r.mapSize/a.size,o.cornerX=a.cornerX*o.scaleFactor,o.cornerY=a.cornerY*o.scaleFactor,o.width=t.width*o.scaleFactor,o.height=t.height*o.scaleFactor,o.context.drawImage(t,o.cornerX,o.cornerY,o.width,o.height),o.data=o.context.getImageData(0,0,r.mapSize,r.mapSize),e("#diva-map-viewbox").show(),b()},I=function(i,n){t=new Image,t.crossOrigin="anonymous",t.onload=function(){a.size=Math.sqrt(t.width*t.width+t.height*t.height),a.canvas=document.getElementById("diva-canvas"),a.canvas.width=a.size,a.canvas.height=a.size,a.cornerX=(a.size-t.width)/2,a.cornerY=(a.size-t.height)/2,a.width=t.width,a.height=t.height,a.centerX=a.size/2,a.centerY=a.size/2,a.context=a.canvas.getContext("2d"),a.context.drawImage(t,a.cornerX,a.cornerY,a.width,a.height);try{a.data=a.context.getImageData(0,0,a.size,a.size)}catch(i){var o='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+i.message+"</p>";if("SecurityError"!==i.name)throw i;o+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div>',o+="</div>",e("#diva-canvas-backdrop").append(o),D()}void 0===n&&w(t),v(),h(a),D(),"function"==typeof n&&n.call(n)},t.src=i,(t.complete||void 0===t.complete)&&(t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.src=i)},y=function(){var t=i[n],a=t.current,o=t.transform?t.transform(a):a;e("#diva-canvas-value").html(o)},x=function(){e("#diva-canvas-slider").val(i[n].current)},P=function(e){var t,i=r.zoomWidthRatio*Math.pow(2,e),n=r.imageDir+"/",a=r.selectedPageIndex;if(r.isIIIF){var o=r.pages[a].api>1.1?"default":"native";t=encodeURI(r.pages[a].url+"full/"+i+",/0/"+o+".jpg")}else t=r.iipServerURL+"?FIF="+n+r.filename+"&WID="+i+"&CVT=JPEG";return t},L=function(){(i.zoom.current>0||r.mobileWebkit)&&e(r.selector+"throbber").addClass("canvas-throbber").show()},D=function(){e(r.selector+"throbber").removeClass("canvas-throbber").hide()},O=function(){var e,t={},n=!1,a=r.localStoragePrefix+r.filename;for(e in i)i[e].previous!==i[e].initial&&(t[e]=i[e].previous,n=!0);n?(r.pluginIcon.addClass("new"),localStorage.setObject(a,t)):(r.pluginIcon.removeClass("new"),localStorage.removeItem(a))},C=function(e,t){r.zoomLevel=e;var i=P(e);I(i,function(){o.scaleFactor=o.size/a.size,b(),O()})},T=function(t){var i=38,n=40,a=37,o=39;switch(t.keyCode){case i:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-r.arrowScrollAmount),!1;case n:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+r.arrowScrollAmount),!1;case a:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-r.arrowScrollAmount),!1;case o:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+r.arrowScrollAmount),!1}},S={init:function(t,s){var d=!!window.HTMLCanvasElement;if(!d)return!1;e.extend(r,l,t.canvasPlugin),r.inCanvas=!1,r.iipServerURL=t.iipServerURL,r.imageDir=t.imageDir,r.selector=t.selector,r.mobileWebkit=t.mobileWebkit,r.arrowScrollAmount=t.arrowScrollAmount,i={contrast:{initial:1,min:r.contrastMin,max:r.contrastMax,step:r.contrastStep,transform:function(e){return e.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:r.brightnessMin,max:r.brightnessMax,step:r.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(e){return e+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the blue channel"}};var c=function(){var e,t,n;for(n in i)t=i[n],e=t.initial,t.current=e,t.previous=e};if(c(),e("#diva-canvas-backdrop").length)return!0;var g,p,f,m,w=[];for(m in r.buttons)p=r.buttons[m],
f=i[p].title,g='<div class="'+p+'" title="'+f+'"></div>',w.push(g);var I=w.join(""),P='<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+I+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>',S='<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div>',k='<div id="diva-canvas-backdrop">'+P+S+"</div>";e("body").append(k),r.mapSize=e("#diva-canvas-minimap").width(),e("#diva-canvas-buttons div").click(function(){e("#diva-canvas-buttons .clicked").removeClass("clicked"),E(e(this).attr("class"))});var E=function(t){n=t;var a=i[n];e("#diva-canvas-buttons ."+n).addClass("clicked"),e("#diva-canvas-mode").text(n);var o=a.current,r=a.transform?a.transform(o):o,l=document.getElementById("diva-canvas-slider");l.min=a.min,l.max=a.max,l.step=a.step,e("#diva-canvas-slider").val(o),e("#diva-canvas-value").html(r)};return E("contrast"),e("#diva-canvas-slider").on("input",function(e){i[n].current=parseFloat(this.value),y(),v()}),e("#diva-canvas-reset-all").click(function(){var e;for(e in i)i[e].current=i[e].initial;y(),x(),v()}),e("#diva-canvas-reset").click(function(){i[n].current=i[n].initial,y(),x(),v()}),e("#diva-canvas-apply").click(function(){u()&&(L(),setTimeout(function(){i.zoom.current!==i.zoom.previous?C(i.zoom.current):(h(),D(),O())},r.throbberTimeout))}),e("#diva-canvas-close").click(function(){e("body").removeClass("overflow-hidden"),a.context.clearRect(0,0,a.size,a.size),o.context.clearRect(0,0,o.size,o.size),e("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0),e("#diva-canvas-backdrop").hide(),e("#diva-map-viewbox").hide(),D(),s.enableScrollable(),e(document).off("keydown",T),c(),y(),x(),e("#diva-canvas-buttons .clicked").removeClass("clicked"),E("contrast"),diva.Events.publish("CanvasViewDidHide")}),e("#diva-canvas-minimise").click(function(){e("#diva-canvas-toolwindow").slideToggle("fast")}),e(window).resize(function(){r.viewport={height:window.innerHeight-t.scrollbarWidth,width:window.innerWidth-t.scrollbarWidth},r.inCanvas&&b()}),e("#diva-canvas-wrapper").scroll(function(){r.inCanvas&&b()}),e("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(t){var i=e("#diva-canvas-minimap").offset(),n=(t.pageX-i.left)/o.scaleFactor,a=(t.pageY-i.top)/o.scaleFactor;e("#diva-canvas-wrapper").scrollTop(a-r.viewport.height/2),e("#diva-canvas-wrapper").scrollLeft(n-r.viewport.width/2)}),e("#diva-canvas").mousedown(function(){e(this).addClass("grabbing")}).mouseup(function(){e(this).removeClass("grabbing")}),r.mobileWebkit?e("#diva-canvas-wrapper").kinetic():e("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0}),"function"==typeof r.onInit&&r.onInit.call(this,r),!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(e){r.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},r.minZoomLevel=e.minZoomLevel,r.maxZoomLevel=e.maxZoomLevel,r.mobileWebkit&&(r.maxZoomLevel=Math.min(r.maxZoomLevel,r.mobileWebkitMaxZoom)),i.zoom.min=r.minZoomLevel,i.zoom.max=r.maxZoomLevel},handleClick:function(t,a,o){var l,s=e(this).parent().parent(),d=e(s).attr("data-filename"),c=e(s).attr("data-index"),u=e(s).width()-1,g=a.zoomLevel;r.zoomWidthRatio=u/Math.pow(2,g),r.pluginIcon=e(this),r.pages=a.pages,r.isIIIF=a.isIIIF,r.selectedPageIndex=c,r.mobileWebkit&&(g=Math.min(r.maxZoomLevel,g)),r.filename=d,i.zoom.initial=g,i.zoom.current=g;var v=localStorage.getObject(r.localStoragePrefix+r.filename);if(v)for(l in v)i[l].current=v[l],l===n&&(y(),x()),"zoom"===l&&(g=v[l]);i.zoom.previous=g,e("body").addClass("overflow-hidden"),e("#diva-canvas-backdrop").show(),o.disableScrollable(),e(document).keydown(T),r.inCanvas=!0;var h=P(g);e("#diva-canvas-info").text(e(s).attr("title")),L(),diva.Events.publish("CanvasViewDidActivate",[s]),I(h)},onPageLoad:function(t,i,n){var a=r.localStoragePrefix+i;null!==localStorage.getItem(a)&&e(n).find(".diva-canvas-icon").addClass("new")},destroy:function(t,i){e("#diva-canvas-backdrop").remove()}};return S}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(e,t){return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(t,i){var n,a=e(this).parent().parent(),o=e(a).attr("data-filename"),r=e(a).attr("data-index"),l=e(a).width()-1;if(i.isIIIF){var s=i.pages[r].api>1.1?"default":"native";n=encodeURI(i.pages[r].url+"full/"+l+",/0/"+s+".jpg")}else n=i.iipServerURL+"?FIF="+i.imageDir+"/"+o+"&WID="+l+"&CVT=JPEG";window.open(n)}};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){function i(i,n,a){var l=e.parentObject.data("highlights");if("undefined"!=typeof l){if(l.hasOwnProperty(i)){for(var s=document.getElementById(e.ID+"page-"+i).getElementsByClassName(e.ID+"highlight");s[0];)s[0].parentNode.removeChild(s[0]);var d,c=t.getInstanceId()+"page-"+i,u=document.getElementById(c),g=l[i].regions,v=l[i].colour,h=l[i].divClass,p=t.getMaxZoomLevel();if(e.inGrid){var f=t.getPageDimensionsAtZoomLevel(i,p).width,m=u.clientWidth,b=f/m;d=Math.log(b)/Math.log(2)}else d=p-t.getZoomLevel();for(var w=g.length;w--;){var I=document.createElement("div");I.style.width=r(g[w].width,d)+"px",I.style.height=r(g[w].height,d)+"px",I.style.top=r(g[w].uly,d)+"px",I.style.left=r(g[w].ulx,d)+"px",I.style.background=v,I.style.border="1px solid #555",I.style.position="absolute",I.style.zIndex=100,I.className=h,"undefined"!=typeof g[w].divID&&I.setAttribute("data-highlight-id",g[w].divID),u.appendChild(I)}}o(),diva.Events.publish("HighlightCompleted",[i,n,a])}}e.parentObject.data("highlights",{});var n,a,o=function(){var i,o=e.ID+"selected-highlight",r=document.getElementsByClassName(o);for(i=0;i<r.length;i++)box=r[i],box.id!=n&&(box.className=box.className.replace(" "+o,""),box.style.border="1px solid #555");if(t.isPageLoaded(a))for(boxes=document.querySelectorAll("*[data-highlight-id="+n+"]"),i=0;i<boxes.length;i++)box=boxes[i],box.className=box.className+" "+o,box.style.border="2px solid #000"};diva.Events.subscribe("PageDidLoad",i);var r=function(e,t){return e/Math.pow(2,t)};t.resetHighlights=function(){for(var t=document.getElementById(e.ID+"inner"),i=e.ID+"highlight",n=t.getElementsByClassName(i),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}e.parentObject.data("highlights",{})},t.removeHighlightsOnPage=function(i){var n=e.parentObject.data("highlights");if(n.hasOwnProperty(i)){for(var a=t.getInstanceId()+"page-"+i,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=n[i].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete n[i]}},t.highlightOnPages=function(e,i,n,a){for(var o=e.length;o--;)t.highlightOnPage(e[o],i[o],n,a)},t.highlightOnPage=function(n,a,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.2)"),r="undefined"==typeof r?e.ID+"highlight":e.ID+"highlight "+r;var l=(t.getMaxZoomLevel(),e.parentObject.data("highlights"));return l[n]={regions:a,colour:o,divClass:r},t.isPageLoaded(n)&&i(n,null,null),!0},t.gotoHighlight=function(t){var i=e.parentObject.data("highlights");if(null!==document.getElementById(t)){for(var n=parseInt(document.getElementById(t).parentNode.getAttribute("data-index"),10),a=i[n].regions.length;a--;)if(i[n].regions[a].divID===t)return l(n,i[n].regions[a])}else for(var o=Object.keys(i),r=o.length;r--;)for(var s=i[o[r]].regions,d=s.length;d--;)if(s[d].divID===t)return l(o[r],s[d]);return console.warn("Diva just tried to find a highlight that doesn't exist."),!1};var l=function(i,r){var l=parseFloat(r.uly)+parseFloat(r.height)/2,s=parseFloat(r.ulx)+parseFloat(r.width)/2,d=t.translateFromMaxZoomLevel(l),c=t.translateFromMaxZoomLevel(s);i=parseInt(i,10),t.gotoPageByIndex(i);var u=t.getSettings().outerObject,g=u.scrollTop()+d-u.height()/2+e.verticalPadding,v=u.scrollLeft()+c-u.width()/2+e.horizontalPadding;return u.scrollTop(g),u.scrollLeft(v),n=r.divID,a=i,diva.Events.publish("SelectedHighlightChanged",[n,a]),o(),n},s=function(i){return t.translateFromMaxZoomLevel(e.verticallyOriented?parseFloat(i.uly)+parseFloat(i.height)/2:parseFloat(i.ulx)+parseFloat(i.width)/2)},d=function(i){var o,r,d,c,u,g,v,h,p,f,m=e.parentObject.data("highlights"),b=!1;if(n&&a){for(d=a,c=m[d].regions,u=c.length;u--;)if(c[u].divID==n){p=c[u],r=s(p);break}for(u=c.length,g=t.getPageDimensionsAtZoomLevel(d,t.getZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,f=i?function(e,t,i){return e>t&&i>e}:function(e,t,i){return t>e&&e>i};u--;)p=c[u],v=s(p),p.divID!=n&&f(v,r,o)&&(b=!0,o=v,h=p);if(b)return l(d,h)}else d=0,r=0;var w,I=Object.keys(m),y=I.indexOf(d);for(w=i?y==I.length-1?I[0]:I[y+1]:0===y?I[I.length-1]:I[y-1],c=m[w].regions,u=c.length,g=t.getPageDimensionsAtZoomLevel(w,t.getMaxZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,f=i?function(e,t){return t>e}:function(e,t){return e>t};u--;)p=c[u],v=s(p),f(v,o)&&(b=!0,o=v,h=p);return l(w,h)};return t.gotoNextHighlight=function(){return d(!0)},t.gotoPreviousHighlight=function(){return d(!1)},!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"};return e}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,n){function a(e,a,r){var l=i.parentObject.data("highlights");if("undefined"!=typeof l&&t.highlightsVisible){if(l.hasOwnProperty(e)){var s,d=n.getInstanceId()+"page-"+e,c=document.getElementById(d),u=l[e].regions,g=l[e].colour,v=l[e].divClass,h=n.getMaxZoomLevel();if(i.inGrid){var p=n.getPageDimensionsAtZoomLevel(e,h).width,f=c.clientWidth,m=p/f;s=Math.log(m)/Math.log(2)}else s=h-n.getZoomLevel();for(var b=u.length;b--;){var w=document.createElement("div");w.style.width=o(u[b].width,s)+"px",w.style.height=o(u[b].height,s)+"px",w.style.top=o(u[b].uly,s)+"px",w.style.left=o(u[b].ulx,s)+"px",w.style.background=g,w.style.border="1px solid #555",w.style.position="absolute",w.style.zIndex=100,w.className=v,"undefined"!=typeof u[b].name&&w.setAttribute("data-name",u[b].name),"undefined"!=typeof u[b].divID&&(w.id=u[b].divID),c.appendChild(w)}}diva.Events.publish("HighlightCompleted",[e,a,r])}}i.parentObject.data("highlights",{}),t.highlightedPages=[],diva.Events.subscribe("PageWillLoad",a);var o=function(e,t){return e/Math.pow(2,t)};n.resetHighlights=function(){for(var e=document.getElementById(i.ID+"inner"),t=i.ID+"highlight",n=e.getElementsByClassName(t),a=n.length;a--;){var o=n[a].parentNode;o.removeChild(n[a])}i.parentObject.data("highlights",{})},n.removeHighlightsOnPage=function(e){var t=i.parentObject.data("highlights");if(t.hasOwnProperty(e)){for(var a=n.getInstanceId()+"page-"+e,o=document.getElementById(a),r=o.getElementsByTagName("div"),l=t[e].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete t[e]}},n.hideHighlights=function(){t.highlightsVisible=!1;for(var e=i.ID+"highlight",n=document.getElementById(i.ID+"inner"),a=n.getElementsByClassName(e),o=a.length;o--;){var r=a[o].parentNode;r.removeChild(a[o])}},n.showHighlights=function(){t.highlightsVisible=!0;for(var e,n=document.getElementById(i.ID+"inner"),o=n.getElementsByClassName("diva-document-page"),r=0;r<o.length;r++){e=parseInt(o[r].getAttribute("data-index"),10);var s=i.parentObject.data("highlights");s.hasOwnProperty(e)?a(e,null,null):l(e)}},n.highlightOnPages=function(e,t,i,a){for(var o=e.length;o--;)n.highlightOnPage(e[o],t[o],i,a)},n.highlightOnPage=function(e,t,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.1)"),r="undefined"==typeof r?i.ID+"highlight":i.ID+"highlight "+r;var l=(n.getMaxZoomLevel(),i.parentObject.data("highlights"));return l[e]={regions:t,colour:o,divClass:r},n.isPageLoaded(e)&&a(e,null,null),!0},n.gotoHighlight=function(e){var t,a,o,r,l=i.parentObject.data("highlights"),s=!1;if(null!==document.getElementById(e)){t=parseInt(document.getElementById(e).parentNode.getAttribute("data-index"),10);for(var d=l[t].regions.length;d--;)if(l[t].regions[d].divID===e){a=l[t].regions[d],o=parseFloat(a.uly)+parseFloat(a.height)/2,r=parseFloat(a.ulx)+parseFloat(a.width)/2,s=!0;break}}else for(var c=Object.keys(l),u=c.length;u--;){for(var g=l[c[u]].regions,v=g.length;v--;)if(g[v].divID===e){t=c[u],a=g[v],o=parseFloat(a.uly)+parseFloat(a.height)/2,r=parseFloat(a.ulx)+parseFloat(a.width)/2,s=!0;break}if(s)break}if(!s)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;var h=n.getSettings().outerObject,p=n.translateFromMaxZoomLevel(o),f=n.translateFromMaxZoomLevel(r);n.gotoPageByIndex(t);var m=h.scrollTop()+p-h.height()/2+i.verticalPadding,b=h.scrollLeft()+f-h.width()/2+i.horizontalPadding;return h.scrollTop(m),h.scrollLeft(b),i.currentHighlight=e,!0};var r=function(e){return function(i,a,o){for(var r=i,l=i.length,s=[],d=0;l>d;d++){var c=r[d],u=c.resource.chars,g=c.on,v=g.slice(g.indexOf("#xywh=")+6),h=v.split(","),p={ulx:parseInt(h[0],10),uly:parseInt(h[1],10),width:parseInt(h[2],10),height:parseInt(h[3],10),name:u};s.push(p)}n.highlightOnPage(e,s),t.highlightedPages.push(e)}},l=function(i){var n=t.manifest.sequences[0].canvases;if(n[i].hasOwnProperty("otherContent"))for(var a=n[i].otherContent,o=0;o<a.length;o++)"sc:AnnotationList"===a[o]["@type"]&&e.ajax({url:a[o]["@id"],cache:!0,dataType:"json",success:r(i)})},s=function(e){t.manifest=e};diva.Events.subscribe("ManifestDidLoad",s),diva.Events.subscribe("PageWillLoad",function(e){if(t.highlightsVisible){for(var i=0;i<t.highlightedPages.length;i++)if(t.highlightedPages[i]===e)return;l(e,t.manifest)}});var d=[];return i.innerObject.on("mouseenter","."+i.ID+"highlight",function(e){var t=e.target,i=t.dataset.name,n=document.createElement("div");n.style.top=t.offsetTop+t.offsetHeight-1+"px",n.style.left=t.style.left,n.style.background="#fff",n.style.border="1px solid #555",n.style.position="absolute",n.style.zIndex=101,n.className="annotation-overlay",n.textContent=i,t.parentNode.appendChild(n),d.push(n)}),i.innerObject.on("mouseleave","."+i.ID+"highlight",function(e){for(;d.length;){var t=d.pop();t.parentNode.removeChild(t)}}),diva.Events.subscribe("ViewerDidLoad",function(){e("#"+i.ID+"page-nav").before('<div id="'+i.ID+'annotations-icon" class="diva-button diva-annotations-icon" title="Turn annotations on or off"></div>'),e(i.selector+"annotations-icon").addClass("annotations-icon-active"),e("#"+i.ID+"annotations-icon").on("click",function(a){t.highlightsVisible?(n.hideHighlights(),e(i.selector+"annotations-icon").removeClass("annotations-icon-active")):(n.showHighlights(),e(i.selector+"annotations-icon").addClass("annotations-icon-active"))})}),t.highlightsVisible=!0,!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(t,i){var n=function(i){var n=function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),n=i.replace("_"," ");return 0===t.indexOf("http://")&&(t='<a href="'+t+'" target="_blank">'+t+"</a>"),'<div class="metadata-row"><span class="metadata-label">'+n+':</span> <span class="metadata-value">'+t+"</span></div>"},a=function(e,t){for(var i=0;i<e.length;i++)if(e[i]["@language"]===t)return e[i]["@value"]},o=function(e){for(var t="",o=0;o<e.length;o++){var r=e[o];if(i.hasOwnProperty(r))if(i[r].constructor===Array){var l=a(i[r],"en");t+=n(r,l)}else t+=n(r,i[r])}return t},r='<div id="'+t.ID+'metadata" class="diva-modal">';if(r+=o(["label"]),i.hasOwnProperty("metadata"))for(var l=i.metadata,s=0;s<l.length;s++)if(l[s].value.constructor===Array){var d=a(l[s].value,"en");r+=n(l[s].label,d)}else r+=n(l[s].label,l[s].value);r+=o(["description","within","see_also","service","license","attribution"]),r+="</div>",t.parentObject.prepend(r),e(t.selector+"metadata").hide()};return diva.Events.subscribe("ManifestDidLoad",n),t.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+t.ID+'metadata-link" class="diva-metadata-link">Details</a></div>'),e(t.selector+"metadata-link").on("click",function(i){e(t.selector+"metadata").fadeToggle("fast")}),!0},destroy:function(e,t){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){void 0===e.pageAliases&&(e.pageAliases={}),void 0===e.pageAliasFunction&&(e.pageAliasFunction=function(){return!1}),t.getAliasForPageIndex=function(t){return e.pageAliases[t]||e.pageAliasFunction(t)||t+1},t.getPageIndexForAlias=function(i){for(var n=0;n<e.numPages;n++)if(t.getAliasForPageIndex(n)==i)return n;return!1},t.getPageIndicesForAlias=function(i){for(var n=[],a=0;a<e.numPages;a++)t.getAliasForPageIndex(a)==i&&n.push(a);return n},t.getCurrentAliasedPageIndex=function(){return t.getAliasForPageIndex(e.currentPageIndex)},t.gotoPageByAliasedNumber=function(e,i,n){return t.gotoPageByIndex(t.getPageIndexForAlias(e),i,n)},updateCurrentAliasedPage=function(){document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex()},initialChanges=function(){var e=this.getSettings(),t=e.numPages;void 0!==e.newTotalPages?t=e.newTotalPages:void 0!==e.totalPageOffset&&(t+=e.totalPageOffset),document.getElementById(this.getSettings().ID+"num-pages").textContent=t,document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex(),diva.Events.unsubscribe(["VisiblePageDidChange",e.toolbar.updateCurrentPage]),diva.Events.subscribe("VisiblePageDidChange",updateCurrentAliasedPage)},diva.Events.subscribe("ViewerDidLoad",initialChanges)},pluginName:"pagealias",titleText:"Re-aliases page indexes"};return e}())}(jQuery);
>>>>>>> refs/heads/openings
//# sourceMappingURL=diva.min.js.map