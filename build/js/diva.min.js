Storage.prototype.setObject=function(b,e){this.setItem(b,JSON.stringify(e))};Storage.prototype.getObject=function(b){return(b=this.getItem(b))&&JSON.parse(b)};(function(b){var e=1;b.generateId=function(b){var c;do c=e++ +(b?"-"+b:"");while(document.getElementById(c));return c}})(jQuery);
(function(b){b.getScrollbarWidth=function(){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";var d=document.createElement("div");d.style.position="absolute";d.style.top="0px";d.style.left="0px";d.style.visibility="hidden";d.style.width="200px";d.style.height="150px";d.style.overflow="hidden";d.appendChild(b);document.body.appendChild(d);var c=b.offsetWidth;d.style.overflow="scroll";b=b.offsetWidth;c==b&&(b=d.clientWidth);document.body.removeChild(d);return c-b}})(jQuery);
(function(b){b.getHashParam=function(b){var d=window.location.hash;if(""!==d){var c=0<d.indexOf("&"+b+"=")?d.indexOf("&"+b+"="):d.indexOf("#"+b+"=");if(0<=c)return c+=b.length+2,b=d.indexOf("&",c),b>c?d.substring(c,b):0>b?d.substring(c):""}return!1}})(jQuery);
(function(b){b.updateHashParam=function(e,d){var c=b.getHashParam(e),a=window.location.hash;if(c!==d)if("string"==typeof c){var l=0<a.indexOf("&"+e+"=")?a.indexOf("&"+e+"="):a.indexOf("#"+e+"="),c=l+e.length+2+c.length,f=0===l?"#":"&";window.location.replace(a.substring(0,l)+f+e+"="+d+a.substring(c))}else 0===a.length?window.location.replace("#"+e+"="+d):window.location.replace(a+"&"+e+"="+d)}})(jQuery);
(function(b){b.fn.dragscrollable=function(e){var d=b.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},e||{}),c={mouseDownHandler:function(a){if(1!=a.which||!a.data.acceptPropagatedEvent&&a.target!=this)return!1;a.data.lastCoord={left:a.clientX,top:a.clientY};b.event.add(document,"mouseup",c.mouseUpHandler,a.data);b.event.add(document,"mousemove",c.mouseMoveHandler,a.data);if(a.data.preventDefault)return a.preventDefault(),!1},mouseMoveHandler:function(a){var b=a.clientX-
a.data.lastCoord.left,c=a.clientY-a.data.lastCoord.top;a.data.scrollable.scrollLeft(a.data.scrollable.scrollLeft()-b);a.data.scrollable.scrollTop(a.data.scrollable.scrollTop()-c);a.data.lastCoord={left:a.clientX,top:a.clientY};if(a.data.preventDefault)return a.preventDefault(),!1},mouseUpHandler:function(a){b.event.remove(document,"mousemove",c.mouseMoveHandler);b.event.remove(document,"mouseup",c.mouseUpHandler);if(a.data.preventDefault)return a.preventDefault(),!1}};this.each(function(){var a={scrollable:b(this),
acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};b(this).find(d.dragSelector).bind("mousedown",a,c.mouseDownHandler)})}})(jQuery);
(function(b){var e={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:0.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}};window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}());b.support=b.support||{};b.extend(b.support,{touch:"ontouchend"in document});var d=function(){return!1},c=function(a,b){return 0===Math.floor(Math.abs(a))?0:a*b},a=function(a,b){var c=a;0<a?a>b&&(c=b):a<0-b&&(c=0-b);return c},l=function(a,b){this.removeClass(a.movingClass.up).removeClass(a.movingClass.down).removeClass(a.movingClass.left).removeClass(a.movingClass.right).removeClass(a.deceleratingClass.up).removeClass(a.deceleratingClass.down).removeClass(a.deceleratingClass.left).removeClass(a.deceleratingClass.right);
0<a.velocity&&this.addClass(b.right);0>a.velocity&&this.addClass(b.left);0<a.velocityY&&this.addClass(b.down);0>a.velocityY&&this.addClass(b.up)},f=function(a,b){b.velocity=0;b.velocityY=0;b.decelerate=!0;"function"===typeof b.stopped&&b.stopped.call(a,b)},m=function(a,b){var d=a[0];b.x&&0<d.scrollWidth?(d.scrollLeft=b.scrollLeft=d.scrollLeft+b.velocity,0<Math.abs(b.velocity)&&(b.velocity=b.decelerate?c(b.velocity,b.slowdown):b.velocity)):b.velocity=0;b.y&&0<d.scrollHeight?(d.scrollTop=b.scrollTop=
d.scrollTop+b.velocityY,0<Math.abs(b.velocityY)&&(b.velocityY=b.decelerate?c(b.velocityY,b.slowdown):b.velocityY)):b.velocityY=0;l.call(a,b,b.deceleratingClass);"function"===typeof b.moved&&b.moved.call(a,b);0<Math.abs(b.velocity)||0<Math.abs(b.velocityY)?window.requestAnimationFrame(function(){m(a,b)}):f(a,b)},s=function(a,c){var d=b.kinetic.callMethods[a],e=Array.prototype.slice.call(arguments);d&&this.each(function(){var a=e.slice(1),c=b(this).data("kinetic-settings");a.unshift(c);d.apply(this,
a)})},w=function(a,c){b.support.touch?a.bind("touchstart",c.events.touchStart).bind("touchend",c.events.inputEnd).bind("touchmove",c.events.touchMove):a.mousedown(c.events.inputDown).mouseup(c.events.inputEnd).mousemove(c.events.inputMove);a.click(c.events.inputClick).scroll(c.events.scroll).bind("selectstart",d).bind("dragstart",c.events.dragStart)},n=function(c){this.addClass("kinetic-active").each(function(){var d=this,f=b(this);if(!f.data("kinetic-settings")){var h=b.extend({},e,c),n,s=!1,t,x=
!1,r=!1,G=1E3/h.throttleFPS,I,z;h.velocity=0;h.velocityY=0;var N=function(){r=t=n=!1};b(document).mouseup(N).click(N);var g=function(){h.velocity=a(s-n,h.maxvelocity);h.velocityY=a(x-t,h.maxvelocity)},q=function(a){return b.isFunction(h.filterTarget)?!1!==h.filterTarget.call(d,a):!0},p=function(a,c){if(!I||new Date>new Date(I.getTime()+G))I=new Date,r&&(n||t)&&(z&&(b(z).blur(),z=null,f.focus()),h.decelerate=!1,h.velocity=h.velocityY=0,f[0].scrollLeft=h.scrollLeft=h.x?f[0].scrollLeft-(a-n):f[0].scrollLeft,
f[0].scrollTop=h.scrollTop=h.y?f[0].scrollTop-(c-t):f[0].scrollTop,s=n,x=t,n=a,t=c,g(),l.call(f,h,h.movingClass),"function"===typeof h.moved&&h.moved.call(f,h))};h.events={touchStart:function(a){var b;if(q(a.target)){b=a.originalEvent.touches[0];var c=b.clientX;b=b.clientY;r=!0;h.velocity=s=0;h.velocityY=x=0;n=c;t=b;a.stopPropagation()}},touchMove:function(a){var b;r&&(b=a.originalEvent.touches[0],p(b.clientX,b.clientY),a.preventDefault&&a.preventDefault())},inputDown:function(a){if(q(a.target)){var b=
a.clientX,c=a.clientY;r=!0;h.velocity=s=0;h.velocityY=x=0;n=b;t=c;z=a.target;"IMG"===a.target.nodeName&&a.preventDefault();a.stopPropagation()}},inputEnd:function(a){n&&s&&!1===h.decelerate&&(h.decelerate=!0,g(),n=s=r=!1,m(f,h));z=null;a.preventDefault&&a.preventDefault()},inputMove:function(a){r&&(p(a.clientX,a.clientY),a.preventDefault&&a.preventDefault())},scroll:function(a){"function"===typeof h.moved&&h.moved.call(f,h);a.preventDefault&&a.preventDefault()},inputClick:function(a){if(0<Math.abs(h.velocity))return a.preventDefault(),
!1},dragStart:function(a){if(z)return!1}};w(f,h);f.data("kinetic-settings",h).css("cursor",h.cursor);h.triggerHardware&&f.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};b.kinetic={settingsKey:"kinetic-settings",callMethods:{start:function(a,c){var d=b(this);if(a=b.extend(a,c))a.decelerate=!1,m(d,a)},end:function(a,c){b(this);a&&(a.decelerate=!0)},stop:function(a,c){var d=b(this);f(d,a)},detach:function(a,c){var e=b(this);b.support.touch?
e.unbind("touchstart",a.events.touchStart).unbind("touchend",a.events.inputEnd).unbind("touchmove",a.events.touchMove):e.unbind("mousedown",a.events.inputDown).unbind("mouseup",a.events.inputEnd).unbind("mousemove",a.events.inputMove).unbind("scroll",a.events.scroll);e.unbind("click",a.events.inputClick).unbind("selectstart",d);e.unbind("dragstart",a.events.dragStart);e.removeClass("kinetic-active").css("cursor","")},attach:function(a,c){var d=b(this);w(d,a);d.addClass("kinetic-active").css("cursor",
"move")}}};b.fn.kinetic=function(a){"string"===typeof a?s.apply(this,arguments):n.call(this,a);return this}})(window.jQuery||window.Zepto);
var diva=function(){var b={};return{Events:{publish:function(e,d,c){if(b[e]){e=b[e];for(var a=e.length;a--;)e[a].apply(c||this,d||[])}},subscribe:function(e,d){b[e]||(b[e]=[]);b[e].push(d);return[e,d]},unsubscribe:function(e,d){var c=e[0],a=b[c].length;if(b[c])for(;a--;)b[c][a]===e[1]&&(b[c].splice(a,1),d&&delete b[c])},unsubscribeAll:function(){b={}}}}}(),multiDiva,multiDivaController=function(){var b;$(document).on("click",function(e){a:{var d=$(e.target);e=d.find(".diva-outer");d=d.closest(".diva-outer");
if(!(0<e.length))if(0<d.length)e=d;else break a;e.parent().data("diva").activate();b=e.parent();for(d=$(".diva-outer").length;d--;)$($(".diva-outer")[d]).attr("id")!=e.attr("id")&&$($(".diva-outer")[d]).parent().data("diva").deactivate()}});this.getActive=function(){return b}};diva.Events.subscribe("ViewerDidLoad",function(b){1<$(".diva-outer").length&&(this.deactivate(),multiDiva||(multiDiva=new multiDivaController))});window.divaPlugins=[];
(function(b){var e=function(d,c){var a=b.extend({},{adaptivePadding:0.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iiifServerURL:"",iipServerURL:"",inFullscreen:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,
minPagesPerRow:2,minZoomLevel:0,onDocumentLoaded:null,onModeToggle:null,onViewToggle:null,onJump:null,onPageLoad:null,onPageLoaded:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onSetCurrentPage:null,onZoom:null,onZoomIn:null,onZoomOut:null,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentSelector:c.parentSelector,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},c);b.extend(a,{allTilesLoaded:[],averageHeights:[],
averageWidths:[],currentPageIndex:0,divaIsFullWindow:!1,doubleClickZoom:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerSelector:"",isActiveDiva:!0,isScrollable:!0,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerSelector:"",pages:[],pageLeftOffsets:[],pageTopOffsets:[],
pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0});var e=this,f=function(a){var b=!0;return function(a){var A,c,d;if("function"===typeof a){A=[];c=1;for(d=arguments.length;c<d;c++)A.push(arguments[c]);b&&
(console.warn('The use of callback functions is deprecated. Use diva.Events.subscribe("Event", function) instead.'),b=!1);a.apply(e,A);return!0}return!1}}(),m=function(A,b){return a.pages[A].d[a.zoomLevel][b]},s=function(A){var b,c=a.numPages;for(b=0;b<c;b++)if(a.pages[b].f===A)return b;return-1},w=function(A,k){var c=b("#"+a.ID+"outer").scrollLeft()-a.viewportMargin,d=c+a.panelWidth+2*a.viewportMargin;return A>=c&&A<=d||A<=c&&k>=d||k>=c&&k<=d},n=function(A,k){var c=b("#"+a.ID+"outer").scrollTop()-
a.viewportMargin,d=c+a.panelHeight+2*a.viewportMargin;return A>=c&&A<=d||A<=c&&k>=d||k>=c&&k<=d},v=function(b){return 0<=b&&b<a.numPages},F=function(b){var k=a.pageTopOffsets[b],c=k+m(b,"h")+a.verticalPadding,d=a.pageLeftOffsets[b];b=d+m(b,"w")+a.horizontalPadding;return n(k,c)&&w(d,b)},P=function(b){if(!document.getElementById(a.ID+"page-"+b)||!a.allTilesLoaded[b]){var k=a.pages[b].f,c=m(b,"w"),d=m(b,"h"),g=a.pageTopOffsets[b]+a.verticalPadding,q=a.pageLeftOffsets[b]+a.horizontalPadding,B=a.selector+
"page-"+b,h;if(!document.getElementById(a.ID+"page-"+b)){var C=document.getElementById(a.ID+"inner"),p=document.createElement("div");p.id=a.ID+"page-"+b;p.classList.add("diva-document-page");p.setAttribute("data-index",b);p.setAttribute("data-filename",k);p.title="Page "+(b+1);p.innerHTML=a.pageTools;p.style.width=c+"px";p.style.height=d+"px";a.verticallyOriented?(p.style.top=g+"px",p.classList.add("diva-page-vertical")):(p.style.left=q+"px",p.classList.add("diva-page-horizontal"));C.appendChild(p);
f(a.onPageLoad,b,k,B);diva.Events.publish("PageWillLoad",[b,k,B],e);for(h in a.plugins)f(a.plugins[h].onPageLoad,b,k,B)}a.pageTimeouts.push(setTimeout(function(b){var A=document.getElementById(a.ID+"page-"+b);if(F(b)){var g=a.imageDir+"/",q=Math.ceil(m(b,"h")/a.tileWidth),p=Math.ceil(m(b,"w")/a.tileHeight),J=a.pages[b].m,h=a.iipServerURL+"?FIF="+g+k+"&JTL=",g=!0,C=0,pa=d-(q-1)*a.tileHeight,qa=c-(p-1)*a.tileWidth,u,E,W,S,ea,s,t,Q;u=a.zoomLevel+J-a.realMaxZoom;h=a.iiifServerURL?a.iiifServerURL+"/"+
k+"/":h+u+",";if(a.iiifServerURL){var v=Math.pow(2,J-u);t=a.tileHeight*v;Q=a.tileWidth*v}else t=a.tileHeight,Q=a.tileWidth;for(J=0;J<q;){for(u=0;u<p;){S=J*a.tileHeight;ea=u*a.tileWidth;E=J===q-1?pa:a.tileHeight;W=u===p-1?qa:a.tileWidth;s=a.iiifServerURL?h+u*Q+","+J*t+","+W*v+","+E*v+"/"+W+","+E+"/0/native.jpg":h+C;if(!document.getElementById(a.ID+"tile-"+b+"-"+C)){var r=void 0,y=void 0;a.verticallyOriented?(r=a.pageTopOffsets[b]+J*a.tileHeight+a.verticalPadding,y=a.pageLeftOffsets[b]+u*a.tileWidth):
(r=a.pageTopOffsets[b]+J*a.tileHeight,y=a.pageLeftOffsets[b]+u*a.tileWidth+a.horizontalPadding);var D=y+a.tileWidth;n(r,r+a.tileHeight)&&w(y,D)?(r=document.createElement("div"),r.id=a.ID+"tile-"+b+"-"+C,r.classList.add("diva-document-tile"),r.style.display="inline",r.style.position="absolute",r.style.top=S+"px",r.style.left=ea+"px",r.style.backgroundImage="url('"+s+"')",r.style.height=E+"px",r.style.width=W+"px",A.appendChild(r)):g=!1}C++;u++}J++}a.allTilesLoaded[b]=g;f(a.onPageLoaded,b,k,B);diva.Events.publish("PageDidLoad",
[b,k,B],e)}}(b),a.pageLoadTimeout))}},h=function(b){b=document.getElementById(a.ID+"page-"+b);if(null!==b){for(;b.firstChild;)b.removeChild(b.firstChild);b.parentNode.removeChild(b)}},U=function(b){if(a.verticallyOriented){b=a.pageTopOffsets[b]+m(b,"h")+a.verticalPadding;var k=document.getElementById(a.ID+"outer").scrollTop}else b=a.pageLeftOffsets[b]+m(b,"w")+a.horizontalPadding,k=document.getElementById(a.ID+"outer").scrollLeft;return b=b<k},M=function(b){if(a.verticallyOriented){b=a.pageTopOffsets[b];
var k=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight}else b=a.pageLeftOffsets[b],k=document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth;return b=b>k},t=function(b,k){0<k?v(b)&&(F(b)?(P(b),a.lastPageLoaded=b,t(a.lastPageLoaded+1,k)):U(b)&&t(b+1,k)):v(b)&&(F(b)?(P(b),a.firstPageLoaded=b,t(a.firstPageLoaded-1,k)):M(b)&&t(b-1,k))},x=function(b,k){0<k?v(b)&&U(b)&&(h(b),a.firstPageLoaded=b+1,x(a.firstPageLoaded,k)):v(b)&&M(b)&&(h(b),a.lastPageLoaded=b-1,x(a.lastPageLoaded,k))},r=
function(b){return 0<=b&&b<a.numRows},G=function(b){b*=a.rowHeight;return n(b,b+a.rowHeight+a.fixedPadding)},I=function(b){if(!document.getElementById(a.ID+"row-"+b)){var k=a.rowHeight*b+a.fixedPadding,c=document.getElementById(a.ID+"inner"),d=document.createElement("div");d.id=a.ID+"row-"+b;d.classList.add("diva-row");d.style.height=a.rowHeight+"px";d.style.top=k+"px";c.appendChild(d);for(var g,f,B,q,p,h,u=a.imageDir+"/",E=a.pagesPerRow,c=0;c<E;c++){g=b*a.pagesPerRow+c;if(!v(g))break;f=a.pages[g].f;
B=m(g,"w");q=m(g,"h");p=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*B/q:a.gridPageWidth;B=a.fixedHeightGrid?a.rowHeight-a.fixedPadding:p/B*q;q=parseInt(c*(a.fixedPadding+a.gridPageWidth)+a.fixedPadding,10);p=parseInt(p,10);B=parseInt(B,10);q+=a.fixedHeightGrid?(a.gridPageWidth-p)/2:0;h=a.iiifServerURL?encodeURI(a.iiifServerURL+"/"+f+"/full/"+p+","+B+"/0/native.jpg"):encodeURI(a.iipServerURL+"?FIF="+u+f+"&HEI="+(B+2)+"&CVT=JPEG");a.pageTopOffsets[g]=k;a.pageLeftOffsets[g]=q;var n=document.createElement("div");
n.id=a.ID+"page-"+g;var r=a.selector+"page-"+g;n.classList.add("diva-page");n.style.width=p+"px";n.style.height=B+"px";n.style.left=q+"px";n.setAttribute("data-index",g);n.setAttribute("data-filename",f);n.title="Page "+(g+1);d.appendChild(n);diva.Events.publish("PageWillLoad",[g,f,r],e);C(b,g,h,p,B)}}},z=function(b){b=document.getElementById(a.ID+"row-"+b);if(null!==b){for(;b.firstChild;)b.removeChild(b.firstChild);b.parentNode.removeChild(b)}},N=function(b){b=a.rowHeight*(b+1);var k=document.getElementById(a.ID+
"outer").scrollTop;return b<k},g=function(b){b*=a.rowHeight;var k=document.getElementById(a.ID+"outer").scrollTop+a.panelHeight;return b>k},q=function(b,k){0<k?r(b)&&(G(b)?(I(b),a.lastRowLoaded=b,q(a.lastRowLoaded+1,k)):N(b)&&q(b+1,k)):r(b)&&(G(b)?(I(b),a.firstRowLoaded=b,q(a.firstRowLoaded-1,k)):g(b)&&q(b-1,k))},p=function(b,k){0<k?r(b)&&N(b)&&(z(b),a.firstRowLoaded++,p(a.firstRowLoaded,k)):r(b)&&g(b)&&(z(b),a.lastRowLoaded--,p(a.lastRowLoaded,k))},C=function(b,k,c,d,e){a.pageTimeouts.push(window.setTimeout(function(b,
A,k,c,d){G(b)&&(b=document.createElement("img"),b.src=k,b.style.width=c+"px",b.style.height=d+"px",document.getElementById(a.ID+"page-"+A).appendChild(b))}(b,k,c,d,e),a.rowLoadTimeout))},E=function(b){var k=a.currentPageIndex,c=k+b;if(!v(c))return!1;var d=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop+a.panelHeight/2:document.getElementById(a.ID+"outer").scrollLeft+a.panelWidth/2,g=!1;0>b?a.verticallyOriented?0<=c&&a.pageTopOffsets[c]+m(c,"h")+a.verticalPadding>=d&&(g=!0):0<=
c&&a.pageLeftOffsets[c]+m(c,"w")+a.horizontalPadding>=d&&(g=!0):0<b&&(a.verticallyOriented?a.pageTopOffsets[k]+m(k,"h")+a.verticalPadding<d&&(g=!0):a.pageLeftOffsets[k]+m(k,"w")+a.horizontalPadding<d&&(g=!0));return g?(a.currentPageIndex=c,0===b||E(b)||(b=a.pages[c].f,f(a.onSetCurrentPage,c,b),diva.Events.publish("VisiblePageDidChange",[c,b],e)),!0):!1},S=function(b){var k=Math.floor(a.currentPageIndex/a.pagesPerRow),c=k+parseInt(b,10),d=document.getElementById(a.ID+"outer").scrollTop,g=d+a.panelHeight/
2,f=!1;0>b?0<=c&&(a.rowHeight*k>=g||a.rowHeight*c>=d)&&(f=!0):0<b&&a.rowHeight*(k+1)<d&&r(c)&&(f=!0);return f?(a.currentPageIndex=c*a.pagesPerRow,0===b||S(b)||(b=a.currentPageIndex,diva.Events.publish("VisiblePageDidChange",[b,a.pages[b].f],e)),!0):!1},X=function(a){var b=K(!1,a),c=L(!1,a);O(a,b,c)},O=function(c,k,d){d="undefined"!==typeof d?d:0;k=a.pageTopOffsets[c]+("undefined"!==typeof k?k:0)-parseInt(a.panelHeight/2,10);d=a.pageLeftOffsets[c]+d-parseInt(a.panelWidth/2,10);b(a.outerSelector).scrollTop(k);
b(a.outerSelector).scrollLeft(d);a.currentPageIndex=c;d=a.pages[c].f;f(a.onSetCurrentPage,c,d);diva.Events.publish("VisiblePageDidChange",[c,d],e);f(a.onJump,c);diva.Events.publish("ViewerDidJump",[c],e)},u=function(c){var k=Math.floor(c/a.pagesPerRow)*a.rowHeight;b(a.outerSelector).scrollTop(k);a.currentPageIndex=c;diva.Events.publish("VisiblePageDidChange",[c,a.pages[c].f],e)},Q=function(b){return b>=a.minZoomLevel&&b<=a.maxZoomLevel?b:a.minZoomLevel},fa=function(b){return b>=a.minPagesPerRow&&
b<=a.maxPagesPerRow?b:a.maxPagesPerRow},ga=function(){a.allTilesLoaded=[];b(a.outerSelector).scrollTop(0);b(a.innerSelector).empty();a.firstPageLoaded=0;a.firstRowLoaded=-1;a.previousTopScroll=0;a.previousLeftScroll=0;for(clearTimeout(a.resizeTimer);a.pageTimeouts.length;)clearTimeout(a.pageTimeouts.pop())},T=function(){a.inGrid?ha():Z()},Z=function(){ga();a.zoomLevel=Q(a.zoomLevel);var b=a.zoomLevel;a.totalHeight=a.totalHeights[b]+a.verticalPadding*(a.numPages+1);a.totalWidth=a.totalWidths[b]+a.horizontalPadding*
(a.numPages+1);var c=a.maxHeights[b]+2*a.verticalPadding,d=Math.max(a.maxWidths[b]+2*a.horizontalPadding,a.panelWidth),c=Math.max(c,a.panelHeight),g=document.getElementById(a.ID+"inner");a.verticallyOriented?(g.style.height=Math.round(a.totalHeight)+"px",g.style.width=Math.round(d)+"px"):(g.style.height=Math.round(c)+"px",g.style.width=Math.round(a.totalWidth)+"px");var q=0,p=0;a.pageTopOffsets=[];a.pageLeftOffsets=[];for(g=0;g<a.numPages;g++)a.pageTopOffsets[g]=parseInt(a.verticallyOriented?q:(c-
m(g,"h"))/2,10),a.pageLeftOffsets[g]=parseInt(a.verticallyOriented?(d-m(g,"w"))/2:p,10),q=a.pageTopOffsets[g]+m(g,"h")+a.verticalPadding,p=a.pageLeftOffsets[g]+m(g,"w")+a.horizontalPadding;v(a.goDirectlyTo)||(a.goDirectlyTo=0);O(a.goDirectlyTo,a.verticalOffset,a.horizontalOffset);d=!1;for(g=0;g<a.numPages;g++)if(F(g))P(g),a.lastPageLoaded=g,d=!0;else if(d)break;0<=a.oldZoomLevel?(a.oldZoomLevel<a.zoomLevel?(f(a.onZoomIn,b),diva.Events.publish("ViewerDidZoomIn",[b],e)):(f(a.onZoomOut,b),diva.Events.publish("ViewerDidZoomOut",
[b],e)),f(a.onZoom,b)):a.oldZoomLevel=a.zoomLevel;a.scaleWait&&(a.scaleWait=!1);b=a.pages[a.currentPageIndex].f;f(a.onDocumentLoaded,a.currentPageIndex,b);diva.Events.publish("DocumentDidLoad",[a.currentPageIndex,b],e)},ha=function(){var b=a.currentPageIndex;a.verticalOffset=a.verticallyOriented?a.panelHeight/2:m(b,"h")/2;a.horizontalOffset=a.verticallyOriented?m(b,"w")/2:a.panelWidth/2;ga();a.pagesPerRow=fa(a.pagesPerRow);b=(a.panelWidth-a.fixedPadding*(a.pagesPerRow+1))/a.pagesPerRow;a.gridPageWidth=
b;a.rowHeight=a.fixedHeightGrid?a.fixedPadding+a.minRatio*b:a.fixedPadding+a.maxRatio*b;a.numRows=Math.ceil(a.numPages/a.pagesPerRow);a.totalHeight=a.numRows*a.rowHeight+a.fixedPadding;b=document.getElementById(a.ID+"inner");b.style.height=Math.round(a.totalHeight)+"px";b.style.width=Math.round(a.panelWidth)+"px";u(a.goDirectlyTo);var c;a.pageTopOffsets=[];a.pageLeftOffsets=[];for(var d=a.numPages,b=0;b<d;b+=a.pagesPerRow)c=Math.floor(b/a.pagesPerRow),G(c)&&(a.firstRowLoaded=0>a.firstRowLoaded?c:
a.firstRowLoaded,I(c),a.lastRowLoaded=c)},ia=function(a){27==a.keyCode&&y()},aa=function(c){var k=K(!0),d=L(!0),g=document.getElementById(a.ID+"outer");a.panelHeight=g.clientHeight-(g.scrollWidth>g.clientWidth?a.scrollbarWidth:0);a.panelWidth=g.clientWidth-(g.scrollHeight>g.clientHeight?a.scrollbarWidth:0);var g=a.panelHeight,q=a.panelWidth;b(a.outerSelector).toggleClass("diva-fullscreen");b("body").toggleClass("diva-hide-scrollbar");b(a.parentSelector).toggleClass("diva-full-width");if(a.mobileWebkit){var p=
parseInt(b(a.outerSelector).css("margin-left"),10)-parseInt(b("body").css("margin-left"),10);b(a.outerSelector).css("margin-left",p)}f(a.onModeToggle,a.inFullscreen);diva.Events.publish("ModeDidSwitch",[a.inFullscreen],e);a.inFullscreen||V();if(0<=a.oldZoomLevel&&!a.inGrid){var p=a.panelHeight,B=a.panelWidth;a.inFullscreen?(a.verticalOffset=(p-g)/2+k,a.horizontalOffset=(B-q)/2+d):(a.verticalOffset=k-(g-p)/2,a.verticalOffset=d-(q-B)/2)}c?(a.inGrid=!a.inGrid,D()):T();if(a.inFullscreen)b(document).on("keyup",
ia);else b(document).off("keyup",ia)},D=function(){T();f(a.onViewToggle,a.inGrid);diva.Events.publish("ViewDidSwitch",[a.inGrid],e)},y=function(){a.goDirectlyTo=a.currentPageIndex;a.inFullscreen=!a.inFullscreen;aa(!1)},H=function(){a.goDirectlyTo=a.currentPageIndex;a.inGrid=!a.inGrid;D()},ba=function(c){var k=b(this).offset();a.doubleClickZoom=!0;a.horizontalOffset=c.pageX-k.left;a.verticalOffset=c.pageY-k.top;a.goDirectlyTo=parseInt(b(this).attr("data-index"),10);R(c.ctrlKey?a.zoomLevel-1:a.zoomLevel+
1)},ja=function(c){var k=parseInt(b(this).attr("data-index"),10);a.goDirectlyTo=k;var d=b(this).offset(),k=m(k,"w")/b(this).width();a.horizontalOffset=(c.pageX-d.left)*k;a.verticalOffset=(c.pageY-d.top)*k;a.inGrid=!1;D()},R=function(b){var c=Q(b);if(c!==b)return!1;b=Math.pow(2,c-a.zoomLevel);a.doubleClickZoom?(a.verticalOffset*=b,a.horizontalOffset*=b,a.doubleClickZoom=!1):(a.goDirectlyTo=a.currentPageIndex,a.verticalOffset=b*K(!0),a.horizontalOffset=b*L(!0));a.oldZoomLevel=a.zoomLevel;a.zoomLevel=
c;diva.Events.publish("ZoomLevelDidChange",[c],e);Z();return!0},Y=function(b){var c=fa(b);if(c!==b)return!1;a.pagesPerRow=c;diva.Events.publish("GridRowNumberDidChange",[c],e);a.goDirectlyTo=a.currentPageIndex;ha();return!0},K=function(b,c){var d;c="undefined"===typeof c?a.currentPageIndex:c;d=b?document.getElementById(a.ID+"outer").scrollTop-a.pageTopOffsets[c]+a.panelHeight/2:a.verticallyOriented?a.panelHeight/2:m(c,"h")/2;return parseInt(d,10)},L=function(b,c){var d;c="undefined"===typeof c?a.currentPageIndex:
c;d=b?document.getElementById(a.ID+"outer").scrollLeft-a.pageLeftOffsets[c]+parseInt(a.panelWidth/2,10):a.verticallyOriented?m(c,"w")/2:a.panelWidth/2;return parseInt(d,10)},ka=function(){return{f:a.inFullscreen,g:a.inGrid,z:a.zoomLevel,n:a.pagesPerRow,i:a.enableFilename?a.pages[a.currentPageIndex].f:!1,p:a.enableFilename?!1:a.currentPageIndex+1,y:a.inGrid?!1:K(!0),x:a.inGrid?!1:L(!0)}},la=function(){var b=ka(),c=[],d;for(d in b)!1!==b[d]&&c.push(d+a.hashParamSuffix+"="+b[d]);return c.join("&")},
ma=function(){return location.protocol+"//"+location.host+location.pathname+"#"+la()},V=function(){var b=document.getElementById(a.ID+"outer");a.panelHeight=b.clientHeight-(b.scrollWidth>b.clientWidth?a.scrollbarWidth:0);a.panelWidth=b.clientWidth-(b.scrollHeight>b.clientHeight?a.scrollbarWidth:0);a.horizontalOffset=L(!0);a.verticalOffset=K(!0);O(a.currentPageIndex,a.verticalOffset,a.horizontalOffset);return!0},na=function(){a.mobileWebkit||b(a.outerSelector+", "+a.innerSelector).dragscrollable({dragSelector:".diva-dragger",
acceptPropagatedEvent:!0});b(a.outerSelector).on("dblclick",".diva-document-page",function(a){ba.call(this,a)});b(a.outerSelector).on("contextmenu",".diva-document-page",function(b){if(b.ctrlKey)return clearTimeout(a.singleClickTimeout),a.singleClick?(ba.call(this,b),a.singleClick=!1):(a.singleClick=!0,a.singleClickTimeout=setTimeout(function(){a.singleClick=!1},500)),!1});b(a.outerSelector).on("dblclick",".diva-row",function(a){ja.call(b(a.target).parent(),a)})},ca=function(a,b,c,d){return Math.sqrt((a-
b)*(a-b)+(c-d)*(c-d))},ra=function(){b(a.innerSelector).mouseover(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});b(a.innerSelector).mouseout(function(){b(this).removeClass("diva-grab")});b(a.innerSelector).mousedown(function(){b(this).removeClass("diva-grab").addClass("diva-grabbing")});b(a.innerSelector).mouseup(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});na();b(a.outerSelector).scroll(function(){var b,c=document.getElementById(a.ID+"outer").scrollTop,
d=document.getElementById(a.ID+"outer").scrollLeft;b=a.verticallyOriented||a.inGrid?c-a.previousTopScroll:d-a.previousLeftScroll;if(a.inGrid){0>b?(q(a.firstRowLoaded,-1),S(-1),p(a.lastRowLoaded,-1)):0<b&&(q(a.lastRowLoaded,1),S(1),p(a.firstRowLoaded,1));var k=document.getElementById(a.ID+"outer").scrollTop}else{if(0>b)t(a.firstPageLoaded,b),E(-1),x(a.lastPageLoaded,b);else if(0<b)t(a.lastPageLoaded,b),E(1),x(a.firstPageLoaded,b);else for(var g=a.lastPageLoaded,k=Math.max(a.firstPageLoaded,0);k<=g;k++)F(k)&&
P(k);k=a.verticallyOriented?document.getElementById(a.ID+"outer").scrollTop:document.getElementById(a.ID+"outer").scrollLeft}f(a.onScroll,k);diva.Events.publish("ViewerDidScroll",[k],e);0<b?(f(a.onScrollDown,k),diva.Events.publish("ViewerDidScrollDown",[k],e)):0>b&&(f(a.onScrollUp,k),diva.Events.publish("ViewerDidScrollUp",[k],e));a.previousTopScroll=c;a.previousLeftScroll=d;a.horizontalOffset=L(!0);a.verticalOffset=K(!0)});if(a.mobileWebkit){var c=[];c.push('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />');
c.push('<meta name="apple-mobile-web-app-capable" content="yes" />');c.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');b("head").append(c.join("\n"));a.blockMobileMove&&b("body").bind("touchmove",function(a){a.originalEvent.preventDefault();return!1});b(a.outerSelector).kinetic({triggerHardware:!0});var d=[],g=[],h=0;b(a.outerSelector).on("touchstart",".diva-document-page",function(a){2===a.originalEvent.touches.length&&(d=[a.originalEvent.touches[0].clientX,a.originalEvent.touches[0].clientY,
a.originalEvent.touches[1].clientX,a.originalEvent.touches[1].clientY],h=ca(d[2],d[0],d[3],d[1]))});b(a.outerSelector).on("touchmove",".diva-document-page",function(c){if(2===c.originalEvent.touches.length){g=[c.originalEvent.touches[0].clientX,c.originalEvent.touches[0].clientY,c.originalEvent.touches[1].clientX,c.originalEvent.touches[1].clientY];var d=ca(g[2],g[0],g[3],g[1])-h;if(!a.scaleWait)if(a.goDirectlyTo=a.currentPageIndex,a.inGrid)a.inGrid=!1,D();else a:{var k=a.zoomLevel;if(100<d&&k<a.maxZoomLevel)k++;
else if(-100>d&&k>a.minZoomLevel)k--;else break a;a.scaleWait=!0;d=b(this).offset();a.horizontalOffset=c.pageX-d.left;a.verticalOffset=c.pageY-d.top;a.goDirectlyTo=parseInt(b(this).attr("data-index"),10);R(k)}}});var C={},m=0,c=function(c){if(a.singleTap){var d={pageX:c.originalEvent.changedTouches[0].clientX,pageY:c.originalEvent.changedTouches[0].clientY};m=ca(C.pageX,d.pageX,C.pageY,d.pageY);50>m&&a.zoomLevel<a.maxZoomLevel&&(a.inGrid?ja.call(b(c.target).parent(),d):ba.call(this,d));a.singleTap=
!1;C={}}else a.singleTap=!0,C.pageX=c.originalEvent.changedTouches[0].clientX,C.pageY=c.originalEvent.changedTouches[0].clientY,a.singleTapTimeout=setTimeout(function(){a.singleTap=!1;C={}},250)};b(a.outerSelector).on("touchend",".diva-document-page",c);b(a.outerSelector).on("touchend",".diva-page",c)}if(a.enableSpaceScroll||a.enableKeyScroll)b(document).keydown(function(c){if(a.isActiveDiva){if(a.enableSpaceScroll&&32===c.keyCode||a.enableKeyScroll&&34===c.keyCode)return b(a.outerSelector).scrollTop(document.getElementById(a.ID+
"outer").scrollTop+a.panelHeight),!1;if(a.enableKeyScroll)switch(c.keyCode){case 33:return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.panelHeight),!1;case 38:return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop-a.arrowScrollAmount),!1;case 40:return b(a.outerSelector).scrollTop(document.getElementById(a.ID+"outer").scrollTop+a.arrowScrollAmount),!1;case 37:return b(a.outerSelector).scrollLeft(document.getElementById(a.ID+"outer").scrollLeft-
a.arrowScrollAmount),!1;case 39:return b(a.outerSelector).scrollLeft(document.getElementById(a.ID+"outer").scrollLeft+a.arrowScrollAmount),!1;case 36:return b(a.outerSelector).scrollTop(0),!1;case 35:return b(a.outerSelector).scrollTop(a.totalHeight),!1}}}),a.mobileWebkit?(c="onorientationchange"in window?"orientationchange":"resize",b(window).bind(c,function(b){b=a.panelWidth;var c=a.panelHeight;V();a.horizontalOffset-=(a.panelWidth-b)/2;a.verticalOffset-=(a.panelHeight-c)/2;a.goDirectlyTo=a.currentPageIndex;
T()})):b(window).resize(function(){V();clearTimeout(a.resizeTimer);a.resizeTimer=setTimeout(function(){a.goDirectlyTo=a.currentPageIndex;a.verticalOffset=K(!0);a.horizontalOffset=L(!0);T()},200)})},sa=function(){var c='<div id="'+a.ID+'tools-left" class="diva-tools-left">'+("slider"===a.enableZoomControls?'<input type="range" id="'+a.ID+'zoom-slider" class="zoom-slider" value="'+a.zoomLevel+'" min="'+a.minZoomLevel+'" max="'+a.maxZoomLevel+'">':"")+("buttons"===a.enableZoomControls?'<div id="'+a.ID+
'zoom-out-button" class="diva-zoom-out-button button" title="Zoom Out"></div><div id="'+a.ID+'zoom-in-button" class="diva-zoom-in-button button" title="Zoom In"></div>':"")+("slider"===a.enableGridControls?'<input type="range" id="'+a.ID+'grid-slider" class="grid-slider" value="'+a.pagesPerRow+'" min="'+a.minPagesPerRow+'" max="'+a.maxPagesPerRow+'">':"")+("buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-out-button" class="diva-grid-out-button button" title="Zoom Out"></div><div id="'+a.ID+
'grid-in-button" class="diva-grid-in-button button" title="Zoom In"></div>':"")+("slider"===a.enableZoomControls?'<div id="'+a.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"")+("buttons"===a.enableZoomControls?'<div id="'+a.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"")+("slider"===a.enableGridControls?'<div id="'+a.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+
a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"")+("buttons"===a.enableGridControls?'<div id="'+a.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"")+'</div><div id="'+a.ID+'tools-right" class="diva-tools-right">'+(a.enableFullscreen?'<div id="'+a.ID+'fullscreen" class="diva-fullscreen-icon button" title="Toggle fullscreen mode"></div>':"")+(a.enableLinkIcon?'<div class="diva-link-icon button" id="'+a.ID+'link-icon" style="'+
(a.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"")+(a.enableGridIcon?'<div class="diva-grid-icon button'+(a.inGrid?" diva-in-grid":"")+'" id="'+a.ID+'grid-icon" title="Toggle grid view"></div>':"")+'<div class="diva-page-nav">'+(a.enableGotoPage?'<form id="'+a.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+a.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"")+('<div class="diva-page-label">Page <span id="'+
a.ID+'current-page">1</span> of <span id="'+a.ID+'num-pages">'+a.numPages+"</span></div>")+"</div></div>";b(a.toolbarParentSelector).prepend('<div id="'+a.ID+'tools" class="diva-tools">'+c+"</div>");b(a.selector+"zoom-slider").on("input",function(a){a=parseInt(this.value,10);R(a)});b(a.selector+"zoom-slider").on("change",function(b){b=parseInt(this.value,10);b!==a.zoomLevel&&R(b)});b(a.selector+"zoom-out-button").click(function(){R(a.zoomLevel+-1)});b(a.selector+"zoom-in-button").click(function(){R(a.zoomLevel+
1)});b(a.selector+"grid-slider").on("input",function(a){a=parseInt(this.value,10);Y(a)});b(a.selector+"grid-slider").on("change",function(b){b=parseInt(this.value,10);b!==a.zoomLevel&&Y(b)});b(a.selector+"fullscreen").click(function(){y()});b(a.selector+"grid-out-button").click(function(){Y(a.pagesPerRow-1)});b(a.selector+"grid-in-button").click(function(){Y(a.pagesPerRow+1)});b(a.selector+"grid-icon").click(function(){H()});b(a.selector+"goto-page").submit(function(){var c=parseInt(b(a.selector+
"goto-page-input").val(),10)-1;v(c)?a.inGrid?u(c):X(c):alert("Invalid page number");return!1});b(a.selector+"link-icon").click(function(){b("body").prepend('<div id="'+a.ID+'link-popup" class="diva-link-popup"><input id="'+a.ID+'link-popup-input" class="diva-input" type="text" value="'+ma()+'"/></div>');if(a.inFullscreen)b(a.selector+"link-popup").addClass("in-fullscreen");else{var c=b(a.outerSelector).offset().left+a.panelWidth,c=c+(a.scrollbarWidth-240-1),d=b(a.outerSelector).offset().top+1;b(a.selector+
"link-popup").removeClass("in-fullscreen").css({top:d+"px",left:c+"px"})}b("body").mouseup(function(c){c=c.target.id;c!==a.ID+"link-popup"&&c!==a.ID+"link-popup-input"&&b(a.selector+"link-popup").remove()});b(a.outerSelector).scroll(function(){b(a.selector+"link-popup").remove()});b(a.selector+"link-popup input").click(function(){b(this).focus().select()});return!1});var d=a.inGrid?"grid":"zoom";b(a.selector+d+"-slider").show();b(a.selector+d+"-out-button").show();b(a.selector+d+"-in-button").show();
b(a.selector+d+"-slider-label").show();b(a.selector+d+"-buttons-label").show();return{updateCurrentPage:function(){document.getElementById(a.ID+"current-page").textContent=a.currentPageIndex+1},setNumPages:function(b){document.getElementById(a.ID+"num-pages").textContent=b},updateZoomSlider:function(){a.zoomLevel!==b(a.selector+"zoom-slider").val()&&b(a.selector+"zoom-slider").val(a.zoomLevel);document.getElementById(a.ID+"zoom-level").textContent=a.zoomLevel},updateZoomButtons:function(){document.getElementById(a.ID+
"zoom-level").textContent=a.zoomLevel},updateGridSlider:function(){a.pagesPerRow!==b(a.selector+"grid-slider").val()&&b(a.selector+"grid-slider").val(a.pagesPerRow);document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},updateGridButtons:function(){document.getElementById(a.ID+"pages-per-row").textContent=a.pagesPerRow},switchView:function(){b(a.selector+d+"-slider").hide();b(a.selector+d+"-out-button").hide();b(a.selector+d+"-in-button").hide();b(a.selector+d+"-slider-label").hide();
b(a.selector+d+"-buttons-label").hide();d=a.inGrid?"grid":"zoom";b(a.selector+d+"-slider").show();b(a.selector+d+"-out-button").show();b(a.selector+d+"-in-button").show();b(a.selector+d+"-slider-label").show();b(a.selector+d+"-buttons-label").show();b(a.selector+"grid-icon").toggleClass("diva-in-grid")},switchMode:function(){b(a.selector+"tools").toggleClass("diva-fullscreen-tools");a.inFullscreen?b(a.selector+"tools-left").addClass("in-fullscreen"):b(a.selector+"tools-left").removeClass("in-fullscreen")}}},
ta=function(){if(window.divaPlugins){var c=[];b.each(window.divaPlugins,function(d,g){var f=g.pluginName[0].toUpperCase()+g.pluginName.substring(1);a["enable"+f]&&g.init(a,e)&&(f=g.titleText||f+" plugin","function"===typeof g.handleClick&&(c.push('<div class="diva-'+g.pluginName+'-icon" title="'+f+'"></div>'),f=a.mobileWebkit?"touchend":"click",b(a.outerSelector).on(f,".diva-"+g.pluginName+"-icon",function(b){g.handleClick.call(this,b,a,e)})),a.plugins.push(g))});c.length&&(a.pageTools='<div class="diva-page-tools">'+
c.join("")+"</div>")}},oa=function(){clearTimeout(a.throbberTimeoutID);b(a.selector+"throbber").hide()},ua=function(a,b){incorporateZoom=function(a,b){return a/Math.pow(2,b)};getMaxZoomLevel=function(a,b){var c=Math.max(a,b);return Math.ceil(Math.log((c+1)/257)/Math.log(2))};initializeArrayWithValue=function(a,b){for(var c=a.length;c--;)a[c]=b};for(var c=a.sequences[0].canvases,d=Array(c.length),g=Array(c.length),e,f,q,p,l=b.length,h=0;h<c.length;h++)e=c[h].width,f=c[h].height,p=c[h].images[0].resource,
q=getMaxZoomLevel(e,f),p=p.service["@id"].substring(l+1),im={mx_w:e,mx_h:f,mx_z:q,fn:p},g[h]=im,d[h]=q;c=Math.min.apply(Math,d);d=0;e=100;f=Array(c+1);q=Array(c+1);l=Array(c+1);p=Array(c+1);initializeArrayWithValue(f,0);initializeArrayWithValue(q,0);initializeArrayWithValue(l,0);initializeArrayWithValue(p,0);for(var C=[],m,u,n,h=0;h<g.length;h++){m=[];for(j=0;j<c+1;j++)u=Math.floor(incorporateZoom(g[h].mx_w,c-j)),n=Math.floor(incorporateZoom(g[h].mx_h,c-j)),m.push({h:n,w:u}),f[j]+=u,q[j]+=n,l[j]=
Math.max(u,l[j]),p[j]=Math.max(n,p[j]),ratio=g[h].mx_h/g[h].mx_w,d=Math.max(ratio,d),e=Math.min(ratio,e);C[h]={d:m,m:g[h].mx_z,f:g[h].fn}}m=[];u=[];for(h=0;h<c+1;h++)m.push(f[h]/g.length),u.push(q[h]/g.length);return{item_title:"item_title",dims:{a_wid:m,a_hei:u,max_w:l,max_h:p,max_ratio:d,min_ratio:e,t_hei:q,t_wid:f},max_zoom:c,pgs:C}},va=function(){var c='<div id="'+a.ID+'throbber" class="diva-throbber"></div>';b(a.outerSelector).append(c);a.throbberTimeoutID=setTimeout(function(){b(a.selector+
"throbber").show()},a.throbberTimeout);b.ajax({url:a.objectData,cache:!0,dataType:"json",error:function(c,d,g){oa();c='<div id="'+a.ID+'error" class="diva-error"><p><strong>Error</strong></p><p>Invalid objectData. Error code: '+d+" "+g+"</p>";0===a.objectData.lastIndexOf("http",0)&&""===g&&(g=a.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0],location.hostname!==g&&(c+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>'));
c+="</div>";b(a.outerSelector).append(c)},success:function(c,d,g){c=c.hasOwnProperty("@context")&&-1!==c["@context"].indexOf("iiif")?ua(c,a.iiifServerURL):c;oa();a.pages=c.pgs;a.maxRatio=c.dims.max_ratio;a.minRatio=c.dims.min_ratio;a.itemTitle=c.item_title;a.numPages=c.pgs.length;a.maxWidths=c.dims.max_w;a.maxHeights=c.dims.max_h;a.averageWidths=c.dims.a_wid;a.averageHeights=c.dims.a_hei;a.totalHeights=c.dims.t_hei;a.totalWidths=c.dims.t_wid;a.realMaxZoom=c.max_zoom;a.maxZoomLevel=0<=a.maxZoomLevel&&
a.maxZoomLevel<=c.max_zoom?a.maxZoomLevel:c.max_zoom;a.minZoomLevel=0<=a.minZoomLevel&&a.minZoomLevel<=a.maxZoomLevel?a.minZoomLevel:0;a.zoomLevel=Q(a.zoomLevel);a.minPagesPerRow=Math.max(2,a.minPagesPerRow);a.maxPagesPerRow=Math.max(a.minPagesPerRow,a.maxPagesPerRow);a.enableFilename?(c=b.getHashParam("i"+a.hashParamSuffix),c=s(c)):c=parseInt(b.getHashParam("p"+a.hashParamSuffix),10)-1;v(c)&&(a.goDirectlyTo=c,a.currentPageIndex=c);b.each(a.plugins,function(b,c){f(c.setupHook,a)});a.enableToolbar&&
(a.toolbar=sa(),diva.Events.subscribe("VisiblePageDidChange",a.toolbar.updateCurrentPage),diva.Events.subscribe("ModeDidSwitch",a.toolbar.switchMode),diva.Events.subscribe("ViewDidSwitch",a.toolbar.switchView),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateZoomButtons),diva.Events.subscribe("GridRowNumberDidChange",a.toolbar.updateGridSlider),diva.Events.subscribe("ZoomLevelDidChange",a.toolbar.updateGridButtons));
b(a.selector+"current label").text(a.numPages);a.enableAutoTitle&&b(a.parentSelector).prepend('<div id="'+a.ID+'title" class="diva-title">'+a.itemTitle+"</div>");b(a.parentSelector).parent()[0]!==document.body||b(a.parentSelector).siblings().not("#diva-canvas-backdrop")[0]||(a.divaIsFullWindow=!0);V();v(parseInt(a.goDirectlyTo),10)||(a.goDirectlyTo=0);0<a.adaptivePadding?(c=a.zoomLevel,a.horizontalPadding=parseInt(a.averageWidths[c]*a.adaptivePadding,10),a.verticalPadding=parseInt(a.averageHeights[c]*
a.adaptivePadding,10)):(a.horizontalPadding=a.fixedPadding,a.verticalPadding=a.fixedPadding);a.pageTools.length&&(a.verticalPadding=Math.max(40,a.verticalPadding));c=parseInt(b.getHashParam("y"+a.hashParamSuffix),10);isNaN(c)?a.verticalOffset=K(!1):a.verticalOffset=c;c=parseInt(b.getHashParam("x"+a.hashParamSuffix),10);isNaN(c)?a.horizontalOffset=L(!1):a.horizontalOffset=c;a.inFullscreen?aa(!1):T();V();f(a.onReady,a);diva.Events.publish("ViewerDidLoad",[a],e);a.loaded=!0}})},da=function(){return a.loaded?
!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)};(function(){a.scrollbarWidth=b.getScrollbarWidth();a.mobileWebkit=void 0!==window.orientation;a.ID=b.generateId("diva-");a.selector="#"+a.ID;"/"===a.iiifServerURL.charAt(a.iiifServerURL.length-1)&&(a.iiifServerURL=a.iiifServerURL.slice(0,-1));a.iipServerURL&&a.iiifServerURL&&console.warn("Both settings.iipServerURL and settings.iiifServerURL are defined. Defaulting to settings.iiifServerURL.");
var c=parseInt(a.ID,10);1<c&&(a.hashParamSuffix=c);a.outerSelector=a.selector+"outer";a.innerSelector=a.selector+"inner";b(a.parentSelector).append('<div id="'+a.ID+'outer" class="diva-outer"></div>');b(a.outerSelector).append('<div id="'+a.ID+'inner" class="diva-inner diva-dragger"></div>');c=parseInt(b.getHashParam("n"+a.hashParamSuffix),10);c>=a.minPagesPerRow&&c<=a.maxPagesPerRow&&(a.pagesPerRow=c);c=b.getHashParam("z"+a.hashParamSuffix);""!==c&&(c=parseInt(c,10),c>=a.minZoomLevel&&(a.zoomLevel=
c));var c=b.getHashParam("g"+a.hashParamSuffix),d="true"===c,g=b.getHashParam("f"+a.hashParamSuffix);a.inGrid=a.inGrid&&"false"!==c||d;a.inFullscreen=a.inFullscreen&&"false"!==g||"true"===g;va();ta();ra()})();this.getItemTitle=function(){return a.itemTitle};this.gotoPageByNumber=function(a){a-=1;return v(a)?(X(a),!0):!1};this.gotoPageByIndex=function(a){return v(a)?(X(a),!0):!1};this.getCurrentPage=function(){console.warn("The call to getCurrentPage is deprecated. Use getCurrentPageIndex instead.");
return a.currentPageIndex};this.getNumberOfPages=function(){return da()?a.numPages:!1};this.getPageDimensionsAtZoomLevel=function(b,c){if(!da())return!1;c>a.maxZoomLevel&&(c=a.maxZoomLevel);var d=a.pages[b].d[parseInt(c,10)];return{width:d.w,height:d.h}};this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(a.currentPageIndex,a.zoomLevel)};this.isReady=function(){return a.loaded};this.getCurrentPageIndex=function(){return a.currentPageIndex};this.getCurrentPageFilename=
function(){return a.pages[a.currentPageIndex].f};this.getCurrentPageNumber=function(){return a.currentPageIndex+1};this.getFilenames=function(){for(var b=[],c=0;c<a.numPages;c++)b[c]=a.pages[c].f;return b};this.getZoomLevel=function(){return a.zoomLevel};this.getMaxZoomLevel=function(){return a.maxZoomLevel};this.getMaxZoomLevelForPage=function(b){return da?a.pages[b].m:!1};this.getMinZoomLevel=function(){return a.minZoomLevel};this.setZoomLevel=function(b){a.inGrid&&H();return R(b)};this.zoomIn=
function(){return this.setZoomLevel(a.zoomLevel+1)};this.zoomOut=function(){return this.setZoomLevel(a.zoomLevel-1)};this.inViewport=function(b,c,d,g,e){b-=1;d=a.pageTopOffsets[b]+d;c=a.pageLeftOffsets[b]+c;g=c+g;return n(d,d+e)&&w(c,g)};this.isPageInViewport=function(a){return F(a)};this.toggleFullscreenMode=function(){y()};this.enterFullscreenMode=function(){return a.inFullscreen?!1:(y(),!0)};this.leaveFullscreenMode=function(){return a.inFullscreen?(y(),!0):!1};this.toggleGridView=function(){H()};
this.enterGridView=function(){return a.inGrid?!1:(H(),!0)};this.leaveGridView=function(){return a.inGrid?(H(),!0):!1};this.gotoPageByName=function(a){a=s(a);return v(a)?(X(a),!0):!1};this.getPageIndex=function(a){return s(a)};this.getCurrentURL=function(){return ma()};this.getURLHash=function(){return la()};this.getState=function(){return ka()};this.getInstanceSelector=function(){return a.selector};this.getInstanceId=function(){return a.ID};this.getSettings=function(){return a};this.translateFromMaxZoomLevel=
function(b){return b/Math.pow(2,a.maxZoomLevel-a.zoomLevel)};this.translateToMaxZoomLevel=function(b){var c=a.maxZoomLevel-a.zoomLevel;return 0===c?b:b*Math.pow(2,c)};this.setState=function(b){var c;c=s(b.i);v(c)?a.goDirectlyTo=c:v(b.p)&&(a.goDirectlyTo=b.p);horizontalOffset=parseInt(b.x,10);verticalOffset=parseInt(b.y,10);b.z>=a.minZoomLevel&&b.z<=a.maxZoomLevel&&(a.zoomLevel=b.z);b.n>=a.minPagesPerRow&&b.n<=a.maxPagesPerRow&&(a.pagesPerRow=b.n);a.inFullscreen!==b.f?(a.inFullscreen=b.f,aa(a.inGrid!==
b.g),a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,O(c,a.verticalOffset,a.horizontalOffset)):(a.horizontalOffset=horizontalOffset,a.verticalOffset=verticalOffset,a.inGrid!==b.g?(a.inGrid=b.g,D()):T())};this.enableScrollable=function(){a.isScrollable||(na(),a.enableKeyScroll=a.initialKeyScroll,a.enableSpaceScroll=a.initialSpaceScroll,b(a.outerSelector).css("overflow","auto"),a.isScrollable=!0)};this.disableScrollable=function(){a.isScrollable&&(b(a.innerSelector+".diva-dragger").unbind("mousedown"),
b(a.outerSelector).unbind("dblclick"),b(a.outerSelector).unbind("contextmenu"),b(a.outerSelector).css("overflow","hidden"),a.initialKeyScroll=a.enableKeyScroll,a.initialSpaceScroll=a.enableSpaceScroll,a.enableKeyScroll=!1,a.enableSpaceScroll=!1,a.isScrollable=!1)};this.toggleOrientation=function(){a.verticallyOriented=!a.verticallyOriented;a.verticalOffset=K(!1);a.horizontalOffset=L(!1);a.goDirectlyTo=a.currentPageIndex;Z();return a.verticallyOriented};this.getPageOffset=function(b){return{top:parseInt(a.pageTopOffsets[b]),
left:parseInt(a.pageLeftOffsets[b])}};this.getPageDimensionsAtCurrentGridLevel=function(b){b=v(b)?b:a.currentPageIndex;var c=a.rowHeight-a.fixedPadding;b=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*m(b,"w")/m(b,"h"):a.gridPageWidth;return{height:parseInt(c,10),width:parseInt(b,10)}};this.activate=function(){a.isActiveDiva=!0};this.deactivate=function(){a.isActiveDiva=!1};this.destroy=function(){b("body").removeClass("diva-hide-scrollbar");b(a.parentSelector).empty().removeData("diva");b.each(a.plugins,
function(b,c){f(c.destroy,a,e)});b(a.parentSelector).removeAttr("style").removeAttr("class");diva.Events.unsubscribeAll()}};b.fn.diva=function(d){return this.each(function(){var c=b(this);if(!c.data("diva")){d.parentSelector=c;var a=new e(this,d);c.data("diva",a)}})}})(jQuery);(function(b){window.divaPlugins.push(function(){var e={},d={},c={},a,l,f,m={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:0.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,onInit:null,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},s=function(b,c){var d=b.context,e=b.size/2,f=-(b.width/2),h=-(b.height/2);d.clearRect(0,0,b.size,b.size);d.save();d.translate(e,e);d.rotate(c*Math.PI/
180);d.drawImage(a,f,h,b.width,b.height);d.restore();b.data=d.getImageData(0,0,b.size,b.size)},w=function(){for(var a in l)if(l[a].current!==l[a].previous)return!0;return!1},n=function(){s(d,l.rotation.current);P(d)},v=function(){var a=l.rotation.current,d=l.zoom.current,f=l.zoom.previous;if(a!==l.rotation.previous||d!==f){var h=b("#diva-canvas-wrapper").scrollLeft(),m=b("#diva-canvas-wrapper").scrollTop(),n=c.viewport.width/2,r=c.viewport.height/2,h=h+n-e.centerX,v=-(m+r-e.centerY),u=(l.rotation.previous-
a)*Math.PI/180,m=Math.cos(u)*h-Math.sin(u)*v+e.centerX,h=-(Math.sin(u)*h+Math.cos(u)*v)+e.centerY,d=Math.pow(2,d-f),n=d*m-n,r=d*h-r;s(e,a);b("#diva-canvas-wrapper").scrollLeft(n);b("#diva-canvas-wrapper").scrollTop(r)}if(w()){P(e);for(var t in l)l[t].previous=l[t].current}},F=function(a){var b=l[a].current!==l[a].initial;return l[a].current!==l[a].previous||b},P=function(a){var b=a.data,d=a.context.createImageData(b),e=d.data,f,h;f=0;for(h=e.length;f<h;f++)e[f]=b.data[f];b=d.data;f=l.contrast.current;
e=(1+Math.min(c.brightnessMax,Math.max(c.brightnessMin,l.brightness.current))/c.brightnessMax)*f;f=128-128*f;h=l.red.current;var m=l.green.current,n=l.blue.current,u=F("red"),r=F("green"),v=F("blue"),t=F("brightness"),s=F("contrast"),t=t||s,w,x,G,z,D,y,H,s=0;for(x=d.width;s<x;s++)for(w=0,G=d.height;w<G;w++)z=4*(w*x+s),D=b[z],y=b[z+1],H=b[z+2],0<D+y+H&&(u&&D&&(D+=h),r&&y&&(y+=m),v&&H&&(H+=n),t&&(D&&(D=D*e+f),y&&(y=y*e+f),H&&(H=H*e+f)),b[z]=D,b[z+1]=y,b[z+2]=H);a.context.clearRect(0,0,x,G);a.context.putImageData(d,
0,0)},h=function(){var a=b("#diva-canvas-wrapper").scrollLeft()*d.scaleFactor,e=b("#diva-canvas-wrapper").scrollTop()*d.scaleFactor,f=Math.min(Math.round(c.viewport.height*d.scaleFactor),c.mapSize)-4,h=Math.min(Math.round(c.viewport.width*d.scaleFactor),c.mapSize)-4;b("#diva-map-viewbox").height(f).width(h).css({top:e,left:a})},U=function(g,f){a=new Image;a.src=g;a.crossOrigin="Anonymous";a.onload=function(){e.size=Math.sqrt(a.width*a.width+a.height*a.height);e.canvas=document.getElementById("diva-canvas");
e.canvas.width=e.size;e.canvas.height=e.size;e.cornerX=(e.size-a.width)/2;e.cornerY=(e.size-a.height)/2;e.width=a.width;e.height=a.height;e.centerX=e.size/2;e.centerY=e.size/2;e.context=e.canvas.getContext("2d");e.context.drawImage(a,e.cornerX,e.cornerY,e.width,e.height);try{e.data=e.context.getImageData(0,0,e.size,e.size)}catch(g){var l='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+g.message+"</p>";if("SecurityError"!==g.name)throw g;l+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div></div>';
b("#diva-canvas-backdrop").append(l);G()}void 0===f&&(l=a,d.canvas=document.getElementById("diva-canvas-minimap"),d.size=c.mapSize,d.canvas.width=d.size,d.canvas.height=d.size,d.context=d.canvas.getContext("2d"),d.context.fillRect(0,0,d.size,d.size),d.scaleFactor=c.mapSize/e.size,d.cornerX=e.cornerX*d.scaleFactor,d.cornerY=e.cornerY*d.scaleFactor,d.width=l.width*d.scaleFactor,d.height=l.height*d.scaleFactor,d.context.drawImage(l,d.cornerX,d.cornerY,d.width,d.height),d.data=d.context.getImageData(0,
0,c.mapSize,c.mapSize),b("#diva-map-viewbox").show(),h());n();v(e);G();"function"===typeof f&&f.call(f)}},M=function(){var a=l[f],c=a.current,a=a.transform?a.transform(c):c;b("#diva-canvas-value").html(a)},t=function(){b("#diva-canvas-slider").val(l[f].current)},x=function(a){a=c.zoomWidthRatio*Math.pow(2,a);return c.proxyURL?c.proxyURL+"?f="+c.filename+"&w="+a:c.iipServerURL+"?FIF="+(c.imageDir+"/")+c.filename+"&WID="+a+"&CVT=JPEG"},r=function(){(0<l.zoom.current||c.mobileWebkit)&&b(c.selector+"throbber").addClass("canvas-throbber").show()},
G=function(){b(c.selector+"throbber").removeClass("canvas-throbber").hide()},I=function(){var a={},b=!1,d=c.localStoragePrefix+c.filename,e;for(e in l)l[e].previous!==l[e].initial&&(a[e]=l[e].previous,b=!0);b?(c.pluginIcon.addClass("new"),localStorage.setObject(d,a)):(c.pluginIcon.removeClass("new"),localStorage.removeItem(d))},z=function(a,b){c.zoomLevel=a;var f=x(a);U(f,function(){d.scaleFactor=d.size/e.size;h();I()})},N=function(a){switch(a.keyCode){case 38:return b("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-
c.arrowScrollAmount),!1;case 40:return b("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+c.arrowScrollAmount),!1;case 37:return b("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-c.arrowScrollAmount),!1;case 39:return b("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+c.arrowScrollAmount),!1}};return{init:function(a,q){if(!window.HTMLCanvasElement)return!1;b.extend(c,
m,a.canvasPlugin);c.inCanvas=!1;c.iipServerURL=a.iipServerURL;c.imageDir=a.imageDir;c.selector=a.selector;c.mobileWebkit=a.mobileWebkit;c.arrowScrollAmount=a.arrowScrollAmount;l={contrast:{initial:1,min:c.contrastMin,max:c.contrastMax,step:c.contrastStep,transform:function(a){return a.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:c.brightnessMin,max:c.brightnessMax,step:c.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(a){return a+
"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:c.rgbMin,max:c.rgbMax,step:1,title:"Adjust the blue channel"}};var p=function(){var a,b,c;for(c in l)b=l[c],a=b.initial,b.current=a,b.previous=a};p();if(b("#diva-canvas-backdrop").length)return!0;var s=[],E,x,F;for(F in c.buttons)E=
c.buttons[F],x=l[E].title,E='<div class="'+E+'" title="'+x+'"></div>',s.push(E);s='<div id="diva-canvas-backdrop">'+('<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+s.join("")+
'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>')+'<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div></div>';b("body").append(s);
c.mapSize=b("#diva-canvas-minimap").width();b("#diva-canvas-buttons div").click(function(){b("#diva-canvas-buttons .clicked").removeClass("clicked");O(b(this).attr("class"))});var O=function(a){f=a;a=l[f];b("#diva-canvas-buttons ."+f).addClass("clicked");b("#diva-canvas-mode").text(f);var c=a.current,d=a.transform?a.transform(c):c,e=document.getElementById("diva-canvas-slider");e.min=a.min;e.max=a.max;e.step=a.step;b("#diva-canvas-slider").val(c);b("#diva-canvas-value").html(d)};O("contrast");b("#diva-canvas-slider").on("input",
function(a){l[f].current=parseFloat(this.value);M();n()});b("#diva-canvas-reset-all").click(function(){for(var a in l)l[a].current=l[a].initial;M();t();n()});b("#diva-canvas-reset").click(function(){l[f].current=l[f].initial;M();t();n()});b("#diva-canvas-apply").click(function(){w()&&(r(),setTimeout(function(){l.zoom.current!==l.zoom.previous?z(l.zoom.current):(v(),G(),I())},c.throbberTimeout))});b("#diva-canvas-close").click(function(){b("body").removeClass("overflow-hidden");e.context.clearRect(0,
0,e.size,e.size);d.context.clearRect(0,0,d.size,d.size);b("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0);b("#diva-canvas-backdrop").hide();b("#diva-map-viewbox").hide();G();q.enableScrollable();b(document).off("keydown",N);p();M();t();b("#diva-canvas-buttons .clicked").removeClass("clicked");O("contrast");diva.Events.publish("CanvasViewDidHide")});b("#diva-canvas-minimise").click(function(){b("#diva-canvas-toolwindow").slideToggle("fast")});b(window).resize(function(){c.viewport={height:window.innerHeight-
a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};c.inCanvas&&h()});b("#diva-canvas-wrapper").scroll(function(){c.inCanvas&&h()});b("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(a){var e=b("#diva-canvas-minimap").offset(),g=(a.pageX-e.left)/d.scaleFactor;a=(a.pageY-e.top)/d.scaleFactor;b("#diva-canvas-wrapper").scrollTop(a-c.viewport.height/2);b("#diva-canvas-wrapper").scrollLeft(g-c.viewport.width/2)});b("#diva-canvas").mousedown(function(){b(this).addClass("grabbing")}).mouseup(function(){b(this).removeClass("grabbing")});
c.mobileWebkit?b("#diva-canvas-wrapper").kinetic():b("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0});"function"===typeof c.onInit&&c.onInit.call(this,c);return!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(a){c.viewport={height:window.innerHeight-a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};c.minZoomLevel=a.minZoomLevel;c.maxZoomLevel=a.maxZoomLevel;c.mobileWebkit&&(c.maxZoomLevel=Math.min(c.maxZoomLevel,
c.mobileWebkitMaxZoom));l.zoom.min=c.minZoomLevel;l.zoom.max=c.maxZoomLevel},handleClick:function(a,d,e){a=b(this).parent().parent();var h=b(a).attr("data-filename"),m=b(a).width()-1;d=d.zoomLevel;var n;c.zoomWidthRatio=m/Math.pow(2,d);c.pluginIcon=b(this);c.mobileWebkit&&(d=Math.min(c.maxZoomLevel,d));c.filename=h;l.zoom.initial=d;l.zoom.current=d;if(h=localStorage.getObject(c.localStoragePrefix+c.filename))for(n in h)l[n].current=h[n],n===f&&(M(),t()),"zoom"===n&&(d=h[n]);l.zoom.previous=d;b("body").addClass("overflow-hidden");
b("#diva-canvas-backdrop").show();e.disableScrollable();b(document).keydown(N);c.inCanvas=!0;e=x(d);b("#diva-canvas-info").text(b(a).attr("title"));r();diva.Events.publish("CanvasViewDidActivate",[a]);U(e)},onPageLoad:function(a,d,e){null!==localStorage.getItem(c.localStoragePrefix+d)&&b(e).find(".diva-canvas-icon").addClass("new")},destroy:function(a,c){b("#diva-canvas-backdrop").remove()}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){var e,d;return{init:function(b,a){e=b.iipServerURL;d=b.imageDir;return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(c){var a=b(this).parent().parent();c=b(a).attr("data-filename");a=b(a).width()-1;window.open(e+"?FIF="+(d+"/")+c+"&WID="+a+"&CVT=JPEG")}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){return{init:function(b,d){function c(a,c,f){var m=b.parentSelector.data("highlights");if("undefined"!==typeof m){if(m.hasOwnProperty(a)){c=d.getInstanceId()+"page-"+a;c=document.getElementById(c);f=m[a].regions;var s=m[a].colour,m=m[a].divClass,w=d.getMaxZoomLevel();b.inGrid?(a=d.getPageDimensionsAtZoomLevel(a,w).width,a=Math.log(a/c.clientWidth)/Math.log(2)):a=w-d.getZoomLevel();for(w=f.length;w--;){var n=document.createElement("div");n.style.width=
f[w].width/Math.pow(2,a)+"px";n.style.height=f[w].height/Math.pow(2,a)+"px";n.style.top=f[w].uly/Math.pow(2,a)+"px";n.style.left=f[w].ulx/Math.pow(2,a)+"px";n.style.background=s;n.style.border="1px solid #555";n.style.position="absolute";n.style.zIndex=100;n.className=m;"undefined"!==typeof f[w].divID&&(n.id=f[w].divID);c.appendChild(n)}}diva.Events.publish("HighlightCompleted")}}b.parentSelector.data("highlights",{});diva.Events.subscribe("PageWillLoad",c);d.resetHighlights=function(){for(var a=
document.getElementById(b.ID+"inner").getElementsByClassName(b.ID+"highlight"),c=a.length;c--;)a[c].parentNode.removeChild(a[c]);b.parentSelector.data("highlights",{})};d.removeHighlightsOnPage=function(a){var c=b.parentSelector.data("highlights");if(c.hasOwnProperty(a)){for(var f=d.getInstanceId()+"page-"+a,f=document.getElementById(f),m=f.getElementsByTagName("div"),s=c[a].divClass,w=m.length;w--;)m[w].className===s&&f.removeChild(m[w]);delete c[a]}};d.highlightOnPages=function(a,b,c,e){for(var s=
a.length;s--;)d.highlightOnPage(a[s],b,c,e)};d.highlightOnPage=function(a,l,f,m){"undefined"===typeof f&&(f="rgba(255, 0, 0, 0.2)");m="undefined"===typeof m?b.ID+"highlight":b.ID+"highlight "+m;d.getMaxZoomLevel();b.parentSelector.data("highlights")[a]={regions:l,colour:f,divClass:m};d.isPageInViewport(a)&&c(a,null,null);return!0};return!0},destroy:function(b,d){b.parentSelector.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"}}())})(jQuery);
